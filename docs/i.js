let t,s,i;s=.3,t=(t=1,s=.05,h=220,e=0,n=0,r=.1,o=0,a=1,c=0,l=0,u=0,f=0,d=0,w=0,p=0,g=0,m=0,x=1,y=0,M=0,E=Math,k=44100,A=2*E.PI,T=(c*=500*A/k/k),_=(h*=(1-s+2*s*E.random(s=[]))*A/k),b=0,F=0,D=0,I=1,v=0,C=0,K=0,L,N)=>{for(l*=500*A/k**3,p*=A/k,u*=A/k,f*=k,d=k*d|0,N=(e=k*e+9)+(y*=k)+(n*=k)+(r*=k)+(m*=k)|0;D<N;s[D++]=K)++C%(100*g|0)||(K=o?1<o?2<o?3<o?E.sin((b%A)**3):E.max(E.min(E.tan(b),1),-1):1-(2*b/A%2+2)%2:1-4*E.abs(E.round(b/A)-b/A):E.sin(b),K=(d?1-M+M*E.sin(A*D/d):1)*(0<K?1:-1)*E.abs(K)**a*.3*t*(D<e?D/e:D<e+y?1-(D-e)/y*(1-x):D<e+y+n?x:D<N-m?(N-D-m)/r*x:0),K=m?K/2+(m>D?0:(D<N-m?1:(N-D)/m)*s[D-m|0]/2):K),b+=(L=(h+=c+=l)*E.cos(p*F++))-L*w*(1-1e9*(E.sin(D)+1)%2),I&&++I>f&&(h+=u,_+=u,I=0),!d||++v%d||(h=_,c=T,I||=1);return(t=i.createBuffer(1,N,k)).getChannelData(0).set(s),(h=i.createBufferSource()).buffer=t,h.connect(i.destination),h.start(),h},i=new AudioContext;const h={t:!0,i:"Arial, sans-serif",h:60,o:96,l:48,u:1,p:2,init(){h.g.init(),h.m.init((()=>{h.m.level=new h.k.M,h.m.A()}))},T(t,s){let i=Math.min(t.x+t.w,s.x+s.w)-Math.max(t.x,s.x);i=i<0?0:i;let h=Math.min(t.y+t._,s.y+s._)-Math.max(t.y,s.y);return h=h<0?0:h,i*h>Number.EPSILON}};window.addEventListener("load",(()=>h.init())),h.F=class{constructor(t=0,s=0){this.x=t,this.y=s}clone(){return new h.F(this.x,this.y)}length(){return this.x+this.y===0?0:Math.sqrt(this.x*this.x+this.y*this.y)}mul(t){return this.x*=t,this.y*=t,this}normalize(){const t=this.length();return t&&(this.x/=t,this.y/=t),this}set(t,s){this.x=t,this.y=s}},h.Audio={D:[.3,0,8,.01,.01,.01,1,2.29,86,,,,,,-82,,,.42,.01],I:[.2,0,68,.02,.01,.18,2,1.89,-.3,,,,,1.4,,.3,,.59,.06,.12],v:[.15,0,382,.1,.01,.09,,2.2,-1.2,-3.8,,,,5,,,,.48,.05],SELECT:[.2,0,883,.01,.07,,1,1.74,,,366,.1,.06,,,,,.62,.01],play(s){t(...s)}},h.g={C:{K:1,L:2,N:3,D:4,S:5,v:6,P:10,R:11,H:12,G:13,B:14,O:15},U:{},W:{},Y:{click:[],Z:[],j:[]},V:{},X:{},q:{},J:{},$:0,tt(){this.st={[this.C.K]:{keyboard:["Escape"],gamepad:[9]},[this.C.R]:{keyboard:["ArrowUp","KeyW","KeyZ","KeyY"],gamepad:[12]},[this.C.P]:{keyboard:["ArrowLeft","KeyA","KeyQ"],gamepad:[14]},[this.C.G]:{keyboard:["ArrowDown","KeyS"],gamepad:[13]},[this.C.H]:{keyboard:["ArrowRight","KeyD"],gamepad:[15]},[this.C.D]:{keyboard:["Space","Enter"],gamepad:[0]},[this.C.v]:{keyboard:["KeyR"],gamepad:[]},[this.C.L]:{keyboard:["Enter"],gamepad:[0]},[this.C.S]:{keyboard:["KeyE"],gamepad:[0]}}},it(){let t=0,s=0;if(this.ht(this.C.P)?t=-1:this.ht(this.C.H)&&(t=1),this.ht(this.C.R)?s=-1:this.ht(this.C.G)&&(s=1),!t||!s){const i=.3;for(const h in this.q){const e=this.q[h];e.axes[0]&&Math.abs(e.axes[0])>i?t=e.axes[0]>0?1:-1:e.axes[2]&&Math.abs(e.axes[2])>i&&(t=e.axes[2]>0?1:-1),e.axes[1]&&Math.abs(e.axes[1])>i?s=e.axes[1]>0?1:-1:e.axes[3]&&Math.abs(e.axes[3])>i&&(s=e.axes[3]>0?1:-1)}}return{x:t,y:s}},et(t){return this.st[t]},init(){this.tt(),this.nt()},ht(t,s){const i=this.et(t);for(const t of i.keyboard)if(this.rt(t,s))return!0;for(const t of i.gamepad)if(this.ot(t,s))return!0;if(t===this.C.P)for(const t in this.q){const i=this.q[t];if(i.axes[6]&&i.axes[6]<=-.2)return!this.W["ct"]&&(s&&(this.W["ct"]=!0),!0)}else if(t===this.C.H)for(const t in this.q){const i=this.q[t];if(i.axes[6]&&i.axes[6]>=.2)return!this.W["lt"]&&(s&&(this.W["lt"]=!0),!0)}else if(t===this.C.R)for(const t in this.q){const i=this.q[t];if(i.axes[7]&&i.axes[7]<=-.2)return!this.W["ut"]&&(s&&(this.W["ut"]=!0),!0)}else if(t===this.C.G)for(const t in this.q){const i=this.q[t];if(i.axes[7]&&i.axes[7]>=.2)return!this.W["ft"]&&(s&&(this.W["ft"]=!0),!0)}return!1},ot(t,s){for(const i in this.q){const h=this.q[i].buttons[t];if(h&&h.pressed)return!this.W[t]&&(s&&(this.W[t]=!0),!0)}return!1},rt(t,s){const i=this.J[t];return!(!i||!i.time)&&(s&&(i.time=0,i.dt=!0),!0)},wt(t,s){if("function"!=typeof s)return void(this.Y[t]=[]);const i=this.Y[t].indexOf(s);i>=0&&this.Y[t].splice(i,1)},gt(t,s){this.Y[t].push(s)},xt(t,s){const i=this.V[t]||[];i.push(s),this.V[t]=i},yt(t,s){const i=this.X[t]||[];i.push(s),this.X[t]=i},nt(){document.body.onkeydown=t=>{const s=this.J[t.code];s&&s.dt||(this.J[t.code]={time:Date.now()},this.V[t.code]&&this.V[t.code].forEach((t=>t())))},document.body.onkeyup=t=>{this.J[t.code]={time:0},this.X[t.code]&&this.X[t.code].forEach((t=>t()))},window.addEventListener("gamepadconnected",(t=>{this.$++,this.q[t.gamepad.index]=t.gamepad,this.Y.Z.forEach((t=>t()))})),window.addEventListener("gamepaddisconnected",(t=>{this.$--,delete this.q[t.gamepad.index],this.Y.j.forEach((t=>t()))}))},update(){const t=navigator.getGamepads();for(const s of t)if(s){this.q[s.index]=s;for(const t in this.W)"axis6-"===t||"axis6+"===t?s.axes[6]||delete this.W[t]:"axis7-"===t||"axis7+"===t?s.axes[7]||delete this.W[t]:s.buttons[t]&&!s.buttons[t].pressed&&delete this.W[t]}}},h.m={Mt:new h.F,scale:1,Et:0,kt:0,At(t,s,i,h=0){const[e,n]=this.Tt(32,32);n.drawImage(this.images,h,s,32,16,0,0,32,16),i&&i._t(n);let r=n.getImageData(0,0,32,16);for(let s=0;s<r.data.length;s+=4){r.data[s]+r.data[s+1]+r.data[s+2]===765&&(r.data[s+0]=t[0],r.data[s+1]=t[1],r.data[s+2]=t[2])}n.putImageData(r,0,0),n.putImageData(r,0,16),r=n.getImageData(0,16,32,16);for(let t=0;t<r.data.length;t+=4){0!==r.data[t+3]&&(r.data[t+0]=255,r.data[t+1]=255,r.data[t+2]=255)}return n.putImageData(r,0,16),e},bt(t){const s=t.Ft();if(this.Et=this.Mt.x-s.x,this.kt=(this.Mt.y-s.y)*this.scale,t.level){const s=t.level.Dt;this.Et=Math.min(0,Math.max(-s.w+2*this.Mt.x,this.Et))}this.Et*=this.scale},It(t){this.level=t},clear(){this.vt.setTransform(1,0,0,1,0,0),this.vt.clearRect(0,0,window.innerWidth,window.innerHeight),this.Ct.setTransform(1,0,0,1,0,0),this.Ct.clearRect(0,0,window.innerWidth,window.innerHeight)},createLinearGradient(t,s,i,h,e="#0003",n="#fff1"){const r=this.vt.createLinearGradient(t,s,i,h);return r.addColorStop(0,e),r.addColorStop(1,n),r},Kt(){this.clear(),this.vt.setTransform(this.scale,0,0,this.scale,this.Et,this.kt),this.Ct.setTransform(this.scale,0,0,this.scale,0,0),this.level&&this.level.Kt()},Lt(){this.Ct.setTransform(1,0,0,1,0,0),this.Ct.clearRect(0,0,window.innerWidth,window.innerHeight),this.Ct.setTransform(this.scale,0,0,this.scale,0,0),this.Ct.fillStyle="rgba(0,0,0,0.4)",this.Ct.fillRect(0,0,this.Nt.width/this.scale,this.Nt.height/this.scale),this.Ct.fillStyle="#FFF",this.Ct.font="56px "+h.i,this.Ct.textAlign="center",this.Ct.textBaseline="top",this.Ct.fillText("GAME OVER",this.Mt.x,this.Mt.y-56)},St(t,s,i){let e=9*h.o,n=2*h.o,r=this.Mt.x-e/2,o=this.Mt.y-n/2;1===i?o=2*this.Mt.y-n-h.o:2===i&&(o=h.l),this.Ct.fillStyle="#0004",this.Ct.fillRect(r-12,o-12,e+24,n+24),this.Ct.fillStyle="#444",this.Ct.fillRect(r,o,e,n),this.Ct.drawImage(t.images,0,0,16,16,r,o+.25*h.o,1.75*h.o,1.75*h.o),this.Ct.lineWidth=12,this.Ct.strokeStyle="#847e87",this.Ct.strokeRect(r+6,o+6,2*h.o-12,2*h.o-12),this.Ct.fillStyle="#fff",this.Ct.font='600 31px "Courier New", monospace',this.Ct.textAlign="left",this.Ct.textBaseline="alphabetic";let a=r+24,c=o+38;s.forEach((t=>{this.Ct.fillText(t,a+2*h.o,c),c+=38}))},Pt(){this.Ct.setTransform(1,0,0,1,0,0),this.Ct.clearRect(0,0,window.innerWidth,window.innerHeight),this.Ct.setTransform(this.scale,0,0,this.scale,0,0),this.Ct.fillStyle="rgba(0,0,0,0.4)",this.Ct.fillRect(0,0,this.Nt.width/this.scale,this.Nt.height/this.scale),this.Ct.fillStyle="#FFF",this.Ct.font="56px "+h.i,this.Ct.textAlign="center",this.Ct.textBaseline="top",this.Ct.fillText("PAUSED",this.Mt.x,this.Mt.y-56)},Rt(){this.vt.fillRect(-this.Et/this.scale-h.o,-this.kt/this.scale-h.o,this.Ht.width/this.scale+2*h.o,this.Ht.height/this.scale+2*h.o)},Tt(t,s){const i=document.createElement("canvas");i.width=t,i.height=s;const h=i.getContext("2d",{alpha:!0});return h.imageSmoothingEnabled=!1,[i,h]},init(t){this.Ht=document.getElementById("c"),this.vt=this.Ht.getContext("2d",{alpha:!0}),this.vt.imageSmoothingEnabled=!1,this.Nt=document.getElementById("ui"),this.Ct=this.Nt.getContext("2d",{alpha:!0}),this.Ct.imageSmoothingEnabled=!1,this.Gt((()=>{this.nt(),t()}))},Gt(t){const s=new Image;s.onload=()=>{this.images=s;const[i,e]=this.Tt(5,3);let n=new ImageData(5,3);n.data.set([255,255,255,196,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,196,0,0,0,0,255,255,255,196,255,255,255,255,255,255,255,196,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,196,0,0,0,0,0,0,0,0]),e.putImageData(n,0,0),this.Bt=i,this.Ot=this.At([255,255,0],16,h.Ut),this.zt=this.At([255,0,0],16,h.Wt),this.Yt=this.At([0,0,0],48),this.Zt=this.At([255,255,255],32),this.jt=this.At([0,0,0],48,null,32);const[r,o]=this.Tt(h.o,h.o);o.drawImage(this.images,16,0,16,16,0,0,h.o,h.o),this.Vt=o.createPattern(r,"repeat");const[a,c]=h.m.Tt(h.o,h.o),l=c.createRadialGradient(h.l,h.l,0,h.l,h.l,h.l);l.addColorStop(0,"#000a"),l.addColorStop(.9,"#0002"),l.addColorStop(1,"#0000"),c.fillStyle=l,c.fillRect(0,0,h.o,h.o),this.Xt=a,t()},s.src="i.png"},A(t=0){if(h.g.update(),t&&this.qt){const s=(t-this.qt)/(1e3/h.h);if(this.vt.imageSmoothingEnabled=!1,this.Ct.imageSmoothingEnabled=!1,this.vt.lineWidth=1,this.vt.textBaseline="alphabetic",this.Qt)return void this.Pt();this.level.update(s),this.Kt(),h.t&&(this.Ct.fillStyle="#000",this.Ct.fillRect(60,this.Ht.height/this.scale-74,140,28),this.Ct.fillStyle="#FFF",this.Ct.font="16px monospace",this.Ct.textAlign="right",this.Ct.textBaseline="bottom",this.Ct.fillText(~~(h.h/s)+" FPS, "+Math.round(1e3*this.scale)/1e3,192,this.Ht.height/this.scale-50))}this.qt=t,requestAnimationFrame((t=>this.A(t)))},pause(){this.Qt=!0},nt(){window.addEventListener("resize",(t=>this.resize())),this.resize();const t=h.g.et(h.g.C.K);setInterval((()=>{this.Qt&&h.g.update(),t.gamepad.forEach((t=>{h.g.ot(t,!0)&&this.Jt()}))}),100);const s=()=>this.Jt();t.keyboard.forEach((t=>h.g.yt(t,s))),h.g.gt("gp_disconnect",(()=>this.pause()))},$t(){this.level=new this.level.constructor},resetTransform(){this.vt.setTransform(this.scale,0,0,this.scale,this.Et,this.kt)},resize(){const t=1920/1080;let s=window.innerHeight,i=Math.round(s*t);i>window.innerWidth&&(i=window.innerWidth,s=i/t),this.scale=s/1080,this.Mt.x=i/2/this.scale,this.Mt.y=s/2/this.scale;let h=~~((window.innerHeight-s)/2)+"px",e=~~((window.innerWidth-i)/2)+"px";this.Ht.width=i,this.Ht.height=s,this.Ht.style.top=h,this.Ht.style.left=e,this.Nt.width=i,this.Nt.height=s,this.Nt.style.top=h,this.Nt.style.left=e,this.Qt&&(clearTimeout(this.ts),this.ts=setTimeout((()=>this.Pt()),100))},ss(t,s,i){t.translate(i.x,i.y),t.rotate(s),t.translate(-i.x,-i.y)},hs(t,s,i,h){t.translate(h.x,h.y),t.scale(s,i),t.translate(-h.x,-h.y)},Jt(){this.Qt?this.unpause():this.pause()},unpause(){this.Qt&&(this.Qt=!1,this.A())}},h.es=class{constructor(t,s=0){this.level=t,this.set(s)}ns(){return this.level.rs>this.timeEnd}os(){return Math.min(1,1-(this.timeEnd-this.level.rs)/this.duration)}set(t){this.duration=t*h.h,this.timeEnd=this.level.rs+this.duration}},h.k=class{constructor(){this.Dt={},this.rs=0,this.cs=[],this.ls=[],this.items=[]}us(t,s){if(h.m.bt(t),t.fs||t.ds)t.update(s);else{h.g.ht(h.g.C.v,!0)?t.ws():h.g.ht(h.g.C.D,!0)&&t.attack();let i=h.g.it();i=new h.F(i.x,i.y),t.update(s,i.normalize());const e=t.ps();this.items.forEach((s=>{s.gs=!1,s.xs&&h.T(s.ps(),e)&&(s.gs=!0,h.g.ht(h.g.C.S,!0)&&t.ys(s))}))}}Ms(...t){this.ls.push(...t),this.Es(...t)}ks(...t){this.items.push(...t),this.Es(...t)}Es(...t){t.forEach((t=>t.level=this)),this.cs.push(...t)}removeItem(t){let s=this.items.indexOf(t);s>=0&&this.items.splice(s,1),s=this.cs.indexOf(t),s>=0&&this.cs.splice(s,1)}Kt(){this.As&&this.As(h.m.vt),this.cs.forEach((t=>t.Kt(h.m.vt))),this.Ts&&this.Ts(h.m.vt),this._s&&h.m.Lt()}bs(t,s){const i=h.m;if(!this.Fs){const[t,s]=i.Tt(2*i.Mt.x+2*h.o,2*i.Mt.y+2*h.o);s.fillStyle=i.Vt,s.fillRect(0,0,t.width,t.height),this.Fs=t}let e=Math.ceil(-i.Et/i.scale/h.o)*h.o,n=Math.ceil(-i.kt/i.scale/h.o)*h.o;t.drawImage(this.Fs,e-h.o-s,n-h.o)}update(t){if(this.rs+=t,this._s)h.g.ht(h.g.C.L,!0)&&h.m.$t();else if(!this.locked){const s=this.Ds;if(s){if(s.Is<=0)return void(this._s=!0);this.us(s,t)}this.cs.sort(((t,s)=>t.vs()-s.vs())),this.cs.forEach((i=>{i!==s&&(i.update(t),s?.ds&&i.Is>0&&i.Cs()&&s.item.Ks(i)&&i.Ls(s.item),i.action||h.Ss.Ns(i,s))}))}}},h.Ps=class{constructor(t={}){this.Rs=new h.F(t.x,t.y),this.w=t.w||0,this._=t._||0,this.Hs=0,this.Gs={},this.Bs=[],this.Os=new h.F(1,0),this.Us=1/0,this.Is=1/0,this.speed=new h.F(4,4),this.state=h.u,this.weight=0}zs(t){for(let s=this.Bs.length-1;s>=0;s--){(0,this.Bs[s])(t)&&this.Bs.splice(s,1)}}Cs(){return(!this.Ws||this.Ws.ns())&&!this.fs}Kt(t){}Ys(t){if(!this.level)return;const s=this.Rs;s.x=Math.min(this.level.Dt.w-this.w,Math.max(0,s.x)),s.y=Math.min(this.level.Dt._-this._-8,Math.max(-h.l,s.y));const i=this.ps();this.level.cs.forEach((s=>{if(s===this||!s.Zs||s.Is<=0)return;if(s instanceof h.js&&this.fs)return;const e=s.ps();h.T(i,e)&&this.Rs.set(t.x,t.y)}))}ps(){return{x:this.Rs.x,y:this.Rs.y,w:this.w,_:this._}}Ft(){return{x:this.Rs.x+this.w/2,y:this.Rs.y+this._/2}}Vs(t,s,i){if(this.Gs.Xs)return i;const e=this.Rs.clone();return this.Rs.x+=Math.round(s*t.x*this.speed.x),this.Rs.y+=Math.round(s*t.y*this.speed.y),(t.x||t.y)&&(i=h.p,this.Os.set(0==t.x?this.Os.x:t.x>0?1:-1,0==t.y?this.Os.y:t.y>0?1:-1)),this.Ys(e),i}vs(){return this.Rs.y+this._}qs(){if(!this.Ws||this.Ws.ns())return!1;const t=this.Ws.os();return t>=0&&t<=.2||t>=.4&&t<=.6||t>=.8&&t<=1}Ls(t){if(!this.Cs())return;this===this.level.Ds&&h.Audio.play(h.Audio.I),this.Ws=this.Ws||new h.es(this.level),this.Ws.set(.5),this.Is=Math.max(0,this.Is-t.Qs);const s=t.Js(this);s&&this.Bs.push(s),this.Is<=0&&this.$s&&this.$s()}update(t,s){if(this.Is<=0||this.ti)return;let i=h.u;this.Hs+=t,this.zs(t),s&&(i=this.Vs(s,t,i)),this.state!=i&&(this.Hs=0),this.state=i}},h.si=class extends h.Ps{constructor(t={}){t.w=h.o,t._=h.o,super(t),this.images=h.m.jt,this.Is=this.Us=50,this.Zs=!0,this.weight=h.o}Kt(t){if(this.Is<=0)return;let s=this.qs()?16:0;t.drawImage(this.images,0,s,16,16,this.Rs.x,this.Rs.y,this.w,this._)}update(t){super.update(t),this.Zs=this.Is>0}},h.js=class extends h.Ps{constructor(t={}){t.w=h.o,t._=h.o,super(t),this.ii=42/h.h,this.images=h.m.Ot,this.Us=this.Is=100,this.Zs=!0,this.item=t.item,this.speed.set(12,12),this.item&&(this.item.ti=this)}hi(t,s){h.m.hs(t,s,1,this.Ft())}ei(t){h.m.ss(t,.1*Math.sin(this.Hs*this.ii),this.Ft())}ni(t){if(this.Is==this.Us||this.fs)return;let s=this.Is/this.Us,i=this.Rs.x+16,h=this.Rs.y-24,e=this.w-32;t.fillStyle="#000",t.fillRect(i,h,e,8),t.fillStyle="#f00",t.fillRect(i,h,e*s,8)}ri(t){const s=this.Os.x<0;s&&this.hi(t,-1),this.item?.Kt(t),s&&this.hi(t,-1)}oi(t){t.drawImage(h.m.Xt,this.Rs.x,this.Rs.y+this._-12,this.w,24)}attack(){this.ds||this.fs||!this.item||(h.Audio.play(h.Audio.D),this.ai=this.ai||new h.es(this.level),this.ai.set(this.item.ci),this.ds=!0)}ws(){this.fs||(h.Audio.play(h.Audio.v),this.li=this.li||new h.es(this.level),this.li.set(.5),this.fs=!0)}Kt(t){if(this.Is<=0)return;let s=this.Os.x<0?16:0,i=0,e=this.images;if(this.oi(t),this.fs){let s=360*this.li.os()*3*Math.PI/180;this.Os.x<0&&(s=-s),h.m.ss(t,s,this.Ft())}else this.qs()&&(i=16),this.state===h.p&&this.ei(t);this.item&&this.ri(t,e),this.ni(t),t.drawImage(e,s,i,16,16,this.Rs.x,this.Rs.y,h.o,h.o),h.m.resetTransform()}static _t(t){t.fillStyle="#000";let s=11;t.fillRect(s,6,1,4),t.fillRect(s-2,6,1,4),t.fillRect(s-4,6,1,4),s=21,t.fillRect(s,6,1,4),t.fillRect(s+2,6,1,4),t.fillRect(s+4,6,1,4)}$s(){this.item?.ui(),this.Is>0?(this.item=new h.fi,this.item.ti=this):this.item=null}ps(){const t={x:this.Rs.x,y:this.Rs.y+this._,w:this.w,_:h.l/2};return t.y-=t._,t}ys(t){t.ti||(this.item?.ui(),this.item=t,t.gs=!1,t.ti=this,this.level.removeItem(t))}update(t,s){if(this.Is<=0)return;let i=h.u;this.Hs+=t,this.zs(t),s&&(i=this.Vs(s,t,i)),this.action&&(i=this.action(t)||i),this.state!=i&&(this.Hs=0),this.ds&&this.ai.ns()&&(this.ds=!1),this.fs&&(this.li.ns()?this.fs=!1:(s=new h.F(this.Os.x<0?-1:1,0),this.Vs(s,t,i))),this.state=i}},h.Ss={di(t,s){if(t.ds||!t.item)return!1;if(t.item.Ks(s)){const i=new h.es(t.level,.3);return t.action=function(){i.ns()&&(t.ds&&t.ai&&t.ai.ns()?t.action=null:t.ds||(t.attack(),s.Ls(t.item)))},!0}return!1},wi(t){if(t.item&&!(t.item instanceof h.fi))return!1;let s=1/0,i=null,e=null;const n=t.Ft(),r=t.ps(),o=new h.F;for(let a=0;a<t.level.items.length;a++){const c=t.level.items[a];if(c instanceof h.pi){const a=c.ps();if(h.T(a,r)){const s=new h.es(t.level,.5);return t.action=function(){s.ns()&&(t.ys(c),t.action=null)},!0}o.set(a.x+a.w/2-n.x,a.y+a._/2-n.y);const l=o.length();l<3*h.o&&s>l&&(s=l,i=o.clone(),e=c)}}if(!e)return!1;const a=new h.es(t.level,1);return i.normalize(),t.action=function(s){if(a.ns())t.action=null;else if(!t.Gs.Xs)return t.Vs(i,s,0)},!0},gi(t,s){const i=t.Ft(),e=s.Ft(),n=new h.F(e.x-i.x,e.y-i.y);if(n.length()>5*h.o)return!1;const r=new h.es(t.level,1);return n.normalize(),t.action=function(s){if(r.ns())t.action=null;else if(!t.Gs.Xs)return t.Vs(n,s,0)},!0},Ns(t,s){t instanceof h.mi||!(t instanceof h.js)||!s||t.Gs.Xs||s.Is<=0||this.wi(t)||this.di(t,s)||this.gi(t,s)}},h.pi=class extends h.Ps{constructor(t){super(t)}xi(){const t=h.m,s=this.ps(),i=t.Et/t.scale,e=t.kt/t.scale,n=Math.sin(t.level.rs/25);let r=s.x+s.w/2+i-15,o=s.y-1.5*h.l+e;t.Ct.drawImage(t.Bt,r,o+8*n,30,18),t.Ct.fillStyle="#fff";let a=2*n;r=s.x-6+i-a,o=s.y+s._+e+a,t.Ct.fillRect(r,o,6,12),t.Ct.fillRect(r,o+6,12,6),r=s.x+s.w+i+a,o=s.y-6+e-a,t.Ct.fillRect(r-6,o,12,6),t.Ct.fillRect(r,o,6,12)}yi(){this.ti&&this.Rs.set(this.ti.Rs.x+this.ti.w/2,this.ti.Rs.y-this.ti._)}ui(){this.xs&&(this.yi(),this.ti?.level.ks(this)),this.ti=null}Js(){return null}vs(){return this.Rs.y}},h.Wt=class extends h.js{constructor(t){super(t),this.images=h.m.zt,this.ii=32/h.h,this.speed.set(3,3)}static _t(t){t.fillStyle="#000";let s=6;t.fillRect(s,7,6,1),t.fillRect(s+2,7,3,2),s=20,t.fillRect(s,7,6,1),t.fillRect(s+1,7,3,2)}Ls(t){this.Is<=0||super.Ls(t)}},h.Mi=class extends h.Wt{constructor(t){super(t),this.images=h.m.Zt}},h.mi=class extends h.Wt{constructor(t){super(t),this.images=h.m.Yt,this.Us=this.Is=1e3}$s(){this.item?.ui(),this.item=null}Ls(t){this.Is<=0||super.Ls(t)}},h.Ut=class extends h.js{},h.fi=class extends h.pi{constructor(t={}){super(t),this.ci=.15,this.Qs=10}Ks(t){if(!this.ti)return!1;const s={x:this.ti.Rs.x+this.ti.w,y:this.ti.Rs.y+h.l/2,w:h.l,_:h.l};this.ti.Os.x<0&&(s.x-=this.ti.w+s.w);const i={x:t.Rs.x,y:t.Rs.y,w:t.w,_:t._};return h.T(i,s)}Kt(t){let s=this.Rs.x,i=this.Rs.y;if(this.ti&&(s=this.ti.Rs.x+this.ti.w-32,i=this.ti.Rs.y+this.ti._/2-16),this.ti.ds){const t=Math.sin(this.ti.ai.os()*Math.PI*2)*h.l;s+=Math.max(0,t)}t.drawImage(h.m.images,40,16,8,8,s,i,h.l,h.l)}Js(t){if(t instanceof h.js)return function(){return t.$s(),!0}}},h.Ei=class extends h.pi{constructor(t={}){t.w=h.l,t._=2*h.o,super(t),this.ci=.25,this.xs=!0,this.Qs=34}yi(){this.ti&&this.Rs.set(this.ti.Rs.x+this.ti.w/2,this.ti.Rs.y-this.ti._+this._/2)}Ks(t){if(!this.ti)return!1;const s=[{x:this.ti.Rs.x+this.ti.w,y:this.ti.Rs.y,w:1.7*h.o,_:h.o},{x:this.ti.Rs.x+this.ti.w,y:this.ti.Rs.y-.7*h.o,w:h.o,_:2.4*h.o}];this.ti.Os.x<0&&(s[0].x-=this.ti.w+s[0].w,s[1].x-=this.ti.w+s[1].w);const i={x:t.Rs.x,y:t.Rs.y,w:t.w,_:t._};for(let t=0;t<s.length;t++)if(h.T(i,s[t]))return!0;return!1}Kt(t){let s=this.Rs.x,i=this.Rs.y;this.ti&&(s=this.ti.Rs.x+h.l,i=this.ti.Rs.y-h.o-16);let e=0,n={x:s+this.w/2,y:i+this._/2};if(this.ti){if(this.ti?.ds){n.x=s+h.o/4,n.y=i+2*h.o;let t=this.ti.ai.os();const r=Math.PI;t<=.4?(t/=.4,e=t*r):e=t<=.8?r:0}}else e=80*Math.PI/180;e&&h.m.ss(t,e,n),t.drawImage(h.m.images,32,16,8,32,s,i,h.l,2*h.o),e&&this.ti?.ds&&h.m.ss(t,-e,n),this.ti||(h.m.resetTransform(),this.gs&&this.xi(t))}Js(t){if(!t.Zs)return;const s=t.Rs.clone(),i=this.ti.Ft(),e=t.Ft(),n=new h.F(e.x-i.x,e.y-i.y);n.normalize();const r=new h.es(this.ti.level,.3),o=1.5*h.o-t.weight;return t.Gs.Xs=!0,function(){if(r.ns())return t.Gs.Xs=!1,!0;const i=r.os(),h=t.Rs.clone();return t.Rs.set(s.x+n.x*o*i,s.y+n.y*o*i),t.Ys(h),!1}}ps(){return{x:this.Rs.x-1.5*this.w,y:this.Rs.y+1.5*this.w,w:this._,_:this.w}}},h.k.ki=class extends h.k{constructor(){super(),this.Ai=0,this.Ti=2}_i(t,s,i,e,n){if(n){let s=h.l/2,n=h.o,r=i-96,o=e-n/2,a={x:r+s/2,y:o+n/2};h.m.ss(t,Math.PI/2,a),h.m.hs(t,Math.sin(.08*this.rs),1,a),t.drawImage(h.m.images,32,16,8,32,r,o,s,n),h.m.resetTransform()}t.fillStyle=n?"#fa0":"#777",t.textBaseline="middle",t.fillText(s,i,e)}Kt(){const t=h.m.vt;let s=Math.max(2*h.o,h.m.Mt.x-500),i=Math.max(2*h.o,h.m.Mt.y-128);t.fillStyle="#0d161e",h.m.Rt(),t.font="600 64px "+h.i,t.textAlign="left",t.fillStyle="#fa0",t.fillText("TREASURE OF THE NIBELUNGS",s,i+3),t.fillStyle="#777",t.fillText("TREASURE OF THE NIBELUNGS",s,i),t.font="42px "+h.i,s+=h.l/2+114,i+=96,this._i(t,"New Game",s,i,0===this.Ai),i+=72,this._i(t,"Continue",s,i,1===this.Ai)}update(t){this.rs+=t,h.g.ht(h.g.C.R,!0)?this.Ai--:h.g.ht(h.g.C.G,!0)?this.Ai++:h.g.ht(h.g.C.L,!0)&&(h.Audio.play(h.Audio.SELECT),0===this.Ai&&(h.m.level=new h.k.bi)),this.Ai<0?this.Ai=this.Ti-1:this.Ai>=this.Ti&&(this.Ai=0)}},h.k.Fi=class extends h.k{constructor(){super(),this.Dt={w:2*h.m.Mt.x,_:8*h.o};const t=new h.Ut({x:6*h.o,y:3*h.o,item:new h.fi}),s=new h.mi({x:13*h.o,y:3*h.o,item:new h.Ei});this.Ms(t,s),this.Ds=t,this.Di=s,this.locked=!0,this.Ii=-1,this.vi=new h.es(this,6)}Kt(){super.Kt();const t=h.m.vt;t.font='600 23px "Courier New", monospace',t.fillStyle="#fffc",t.textAlign="center";const s=this.Ds,i=s.Ft(),e=this.Di.Ft();if(this.Ii<0)t.fillStyle="#111",h.m.Rt();else if(0===this.Ii)t.fillText("Move with [W][A][S][D] or arrow keys",i.x,i.y-s._);else if(1===this.Ii)t.fillText("Attack with [ENTER]",e.x,e.y-2*this.Di._);else if(2===this.Ii){const s=this.items[0];if(s){const i=s.ps();t.fillText("Pick up with [E]",i.x+i.w/2,i.y-i._-h.l-8)}}else 3===this.Ii?t.fillText("Attack with the sword",e.x,e.y-this.Di._):4===this.Ii?t.fillText("You can dodge roll with [R]",i.x,i.y-s._-h.o):5===this.Ii&&t.fillText("Right, that’s how it goes!",h.m.Mt.x,0)}As(t){if(this.Ii<0)return;const s=this.Ds,i=this.Di,e=this.items[0];if(t.fillStyle="#222",t.fillRect(s.Rs.x-h.l,s.Rs.y+s._-h.l,2*h.o,h.o),t.fillRect(i.Rs.x-h.l,i.Rs.y+i._-h.l,2*h.o,h.o),e){const s=e.ps();t.fillRect(s.x-h.l,s.y+s._-1.5*h.l,3*h.o,1.25*h.o)}}Ts(t){const s=h.m;if(this.Ii<0){const t=this.vi.os(),i=1-(t>=.5?2-2*t:1);s.hs(s.Ct,1,1-i,s.Mt),s.St(this.Ds,["Before heading out, let’s","think back on my training.","How did it go again?"],0),s.Ct.setTransform(s.scale,0,0,s.scale,0,0)}if(5!==this.Ii)return;const i=Math.sin(this.rs/25);let e=this.Dt.w-h.o+8*i,n=this.Dt._/2+9;const r={x:e,y:n};t.fillStyle="#fff",t.textAlign="right",t.fillText("Continue",e-22,n-8);let o=-Math.PI/2;s.ss(t,o,r),t.drawImage(s.Bt,e,n,30,18),s.ss(t,-o,r)}update(t){const s=this.Ds,i=h.g;if(-1===this.Ii)i.ht(i.C.L,!0)&&this.vi.set(0),this.vi.ns()&&(this.locked=!1,this.Ii=0);else if(0===this.Ii)(i.ht(i.C.R)||i.ht(i.C.H)||i.ht(i.C.G)||i.ht(i.C.P))&&(this.Ii=1);else if(1===this.Ii)this.Di.item instanceof h.Ei||(this.items[0].Rs.x=this.Di.Rs.x+2*h.o,this.Ii=2);else if(2===this.Ii)s.item instanceof h.Ei&&(this.Ii=3);else if(3===this.Ii)this.Di.Is<this.Di.Us-s.item.Qs&&(this.Ii=4);else if(4===this.Ii)i.ht(i.C.v)&&(this.Ii=5);else if(5===this.Ii){if(s.Ft().x>=this.Dt.w-h.l)return void h.m.It(new h.k.M)}super.update(t)}},h.k.bi=class extends h.k{constructor(){super(),this.Ci=["Ez enwas niht anders","wan gestéinẹ unde golt.","unt ob man al die werlde","het dâ von versolt,","sîn wǽré niht mínner","einer marke wert."],this.Ki=["Ê daz der künee rîche","wider wære komen,","die wîle hete Hagene","den schaz vil gar genomen.","","er sanctẹ in dâ ze Lôche","allen in den Rîn.","er wandẹ er soldẹ in niezen:","des enkunde niht gesîn."],this.Li=["The legendary treasure of the Nibelungs:","Gems and gold more than one could ever hope to spent.","","While the king and his men where away, Hagen stole it","all and sunk the treasure in the Rhine at Lochheim.","But he was killed before being able to retrieve the riches.","","Betting on its the existance,","many set off to look for the treasure."],this.Ni=0,this.Si=new h.es(this,2);this.Ci.concat(this.Ki).forEach((t=>{const s=h.m.vt.measureText(t);this.Ni=Math.max(this.Ni,s.width)}))}Kt(){const t=h.m.vt;t.fillStyle="#0d161e",h.m.Rt();let s=2*h.o,i=s,e=this.Ni+h.o,n=49*(this.Ci.length+this.Ki.length)+1.5*h.o+16;if(t.fillStyle="#e5c382",t.fillRect(s-h.l,i-h.o,e,n),t.font='italic 40px "Times New Roman", serif',t.textAlign="center",t.fillStyle="#000",s+=this.Ni/2,!this.Si.ns()){const s=this.Si.os();i+=(1-s)*h.l,t.fillStyle="#000000"+Math.round(255*s).toString(16).padStart(2,"0")}if(this.Ci.forEach((h=>{t.fillText(h,s,i),i+=49})),this.Si.ns()){if(i+=49,!this.Pi.ns()){const s=this.Pi.os();i+=(1-s)*h.l,t.fillStyle="#000000"+Math.round(255*s).toString(16).padStart(2,"0")}this.Ki.forEach((h=>{t.fillText(h,s,i),i+=49}))}if(this.Pi?.ns()){const n=this.Ri.os();if(s=e+2.5*h.o,i=2*h.o+(1-n)*h.l,t.font="32px "+h.i,t.textAlign="left",t.fillStyle="#ffffff"+Math.round(255*n).toString(16).padStart(2,"0"),this.Li.forEach((h=>{t.fillText(h,s,i),i+=49})),this.Ri.ns()){i+=49;let e=h.l/2,n=h.o,r=s+n/2,o=i-n/2,a={x:r+e/2,y:o+n/2};h.m.ss(t,Math.PI/2,a),h.m.hs(t,Math.sin(.08*this.rs),1,a),t.drawImage(h.m.images,32,16,8,32,r,o,e,n),h.m.resetTransform(),t.font="32px "+h.i,t.fillStyle="#fa0",t.textBaseline="middle",t.fillText("Continue",s+n+32,i)}}}update(t){this.rs+=t,this.Si.ns()&&!this.Pi?this.Pi=new h.es(this,2):this.Pi&&this.Pi.ns()&&!this.Ri&&(this.Ri=new h.es(this,2)),h.g.ht(h.g.C.L,!0)&&(this.Si.ns()?this.Pi&&!this.Pi.ns()?this.Pi.set(0):this.Ri&&!this.Ri.ns()?this.Ri.set(0):(h.Audio.play(h.Audio.SELECT),h.m.level=new h.k.Hi):this.Si.set(0))}},h.k.M=class extends h.k{constructor(){super(),this.Gi=36,this.Bi=2,this.Dt={w:h.o*this.Gi,_:h.o*this.Bi};let t=new h.Ut({x:h.o,item:new h.Ei}),s=new h.Mi({x:12*h.o,item:new h.Ei}),i=new h.Mi({x:13*h.o});s.Os.x=-1,i.Os.x=-1,this.Ms(t,s,i),this.ks(new h.si({x:3*h.o})),this.Ds=t,this.vi=new h.es(this,10)}Oi(t,s,i,h,e){const n=t.fillStyle;t.fillRect(s,i,h,e),t.fillStyle="#0001",t.fillRect(s,i,12,e),t.fillStyle="#fff1",t.fillRect(s+h-12,i,12,e),t.fillStyle=n}As(t){const s=h.m,i=12*Math.sin(this.rs/50);if(this.bs(t,i),this.Ui)t.drawImage(this.Ui,0,-h.l/2);else{const[t,i]=s.Tt(this.Dt.w,this.Dt._+4*h.o),e=h.l;i.fillStyle="#0003",i.fillRect(0,e+1.25*h.o,this.Dt.w,this.Dt._),i.fillStyle="#544";for(let t=0;t<this.Gi;t+=4)this.Oi(i,t*h.o,4,h.l,2*h.o);for(let t=0;t<this.Gi;t++)for(let n=0;n<this.Bi;n++){let r=t*h.o,o=n*h.o+e;i.drawImage(s.images,0,0,16,16,r,o,h.o,h.o)}i.fillStyle=s.createLinearGradient(0,e,0,this.Dt._,"#0001"),i.fillRect(0,e,this.Dt.w,this.Dt._),i.fillStyle="#544",i.fillRect(0,this.Dt._-6+e,this.Dt.w,24),this.Ui=t}}Ts(t){this.vi.ns()||h.m.St(this.Ds,["My crew is already waiting. I","just have to make it to the ship.","But it seems there are pirates","in the harbor."],2),t.fillStyle="#544";let s=this.Bi*h.o-h.l/2,i=2*h.o;for(let e=0;e<this.Gi;e+=4)this.Oi(t,e*h.o,s,h.l,i)}update(t){super.update(t);this.Ds.Ft().x>=this.Dt.w-h.l&&h.m.It(new h.k.Hi)}},h.k.Hi=class extends h.k{constructor(){super(),this.Gi=24,this.Bi=6,this.Dt={w:h.o*this.Gi,_:h.o*this.Bi};const t=new h.Ut({x:2*h.o,y:2*h.o,item:new h.fi}),s=new h.Wt({x:12*h.o,y:2*h.o,item:new h.Ei});s.Os.x=-1,this.Ms(t,s);const i=new h.Ei({x:4*h.o,y:4.5*h.o});this.ks(i),this.Ds=t}As(t){const s=h.m;if(this.bs(t,this.zi),this.Wi&&t.drawImage(this.Wi,-6,-h.o),this.Yi)t.drawImage(this.Yi,0,0);else{const t=6,[i,e]=h.m.Tt(this.Dt.w+1.5*t,this.Dt._+.5*t+h.o);e.lineWidth=t;let n=t/2;e.strokeStyle="#8f563b",e.strokeRect(0,n,this.Dt.w+e.lineWidth+n,this.Dt._+n);for(let i=0;i<this.Gi;i++)for(let n=0;n<this.Bi;n++){let r=i*h.o,o=t+n*h.o;e.drawImage(s.images,0,0,16,16,r,o,h.o,h.o)}e.fillStyle="#5a3c2e",e.fillRect(n-e.lineWidth,this.Dt._,this.Dt.w+2*e.lineWidth,h.o),e.fillStyle=h.m.createLinearGradient(0,this.Dt._,0,this.Dt._+h.o,"#0003","#4b73ac30"),e.fillRect(n-e.lineWidth,this.Dt._,this.Dt.w+2*e.lineWidth,h.o),e.fillStyle=h.m.createLinearGradient(0,0,0,this.Dt._),e.fillRect(0,0,this.Dt.w+n,this.Dt._),this.Yi=i}}Ts(t){if(this.Zi)t.drawImage(this.Zi,-this.zi,this.Dt._+.5,h.o*(this.Gi+1),h.o);else{const[t,s]=h.m.Tt(h.o*(this.Gi+1),h.o);for(let t=0;t<=this.Gi;t++)s.drawImage(h.m.images,32,0,16,16,t*h.o,0,h.o,h.o);this.Zi=t}if(this.Wi)t.drawImage(this.Wi,-6,this.Dt._-h.o);else{const t=12+this.Dt.w,s=h.o,[i,e]=h.m.Tt(t,s);e.lineWidth=6,e.fillStyle="#5a3c2e",e.fillRect(0,0,this.Dt.w+2*e.lineWidth,18),e.fillStyle="#0002",e.fillRect(0,12,this.Dt.w+2*e.lineWidth,6),e.fillStyle="#fff1",e.fillRect(0,0,this.Dt.w+2*e.lineWidth,6);const n=this.Dt.w/h.o+1;for(let t=0;t<=n;t++){let s=t*h.o,i=18,n=h.o+1;e.fillStyle="#5a3c2e",e.fillRect(s,i,18,n),e.fillStyle="#0002",e.fillRect(s,i,6,n),e.fillStyle="#fff1",e.fillRect(s+12,i,6,n)}this.Wi=i}}update(t){super.update(t),this.zi=this.rs%25/25*h.o}},h.k.ji=class extends h.k{constructor(){super()}};