const t={t:!0,i:'"Courier New", monospace',h:60,init(){t.o.init(),t.Audio.init(),t.u.init((()=>{t.u.level=new t.p.l,t.u.m()}))}};window.addEventListener("load",(()=>t.init())),t.g=class{constructor(t=0,s=0){this.x=t,this.y=s}clone(){return new t.g(this.x,this.y)}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const t=this.length();this.x/=t,this.y/=t}set(t,s){this.x=t,this.y=s}},t.Audio={M:{},A:.2,D:{K:(t,s,i)=>(s[t]=2*Math.random()-1,i[t]=2*Math.random()-1,!1)},init(){this.F=new window.AudioContext,this.gain=this.F.createGain(),this.gain.connect(this.F.destination),this.volume(.1);for(const t in this.D){const s=2*this.F.sampleRate,i=this.F.createBuffer(2,s,this.F.sampleRate),h=i.getChannelData(0),e=i.getChannelData(1);for(let i=0;i<s&&!this.D[t](i,h,e);i++);this.M[t]=i}},_(){0!==this.gain.gain.value&&(this.A=this.gain.gain.value,this.gain.gain.value=0)},play(t,s,i=1,h="dec"){const e=this.F.createGain();e.connect(this.gain),"inc"===h?(e.gain.setValueAtTime(0,this.F.currentTime),e.gain.linearRampToValueAtTime(i,this.F.currentTime+s-.01)):(e.gain.setValueAtTime(i,this.F.currentTime),e.gain.linearRampToValueAtTime(0,this.F.currentTime+s-.01));const n=this.M[t.name],o=this.F.createBufferSource();return o.buffer=n,o.connect(e),o.start(0,0,s),o},P(t,s,i="sine",h="dec"){const e=this.F.createGain();e.connect(this.gain),"inc"===h?(e.gain.setValueAtTime(0,this.F.currentTime),e.gain.linearRampToValueAtTime(1,this.F.currentTime+s-.01)):(e.gain.setValueAtTime(1,this.F.currentTime),e.gain.linearRampToValueAtTime(0,this.F.currentTime+s-.01));const n=this.F.createOscillator();return n.type=i,n.frequency.setValueAtTime(t,this.F.currentTime),n.connect(e),n.start(),n.stop(this.F.currentTime+s),n},k(){this.gain.gain.value=this.A},volume(t){this.gain.gain.value=Math.min(1,Math.max(0,t))}},t.o={v:{T:1,S:2,O:3,U:10,C:11,N:12,G:13,L:14,I:15},R:{},V:{},q:{click:[],B:[],H:[]},W:{},X:{},Y:{},Z:{},j:new t.g,J:0,$(){this.tt={[this.v.T]:{keyboard:["Escape"],gamepad:[9]},[this.v.C]:{keyboard:["ArrowUp","KeyW","KeyZ","KeyY"],gamepad:[12]},[this.v.U]:{keyboard:["ArrowLeft","KeyA","KeyQ"],gamepad:[14]},[this.v.G]:{keyboard:["ArrowDown","KeyS"],gamepad:[13]},[this.v.N]:{keyboard:["ArrowRight","KeyD"],gamepad:[15]},[this.v.S]:{keyboard:["Space","Enter"],gamepad:[0]}}},st(){let t=0,s=0;if(this.it(this.v.U)?t=-1:this.it(this.v.N)&&(t=1),this.it(this.v.C)?s=-1:this.it(this.v.G)&&(s=1),!t||!s){const i=.3;for(const h in this.Y){const e=this.Y[h];e.axes[0]&&Math.abs(e.axes[0])>i?t=e.axes[0]>0?1:-1:e.axes[2]&&Math.abs(e.axes[2])>i&&(t=e.axes[2]>0?1:-1),e.axes[1]&&Math.abs(e.axes[1])>i?s=e.axes[1]>0?1:-1:e.axes[3]&&Math.abs(e.axes[3])>i&&(s=e.axes[3]>0?1:-1)}}return{x:t,y:s}},ht(t){return this.tt[t]},init(){this.$(),this.et()},it(t,s){const i=this.ht(t);for(const t of i.keyboard)if(this.nt(t,s))return!0;for(const t of i.gamepad)if(this.ot(t,s))return!0;if(t===this.v.U)for(const t in this.Y){const i=this.Y[t];if(i.axes[6]&&i.axes[6]<=-.2)return!this.V["rt"]&&(s&&(this.V["rt"]=!0),!0)}else if(t===this.v.N)for(const t in this.Y){const i=this.Y[t];if(i.axes[6]&&i.axes[6]>=.2)return!this.V["ct"]&&(s&&(this.V["ct"]=!0),!0)}else if(t===this.v.C)for(const t in this.Y){const i=this.Y[t];if(i.axes[7]&&i.axes[7]<=-.2)return!this.V["dt"]&&(s&&(this.V["dt"]=!0),!0)}else if(t===this.v.G)for(const t in this.Y){const i=this.Y[t];if(i.axes[7]&&i.axes[7]>=.2)return!this.V["ut"]&&(s&&(this.V["ut"]=!0),!0)}return!1},ot(t,s){for(const i in this.Y){const h=this.Y[i].buttons[t];if(h&&h.pressed)return!this.V[t]&&(s&&(this.V[t]=!0),!0)}return!1},nt(t,s){const i=this.Z[t];return!(!i||!i.time)&&(s&&(i.time=0,i.wt=!0),!0)},lt(t,s){if("function"!=typeof s)return void(this.q[t]=[]);const i=this.q[t].indexOf(s);i>=0&&this.q[t].splice(i,1)},ft(t,s){this.q[t].push(s)},gt(t,s){const i=this.W[t]||[];i.push(s),this.W[t]=i},yt(t,s){const i=this.X[t]||[];i.push(s),this.X[t]=i},et(){document.body.onkeydown=t=>{const s=this.Z[t.code];s&&s.wt||(this.Z[t.code]={time:Date.now()},this.W[t.code]&&this.W[t.code].forEach((t=>t())))},document.body.onkeyup=t=>{this.Z[t.code]={time:0},this.X[t.code]&&this.X[t.code].forEach((t=>t()))},document.body.onmousemove=t=>{this.j.x=t.clientX,this.j.y=t.clientY},document.body.onclick=t=>{this.q.click.forEach((t=>t(this.j.clone())))},window.addEventListener("gamepadconnected",(t=>{this.J++,this.Y[t.gamepad.index]=t.gamepad,this.q.B.forEach((t=>t()))})),window.addEventListener("gamepaddisconnected",(t=>{this.J--,delete this.Y[t.gamepad.index],this.q.H.forEach((t=>t()))}))},update(){const t=navigator.getGamepads();for(const s of t)if(s){this.Y[s.index]=s;for(const t in this.V)"axis6-"===t||"axis6+"===t?s.axes[6]||delete this.V[t]:"axis7-"===t||"axis7+"===t?s.axes[7]||delete this.V[t]:s.buttons[t]&&!s.buttons[t].pressed&&delete this.V[t]}}},t.u={Mt:new t.g,scale:1,Et:0,xt:0,clear(){this.F.clearRect(0,0,window.innerWidth,window.innerHeight),this.At.clearRect(0,0,window.innerWidth,window.innerHeight)},bt(){this.F.setTransform(this.scale,0,0,this.scale,this.Et,this.xt),this.At.setTransform(this.scale,0,0,this.scale,0,0),this.clear(),this.level&&this.level.bt()},Dt(){this.At.setTransform(this.scale,0,0,this.scale,0,0),this.At.clearRect(0,0,window.innerWidth,window.innerHeight),this.At.fillStyle="rgba(0,0,0,0.4)",this.At.fillRect(0,0,window.innerWidth,window.innerHeight),this.At.fillStyle="#FFF",this.At.font="normal 56px "+t.i,this.At.textAlign="center",this.At.textBaseline="top",this.At.fillText("PAUSED",this.Mt.x,60)},Kt(t,s){const i=document.createElement("canvas");i.width=t,i.height=s;const h=i.getContext("2d",{alpha:!0});return h.imageSmoothingEnabled=!1,[i,h]},init(t){this.Ft=document.getElementById("c"),this.F=this.Ft.getContext("2d",{alpha:!0}),this.F.imageSmoothingEnabled=!1,this._t=document.getElementById("ui"),this.At=this._t.getContext("2d",{alpha:!0}),this.At.imageSmoothingEnabled=!1,this.Pt((()=>{this.et(),t()}))},Pt(t){const s=new Image;s.onload=()=>{this.images=s,t()},s.src="i.png"},m(s=0){if(t.o.update(),s&&this.kt){const i=(s-this.kt)/(1e3/t.h);if(this.F.imageSmoothingEnabled=!1,this.At.imageSmoothingEnabled=!1,this.vt)return void this.Dt();this.level.update(i),this.bt(),t.t&&(this.At.fillStyle="#000",this.At.fillRect(40,window.innerHeight-45,140,28),this.At.fillStyle="#FFF",this.At.font="bold 16px "+t.i,this.At.textAlign="right",this.At.textBaseline="bottom",this.At.fillText(~~(t.h/i)+" FPS / "+this.scale,160,window.innerHeight-22))}this.kt=s,requestAnimationFrame((t=>this.m(t)))},pause(){this.vt=!0,t.Audio._()},et(){window.addEventListener("resize",(t=>this.resize())),this.resize();const s=t.o.ht(t.o.v.T);setInterval((()=>{this.vt&&t.o.update(),s.gamepad.forEach((s=>{t.o.ot(s,!0)&&this.Tt()}))}),100);const i=()=>this.Tt();s.keyboard.forEach((s=>t.o.yt(s,i))),t.o.ft("gp_disconnect",(()=>this.pause())),t.o.ft("click",(t=>{this.vt||this.level&&this.level.St(t)}))},Ot(){this.level=new this.level.constructor},resize(){this.Ft.width=window.innerWidth,this.Ft.height=window.innerHeight,this._t.width=window.innerWidth,this._t.height=window.innerHeight,this.Mt.x=Math.floor(this.Ft.width/2),this.Mt.y=Math.floor(this.Ft.height/2),this.vt&&(clearTimeout(this.Ut),this.Ut=setTimeout((()=>this.Dt()),100))},Tt(){this.vt?this.unpause():this.pause()},unpause(){this.vt&&(this.vt=!1,t.Audio.k(),this.m())}},t.p=class{constructor(){this.Ct=!1,this.Nt=0,this.Gt=[],this.Lt=[],this.It=null,this.Rt={p1:null,p2:null}}zt(...t){this.Lt.push(...t),this.Gt.push(...t)}St(t){if(!this.Ct)for(const s of this.Lt)if(s.Vt(t)&&this.Rt.p2!==s){this.Rt.p1=s;break}}bt(){this.Ct?this.qt(t.u.F):this.Gt.forEach((s=>s.bt(t.u.F)))}qt(s){const i=t.u.Mt;s.font="bold 36px "+t.i,s.textAlign="center",s.fillStyle="#DDD",s.fillText("GAME OVER",i.x,i.y)}update(s){if(this.Nt+=s,this.Ct)t.o.it(t.o.v.S,!0)&&t.u.Ot();else{if(this.It){const s=t.u;s.Et=s.Mt.x+this.It.Bt.x-this.It.w/2,s.xt=s.Mt.y+this.It.Bt.y-this.It.Ht/2-64}const i=t.o.st();this.Gt.sort(((t,s)=>t.Wt()-s.Wt())),this.Gt.forEach((t=>{t===this.Rt.p1?t.update(s,i):t.update(s)}))}}},t.Xt=class{constructor(s={}){this.Bt=new t.g(s.x,s.y),this.w=s.w||0,this.Ht=s.Ht||0,this.Yt=1/0,this.speed=new t.g}bt(t){}Vt(t){return this.Bt.x<=t.x&&t.x<=this.Bt.x+this.w&&this.Bt.y<=t.y&&t.y<=this.Bt.y+this.Ht}Wt(){return this.Bt.y+this.Ht}update(t,s){s&&(this.Bt.x+=Math.round(t*s.x*this.speed.x),this.Bt.y+=Math.round(t*s.y*this.speed.y))}},t.Qt=class extends t.Xt{constructor(t={}){t.w=64,t.Ht=64,super(t),this.speed.x=8,this.speed.y=8}update(t,s){super.update(t,s),this.It&&(this.Bt.x=Math.min(this.It.Bt.x+this.It.w-this.w,Math.max(this.It.Bt.x,this.Bt.x)),this.Bt.y=Math.min(this.It.Bt.y+this.It.Ht-this.Ht,Math.max(this.It.Bt.y,this.Bt.y)))}},t.Zt=class extends t.Qt{constructor(t){super(t)}},t.jt=class extends t.Qt{constructor(t){super(t)}bt(t){t.fillStyle="#ff0000",t.fillRect(Math.round(this.Bt.x),Math.round(this.Bt.y),this.w,this.Ht)}},t.Jt=class extends t.Qt{constructor(t){super(t)}},t.p.l=class extends t.p{constructor(){super();const s=new t.jt;this.zt(s),this.It=new t.$t({x:0,y:0}),this.It.add(s),this.Gt.push(this.It),this.Rt.p1=this.Lt[0]}},t.ts=class extends t.Xt{constructor(t){super(t),this.ss=[]}Wt(){return this.Bt.y}},t.$t=class extends t.ts{constructor(t){super(t),this.Yt=100,this.hs=8,this.es=4,this.ns=96,this.w=this.hs*this.ns,this.Ht=this.es*this.ns}add(...s){s.forEach((s=>{s.It=this,s instanceof t.jt?s.Bt.set(this.Bt.x+this.w-this.ns,this.Bt.y+this.Ht/2-s.Ht/2):s instanceof t.Jt||t.Zt})),this.ss.push(...s)}bt(s){s.fillStyle="#8f563b",s.fillRect(this.Bt.x-3,this.Bt.y-3,this.w+6,this.Ht+3);for(let i=0;i<this.hs;i++)for(let h=0;h<this.es;h++){const e=this.Bt.x+i*this.ns,n=this.Bt.y+h*this.ns;s.drawImage(t.u.images,0,0,32,32,e,n,this.ns,this.ns)}}},t.os=class extends t.ts{constructor(t){super(t)}};