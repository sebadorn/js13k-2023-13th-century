const t={t:!0,i:'"Courier New", monospace',h:120,o:96,init(){t.u.init(),t.Audio.init(),t.l.init((()=>{t.l.level=new t.m.p,t.l.g()}))}};window.addEventListener("load",(()=>t.init())),t.M=class{constructor(t=0,s=0){this.x=t,this.y=s}clone(){return new t.M(this.x,this.y)}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const t=this.length();this.x/=t,this.y/=t}set(t,s){this.x=t,this.y=s}},t.Audio={A:{},D:.2,K:{_:(t,s,i)=>(s[t]=2*Math.random()-1,i[t]=2*Math.random()-1,!1)},init(){this.F=new window.AudioContext,this.gain=this.F.createGain(),this.gain.connect(this.F.destination),this.volume(.1);for(const t in this.K){const s=2*this.F.sampleRate,i=this.F.createBuffer(2,s,this.F.sampleRate),h=i.getChannelData(0),e=i.getChannelData(1);for(let i=0;i<s&&!this.K[t](i,h,e);i++);this.A[t]=i}},k(){0!==this.gain.gain.value&&(this.D=this.gain.gain.value,this.gain.gain.value=0)},play(t,s,i=1,h="dec"){const e=this.F.createGain();e.connect(this.gain),"inc"===h?(e.gain.setValueAtTime(0,this.F.currentTime),e.gain.linearRampToValueAtTime(i,this.F.currentTime+s-.01)):(e.gain.setValueAtTime(i,this.F.currentTime),e.gain.linearRampToValueAtTime(0,this.F.currentTime+s-.01));const n=this.A[t.name],o=this.F.createBufferSource();return o.buffer=n,o.connect(e),o.start(0,0,s),o},P(t,s,i="sine",h="dec"){const e=this.F.createGain();e.connect(this.gain),"inc"===h?(e.gain.setValueAtTime(0,this.F.currentTime),e.gain.linearRampToValueAtTime(1,this.F.currentTime+s-.01)):(e.gain.setValueAtTime(1,this.F.currentTime),e.gain.linearRampToValueAtTime(0,this.F.currentTime+s-.01));const n=this.F.createOscillator();return n.type=i,n.frequency.setValueAtTime(t,this.F.currentTime),n.connect(e),n.start(),n.stop(this.F.currentTime+s),n},T(){this.gain.gain.value=this.D},volume(t){this.gain.gain.value=Math.min(1,Math.max(0,t))}},t.u={v:{S:1,O:2,U:3,C:10,I:11,L:12,N:13,G:14,R:15},B:{},V:{},q:{click:[],H:[],W:[]},X:{},Y:{},Z:{},j:{},J:new t.M,$:0,tt(){this.st={[this.v.S]:{keyboard:["Escape"],gamepad:[9]},[this.v.I]:{keyboard:["ArrowUp","KeyW","KeyZ","KeyY"],gamepad:[12]},[this.v.C]:{keyboard:["ArrowLeft","KeyA","KeyQ"],gamepad:[14]},[this.v.N]:{keyboard:["ArrowDown","KeyS"],gamepad:[13]},[this.v.L]:{keyboard:["ArrowRight","KeyD"],gamepad:[15]},[this.v.O]:{keyboard:["Space","Enter"],gamepad:[0]}}},it(){let t=0,s=0;if(this.ht(this.v.C)?t=-1:this.ht(this.v.L)&&(t=1),this.ht(this.v.I)?s=-1:this.ht(this.v.N)&&(s=1),!t||!s){const i=.3;for(const h in this.Z){const e=this.Z[h];e.axes[0]&&Math.abs(e.axes[0])>i?t=e.axes[0]>0?1:-1:e.axes[2]&&Math.abs(e.axes[2])>i&&(t=e.axes[2]>0?1:-1),e.axes[1]&&Math.abs(e.axes[1])>i?s=e.axes[1]>0?1:-1:e.axes[3]&&Math.abs(e.axes[3])>i&&(s=e.axes[3]>0?1:-1)}}return{x:t,y:s}},et(t){return this.st[t]},init(){this.tt(),this.nt()},ht(t,s){const i=this.et(t);for(const t of i.keyboard)if(this.ot(t,s))return!0;for(const t of i.gamepad)if(this.rt(t,s))return!0;if(t===this.v.C)for(const t in this.Z){const i=this.Z[t];if(i.axes[6]&&i.axes[6]<=-.2)return!this.V["ct"]&&(s&&(this.V["ct"]=!0),!0)}else if(t===this.v.L)for(const t in this.Z){const i=this.Z[t];if(i.axes[6]&&i.axes[6]>=.2)return!this.V["dt"]&&(s&&(this.V["dt"]=!0),!0)}else if(t===this.v.I)for(const t in this.Z){const i=this.Z[t];if(i.axes[7]&&i.axes[7]<=-.2)return!this.V["ut"]&&(s&&(this.V["ut"]=!0),!0)}else if(t===this.v.N)for(const t in this.Z){const i=this.Z[t];if(i.axes[7]&&i.axes[7]>=.2)return!this.V["wt"]&&(s&&(this.V["wt"]=!0),!0)}return!1},rt(t,s){for(const i in this.Z){const h=this.Z[i].buttons[t];if(h&&h.pressed)return!this.V[t]&&(s&&(this.V[t]=!0),!0)}return!1},ot(t,s){const i=this.j[t];return!(!i||!i.time)&&(s&&(i.time=0,i.lt=!0),!0)},ft(t,s){if("function"!=typeof s)return void(this.q[t]=[]);const i=this.q[t].indexOf(s);i>=0&&this.q[t].splice(i,1)},gt(t,s){this.q[t].push(s)},yt(t,s){const i=this.X[t]||[];i.push(s),this.X[t]=i},Et(t,s){const i=this.Y[t]||[];i.push(s),this.Y[t]=i},nt(){document.body.onkeydown=t=>{const s=this.j[t.code];s&&s.lt||(this.j[t.code]={time:Date.now()},this.X[t.code]&&this.X[t.code].forEach((t=>t())))},document.body.onkeyup=t=>{this.j[t.code]={time:0},this.Y[t.code]&&this.Y[t.code].forEach((t=>t()))},document.body.onmousemove=t=>{this.J.x=t.clientX,this.J.y=t.clientY},document.body.onclick=t=>{this.q.click.forEach((t=>t(this.J.clone())))},window.addEventListener("gamepadconnected",(t=>{this.$++,this.Z[t.gamepad.index]=t.gamepad,this.q.H.forEach((t=>t()))})),window.addEventListener("gamepaddisconnected",(t=>{this.$--,delete this.Z[t.gamepad.index],this.q.W.forEach((t=>t()))}))},update(){const t=navigator.getGamepads();for(const s of t)if(s){this.Z[s.index]=s;for(const t in this.V)"axis6-"===t||"axis6+"===t?s.axes[6]||delete this.V[t]:"axis7-"===t||"axis7+"===t?s.axes[7]||delete this.V[t]:s.buttons[t]&&!s.buttons[t].pressed&&delete this.V[t]}}},t.l={Mt:new t.M,scale:1,At:0,bt:0,clear(){this.F.setTransform(1,0,0,1,0,0),this.F.clearRect(0,0,window.innerWidth,window.innerHeight),this.xt.setTransform(1,0,0,1,0,0),this.xt.clearRect(0,0,window.innerWidth,window.innerHeight)},Dt(){this.clear(),this.F.setTransform(this.scale,0,0,this.scale,this.At,this.bt),this.xt.setTransform(this.scale,0,0,this.scale,0,0),this.level&&this.level.Dt()},Kt(){this.xt.setTransform(this.scale,0,0,this.scale,0,0),this.xt.clearRect(0,0,window.innerWidth,window.innerHeight),this.xt.fillStyle="rgba(0,0,0,0.4)",this.xt.fillRect(0,0,window.innerWidth,window.innerHeight),this.xt.fillStyle="#FFF",this.xt.font="normal 56px "+t.i,this.xt.textAlign="center",this.xt.textBaseline="top",this.xt.fillText("PAUSED",this.Mt.x,60)},_t(t,s){const i=document.createElement("canvas");i.width=t,i.height=s;const h=i.getContext("2d",{alpha:!0});return h.imageSmoothingEnabled=!1,[i,h]},init(t){this.Ft=document.getElementById("c"),this.F=this.Ft.getContext("2d",{alpha:!0}),this.F.imageSmoothingEnabled=!1,this.kt=document.getElementById("ui"),this.xt=this.kt.getContext("2d",{alpha:!0}),this.xt.imageSmoothingEnabled=!1,this.Pt((()=>{this.nt(),t()}))},Pt(t){const s=new Image;s.onload=()=>{this.images=s,t()},s.src="i.png"},g(s=0){if(t.u.update(),s&&this.Tt){const i=(s-this.Tt)/(1e3/t.h);if(this.F.imageSmoothingEnabled=!1,this.xt.imageSmoothingEnabled=!1,this.vt)return void this.Kt();this.level.update(i),this.Dt(),t.t&&(this.xt.fillStyle="#000",this.xt.fillRect(40,window.innerHeight-45,140,28),this.xt.fillStyle="#FFF",this.xt.font="bold 16px "+t.i,this.xt.textAlign="right",this.xt.textBaseline="bottom",this.xt.fillText(~~(t.h/i)+" FPS / "+this.scale,160,window.innerHeight-22))}this.Tt=s,requestAnimationFrame((t=>this.g(t)))},pause(){this.vt=!0,t.Audio.k()},nt(){window.addEventListener("resize",(t=>this.resize())),this.resize();const s=t.u.et(t.u.v.S);setInterval((()=>{this.vt&&t.u.update(),s.gamepad.forEach((s=>{t.u.rt(s,!0)&&this.St()}))}),100);const i=()=>this.St();s.keyboard.forEach((s=>t.u.Et(s,i))),t.u.gt("gp_disconnect",(()=>this.pause())),t.u.gt("click",(t=>{this.vt||this.level&&this.level.Ot(t)}))},Ut(){this.level=new this.level.constructor},resize(){this.Ft.width=window.innerWidth,this.Ft.height=window.innerHeight,this.kt.width=window.innerWidth,this.kt.height=window.innerHeight,this.Mt.x=Math.floor(this.Ft.width/2),this.Mt.y=Math.floor(this.Ft.height/2),this.vt&&(clearTimeout(this.Ct),this.Ct=setTimeout((()=>this.Kt()),100))},St(){this.vt?this.unpause():this.pause()},unpause(){this.vt&&(this.vt=!1,t.Audio.T(),this.g())}},t.m=class{constructor(){this.It=!1,this.Lt={},this.Nt=0,this.Gt=[],this.Rt=[],this.zt={p1:null,p2:null}}Bt(...t){t.forEach((t=>t.level=this)),this.Rt.push(...t),this.Gt.push(...t)}Vt(...t){t.forEach((t=>t.level=this)),this.Gt.push(...t)}Ot(t){if(!this.It)for(const s of this.Rt)if(s.qt(t)&&this.zt.p2!==s){this.zt.p1=s;break}}Dt(){this.It?this.Ht(t.l.F):(this.Wt(t.l.F),this.Gt.forEach((s=>s.Dt(t.l.F))))}Ht(s){const i=t.l.Mt;s.font="bold 36px "+t.i,s.textAlign="center",s.fillStyle="#DDD",s.fillText("GAME OVER",i.x,i.y)}update(s){if(this.Nt+=s,this.It)t.u.ht(t.u.v.O,!0)&&t.l.Ut();else{const i=this.zt.p1;if(i){const s=t.l;s.At=s.Mt.x-i.Xt.x-i.w/2,s.bt=s.Mt.y-i.Xt.y-i.Yt/2}const h=t.u.it();this.Gt.sort(((t,s)=>t.Zt()-s.Zt())),this.Gt.forEach((t=>{t===i?t.update(s,h):t.update(s)}))}}},t.jt=class{constructor(s={}){this.Xt=new t.M(s.x,s.y),this.w=s.w||0,this.Yt=s.Yt||0,this.Qt=1/0,this.Jt=new t.M(1,0),this.speed=new t.M}Dt(t){}qt(t){return this.Xt.x<=t.x&&t.x<=this.Xt.x+this.w&&this.Xt.y<=t.y&&t.y<=this.Xt.y+this.Yt}Zt(){return this.Xt.y+this.Yt}update(t,s){s&&(this.Xt.x+=Math.round(t*s.x*this.speed.x),this.Xt.y+=Math.round(t*s.y*this.speed.y),(s.x||s.y)&&this.Jt.set(0==s.x?0:s.x>0?1:-1,0==s.y?0:s.y>0?1:-1))}},t.$t=class extends t.jt{constructor(s={}){s.w=t.o,s.Yt=t.o,super(s),this.level=null,this.speed.set(6,6)}update(t,s){super.update(t,s),this.level&&(this.Xt.x=Math.min(this.level.Lt.x+this.level.Lt.w-this.w,Math.max(this.level.Lt.x,this.Xt.x)),this.Xt.y=Math.min(this.level.Lt.y+this.level.Lt.Yt-this.Yt,Math.max(this.level.Lt.y,this.Xt.y)))}},t.ts=class extends t.$t{constructor(t){super(t)}Dt(s){let i=0;this.Jt.y<0?i=16:this.Jt.y>0?i=32:this.Jt.x<0&&(i=48),s.drawImage(t.l.images,i,16,16,16,Math.round(this.Xt.x),Math.round(this.Xt.y),t.o,t.o)}},t.m.p=class extends t.m{constructor(){super(),this.Lt={x:0,y:0,w:8*t.o,Yt:8*t.o};const s=new t.ts({x:400,y:400});this.Bt(s),this.zt.p1=this.Rt[0]}Wt(s){s.strokeStyle="#8f563b",s.lineWidth=t.o/16;let i=s.lineWidth/2;s.strokeRect(-i,-i,this.Lt.w+2*i,this.Lt.Yt);for(let i=0;i<8;i++)for(let h=0;h<8;h++){let e=i*t.o,n=h*t.o;s.drawImage(t.l.images,0,0,16,16,e,n,t.o,t.o)}}};