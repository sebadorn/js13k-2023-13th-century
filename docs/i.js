const t={t:!0,i:'"Courier New", monospace',h:60,o:96,u:48,l:1,p:2,init(){t.m.init(),t.Audio.init(),t.g.init((()=>{t.g.level=new t._.M,t.g.A()}))},T(t,s){let i=Math.min(t.x+t.w,s.x+s.w)-Math.max(t.x,s.x);i=i<0?0:i;let h=Math.min(t.y+t.I,s.y+s.I)-Math.max(t.y,s.y);return h=h<0?0:h,i*h>Number.EPSILON}};window.addEventListener("load",(()=>t.init())),t.D=class{constructor(t=0,s=0){this.x=t,this.y=s}clone(){return new t.D(this.x,this.y)}length(){return this.x+this.y===0?0:Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const t=this.length();return t&&(this.x/=t,this.y/=t),this}set(t,s){this.x=t,this.y=s}},t.Audio={k:{},K:.2,F:{S:(t,s,i)=>(s[t]=2*Math.random()-1,i[t]=2*Math.random()-1,!1)},init(){this.v=new window.AudioContext,this.gain=this.v.createGain(),this.gain.connect(this.v.destination),this.volume(.1);for(const t in this.F){const s=2*this.v.sampleRate,i=this.v.createBuffer(2,s,this.v.sampleRate),h=i.getChannelData(0),e=i.getChannelData(1);for(let i=0;i<s&&!this.F[t](i,h,e);i++);this.k[t]=i}},P(){0!==this.gain.gain.value&&(this.K=this.gain.gain.value,this.gain.gain.value=0)},play(t,s,i=1,h="dec"){const e=this.v.createGain();e.connect(this.gain),"inc"===h?(e.gain.setValueAtTime(0,this.v.currentTime),e.gain.linearRampToValueAtTime(i,this.v.currentTime+s-.01)):(e.gain.setValueAtTime(i,this.v.currentTime),e.gain.linearRampToValueAtTime(0,this.v.currentTime+s-.01));const n=this.k[t.name],r=this.v.createBufferSource();return r.buffer=n,r.connect(e),r.start(0,0,s),r},L(t,s,i="sine",h="dec"){const e=this.v.createGain();e.connect(this.gain),"inc"===h?(e.gain.setValueAtTime(0,this.v.currentTime),e.gain.linearRampToValueAtTime(1,this.v.currentTime+s-.01)):(e.gain.setValueAtTime(1,this.v.currentTime),e.gain.linearRampToValueAtTime(0,this.v.currentTime+s-.01));const n=this.v.createOscillator();return n.type=i,n.frequency.setValueAtTime(t,this.v.currentTime),n.connect(e),n.start(),n.stop(this.v.currentTime+s),n},O(){this.gain.gain.value=this.K},volume(t){this.gain.gain.value=Math.min(1,Math.max(0,t))}},t.m={C:{N:1,H:2,U:3,G:4,R:5,W:10,B:11,V:12,Z:13,q:14,X:15},Y:{},j:{},J:{click:[],$:[],tt:[]},st:{},it:{},ht:{},et:{},nt:new t.D,rt:0,ot(){this.ct={[this.C.N]:{keyboard:["Escape"],gamepad:[9]},[this.C.B]:{keyboard:["ArrowUp","KeyW","KeyZ","KeyY"],gamepad:[12]},[this.C.W]:{keyboard:["ArrowLeft","KeyA","KeyQ"],gamepad:[14]},[this.C.Z]:{keyboard:["ArrowDown","KeyS"],gamepad:[13]},[this.C.V]:{keyboard:["ArrowRight","KeyD"],gamepad:[15]},[this.C.G]:{keyboard:["Space","Enter"],gamepad:[0]},[this.C.H]:{keyboard:["Enter"],gamepad:[0]},[this.C.R]:{keyboard:["KeyE"],gamepad:[0]}}},dt(){let t=0,s=0;if(this.ut(this.C.W)?t=-1:this.ut(this.C.V)&&(t=1),this.ut(this.C.B)?s=-1:this.ut(this.C.Z)&&(s=1),!t||!s){const i=.3;for(const h in this.ht){const e=this.ht[h];e.axes[0]&&Math.abs(e.axes[0])>i?t=e.axes[0]>0?1:-1:e.axes[2]&&Math.abs(e.axes[2])>i&&(t=e.axes[2]>0?1:-1),e.axes[1]&&Math.abs(e.axes[1])>i?s=e.axes[1]>0?1:-1:e.axes[3]&&Math.abs(e.axes[3])>i&&(s=e.axes[3]>0?1:-1)}}return{x:t,y:s}},lt(t){return this.ct[t]},init(){this.ot(),this.wt()},ut(t,s){const i=this.lt(t);for(const t of i.keyboard)if(this.ft(t,s))return!0;for(const t of i.gamepad)if(this.yt(t,s))return!0;if(t===this.C.W)for(const t in this.ht){const i=this.ht[t];if(i.axes[6]&&i.axes[6]<=-.2)return!this.j["gt"]&&(s&&(this.j["gt"]=!0),!0)}else if(t===this.C.V)for(const t in this.ht){const i=this.ht[t];if(i.axes[6]&&i.axes[6]>=.2)return!this.j["xt"]&&(s&&(this.j["xt"]=!0),!0)}else if(t===this.C.B)for(const t in this.ht){const i=this.ht[t];if(i.axes[7]&&i.axes[7]<=-.2)return!this.j["Mt"]&&(s&&(this.j["Mt"]=!0),!0)}else if(t===this.C.Z)for(const t in this.ht){const i=this.ht[t];if(i.axes[7]&&i.axes[7]>=.2)return!this.j["Et"]&&(s&&(this.j["Et"]=!0),!0)}return!1},yt(t,s){for(const i in this.ht){const h=this.ht[i].buttons[t];if(h&&h.pressed)return!this.j[t]&&(s&&(this.j[t]=!0),!0)}return!1},ft(t,s){const i=this.et[t];return!(!i||!i.time)&&(s&&(i.time=0,i._t=!0),!0)},At(t,s){if("function"!=typeof s)return void(this.J[t]=[]);const i=this.J[t].indexOf(s);i>=0&&this.J[t].splice(i,1)},Tt(t,s){this.J[t].push(s)},It(t,s){const i=this.st[t]||[];i.push(s),this.st[t]=i},bt(t,s){const i=this.it[t]||[];i.push(s),this.it[t]=i},wt(){document.body.onkeydown=t=>{const s=this.et[t.code];s&&s._t||(this.et[t.code]={time:Date.now()},this.st[t.code]&&this.st[t.code].forEach((t=>t())))},document.body.onkeyup=t=>{this.et[t.code]={time:0},this.it[t.code]&&this.it[t.code].forEach((t=>t()))},document.body.onmousemove=t=>{this.nt.x=t.clientX,this.nt.y=t.clientY},document.body.onclick=t=>{this.J.click.forEach((t=>t(this.nt.clone())))},window.addEventListener("gamepadconnected",(t=>{this.rt++,this.ht[t.gamepad.index]=t.gamepad,this.J.$.forEach((t=>t()))})),window.addEventListener("gamepaddisconnected",(t=>{this.rt--,delete this.ht[t.gamepad.index],this.J.tt.forEach((t=>t()))}))},update(){const t=navigator.getGamepads();for(const s of t)if(s){this.ht[s.index]=s;for(const t in this.j)"axis6-"===t||"axis6+"===t?s.axes[6]||delete this.j[t]:"axis7-"===t||"axis7+"===t?s.axes[7]||delete this.j[t]:s.buttons[t]&&!s.buttons[t].pressed&&delete this.j[t]}}},t.g={Dt:new t.D,scale:1,kt:0,Kt:0,Ft(t){const s=t.St();this.kt=this.Dt.x-s.x,this.Kt=this.Dt.y-s.y},clear(){this.v.setTransform(1,0,0,1,0,0),this.v.clearRect(0,0,window.innerWidth,window.innerHeight),this.vt.setTransform(1,0,0,1,0,0),this.vt.clearRect(0,0,window.innerWidth,window.innerHeight)},Pt(){this.clear(),this.v.setTransform(this.scale,0,0,this.scale,this.kt,this.Kt),this.vt.setTransform(this.scale,0,0,this.scale,0,0),this.level&&this.level.Pt()},Lt(){this.vt.setTransform(this.scale,0,0,this.scale,0,0),this.vt.clearRect(0,0,window.innerWidth,window.innerHeight),this.vt.fillStyle="rgba(0,0,0,0.4)",this.vt.fillRect(0,0,window.innerWidth,window.innerHeight),this.vt.fillStyle="#FFF",this.vt.font="normal 56px "+t.i,this.vt.textAlign="center",this.vt.textBaseline="top",this.vt.fillText("PAUSED",this.Dt.x,60)},Ot(t,s){const i=document.createElement("canvas");i.width=t,i.height=s;const h=i.getContext("2d",{alpha:!0});return h.imageSmoothingEnabled=!1,[i,h]},init(t){this.Ct=document.getElementById("c"),this.v=this.Ct.getContext("2d",{alpha:!0}),this.v.imageSmoothingEnabled=!1,this.Nt=document.getElementById("ui"),this.vt=this.Nt.getContext("2d",{alpha:!0}),this.vt.imageSmoothingEnabled=!1,this.Ht((()=>{this.wt(),t()}))},Ht(t){const s=new Image;s.onload=()=>{this.images=s,t()},s.src="i.png"},A(s=0){if(t.m.update(),s&&this.Ut){const i=(s-this.Ut)/(1e3/t.h);if(this.v.imageSmoothingEnabled=!1,this.vt.imageSmoothingEnabled=!1,this.Gt)return void this.Lt();this.level.update(i),this.Pt(),t.t&&(this.vt.fillStyle="#000",this.vt.fillRect(40,window.innerHeight-45,140,28),this.vt.fillStyle="#FFF",this.vt.font="bold 16px "+t.i,this.vt.textAlign="right",this.vt.textBaseline="bottom",this.vt.fillText(~~(t.h/i)+" FPS / "+this.scale,160,window.innerHeight-22))}this.Ut=s,requestAnimationFrame((t=>this.A(t)))},resetTransform(){this.v.setTransform(this.scale,0,0,this.scale,this.kt,this.Kt)},pause(){this.Gt=!0,t.Audio.P()},wt(){window.addEventListener("resize",(t=>this.resize())),this.resize();const s=t.m.lt(t.m.C.N);setInterval((()=>{this.Gt&&t.m.update(),s.gamepad.forEach((s=>{t.m.yt(s,!0)&&this.Rt()}))}),100);const i=()=>this.Rt();s.keyboard.forEach((s=>t.m.bt(s,i))),t.m.Tt("gp_disconnect",(()=>this.pause()))},Wt(){this.level=new this.level.constructor},resize(){this.Ct.width=window.innerWidth,this.Ct.height=window.innerHeight,this.Nt.width=window.innerWidth,this.Nt.height=window.innerHeight,this.Dt.x=Math.floor(this.Ct.width/2),this.Dt.y=Math.floor(this.Ct.height/2),this.Gt&&(clearTimeout(this.zt),this.zt=setTimeout((()=>this.Lt()),100))},Rt(){this.Gt?this.unpause():this.pause()},unpause(){this.Gt&&(this.Gt=!1,t.Audio.O(),this.A())}},t.Bt=class{constructor(t,s=0){this.level=t,this.set(s)}Vt(){return this.level.Zt>this.timeEnd}qt(){return Math.min(1,1-(this.timeEnd-this.level.Zt)/this.duration)}set(s){this.duration=s*t.h,this.timeEnd=this.level.Zt+this.duration}},t._=class{constructor(){this.Xt=!1,this.Yt={},this.Zt=0,this.jt=[],this.Qt=[],this.items=[],this.Jt={p1:null,p2:null}}$t(...t){this.Qt.push(...t),this.ts(...t)}ss(...t){this.items.push(...t),this.ts(...t)}ts(...t){t.forEach((t=>t.level=this)),this.jt.push(...t)}removeItem(t){let s=this.items.indexOf(t);s>=0&&this.items.splice(s,1),s=this.jt.indexOf(t),s>=0&&this.jt.splice(s,1)}Pt(){this.Xt?this.hs(t.g.v):(this.es(t.g.v),this.jt.forEach((s=>s.Pt(t.g.v))))}hs(s){const i=t.g.Dt;s.font="bold 36px "+t.i,s.textAlign="center",s.fillStyle="#DDD",s.fillText("GAME OVER",i.x,i.y)}update(s){if(this.Zt+=s,this.Xt)t.m.ut(t.m.C.H,!0)&&t.g.Wt();else{const i=this.Jt.p1;if(i){t.g.Ft(i),t.m.ut(t.m.C.G,!0)&&i.attack();let h=t.m.dt();h=new t.D(h.x,h.y),i.update(s,h.normalize());const e=i.ns();this.items.forEach((s=>{s.rs=!1,s.os&&t.T(s.ns(),e)&&(s.rs=!0,t.m.ut(t.m.C.R,!0)&&i.cs(s))}))}this.jt.sort(((t,s)=>t.ds()-s.ds())),this.jt.forEach((t=>{t!==i&&(t.update(s),i?.us&&(!t.ls||t.ls.Vt())&&t.ws>0&&i.item.ps(t)&&t.fs(i.item))}))}}},t.ys=class{constructor(s={}){this.gs=new t.D(s.x,s.y),this.w=s.w||0,this.I=s.I||0,this.xs=0,this.ls=null,this.os=!1,this.Ms=new t.D(1,0),this.Es=1/0,this.ws=1/0,this.rs=!1,this.level=null,this.speed=new t.D,this.state=t.l}Pt(t){}ns(){return{x:this.gs.x,y:this.gs.y,w:this.w,I:this.I}}St(){return{x:this.gs.x+this.w/2,y:this.gs.y+this.I/2}}ds(){return this.gs.y+this.I}fs(s){this.ls=this.ls||new t.Bt(this.level),this.ls.set(.5),this.ws=Math.max(0,this.ws-s._s),this.ws<=0&&this.As()}update(s,i){if(this.ws<=0||this.Ts)return;let h=t.l;this.xs+=s,i&&(this.gs.x+=Math.round(s*i.x*this.speed.x),this.gs.y+=Math.round(s*i.y*this.speed.y),(i.x||i.y)&&(h=t.p,this.Ms.set(0==i.x?this.Ms.x:i.x>0?1:-1,0==i.y?this.Ms.y:i.y>0?1:-1))),this.state!=h&&(this.xs=0),this.state=h}},t.Is=class extends t.ys{constructor(s={}){s.w=t.o,s.I=t.o,super(s),this.bs=null,this.us=!1,this.Es=100,this.ws=100,this.item=s.item,this.speed.set(12,12),this.item&&(this.item.Ts=this)}Ds(t,s){const i=this.St();t.translate(i.x,i.y),t.scale(s,1),t.translate(-i.x,-i.y)}ks(s){const i=this.St();s.translate(i.x,i.y),s.rotate(.1*Math.sin(this.xs/t.h*48)),s.translate(-i.x,-i.y)}Ks(t){if(this.ws==this.Es)return;let s=this.ws/this.Es,i=this.gs.x+16,h=this.gs.y-24,e=this.w-32;t.fillStyle="#000",t.fillRect(i,h,e,8),t.fillStyle="#f00",t.fillRect(i,h,e*s,8)}Fs(t){const s=this.Ms.x<0;s&&this.Ds(t,-1),this.item?.Pt(t),s&&this.Ds(t,-1)}attack(){!this.us&&this.item&&(this.bs=this.bs||new t.Bt(this.level),this.bs.set(this.item.Ss),this.us=!0)}Pt(s){if(this.ws<=0)return;let i=this.vs+(this.Ms.x<0?16:0);this.state===t.p&&this.ks(s),this.item&&this.Fs(s),this.Ks(s),s.drawImage(t.g.images,i,this.Ps,this.Ls,this.Os,this.gs.x,this.gs.y,t.o,t.o),t.g.resetTransform()}As(){this.item?.Cs(),this.ws>0&&(this.item=new t.Ns,this.item.Ts=this)}ns(){const s={x:this.gs.x,y:this.gs.y+this.I,w:this.w,I:t.u/2};return s.y-=s.I,s}cs(t){this.item?.Cs(),this.item=t,t.rs=!1,t.Ts=this,this.level.removeItem(t)}update(t,s){super.update(t,s),this.us&&this.bs.Vt()&&(this.us=!1),this.level&&(this.gs.x=Math.min(this.level.Yt.x+this.level.Yt.w-this.w,Math.max(this.level.Yt.x,this.gs.x)),this.gs.y=Math.min(this.level.Yt.y+this.level.Yt.I-this.I,Math.max(this.level.Yt.y,this.gs.y)))}},t.Hs=class extends t.ys{constructor(t){super(t),this.Ts=null}Us(t){const s=this.ns();t.strokeStyle="#f00",t.lineWidth=2,t.strokeRect(s.x,s.y,s.w,s.I)}Gs(){this.gs.set(this.Ts.gs.x+this.Ts.w/2,this.Ts.gs.y-this.Ts.I)}Cs(){this.os&&(this.Gs(),this.Ts.level.ss(this)),this.Ts=null}ds(){return this.gs.y}},t.Rs=class extends t.Is{constructor(t){super(t),this.vs=0,this.Ps=32,this.Ls=16,this.Os=16}fs(t){this.ws<=0||super.fs(t)}},t.Ws=class extends t.Is{constructor(t){super(t),this.vs=0,this.Ps=16,this.Ls=16,this.Os=16}},t.Ns=class extends t.Hs{constructor(t={}){super(t),this.Ss=.15,this._s=10}ps(s){const i={x:this.Ts.gs.x+this.Ts.w,y:this.Ts.gs.y+t.u/2,w:t.u,I:t.u};this.Ts.Ms.x<0&&(i.x-=this.Ts.w+i.w);const h={x:s.gs.x,y:s.gs.y,w:s.w,I:s.I};return t.T(h,i)}Pt(s){let i=this.gs.x,h=this.gs.y;if(this.Ts&&(i=this.Ts.gs.x+this.Ts.w-32,h=this.Ts.gs.y+this.Ts.I/2-16),this.Ts.us){const s=Math.sin(this.Ts.bs.qt()*Math.PI*2)*t.u;i+=Math.max(0,s)}s.drawImage(t.g.images,40,16,8,8,i,h,t.u,t.u)}},t.zs=class extends t.Hs{constructor(s={}){s.w=t.u,s.I=2*t.o,super(s),this.Ss=.25,this.os=!0,this._s=25}Gs(){this.gs.set(this.Ts.gs.x+this.Ts.w/2,this.Ts.gs.y-this.Ts.I+this.I/2)}ps(s){const i=[{x:this.Ts.gs.x+this.Ts.w,y:this.Ts.gs.y,w:1.7*t.o,I:t.o},{x:this.Ts.gs.x+this.Ts.w,y:this.Ts.gs.y-.7*t.o,w:t.o,I:2.4*t.o}];this.Ts.Ms.x<0&&(i[0].x-=this.Ts.w+i[0].w,i[1].x-=this.Ts.w+i[1].w);const h={x:s.gs.x,y:s.gs.y,w:s.w,I:s.I};for(let s=0;s<i.length;s++)if(t.T(h,i[s]))return!0;return!1}Pt(s){let i=this.gs.x,h=this.gs.y;this.Ts&&(i=this.Ts.gs.x+t.u,h=this.Ts.gs.y-t.o-16);let e=0,n={x:i+this.w/2,y:h+this.I/2};if(this.Ts){if(this.Ts?.us){n.x=i+t.o/4,n.y=h+2*t.o;let s=this.Ts.bs.qt();const r=Math.PI;s<=.4?(s/=.4,e=s*r):e=s<=.8?r:0}}else e=80*Math.PI/180;e&&(s.translate(n.x,n.y),s.rotate(e),s.translate(-n.x,-n.y)),s.drawImage(t.g.images,32,16,8,32,i,h,t.u,2*t.o),e&&this.Ts?.us&&(s.translate(n.x,n.y),s.rotate(-e),s.translate(-n.x,-n.y)),this.Ts||(t.g.resetTransform(),this.rs&&this.Us(s))}ns(){return{x:this.gs.x-1.5*this.w,y:this.gs.y+1.5*this.w,w:this.I,I:this.w}}},t._.M=class extends t._{constructor(){super(),this.Yt={x:0,y:0,w:8*t.o,I:8*t.o};const s=new t.Ws({x:400,y:400,item:new t.zs}),i=new t.Rs({x:600,y:400,item:new t.zs});i.Ms.x=-1,this.$t(s,i);const h=new t.zs({x:400,y:540});this.ss(h),this.Jt.p1=s}es(s){s.strokeStyle="#8f563b",s.lineWidth=t.o/16;let i=s.lineWidth/2;s.strokeRect(-i,-i,this.Yt.w+2*i,this.Yt.I);for(let i=0;i<8;i++)for(let h=0;h<8;h++){let e=i*t.o,n=h*t.o;s.drawImage(t.g.images,0,0,16,16,e,n,t.o,t.o)}}};