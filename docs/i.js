let t,s,i;s=.3,t=(t=1,s=.05,h=220,e=0,n=0,r=.1,o=0,a=1,c=0,l=0,f=0,u=0,w=0,d=0,p=0,x=0,g=0,y=1,m=0,M=0,E=Math,k=44100,_=2*E.PI,A=(c*=500*_/k/k),T=(h*=(1-s+2*s*E.random(s=[]))*_/k),b=0,v=0,F=0,I=1,S=0,D=0,N=0,C,H)=>{for(l*=500*_/k**3,p*=_/k,f*=_/k,u*=k,w=k*w|0,H=(e=k*e+9)+(m*=k)+(n*=k)+(r*=k)+(g*=k)|0;F<H;s[F++]=N)++D%(100*x|0)||(N=o?1<o?2<o?3<o?E.sin((b%_)**3):E.max(E.min(E.tan(b),1),-1):1-(2*b/_%2+2)%2:1-4*E.abs(E.round(b/_)-b/_):E.sin(b),N=(w?1-M+M*E.sin(_*F/w):1)*(0<N?1:-1)*E.abs(N)**a*.3*t*(F<e?F/e:F<e+m?1-(F-e)/m*(1-y):F<e+m+n?y:F<H-g?(H-F-g)/r*y:0),N=g?N/2+(g>F?0:(F<H-g?1:(H-F)/g)*s[F-g|0]/2):N),b+=(C=(h+=c+=l)*E.cos(p*v++))-C*d*(1-1e9*(E.sin(F)+1)%2),I&&++I>u&&(h+=f,T+=f,I=0),!w||++S%w||(h=T,c=A,I||=1);return(t=i.createBuffer(1,H,k)).getChannelData(0).set(s),(h=i.createBufferSource()).buffer=t,h.connect(i.destination),h.start(),h},i=new AudioContext;const h={t:!0,i:"Arial, sans-serif",h:'"Times New Roman", serif',o:'"Courier New", monospace',l:60,u:96,p:48,g:1,m:2,M(t,s){let i=Math.min(t.x+t.w,s.x+s.w)-Math.max(t.x,s.x);i=i<0?0:i;let h=Math.min(t.y+t.k,s.y+s.k)-Math.max(t.y,s.y);return h=h<0?0:h,i*h},init(){h._.init(),h.A.init((()=>{h.A.level=new h.v.T,h.A.F()}))},I(){const t=localStorage.getItem("2023_sd_nibelungs.save");return t?JSON.parse(t):null},S(t,s){return this.M(t,s)>Number.EPSILON},D(t){if(!t||0==t.id)return;const s={level:t.id};localStorage.setItem("2023_sd_nibelungs.save",JSON.stringify(s))}};window.addEventListener("load",(()=>h.init())),h.N=class{constructor(t=0,s=0){this.x=t,this.y=s}clone(){return new h.N(this.x,this.y)}length(){return this.x+this.y===0?0:Math.sqrt(this.x*this.x+this.y*this.y)}mul(t){return this.x*=t,this.y*=t,this}normalize(){const t=this.length();return t&&(this.x/=t,this.y/=t),this}set(t,s){this.x=t,this.y=s}sub(t){return this.x-=t.x,this.y-=t.y,this}},h.Audio={C:[.3,0,8,.01,.01,.01,1,2.29,86,,,,,,-82,,,.42,.01],H:[.2,0,68,.02,.01,.18,2,1.89,-.3,,,,,1.4,,.3,,.59,.06,.12],O:[.15,0,382,.1,.01,.09,,2.2,-1.2,-3.8,,,,5,,,,.48,.05],SELECT:[.2,0,883,.01,.07,,1,1.74,,,366,.1,.06,,,,,.62,.01],play(s){t(...s)}},h._={L:{R:1,P:2,G:3,C:4,K:5,O:6,B:10,U:11,X:12,W:13,Y:14,j:15},Z:{},J:{},V:{click:[],$:[],q:[]},tt:{},st:{},it:{},ht:{},et:0,nt(){this.rt={[this.L.R]:{keyboard:["Escape"],gamepad:[9]},[this.L.U]:{keyboard:["ArrowUp","KeyW","KeyZ","KeyY"],gamepad:[12]},[this.L.B]:{keyboard:["ArrowLeft","KeyA","KeyQ"],gamepad:[14]},[this.L.W]:{keyboard:["ArrowDown","KeyS"],gamepad:[13]},[this.L.X]:{keyboard:["ArrowRight","KeyD"],gamepad:[15]},[this.L.C]:{keyboard:["Space","Enter"],gamepad:[0,2]},[this.L.O]:{keyboard:["ShiftLeft","ShiftRight"],gamepad:[4,5]},[this.L.P]:{keyboard:["Space","Enter"],gamepad:[0,2]},[this.L.K]:{keyboard:["KeyE","CtrlLeft"],gamepad:[1,3]}}},ot(){let t=0,s=0;if(this.ct(this.L.B)?t=-1:this.ct(this.L.X)&&(t=1),this.ct(this.L.U)?s=-1:this.ct(this.L.W)&&(s=1),!t||!s){const i=.3;for(const h in this.it){const e=this.it[h];e.axes[0]&&Math.abs(e.axes[0])>i?t=e.axes[0]>0?1:-1:e.axes[2]&&Math.abs(e.axes[2])>i&&(t=e.axes[2]>0?1:-1),e.axes[1]&&Math.abs(e.axes[1])>i?s=e.axes[1]>0?1:-1:e.axes[3]&&Math.abs(e.axes[3])>i&&(s=e.axes[3]>0?1:-1)}}return{x:t,y:s}},lt(t){return this.rt[t]},init(){this.nt(),this.ft()},ct(t,s){const i=this.lt(t);for(const t of i.keyboard)if(this.ut(t,s))return!0;for(const t of i.gamepad)if(this.wt(t,s))return!0;if(t===this.L.B)for(const t in this.it){const i=this.it[t];if(i.axes[6]&&i.axes[6]<=-.2)return!this.J["dt"]&&(s&&(this.J["dt"]=!0),!0)}else if(t===this.L.X)for(const t in this.it){const i=this.it[t];if(i.axes[6]&&i.axes[6]>=.2)return!this.J["xt"]&&(s&&(this.J["xt"]=!0),!0)}else if(t===this.L.U)for(const t in this.it){const i=this.it[t];if(i.axes[7]&&i.axes[7]<=-.2)return!this.J["gt"]&&(s&&(this.J["gt"]=!0),!0)}else if(t===this.L.W)for(const t in this.it){const i=this.it[t];if(i.axes[7]&&i.axes[7]>=.2)return!this.J["yt"]&&(s&&(this.J["yt"]=!0),!0)}return!1},wt(t,s){for(const i in this.it){const h=this.it[i].buttons[t];if(h&&h.pressed)return!this.J[t]&&(s&&(this.J[t]=!0),!0)}return!1},ut(t,s){const i=this.ht[t];return!(!i||!i.time)&&(s&&(i.time=0,i.Mt=!0),!0)},Et(t,s){if("function"!=typeof s)return void(this.V[t]=[]);const i=this.V[t].indexOf(s);i>=0&&this.V[t].splice(i,1)},kt(t,s){this.V[t].push(s)},_t(t,s){const i=this.tt[t]||[];i.push(s),this.tt[t]=i},At(t,s){const i=this.st[t]||[];i.push(s),this.st[t]=i},ft(){document.body.onkeydown=t=>{const s=this.ht[t.code];s&&s.Mt||(this.ht[t.code]={time:Date.now()},this.tt[t.code]&&this.tt[t.code].forEach((t=>t())))},document.body.onkeyup=t=>{this.ht[t.code]={time:0},this.st[t.code]&&this.st[t.code].forEach((t=>t()))},window.addEventListener("gamepadconnected",(t=>{this.et++,this.it[t.gamepad.index]=t.gamepad,this.V.$.forEach((t=>t()))})),window.addEventListener("gamepaddisconnected",(t=>{this.et--,delete this.it[t.gamepad.index],this.V.q.forEach((t=>t()))}))},update(){const t=navigator.getGamepads();for(const s of t)if(s){this.it[s.index]=s;for(const t in this.J)"axis6-"===t||"axis6+"===t?s.axes[6]||delete this.J[t]:"axis7-"===t||"axis7+"===t?s.axes[7]||delete this.J[t]:s.buttons[t]&&!s.buttons[t].pressed&&delete this.J[t]}}},h.A={Tt:new h.N,scale:1,bt:0,vt:0,Ft(t,s,i,h=0){const[e,n]=this.It(36,36);n.drawImage(this.images,h,s,16,16,1,1,16,16),n.drawImage(this.images,h+16,s,16,16,18,1,16,16),i&&i.St(n);let r=n.getImageData(1,1,35,16);for(let s=0;s<r.data.length;s+=4){r.data[s]+r.data[s+1]+r.data[s+2]===765&&(r.data[s+0]=t[0],r.data[s+1]=t[1],r.data[s+2]=t[2])}n.putImageData(r,1,1),n.putImageData(r,1,18),r=n.getImageData(1,18,34,16);for(let t=0;t<r.data.length;t+=4){0!==r.data[t+3]&&(r.data[t+0]=255,r.data[t+1]=255,r.data[t+2]=255)}return n.putImageData(r,1,18),e},Dt(t,s,i,h){const[e,n]=this.It(i+2,h+2);return n.drawImage(this.images,t,s,i,h,1,1,i,h),e},Nt(t){const s=t.Ct();if(this.bt=this.Tt.x-s.x,this.vt=(this.Tt.y-s.y)*this.scale,t.level){const s=t.level.Ht;this.bt=Math.min(0,Math.max(-s.w+2*this.Tt.x,this.bt))}this.bt*=this.scale},Ot(t){h.D(t),this.level=t},clear(){this.Lt.setTransform(1,0,0,1,0,0),this.Lt.clearRect(0,0,window.innerWidth,window.innerHeight),this.Rt.setTransform(1,0,0,1,0,0),this.Rt.clearRect(0,0,window.innerWidth,window.innerHeight)},createLinearGradient(t,s,i,h,e="#0003",n="#fff1"){const r=this.Lt.createLinearGradient(t,s,i,h);return r.addColorStop(0,e),r.addColorStop(1,n),r},Pt(){this.clear(),this.Lt.setTransform(this.scale,0,0,this.scale,this.bt,this.vt),this.Rt.setTransform(this.scale,0,0,this.scale,0,0),this.level&&this.level.Pt()},Gt(){this.Rt.setTransform(1,0,0,1,0,0),this.Rt.clearRect(0,0,window.innerWidth,window.innerHeight),this.Rt.setTransform(this.scale,0,0,this.scale,0,0),this.Rt.fillStyle="rgba(0,0,0,0.4)",this.Rt.fillRect(0,0,this.Kt.width/this.scale,this.Kt.height/this.scale),this.Rt.fillStyle="#FFF",this.Rt.font="56px "+h.i,this.Rt.textAlign="center",this.Rt.textBaseline="top",this.Rt.fillText("GAME OVER",this.Tt.x,this.Tt.y-56)},Bt(t,s,i){let e=9*h.u,n=2*h.u,r=this.Tt.x-e/2,o=this.Tt.y-n/2;1===i?o=2*this.Tt.y-n-h.u:2===i&&(o=h.p),this.Rt.fillStyle="#0004",this.Rt.fillRect(r-12,o-12,e+24,n+24),this.Rt.fillStyle="#444",this.Rt.fillRect(r,o,e,n),this.Rt.drawImage(t.images,0,0,16,16,r,o+.25*h.u,1.75*h.u,1.75*h.u),this.Rt.lineWidth=12,this.Rt.strokeStyle="#847e87",this.Rt.strokeRect(r+6,o+6,2*h.u-12,2*h.u-12),this.Rt.fillStyle="#fff",this.Rt.font="600 31px "+h.o,this.Rt.textAlign="left",this.Rt.textBaseline="alphabetic";let a=r+28,c=o+48;s.forEach((t=>{this.Rt.fillText(t,a+2*h.u,c),c+=38}))},Ut(){this.Rt.setTransform(1,0,0,1,0,0),this.Rt.clearRect(0,0,window.innerWidth,window.innerHeight),this.Rt.setTransform(this.scale,0,0,this.scale,0,0),this.Rt.fillStyle="rgba(0,0,0,0.4)",this.Rt.fillRect(0,0,this.Kt.width/this.scale,this.Kt.height/this.scale),this.Rt.fillStyle="#FFF",this.Rt.font="56px "+h.i,this.Rt.textAlign="center",this.Rt.textBaseline="top",this.Rt.fillText("PAUSED",this.Tt.x,this.Tt.y-56)},Xt(){this.Lt.fillRect(-this.bt/this.scale-h.u,-this.vt/this.scale-h.u,this.Wt.width/this.scale+2*h.u,this.Wt.height/this.scale+2*h.u)},It(t,s){const i=document.createElement("canvas");i.width=t,i.height=s;const h=i.getContext("2d",{alpha:!0});return h.imageSmoothingEnabled=!1,[i,h]},init(t){this.Wt=document.getElementById("c"),this.Lt=this.Wt.getContext("2d",{alpha:!0}),this.Lt.imageSmoothingEnabled=!1,this.Kt=document.getElementById("ui"),this.Rt=this.Kt.getContext("2d",{alpha:!0}),this.Rt.imageSmoothingEnabled=!1,this.zt((()=>{this.ft(),t()}))},zt(t){const s=new Image;s.onload=()=>{this.images=s;const[i,e]=this.It(5,3);let n=new ImageData(5,3);n.data.set([255,255,255,196,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,196,0,0,0,0,255,255,255,196,255,255,255,255,255,255,255,196,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,196,0,0,0,0,0,0,0,0]),e.putImageData(n,0,0),this.Yt=i,this.jt=this.Ft([255,255,0],16,h.Zt),this.Jt=this.Ft([255,0,0],16,h.Vt),this.$t=this.Ft([127,0,0],16,h.qt),this.Qt=this.Ft([0,0,0],48),this.ts=this.Ft([255,255,255],32),this.ss=this.Ft([0,0,0],48,null,32),this.hs=this.Dt(41,16,7,6),this.es=this.Dt(32,16,8,32),this.ns=this.Dt(40,32,6,14);const[r,o]=this.It(h.u,h.u);o.drawImage(this.images,16,0,16,16,0,0,h.u,h.u),this.rs=o.createPattern(r,"repeat");const[a,c]=h.A.It(h.u,h.u),l=c.createRadialGradient(h.p,h.p,0,h.p,h.p,h.p);l.addColorStop(0,"#000a"),l.addColorStop(.9,"#0002"),l.addColorStop(1,"#0000"),c.fillStyle=l,c.fillRect(0,0,h.u,h.u),this.os=a,t()},s.src="i.png"},F(t=0){if(h._.update(),t&&this.cs){const s=(t-this.cs)/(1e3/h.l);if(this.Lt.imageSmoothingEnabled=!1,this.Rt.imageSmoothingEnabled=!1,this.Lt.lineWidth=1,this.Lt.textBaseline="alphabetic",this.ls)return void this.Ut();this.level.update(s),this.Pt(),h.t&&(this.Rt.fillStyle="#fff",this.Rt.font="600 16px "+h.o,this.Rt.textAlign="left",this.Rt.fillText(~~(h.l/s)+" FPS, "+Math.round(1e3*this.scale)/1e3,h.u,this.Wt.height/this.scale-h.u))}this.cs=t,requestAnimationFrame((t=>this.F(t)))},pause(){this.ls=!0},ft(){window.addEventListener("resize",(t=>this.resize())),this.resize();const t=h._.lt(h._.L.R);setInterval((()=>{this.ls&&h._.update(),t.gamepad.forEach((t=>{h._.wt(t,!0)&&this.fs()}))}),100);const s=()=>this.fs();t.keyboard.forEach((t=>h._.At(t,s))),h._.kt("gp_disconnect",(()=>this.pause()))},us(){this.level=new this.level.constructor},resetTransform(){this.Lt.setTransform(this.scale,0,0,this.scale,this.bt,this.vt)},resize(){const t=1920/1080;let s=window.innerHeight,i=Math.round(s*t);i>window.innerWidth&&(i=window.innerWidth,s=i/t),this.scale=s/1080,this.Tt.x=i/2/this.scale,this.Tt.y=s/2/this.scale;let h=~~((window.innerHeight-s)/2)+"px",e=~~((window.innerWidth-i)/2)+"px";this.Wt.width=i,this.Wt.height=s,this.Wt.style.top=h,this.Wt.style.left=e,this.Kt.width=i,this.Kt.height=s,this.Kt.style.top=h,this.Kt.style.left=e,this.ls&&(clearTimeout(this.ws),this.ws=setTimeout((()=>this.Ut()),100))},ds(t,s,i){t.translate(i.x,i.y),t.rotate(s),t.translate(-i.x,-i.y)},ps(t,s,i,h){t.translate(h.x,h.y),t.scale(s,i),t.translate(-h.x,-h.y)},fs(){this.ls?this.unpause():this.pause()},unpause(){this.ls&&(this.ls=!1,this.F())}},h.xs=class{constructor(t,s=0){this.level=t,this.set(s)}gs(){return this.level.ys>this.timeEnd}Ms(){return Math.min(1,1-(this.timeEnd-this.level.ys)/this.duration)}set(t){this.duration=t*h.l,this.timeEnd=this.level.ys+this.duration}},h.v=class{constructor(){this.id=0,this.Ht={},this.ys=0,this.Es=[],this.ks=[],this.items=[]}_s(t,s){if(h.A.Nt(t),t.As||t.Ts)t.update(s);else{h._.ct(h._.L.O,!0)?t.bs():h._.ct(h._.L.C,!0)&&t.attack();let i=h._.ot();i=new h.N(i.x,i.y),t.update(s,i.normalize());const e=t.vs();this.items.forEach((s=>{s.Fs=!1,s.Is&&h.S(s.vs(),e)&&(s.Fs=!0,h._.ct(h._.L.K,!0)&&t.Ss(s))}))}}Ds(...t){this.ks.push(...t),this.Ns(...t)}Cs(...t){this.items.push(...t),this.Ns(...t)}Ns(...t){t.forEach((t=>t.level=this)),this.Es.push(...t)}removeItem(t){let s=this.items.indexOf(t);s>=0&&this.items.splice(s,1),s=this.Es.indexOf(t),s>=0&&this.Es.splice(s,1)}Pt(){this.Hs&&this.Hs(h.A.Lt),this.Es.forEach((t=>t.Pt(h.A.Lt))),this.Os&&this.Os(h.A.Lt),this.Ls&&h.A.Gt()}Rs(t,s){const i=h.A;if(!this.Ps){const[t,s]=i.It(2*i.Tt.x+2*h.u,2*i.Tt.y+2*h.u);s.fillStyle=i.rs,s.fillRect(0,0,t.width,t.height),this.Ps=t}let e=Math.ceil(-i.bt/i.scale/h.u)*h.u,n=Math.ceil(-i.vt/i.scale/h.u)*h.u;t.drawImage(this.Ps,e-h.u-s,n-h.u)}update(t){if(this.ys+=t,this.Ls)h._.ct(h._.L.P,!0)&&h.A.us();else if(!this.locked){const s=this.Gs;if(s){if(s.Ks<=0)return void(this.Ls=!0);this._s(s,t)}this.Es.sort(((t,s)=>t.Bs()-s.Bs())),this.Es.forEach((i=>{i!==s&&(i.update(t),s?.Ts&&i.Ks>0&&i.Us()&&s.item.Xs(i)&&i.Ws(s.item),i.action||h.Ys.zs(i,s))}))}}},h.js=class{constructor(t={}){this.Zs=new h.N(t.x,t.y),this.w=t.w||0,this.k=t.k||0,this.Js=0,this.Vs={},this.$s=[],this.qs=t.qs||1,this.Ks=this.Qs=1/0,this.speed=new h.N(4,4),this.state=h.g,this.weight=0}ti(t){for(let s=this.$s.length-1;s>=0;s--){(0,this.$s[s])(t)&&this.$s.splice(s,1)}}Us(){return(!this.si||this.si.gs())&&!this.As}Pt(){}ii(t,s){if(!this.level||this.hi)return;this.Zs.x=Math.min(this.level.Ht.w-this.w,Math.max(0,this.Zs.x)),this.Zs.y=Math.min(this.level.Ht.k-this.k-8,Math.max(-h.p,this.Zs.y));const i=this.Zs.clone().sub(t);i.x=i.x<0?-i.x:i.x,i.y=i.y<0?-i.y:i.y;const e=this.vs();this.level.Es.forEach((n=>{if(n===this||!n.ei||n.Ks<=0)return;if(n instanceof h.ni&&this.As)return;const r=n.vs(),o=h.M(e,r);o>Number.EPSILON&&(s&&o>=8?this.Zs.set(i.x>0?r.x+r.w:r.x-e.w,t.y):this.Zs.set(t.x,t.y))}))}vs(){return{x:this.Zs.x,y:this.Zs.y,w:this.w,k:this.k}}Ct(){return{x:this.Zs.x+this.w/2,y:this.Zs.y+this.k/2}}ri(t,s,i){if(this.Vs.oi&&this!==this.level?.Gs)return i;const e=this.Zs.clone();return this.Zs.x+=Math.round(s*t.x*this.speed.x),this.Zs.y+=Math.round(s*t.y*this.speed.y),(t.x||t.y)&&(i=h.m,this.qs=0==t.x?this.qs:t.x>0?1:-1),this.ii(e),i}Bs(){return this.Zs.y+this.k}ai(){if(!this.si||this.si.gs())return!1;const t=this.si.Ms();return t>=0&&t<=.2||t>=.4&&t<=.6||t>=.8&&t<=1}Ws(t){if(!this.Us())return;this===this.level.Gs&&h.Audio.play(h.Audio.H),this.si=this.si||new h.xs(this.level),this.si.set(.5),this.Ks=Math.max(0,this.Ks-t.ci);const s=t.li(this);s&&this.$s.push(s),this.Ks<=0&&this.fi&&this.fi()}update(t,s){if(this.Ks<=0||this.ui)return;let i=h.g;this.Js+=t,this.ti(t),s&&(i=this.ri(s,t,i)),this.state!=i&&(this.Js=0),this.state=i}},h.wi=class extends h.js{constructor(t={}){t.w=h.u,t.k=h.u,super(t),this.images=h.A.ss,this.Ks=this.Qs=50,this.ei=!0,this.weight=h.u}Pt(t){if(this.Ks<=0)return;let s=this.ai()?16:0;t.drawImage(this.images,0,s,16,16,this.Zs.x,this.Zs.y,this.w,this.k)}update(t){super.update(t),this.ei=this.Ks>0}},h.di=class extends h.js{constructor(t){t.w=h.u-6,t.k=h.u-12,super(t),this.ei=!0,this.hi=!0,this.weight=2*h.u}Pt(t){t.drawImage(h.A.images,16,50,15,14,this.Zs.x,this.Zs.y,this.w,this.k)}},h.ni=class extends h.js{constructor(t={}){t.w=h.u,t.k=h.u,super(t),this.pi=42/h.l,this.images=h.A.jt,this.Ks=this.Qs=100,this.ei=!0,this.item=t.item,this.xi=7*h.u,this.speed.set(12,12),this.item&&(this.item.ui=this)}gi(t,s){h.A.ps(t,s,1,this.Ct())}yi(t){h.A.ds(t,.1*Math.sin(this.Js*this.pi),this.Ct())}mi(t){if(this.Ks==this.Qs||this.As)return;let s=this.Ks/this.Qs,i=this.Zs.x+16,h=this.Zs.y-24,e=this.w-32;t.fillStyle="#000",t.fillRect(i,h,e,8),t.fillStyle="#f00",t.fillRect(i,h,e*s,8)}Mi(t){const s=this.qs<0;s&&this.gi(t,-1),this.item?.Pt(t),s&&this.gi(t,-1)}Ei(t){t.drawImage(h.A.os,this.Zs.x,this.Zs.y+this.k-12,this.w,24)}attack(){return!(this.Ts||this.As||!this.item||this.Vs?.oi)&&(h.Audio.play(h.Audio.C),this.ki=this.ki||new h.xs(this.level),this.ki.set(this.item._i),this.Ts=!0,!0)}bs(){return!this.As&&!this.Vs?.oi&&(h.Audio.play(h.Audio.O),this.Ai=this.Ai||new h.xs(this.level),this.Ai.set(.5),this.Ti=this.Zs.clone(),this.As=!0,!0)}Pt(t){if(this.Ks<=0)return;let s=this.qs<0?18:1,i=1,e=this.images;if(this.Ei(t),this.As){let s=360*this.Ai.Ms()*3*Math.PI/180;this.qs<0&&(s=-s),h.A.ds(t,s,this.Ct())}else this.ai()&&(i=18),this.state===h.m&&this.yi(t);this.item&&this.Mi(t,e),this.mi(t),t.drawImage(e,s,i,16,16,this.Zs.x,this.Zs.y,h.u,h.u),h.A.resetTransform()}fi(){this.item?.bi(),this.Ks>0?(this.item=new h.vi,this.item.ui=this):this.item=null}vs(){const t={x:this.Zs.x+16,y:this.Zs.y+this.k,w:this.w-32,k:h.p/2};return t.y-=t.k,t}Ss(t){t.ui||(this.item?.bi(),this.item=t,t.Fs=!1,t.ui=this,this.level.removeItem(t))}update(t,s){if(this.Ks<=0)return;let i=h.g;this.Js+=t,this.ti(t),this.As?this.Ai.gs()?(this.As=!1,this.ii(this.Ti,!0)):(s=new h.N(this.qs<0?-1:1,0),this.ri(s,t,i)):s&&(i=this.ri(s,t,i)),this.action&&(i=this.action(t)||i),this.state!=i&&(this.Js=0),this.Ts&&this.ki.gs()&&(this.Ts=!1),this.state=i}},h.Ys={Fi(t,s){if(!t.item||!t.item.Xs(s))return!1;if(t.Ii&&!t.Ii.gs())return!0;const i=new h.xs(t.level,.3);return t.action=function(){i.gs()&&(t.Ts&&t.ki&&t.ki.gs()?t.action=null:t.Ts||(t.attack(),s.Ws(t.item),t.Ii=t.Ii||new h.xs(t.level),t.Ii.set(.8)))},!0},Si(t,s){if(!(t instanceof h.Vt)||Math.random()<.8)return!1;if(t.Di&&!t.Di.gs())return!1;const i=t.Ct(),e=s.Ct(),n=new h.N(e.x-i.x,e.y-i.y);return!(Math.abs(n.y)>h.p||n.length()>2*h.u)&&(t.qs=n.x<0?-1:1,t.speed.set(11,11),t.bs(),t.Di=t.Di||new h.xs(t.level),t.Di.set(1.5),t.action=function(){t.As||(t.speed.set(3,3),t.action=null)},!0)},Ni(t){if(t.item&&!(t.item instanceof h.vi))return!1;let s=1/0,i=null,e=null;const n=t.Ct(),r=t.vs(),o=new h.N;for(let a=0;a<t.level.items.length;a++){const c=t.level.items[a];if(c instanceof h.Ci){const a=c.vs();if(h.S(a,r)){const s=new h.xs(t.level,.5);return t.action=function(){s.gs()&&(t.Ss(c),t.action=null)},!0}o.set(a.x+a.w/2-n.x,a.y+a.k/2-n.y);const l=o.length();l<3*h.u&&s>l&&(s=l,i=o.clone(),e=c)}}if(!e)return!1;const a=new h.xs(t.level,.5);return i.normalize().mul(.5),t.action=function(s){if(a.gs())t.action=null;else if(!t.Vs.oi)return t.ri(i,s,0)},!0},Hi(t,s){const i=t.Ct(),e=s.Ct(),n=new h.N(e.x-i.x,e.y-i.y);if(n.length()>t.xi)return!1;const r=new h.xs(t.level,1);return n.normalize(),t.action=function(s){if(r.gs())t.action=null;else if(!t.Vs.oi)return t.ri(n,s,0)},!0},zs(t,s){!s||t instanceof h.Oi||!(t instanceof h.ni)||t.Vs.oi||t.Ts||t.As||s.Ks<=0||this.Ni(t)||this.Si(t,s)||this.Fi(t,s)||this.Hi(t,s)}},h.Ci=class extends h.js{constructor(t){super(t)}Li(){const t=h.A,s=this.vs(),i=t.bt/t.scale,e=t.vt/t.scale,n=Math.sin(t.level.ys/25);let r=s.x+s.w/2+i-15,o=s.y-1.5*h.p+e;t.Rt.drawImage(t.Yt,r,o+8*n,30,18),t.Rt.fillStyle="#fff";let a=2*n;r=s.x-6+i-a,o=s.y+s.k+e+a,t.Rt.fillRect(r,o,6,12),t.Rt.fillRect(r,o+6,12,6),r=s.x+s.w+i+a,o=s.y-6+e-a,t.Rt.fillRect(r-6,o,12,6),t.Rt.fillRect(r,o,6,12)}Ri(){this.ui&&this.Zs.set(this.ui.Zs.x-h.p,this.ui.Zs.y+this.ui.k)}bi(){this.Is&&(this.Ri(),this.ui?.level.Cs(this)),this.ui=null}li(){return null}Bs(){return this.Zs.y}},h.Pi=class extends h.ni{constructor(t={}){t.item=t.item||new h.vi,super(t),this.images=h.A.Jt,this.pi=32/h.l,this.speed.set(3,3)}Ws(t){this.Ks<=0||super.Ws(t)}},h.Vt=class extends h.Pi{static St(t){t.fillStyle="#000";let s=7;t.fillRect(s,8,6,1),t.fillRect(s+2,8,3,2),s=22,t.fillRect(s,8,6,1),t.fillRect(s+1,8,3,2)}},h.qt=class extends h.Vt{constructor(t){super(t),this.Ks=this.Qs=300,this.images=h.A.$t,this.xi=14*h.u}static St(t){t.fillStyle="#000";let s=8;t.fillRect(s,7,3,1),t.fillRect(s+1,7,2,2),t.fillRect(s+2,7,1,3),t.fillRect(s+4,7,1,3),t.fillRect(s+4,7,2,2),s=22,t.fillRect(s,7,2,2),t.fillRect(s+1,7,1,3),t.fillRect(s+3,7,1,3),t.fillRect(s+3,7,2,2),t.fillRect(s+3,7,3,1)}mi(){}},h.Gi=class extends h.Pi{constructor(t={}){super(t),this.images=h.A.ts,this.speed.set(4,4)}},h.Oi=class extends h.Pi{constructor(t){super(t),this.images=h.A.Qt,this.Ks=this.Qs=300}fi(){this.item?.bi(),this.item=null}Ws(t){this.Ks<=0||super.Ws(t)}},h.Zt=class extends h.ni{constructor(t={}){t.item=t.item||new h.vi,super(t),this.Ks=this.Qs=1/0}attack(){return!(this.Ii&&!this.Ii.gs())&&(!!super.attack()&&(this.Ii=this.Ii||new h.xs(this.level),this.Ii.set(.65),!0))}bs(){return!(this.Di&&!this.Di.gs())&&(!!super.bs()&&(this.Di=this.Di||new h.xs(this.level),this.Di.set(.8),!0))}static St(t){t.fillStyle="#000";let s=12;t.fillRect(s,7,1,4),t.fillRect(s-2,7,1,4),t.fillRect(s-4,7,1,4),s=23,t.fillRect(s,7,1,4),t.fillRect(s+2,7,1,4),t.fillRect(s+4,7,1,4)}},h.vi=class extends h.Ci{constructor(t={}){super(t),this._i=.2,this.ci=10}Xs(t){if(!this.ui)return!1;const s={x:this.ui.Zs.x+this.ui.w,y:this.ui.Zs.y+h.p/2,w:h.p,k:h.p};this.ui.qs<0&&(s.x-=this.ui.w+s.w);const i={x:t.Zs.x,y:t.Zs.y,w:t.w,k:t.k};return h.S(i,s)}Pt(t){if(!this.ui?.Ts)return;let s=this.ui.Zs.x+this.ui.w-32,i=this.ui.Zs.y+this.ui.k/2-16,e=this.ui.ki.Ms();s+=e*e*h.p*1.5,t.globalAlpha=Math.min(1,e+.5),t.drawImage(h.A.hs,1,1,7,6,s,i,h.p,h.p),t.globalAlpha=1}li(t){if(!(t instanceof h.ni))return;const s=new h.xs(this.ui.level,.4);return t.Vs.oi=!0,t.fi(),function(){return!!s.gs()&&(t.Vs.oi=!1,!0)}}},h.Ki=class extends h.Ci{constructor(t={}){t.w=t.w||h.p,t.k=t.k||2*h.u,super(t),this._i=.25,this.Is=!0,this.ci=34,this.Bi=1.35*h.u}Ri(){this.ui&&(this.Zs.x=this.ui.Zs.x-h.p,this.Zs.y=this.ui.Zs.y-this.ui.k+this.k/2,this.ui.qs>0&&(this.Zs.x+=1.5*h.p+this.ui.w))}Xs(t){if(!this.ui)return!1;const s=[{x:this.ui.Zs.x+this.ui.w,y:this.ui.Zs.y,w:1.7*h.u,k:h.u},{x:this.ui.Zs.x+this.ui.w,y:this.ui.Zs.y-.7*h.u,w:h.u,k:2.4*h.u}];this.ui.qs<0&&(s[0].x-=this.ui.w+s[0].w,s[1].x-=this.ui.w+s[1].w);const i={x:t.Zs.x,y:t.Zs.y,w:t.w,k:t.k};for(let t=0;t<s.length;t++)if(h.S(i,s[t]))return!0;return!1}Pt(t){let s=this.Zs.x,i=this.Zs.y;this.ui&&(s=this.ui.Zs.x+h.p,i=this.ui.Zs.y-h.u-16);let e=0,n={x:s+this.w/2,y:i+this.k/2};if(this.ui){if(this.ui?.Ts){n.x=s+this.w/2,n.y=i+this.k;let t=this.ui.ki.Ms();const h=Math.PI;t<=.4?(t/=.4,e=t*h):e=t<=.8?h:0}}else e=80*Math.PI/180;e&&h.A.ds(t,e,n),t.drawImage(h.A.es,1,1,8,32,s,i,this.w,this.k),e&&this.ui?.Ts&&h.A.ds(t,-e,n),this.ui||(h.A.resetTransform(),this.Fs&&this.Li(t))}li(t){if(!t.ei)return;const s=t.Zs.clone(),i=this.ui.Ct(),e=t.Ct(),n=new h.N(e.x-i.x,e.y-i.y);n.normalize();const r=new h.xs(this.ui.level,.5),o=Math.max(0,this.Bi-t.weight);return t.Vs.oi=!0,function(){if(r.gs())return t.Vs.oi=!1,!0;const i=r.Ms(),h=t.Zs.clone();return t.Zs.set(s.x+n.x*o*i,s.y+n.y*o*i),t.ii(h),!1}}vs(){return{x:this.Zs.x-1.5*this.w,y:this.Zs.y+1.5*this.w,w:this.k,k:this.w}}},h.Ui=class extends h.Ki{constructor(t={}){t.w=30,t.k=70,super(t),this._i=.2,this.ci=20,this.Bi=.8*h.u}Ri(){this.ui&&(this.Zs.x=this.ui.Zs.x-this.w/2,this.Zs.y=this.ui.Zs.y+this.ui.k-this.k/2,this.ui.qs>0&&(this.Zs.x+=this.ui.w+this.w/2-16))}Xs(t){if(!this.ui)return!1;const s={x:this.ui.Zs.x+this.ui.w-24,y:this.ui.Zs.y-16,w:.7*h.u+24,k:.7*h.u+16};this.ui.qs<0&&(s.x-=this.ui.w+s.w-48);const i={x:t.Zs.x,y:t.Zs.y,w:t.w,k:t.k};return h.S(i,s)}Pt(t){let s=this.Zs.x,i=this.Zs.y;this.ui&&(s=this.ui.Zs.x+this.ui.w-26,i=this.ui.Zs.y-8);let e=0,n={x:s+this.w/2,y:i+this.k/2};if(this.ui){if(this.ui?.Ts){n.x=s+this.w/2,n.y=i+this.k;let t=this.ui.ki.Ms();const h=75*Math.PI/180;t<=.4?(t/=.4,e=t*h):e=t<=.8?h:0}}else e=55*Math.PI/180;e&&h.A.ds(t,e,n),t.drawImage(h.A.ns,1,1,6,14,s,i,this.w,this.k),e&&this.ui?.Ts&&h.A.ds(t,-e,n),this.ui||(h.A.resetTransform(),this.Fs&&this.Li(t))}vs(){return{x:this.Zs.x-36,y:this.Zs.y,w:this.w+56,k:this.k}}},h.v.Xi=class extends h.v{constructor(){super(),this.Wi=0,this.zi=2}Yi(t,s,i,e,n){if(n){let s=h.p/2,n=h.u,r=i-96,o=e-n/2,a={x:r+s/2,y:o+n/2};h.A.ds(t,Math.PI/2,a),h.A.ps(t,Math.sin(.08*this.ys),1,a),t.drawImage(h.A.images,32,16,8,32,r,o,s,n),h.A.resetTransform()}t.fillStyle=n?"#fa0":"#777",t.textBaseline="middle",t.fillText(s,i,e)}Pt(){const t=h.A.Lt;let s=Math.max(2*h.u,h.A.Tt.x-500),i=Math.max(2*h.u,h.A.Tt.y-128);t.fillStyle="#0d161e",h.A.Xt(),t.font="600 64px "+h.i,t.textAlign="left",t.fillStyle="#fa0",t.fillText("TREASURE OF THE NIBELUNGS",s,i+3),t.fillStyle="#777",t.fillText("TREASURE OF THE NIBELUNGS",s,i),t.font="42px "+h.i,s+=h.p/2+114,i+=96,this.Yi(t,"New Game",s,i,0===this.Wi),i+=72,this.Yi(t,"Continue",s,i,1===this.Wi)}I(){const t=h.I();if(!t)return;let s=null;if(1===t.level)s=new h.v.ji;else if(2===t.level)s=new h.v.Zi;else if(3===t.level)s=new h.v.Ji;else{if(4!==t.level)return;s=new h.v.T}h.A.Ot(s)}update(t){this.ys+=t,h._.ct(h._.L.U,!0)?this.Wi--:h._.ct(h._.L.W,!0)?this.Wi++:h._.ct(h._.L.P,!0)&&(h.Audio.play(h.Audio.SELECT),0===this.Wi?h.A.Ot(new h.v.Vi):1===this.Wi&&this.I()),this.Wi<0?this.Wi=this.zi-1:this.Wi>=this.zi&&(this.Wi=0)}},h.v.ji=class extends h.v{constructor(){super(),this.id=1,this.Ht={w:2*h.A.Tt.x,k:8*h.u};const t=new h.Zt({x:6*h.u,y:3*h.u,item:new h.vi}),s=new h.Oi({x:13*h.u,y:3*h.u,item:new h.Ki});this.Ds(t,s),this.Gs=t,this.$i=s,this.locked=!0,this.qi=-1,this.Qi=new h.xs(this,6)}Pt(){super.Pt();const t=h.A.Lt;t.font="600 23px "+h.o,t.fillStyle="#fffc",t.textAlign="center";const s=this.Gs,i=s.Ct(),e=this.$i.Ct();if(0===this.qi)t.fillText("Move with [W][A][S][D] or arrow keys",i.x,i.y-s.k);else if(1===this.qi)t.fillText("Attack with [ENTER] or [SPACE]",e.x,e.y-2*this.$i.k);else if(2===this.qi){const s=this.items[0];if(s){const i=s.vs();t.fillText("Pick up with [E]",i.x+i.w/2,i.y-i.k-h.p-8)}}else 3===this.qi?t.fillText("Attack with the sword",e.x,e.y-this.$i.k):4===this.qi&&t.fillText("You can dodge roll with [SHIFT]",i.x,i.y-s.k-h.u)}Hs(t){const s=this.Gs,i=this.$i,e=this.items[0];if(t.fillStyle="#222",t.fillRect(s.Zs.x-h.p,s.Zs.y+s.k-h.p,2*h.u,h.u),i.Ks>0&&t.fillRect(i.Zs.x-h.p,i.Zs.y+i.k-h.p,2*h.u,h.u),e){const s=e.vs();t.fillRect(s.x-h.p,s.y+s.k-1.5*h.p,3*h.u,1.25*h.u)}}Os(t){const s=h.A;if(this.qi<0&&s.Bt(this.Gs,["Before heading out, let’s","think back on my training.","How did it go again?"],2),5!==this.qi)return;s.Bt(this.Gs,["Right, that’s how it goes!","Now I am prepared!"],2);const i=Math.sin(this.ys/25);let e=this.Ht.w-h.u+8*i,n=this.Ht.k/2+9;const r={x:e,y:n};t.fillStyle="#fff",t.textAlign="right",t.fillText("Continue",e-22,n-8);let o=-Math.PI/2;s.ds(t,o,r),t.drawImage(s.Yt,e,n,30,18),s.ds(t,-o,r)}update(t){const s=this.Gs,i=h._;if(-1===this.qi)h.A.Nt(s),i.ct(i.L.P,!0)&&this.Qi.set(0),this.Qi.gs()&&(this.locked=!1,this.qi=0);else if(0===this.qi)i.ct(i.L.C,!0),this.th?this.th.gs()&&(this.qi=1):(i.ct(i.L.U)||i.ct(i.L.X)||i.ct(i.L.W)||i.ct(i.L.B))&&(this.th=new h.xs(this,3));else if(1===this.qi){if(!(this.$i.item instanceof h.Ki)){const t=this.items[0];t.Zs.x=this.$i.Zs.x+2*h.u,t.Zs.y+=h.p,this.qi=2}}else if(2===this.qi)s.item instanceof h.Ki&&(this.qi=3);else if(3===this.qi)this.$i.Ks<this.$i.Qs-s.item.ci&&(this.qi=4);else if(4===this.qi)i.ct(i.L.O)&&(this.qi=5);else if(5===this.qi){if(s.Ct().x>=this.Ht.w-h.p)return void h.A.Ot(new h.v.Zi)}super.update(t)}},h.v.Vi=class extends h.v{constructor(){super(),this.sh=["Ez enwas niht anders","wan gestéinẹ unde golt.","unt ob man al die werlde","het dâ von versolt,","sîn wǽré niht mínner","einer marke wert."],this.ih=["Ê daz der künee rîche","wider wære komen,","die wîle hete Hagene","den schaz vil gar genomen.","","er sanctẹ in dâ ze Lôche","allen in den Rîn.","er wandẹ er soldẹ in niezen:","des enkunde niht gesîn."],this.hh=["The legendary treasure of the Nibelungs:","Gems and gold more than one could ever hope to spent.","","While the king and his men where away, Hagen stole it","all and sunk the treasure in the Rhine at Lochheim.","But he was killed before being able to retrieve the riches.","","Betting on its the existance,","many set off to look for the treasure."],this.eh=0,this.nh=new h.xs(this,2);this.sh.concat(this.ih).forEach((t=>{const s=h.A.Lt.measureText(t);this.eh=Math.max(this.eh,s.width)}))}Pt(){const t=h.A.Lt;t.fillStyle="#0d161e",h.A.Xt();let s=2*h.u,i=s,e=this.eh+h.u,n=49*(this.sh.length+this.ih.length)+1.5*h.u+16;if(t.fillStyle="#e5c382",t.fillRect(s-h.p,i-h.u,e,n),t.font="italic 40px "+h.h,t.textAlign="center",t.fillStyle="#000",s+=this.eh/2,!this.nh.gs()){const s=this.nh.Ms();i+=(1-s)*h.p,t.fillStyle="#000000"+Math.round(255*s).toString(16).padStart(2,"0")}if(this.sh.forEach((h=>{t.fillText(h,s,i),i+=49})),this.nh.gs()){if(i+=49,!this.rh.gs()){const s=this.rh.Ms();i+=(1-s)*h.p,t.fillStyle="#000000"+Math.round(255*s).toString(16).padStart(2,"0")}this.ih.forEach((h=>{t.fillText(h,s,i),i+=49}))}if(this.rh?.gs()){const n=this.oh.Ms();if(s=e+2.5*h.u,i=2*h.u+(1-n)*h.p,t.font="32px "+h.i,t.textAlign="left",t.fillStyle="#ffffff"+Math.round(255*n).toString(16).padStart(2,"0"),this.hh.forEach((h=>{t.fillText(h,s,i),i+=49})),this.oh.gs()){i+=49;let e=h.p/2,n=h.u,r=s+n/2,o=i-n/2,a={x:r+e/2,y:o+n/2};h.A.ds(t,Math.PI/2,a),h.A.ps(t,Math.sin(.08*this.ys),1,a),t.drawImage(h.A.images,32,16,8,32,r,o,e,n),h.A.resetTransform(),t.font="32px "+h.i,t.fillStyle="#fa0",t.textBaseline="middle",t.fillText("Continue",s+n+32,i)}}}update(t){this.ys+=t,this.nh.gs()&&!this.rh?this.rh=new h.xs(this,2):this.rh&&this.rh.gs()&&!this.oh&&(this.oh=new h.xs(this,2)),h._.ct(h._.L.P,!0)&&(this.nh.gs()?this.rh&&!this.rh.gs()?this.rh.set(0):this.oh&&!this.oh.gs()?this.oh.set(0):(h.Audio.play(h.Audio.SELECT),h.A.Ot(new h.v.ji)):this.nh.set(0))}},h.v.Zi=class extends h.v{constructor(){super(),this.id=2,this.ah=36,this.lh=2,this.Ht={w:h.u*this.ah,k:h.u*this.lh};const t=new h.Zt({x:h.u});this.Ds(t,new h.Gi({x:11*h.u,y:h.u-8,qs:-1,item:new h.Ki}),new h.Gi({x:20*h.u,y:h.u-8,qs:-1}),new h.Gi({x:31*h.u,qs:-1,item:new h.Ki}),new h.Gi({x:31*h.u,y:h.u-8,qs:-1})),this.Cs(new h.wi({x:11*h.u}),new h.wi({x:22*h.u,y:h.u+8}),new h.wi({x:32*h.u}),new h.wi({x:32*h.u,y:h.u+8}),new h.wi({x:33*h.u,y:h.u/2})),this.Gs=t,this.Qi=new h.xs(this,14)}fh(t,s,i,h,e){const n=t.fillStyle;t.fillRect(s,i,h,e),t.fillStyle="#0001",t.fillRect(s,i,12,e),t.fillStyle="#fff1",t.fillRect(s+h-12,i,12,e),t.fillStyle=n}Hs(t){const s=h.A,i=12*Math.sin(this.ys/50);if(this.Rs(t,i),this.uh)t.drawImage(this.uh,0,-h.p/2);else{const[t,i]=s.It(this.Ht.w,this.Ht.k+4*h.u),e=h.p;i.fillStyle="#0003",i.fillRect(0,e+1.25*h.u,this.Ht.w,this.Ht.k),i.fillStyle="#544";for(let t=0;t<this.ah;t+=4)this.fh(i,t*h.u,4,h.p,2*h.u);for(let t=0;t<this.ah;t++)for(let n=0;n<this.lh;n++){let r=t*h.u,o=n*h.u+e;i.drawImage(s.images,0,0,16,16,r,o,h.u,h.u)}i.fillStyle=s.createLinearGradient(0,e,0,this.Ht.k,"#0001"),i.fillRect(0,e,this.Ht.w,this.Ht.k),i.fillStyle="#544",i.fillRect(0,this.Ht.k-6+e,this.Ht.w,24),this.uh=t}}Os(t){this.Qi.gs()||h.A.Bt(this.Gs,["My crew is already waiting. I","just have to make it to the ship.","But it seems there are pirates","in the harbor."],2),t.fillStyle="#544";let s=this.lh*h.u-h.p/2,i=2*h.u;for(let e=0;e<this.ah;e+=4)this.fh(t,e*h.u,s,h.p,i)}update(t){super.update(t);this.Gs.Ct().x>=this.Ht.w-h.p&&h.A.Ot(new h.v.Ji)}},h.v.Ji=class extends h.v{constructor(){super(),this.id=3,this.ah=24,this.lh=6,this.Ht={w:h.u*this.ah,k:h.u*this.lh},this.Gs=new h.Zt({x:this.Ht.w/2-2*h.u,y:this.Ht.k/2-h.u,item:new h.Ui}),this.Ds(this.Gs);const t=this.Ht.k-h.u;this.Cs(this.wh(),new h.Ui({x:4*h.u,y:4.5*h.u}),new h.wi({x:this.Ht.w/2-h.p,y:this.Ht.k/2-h.u}),new h.wi({y:t}),new h.wi({x:4*h.u}),new h.wi({x:2*h.u,y:h.u}),new h.wi({x:2*h.u,y:h.u}),new h.wi({x:18*h.u}),new h.wi({x:19*h.u}),new h.wi({x:18.5*h.u,y:h.u}),new h.wi({x:8.5*h.u,y:t}),new h.wi({x:9.5*h.u,y:t}),new h.wi({x:this.Ht.w-2*h.u,y:t})),this.Qi=new h.xs(this,10),this.dh=new h.xs(this),this.ph=new h.xs(this,4),this.xh=0,this.gh=3}wh(){const t=new h.js({x:this.Ht.w/2+h.p+8,y:this.Ht.k/2-1.25*h.p,w:h.u-16,k:1.25*h.p});return t.ei=!0,t.Us=()=>!1,t.Pt=function(t){const s=this.Zs.y-8*h.u,i=this.k+8*h.u,e=this.w/3;t.fillStyle="#5a3c2e",t.fillRect(this.Zs.x,s,this.w,i),t.fillStyle="#0002",t.fillRect(this.Zs.x,s,e,i),t.fillStyle="#fff1",t.fillRect(this.Zs.x+this.w-e,s,e,i)},t}yh(){this.xh>=this.gh||(this.xh++,this.dh.set(2),this.mh=[],1===this.xh?this.mh.push(new h.Gi({x:-h.u,y:1.5*h.u,item:new h.Ui}),new h.Gi({x:-h.u,y:3*h.u}),new h.Gi({x:this.Ht.w,y:2.5*h.u,qs:-1})):2===this.xh?this.mh.push(new h.Gi({x:this.Ht.w,y:1.5*h.u,qs:-1}),new h.Gi({x:this.Ht.w,y:3*h.u,qs:-1}),new h.Gi({x:-h.u,y:2.5*h.u})):3===this.xh&&this.mh.push(new h.Gi({x:this.Ht.w,y:1.5*h.u,qs:-1}),new h.Vt({x:this.Ht.w,y:3*h.u,qs:-1,item:new h.Ki}),new h.Vt({x:-h.u,y:2.5*h.u,item:new h.Ki})),this.mh.forEach((t=>{t.hi=!0;const s=new h.N(t.qs/2);t.action=i=>this.dh.gs()?(t.action=null,void delete t.hi):t.ri(s,i,h.m)})),this.Ds(...this.mh))}Hs(t){const s=h.A;if(this.Rs(t,this.Mh),this.Eh&&t.drawImage(this.Eh,-6,-h.u),this.kh)t.drawImage(this.kh,0,0);else{const t=6,[i,e]=h.A.It(this.Ht.w+1.5*t,this.Ht.k+.5*t+2*h.u);e.lineWidth=t;let n=t/2;e.strokeStyle="#8f563b",e.strokeRect(0,n,this.Ht.w+e.lineWidth+n,this.Ht.k+n);for(let i=0;i<this.ah;i++)for(let n=0;n<this.lh;n++){let r=i*h.u,o=t+n*h.u;e.drawImage(s.images,0,0,16,16,r,o,h.u,h.u)}e.fillStyle="#5a3c2e",e.fillRect(n-e.lineWidth,this.Ht.k,this.Ht.w+2*e.lineWidth,2*h.u),e.fillStyle=h.A.createLinearGradient(0,this.Ht.k,0,this.Ht.k+2*h.u,"#0003","#4b73ac30"),e.fillRect(n-e.lineWidth,this.Ht.k,this.Ht.w+2*e.lineWidth,2*h.u),e.fillStyle=h.A.createLinearGradient(0,0,0,this.Ht.k),e.fillRect(0,0,this.Ht.w+n,this.Ht.k),this.kh=i}}Os(t){const s=h.A.Rt;s.fillStyle="#fff",s.font="600 23px "+h.o,s.textAlign="left",s.fillText(`Wave ${this.xh}/${this.gh}`,h.p,h.p);if(this._h)t.drawImage(this._h,-this.Mh,this.Ht.k+h.u+.5,h.u*(this.ah+1),h.u);else{const[t,s]=h.A.It(h.u*(this.ah+1),h.u);for(let t=0;t<=this.ah;t++)s.drawImage(h.A.images,32,0,16,16,t*h.u,0,h.u,h.u);this._h=t}if(this.Eh)t.drawImage(this.Eh,-6,this.Ht.k-h.u);else{const t=12+this.Ht.w,s=h.u,[i,e]=h.A.It(t,s);e.lineWidth=6,e.fillStyle="#5a3c2e",e.fillRect(0,0,this.Ht.w+2*e.lineWidth,18),e.fillStyle="#0002",e.fillRect(0,12,this.Ht.w+2*e.lineWidth,6),e.fillStyle="#fff1",e.fillRect(0,0,this.Ht.w+2*e.lineWidth,6);const n=this.Ht.w/h.u+1;for(let t=0;t<=n;t++){let s=t*h.u,i=18,n=h.u+1;e.fillStyle="#5a3c2e",e.fillRect(s,i,18,n),e.fillStyle="#0002",e.fillRect(s,i,6,n),e.fillStyle="#fff1",e.fillRect(s+12,i,6,n)}this.Eh=i}this.Qi.gs()||h.A.Bt(this.Gs,["The Rhine has become a","battlefield! I have to","to defend the ship!"],2)}Ah(){let t=0;return this.Es.forEach((s=>{s instanceof h.Pi&&(t+=s.Ks>0?1:0)})),t}update(t){super.update(t),this.Mh=this.ys%20/20*h.u,this.xh<=this.gh&&this.ph.gs()&&(this.yh(),this.ph.set(20)),this.xh>this.gh&&0===this.Ah()&&h.A.Ot(new h.v.T)}},h.v.T=class extends h.v{constructor(){super(),this.id=4,this.ah=24,this.lh=6,this.Ht={w:2*h.A.Tt.x,k:h.u*this.lh},this.Gs=new h.Zt({x:4*h.u,y:this.Ht.k/2-h.u,item:new h.Ui}),this.Th=new h.qt({x:this.Ht.w-5*h.u,y:this.Gs.Zs.y,qs:-1,item:new h.Ki}),this.Ds(this.Gs,this.Th);let t=this.Ht.w-h.u+6;const s=[new h.wi({x:4*h.u,y:0}),new h.wi({x:5*h.u,y:0}),new h.wi({x:12*h.u,y:0}),new h.wi({x:16*h.u,y:this.Ht.k-h.u}),new h.wi({x:17*h.u,y:this.Ht.k-2*h.u}),new h.wi({x:18*h.u,y:this.Ht.k-2*h.u}),new h.di({x:h.u-18,y:-10}),new h.di({x:h.u-18,y:6*h.u-130}),new h.di({x:t-h.u+18,y:-10}),new h.di({x:t-h.u+18,y:6*h.u-130})];for(let i=0;i<8;i++){if(3===i||4===i)continue;let e=(h.u-20)*i-46;s.push(new h.di({y:e})),s.push(new h.di({x:t,y:e}))}this.Cs(...s),this.Qi=new h.xs(this,1),this.locked=!0,this.bh=1,this.dh=new h.xs(this),this.Fh=this.Th.Ks,h.A.Nt(this.Gs)}Ih(){if(this.Fh<=0)return;const t=Math.max(0,this.Fh/this.Th.Qs),s=h.A,i=s.Rt;let e=3*h.u,n=s.Kt.height/s.scale-2*h.u,r=s.Kt.width/s.scale-6*h.u,o=24;i.fillStyle="#000a",i.fillRect(e,n,r,o),i.fillStyle="#f00",i.fillRect(e,n,r*t,o),i.fillStyle="#fff2",i.fillRect(e,n,r*t,12),i.fillStyle="#fffa",i.fillRect(e,n,2,o),i.fillRect(e+r/3,n,2,o),i.fillRect(e+2*r/3,n,2,o),i.fillRect(e+r,n,2,o)}Sh(){this.dh.set(2),this.mh=[],2===this.bh?this.mh.push(new h.Gi({x:-h.u,y:1.5*h.u,item:new h.Ui}),new h.Gi({x:this.Ht.w,y:2.5*h.u,qs:-1})):3===this.bh&&this.mh.push(new h.Gi({x:this.Ht.w,y:1.5*h.u,qs:-1}),new h.Vt({x:-h.u,y:2.5*h.u,item:new h.Ki})),this.mh.forEach((t=>{t.hi=!0;const s=new h.N(t.qs/2);t.action=i=>this.dh.gs()?(t.action=null,void delete t.hi):t.ri(s,i,h.m)})),this.Ds(...this.mh)}Hs(t){const s=h.A;if(this.Rs(t,this.Mh),this.Eh&&t.drawImage(this.Eh,-6,-h.u),this.kh)t.drawImage(this.kh,0,0);else{const t=6,[i,e]=h.A.It(this.Ht.w+1.5*t,this.Ht.k+.5*t+2*h.u);e.lineWidth=t;let n=t/2;e.strokeStyle="#8f563b",e.strokeRect(0,n,this.Ht.w+e.lineWidth+n,this.Ht.k+n);for(let i=0;i<this.ah;i++)for(let n=0;n<this.lh;n++){let r=i*h.u,o=t+n*h.u;e.drawImage(s.images,0,0,16,16,r,o,h.u,h.u)}e.fillStyle="#5a3c2e",e.fillRect(n-e.lineWidth,this.Ht.k,this.Ht.w+2*e.lineWidth,2*h.u),e.fillStyle=h.A.createLinearGradient(0,this.Ht.k,0,this.Ht.k+2*h.u,"#0003","#4b73ac30"),e.fillRect(n-e.lineWidth,this.Ht.k,this.Ht.w+2*e.lineWidth,2*h.u),e.fillStyle=h.A.createLinearGradient(0,0,0,this.Ht.k),e.fillRect(0,0,this.Ht.w+n,this.Ht.k),this.kh=i}}Os(t){const s=h.A;if(this._h)t.drawImage(this._h,-this.Mh,this.Ht.k+h.u+.5,h.u*(this.ah+1),h.u);else{const[t,i]=s.It(h.u*(this.ah+1),h.u);for(let t=0;t<=this.ah;t++)i.drawImage(s.images,32,0,16,16,t*h.u,0,h.u,h.u);this._h=t}if(this.Eh)t.drawImage(this.Eh,-6,this.Ht.k-h.u);else{const t=12+this.Ht.w,i=h.u,[e,n]=s.It(t,i);n.lineWidth=6,n.fillStyle="#5a3c2e",n.fillRect(0,0,this.Ht.w+2*n.lineWidth,18),n.fillStyle="#0002",n.fillRect(0,12,this.Ht.w+2*n.lineWidth,6),n.fillStyle="#fff1",n.fillRect(0,0,this.Ht.w+2*n.lineWidth,6);const r=this.Ht.w/h.u+1;for(let t=0;t<=r;t++){let s=t*h.u,i=18,e=h.u+1;n.fillStyle="#5a3c2e",n.fillRect(s,i,18,e),n.fillStyle="#0002",n.fillRect(s,i,6,e),n.fillStyle="#fff1",n.fillRect(s+12,i,6,e)}this.Eh=e}this.Ih(),this.Qi.gs()||s.Bt(this.Gs,["The Rhine has become a","battlefield! I have to","to defend the ship!"],2)}update(t){this.Qi.gs()&&(this.locked=!1),super.update(t),this.Mh=12*Math.sin(this.ys/50),this.Fh>this.Th.Ks&&(this.Fh=Math.max(this.Th.Ks,this.Fh-t));const s=Math.max(0,this.Fh/this.Th.Qs);1===this.bh?s<.67&&(this.bh=2,this.Sh()):2===this.bh?s<.34&&(this.bh=3,this.Sh()):0===s&&h.A.Ot(new h.v.Dh)}},h.v.Dh=class extends h.v{constructor(){super();const t=h.A.Tt.x,s=h.A.Tt.y;this.Gs=new h.Zt({x:t-h.p,y:s-h.p,qs:-1,item:new h.Ki}),this.Gs.hi=!0,this.Ds(this.Gs);const i=h.u-6,e=h.u-30;this.Nh=[];let n=1;const r=i/2,o=this.Gs.Zs.y+e;for(let t=-1;t<8;t++){const s=this.Gs.Zs.x-Math.floor(n/2)*r;for(let i=0;i<n;i++)this.Nh.push(new h.di({x:s+i*r,y:o+t*e}));n+=2}this.Ch=0,this.Hh=new h.xs(this,5),h.A.Nt(this.Gs)}Hs(t){this.Nh.forEach((s=>s.Pt(t)))}Os(t){const s=h.A.Tt.x;let i=2.5*h.u;t.fillStyle="#ff0",t.font="600 72px "+h.o,t.textAlign="center",t.fillText("YOU CLAIMED THE TREASURE!",s,i),t.fillStyle="#fffa",t.font="600 18px "+h.o,this.Ch>0&&(i+=32,t.fillText("That makes you the richest person far and wide.",s,i)),this.Ch>1&&(i+=25,t.fillText("Make sure to properly pay your crew.",s,i)),this.Ch>2&&(i+=25,t.fillText("Where will you even store all that?",s,i))}update(t){this.ys+=t,this.Es.sort(((t,s)=>t.Bs()-s.Bs())),this.Hh.gs()&&(this.Ch++,this.Hh.set(5))}};