const t={t:!0,i:'"Courier New", monospace',h:60,o:96,u:48,l:1,p:2,init(){t.m.init(),t.Audio.init(),t.g.init((()=>{t.g.level=new t._.M,t.g.A()}))},T(t,s){let i=Math.min(t.x+t.w,s.x+s.w)-Math.max(t.x,s.x);i=i<0?0:i;let h=Math.min(t.y+t.I,s.y+s.I)-Math.max(t.y,s.y);return h=h<0?0:h,i*h>Number.EPSILON}};window.addEventListener("load",(()=>t.init())),t.D=class{constructor(t=0,s=0){this.x=t,this.y=s}clone(){return new t.D(this.x,this.y)}length(){return this.x+this.y===0?0:Math.sqrt(this.x*this.x+this.y*this.y)}mul(t){return this.x*=t,this.y*=t,this}normalize(){const t=this.length();return t&&(this.x/=t,this.y/=t),this}set(t,s){this.x=t,this.y=s}},t.Audio={k:{},K:.2,v:{F:(t,s,i)=>(s[t]=2*Math.random()-1,i[t]=2*Math.random()-1,!1)},init(){this.S=new window.AudioContext,this.gain=this.S.createGain(),this.gain.connect(this.S.destination),this.volume(.1);for(const t in this.v){const s=2*this.S.sampleRate,i=this.S.createBuffer(2,s,this.S.sampleRate),h=i.getChannelData(0),e=i.getChannelData(1);for(let i=0;i<s&&!this.v[t](i,h,e);i++);this.k[t]=i}},P(){0!==this.gain.gain.value&&(this.K=this.gain.gain.value,this.gain.gain.value=0)},play(t,s,i=1,h="dec"){const e=this.S.createGain();e.connect(this.gain),"inc"===h?(e.gain.setValueAtTime(0,this.S.currentTime),e.gain.linearRampToValueAtTime(i,this.S.currentTime+s-.01)):(e.gain.setValueAtTime(i,this.S.currentTime),e.gain.linearRampToValueAtTime(0,this.S.currentTime+s-.01));const n=this.k[t.name],r=this.S.createBufferSource();return r.buffer=n,r.connect(e),r.start(0,0,s),r},H(t,s,i="sine",h="dec"){const e=this.S.createGain();e.connect(this.gain),"inc"===h?(e.gain.setValueAtTime(0,this.S.currentTime),e.gain.linearRampToValueAtTime(1,this.S.currentTime+s-.01)):(e.gain.setValueAtTime(1,this.S.currentTime),e.gain.linearRampToValueAtTime(0,this.S.currentTime+s-.01));const n=this.S.createOscillator();return n.type=i,n.frequency.setValueAtTime(t,this.S.currentTime),n.connect(e),n.start(),n.stop(this.S.currentTime+s),n},L(){this.gain.gain.value=this.K},volume(t){this.gain.gain.value=Math.min(1,Math.max(0,t))}},t.m={O:{C:1,N:2,U:3,G:4,R:5,W:10,B:11,V:12,Z:13,q:14,X:15},Y:{},j:{},J:{click:[],$:[],tt:[]},st:{},it:{},ht:{},et:{},nt:new t.D,rt:0,ot(){this.ct={[this.O.C]:{keyboard:["Escape"],gamepad:[9]},[this.O.B]:{keyboard:["ArrowUp","KeyW","KeyZ","KeyY"],gamepad:[12]},[this.O.W]:{keyboard:["ArrowLeft","KeyA","KeyQ"],gamepad:[14]},[this.O.Z]:{keyboard:["ArrowDown","KeyS"],gamepad:[13]},[this.O.V]:{keyboard:["ArrowRight","KeyD"],gamepad:[15]},[this.O.G]:{keyboard:["Space","Enter"],gamepad:[0]},[this.O.N]:{keyboard:["Enter"],gamepad:[0]},[this.O.R]:{keyboard:["KeyE"],gamepad:[0]}}},ut(){let t=0,s=0;if(this.dt(this.O.W)?t=-1:this.dt(this.O.V)&&(t=1),this.dt(this.O.B)?s=-1:this.dt(this.O.Z)&&(s=1),!t||!s){const i=.3;for(const h in this.ht){const e=this.ht[h];e.axes[0]&&Math.abs(e.axes[0])>i?t=e.axes[0]>0?1:-1:e.axes[2]&&Math.abs(e.axes[2])>i&&(t=e.axes[2]>0?1:-1),e.axes[1]&&Math.abs(e.axes[1])>i?s=e.axes[1]>0?1:-1:e.axes[3]&&Math.abs(e.axes[3])>i&&(s=e.axes[3]>0?1:-1)}}return{x:t,y:s}},lt(t){return this.ct[t]},init(){this.ot(),this.wt()},dt(t,s){const i=this.lt(t);for(const t of i.keyboard)if(this.ft(t,s))return!0;for(const t of i.gamepad)if(this.gt(t,s))return!0;if(t===this.O.W)for(const t in this.ht){const i=this.ht[t];if(i.axes[6]&&i.axes[6]<=-.2)return!this.j["yt"]&&(s&&(this.j["yt"]=!0),!0)}else if(t===this.O.V)for(const t in this.ht){const i=this.ht[t];if(i.axes[6]&&i.axes[6]>=.2)return!this.j["Et"]&&(s&&(this.j["Et"]=!0),!0)}else if(t===this.O.B)for(const t in this.ht){const i=this.ht[t];if(i.axes[7]&&i.axes[7]<=-.2)return!this.j["xt"]&&(s&&(this.j["xt"]=!0),!0)}else if(t===this.O.Z)for(const t in this.ht){const i=this.ht[t];if(i.axes[7]&&i.axes[7]>=.2)return!this.j["Mt"]&&(s&&(this.j["Mt"]=!0),!0)}return!1},gt(t,s){for(const i in this.ht){const h=this.ht[i].buttons[t];if(h&&h.pressed)return!this.j[t]&&(s&&(this.j[t]=!0),!0)}return!1},ft(t,s){const i=this.et[t];return!(!i||!i.time)&&(s&&(i.time=0,i._t=!0),!0)},At(t,s){if("function"!=typeof s)return void(this.J[t]=[]);const i=this.J[t].indexOf(s);i>=0&&this.J[t].splice(i,1)},Tt(t,s){this.J[t].push(s)},It(t,s){const i=this.st[t]||[];i.push(s),this.st[t]=i},Dt(t,s){const i=this.it[t]||[];i.push(s),this.it[t]=i},wt(){document.body.onkeydown=t=>{const s=this.et[t.code];s&&s._t||(this.et[t.code]={time:Date.now()},this.st[t.code]&&this.st[t.code].forEach((t=>t())))},document.body.onkeyup=t=>{this.et[t.code]={time:0},this.it[t.code]&&this.it[t.code].forEach((t=>t()))},document.body.onmousemove=t=>{this.nt.x=t.clientX,this.nt.y=t.clientY},document.body.onclick=t=>{this.J.click.forEach((t=>t(this.nt.clone())))},window.addEventListener("gamepadconnected",(t=>{this.rt++,this.ht[t.gamepad.index]=t.gamepad,this.J.$.forEach((t=>t()))})),window.addEventListener("gamepaddisconnected",(t=>{this.rt--,delete this.ht[t.gamepad.index],this.J.tt.forEach((t=>t()))}))},update(){const t=navigator.getGamepads();for(const s of t)if(s){this.ht[s.index]=s;for(const t in this.j)"axis6-"===t||"axis6+"===t?s.axes[6]||delete this.j[t]:"axis7-"===t||"axis7+"===t?s.axes[7]||delete this.j[t]:s.buttons[t]&&!s.buttons[t].pressed&&delete this.j[t]}}},t.g={bt:new t.D,scale:1,kt:0,Kt:0,vt(t){const[s,i]=this.Ft(t.width,t.height);i.drawImage(t,0,0);const h=i.getImageData(0,0,t.width,t.height);for(let s=0;s<t.height;s++)for(let i=0;i<t.width;i++){const e=4*(s*t.width+i);0!==h.data[e+3]&&(h.data[e+0]=255,h.data[e+1]=255,h.data[e+2]=255)}return i.putImageData(h,0,0),s},St(t){const s=t.Pt();this.kt=this.bt.x-s.x,this.Kt=this.bt.y-s.y},clear(){this.S.setTransform(1,0,0,1,0,0),this.S.clearRect(0,0,window.innerWidth,window.innerHeight),this.Ht.setTransform(1,0,0,1,0,0),this.Ht.clearRect(0,0,window.innerWidth,window.innerHeight)},Lt(){this.clear(),this.S.setTransform(this.scale,0,0,this.scale,this.kt,this.Kt),this.Ht.setTransform(this.scale,0,0,this.scale,0,0),this.level&&this.level.Lt()},Ot(){this.Ht.setTransform(this.scale,0,0,this.scale,0,0),this.Ht.clearRect(0,0,window.innerWidth,window.innerHeight),this.Ht.fillStyle="rgba(0,0,0,0.4)",this.Ht.fillRect(0,0,window.innerWidth,window.innerHeight),this.Ht.fillStyle="#FFF",this.Ht.font="normal 56px "+t.i,this.Ht.textAlign="center",this.Ht.textBaseline="top",this.Ht.fillText("PAUSED",this.bt.x,60)},Ft(t,s){const i=document.createElement("canvas");i.width=t,i.height=s;const h=i.getContext("2d",{alpha:!0});return h.imageSmoothingEnabled=!1,[i,h]},init(t){this.Ct=document.getElementById("c"),this.S=this.Ct.getContext("2d",{alpha:!0}),this.S.imageSmoothingEnabled=!1,this.Nt=document.getElementById("ui"),this.Ht=this.Nt.getContext("2d",{alpha:!0}),this.Ht.imageSmoothingEnabled=!1,this.Ut((()=>{this.wt(),t()}))},Ut(t){const s=new Image;s.onload=()=>{this.images=s,this.Gt=this.vt(s),t()},s.src="i.png"},A(s=0){if(t.m.update(),s&&this.Rt){const i=(s-this.Rt)/(1e3/t.h);if(this.S.imageSmoothingEnabled=!1,this.Ht.imageSmoothingEnabled=!1,this.Wt)return void this.Ot();this.level.update(i),this.Lt(),t.t&&(this.Ht.fillStyle="#000",this.Ht.fillRect(40,window.innerHeight-45,140,28),this.Ht.fillStyle="#FFF",this.Ht.font="bold 16px "+t.i,this.Ht.textAlign="right",this.Ht.textBaseline="bottom",this.Ht.fillText(~~(t.h/i)+" FPS / "+this.scale,160,window.innerHeight-22))}this.Rt=s,requestAnimationFrame((t=>this.A(t)))},resetTransform(){this.S.setTransform(this.scale,0,0,this.scale,this.kt,this.Kt)},pause(){this.Wt=!0,t.Audio.P()},wt(){window.addEventListener("resize",(t=>this.resize())),this.resize();const s=t.m.lt(t.m.O.C);setInterval((()=>{this.Wt&&t.m.update(),s.gamepad.forEach((s=>{t.m.gt(s,!0)&&this.zt()}))}),100);const i=()=>this.zt();s.keyboard.forEach((s=>t.m.Dt(s,i))),t.m.Tt("gp_disconnect",(()=>this.pause()))},Bt(){this.level=new this.level.constructor},resize(){this.Ct.width=window.innerWidth,this.Ct.height=window.innerHeight,this.Nt.width=window.innerWidth,this.Nt.height=window.innerHeight,this.bt.x=Math.floor(this.Ct.width/2),this.bt.y=Math.floor(this.Ct.height/2),this.Wt&&(clearTimeout(this.Vt),this.Vt=setTimeout((()=>this.Ot()),100))},zt(){this.Wt?this.unpause():this.pause()},unpause(){this.Wt&&(this.Wt=!1,t.Audio.L(),this.A())}},t.Zt=class{constructor(t,s=0){this.level=t,this.set(s)}qt(){return this.level.Xt>this.timeEnd}Yt(){return Math.min(1,1-(this.timeEnd-this.level.Xt)/this.duration)}set(s){this.duration=s*t.h,this.timeEnd=this.level.Xt+this.duration}},t._=class{constructor(){this.jt=!1,this.Qt={},this.Xt=0,this.Jt=[],this.$t=[],this.items=[],this.ts={p1:null,p2:null}}ss(...t){this.$t.push(...t),this.hs(...t)}es(...t){this.items.push(...t),this.hs(...t)}hs(...t){t.forEach((t=>t.level=this)),this.Jt.push(...t)}removeItem(t){let s=this.items.indexOf(t);s>=0&&this.items.splice(s,1),s=this.Jt.indexOf(t),s>=0&&this.Jt.splice(s,1)}Lt(){this.jt?this.ns(t.g.S):(this.rs(t.g.S),this.Jt.forEach((s=>s.Lt(t.g.S))))}ns(s){const i=t.g.bt;s.font="bold 36px "+t.i,s.textAlign="center",s.fillStyle="#DDD",s.fillText("GAME OVER",i.x,i.y)}update(s){if(this.Xt+=s,this.jt)t.m.dt(t.m.O.N,!0)&&t.g.Bt();else{const i=this.ts.p1;if(i){t.g.St(i),t.m.dt(t.m.O.G,!0)&&i.attack();let h=t.m.ut();h=new t.D(h.x,h.y),i.update(s,h.normalize());const e=i.os();this.items.forEach((s=>{s.cs=!1,s.us&&t.T(s.os(),e)&&(s.cs=!0,t.m.dt(t.m.O.R,!0)&&i.ds(s))}))}this.Jt.sort(((t,s)=>t.ls()-s.ls())),this.Jt.forEach((h=>{h!==i&&(h.update(s),i?.ws&&(!h.fs||h.fs.qt())&&h.ps>0&&i.item.gs(h)&&h.ys(i.item),h.action||t.xs.Es(h,i))}))}}},t.Ms=class{constructor(s={}){this._s=new t.D(s.x,s.y),this.w=s.w||0,this.I=s.I||0,this.As=0,this.fs=null,this.Ts={},this.us=!1,this.Is=[],this.Ds=new t.D(1,0),this.bs=1/0,this.ps=1/0,this.cs=!1,this.level=null,this.speed=new t.D,this.state=t.l}ks(t){for(let s=this.Is.length-1;s>=0;s--){(0,this.Is[s])(t)&&this.Is.splice(s,1)}}Lt(t){}os(){return{x:this._s.x,y:this._s.y,w:this.w,I:this.I}}Pt(){return{x:this._s.x+this.w/2,y:this._s.y+this.I/2}}Ks(s,i,h){return this.Ts.vs||(this._s.x+=Math.round(i*s.x*this.speed.x),this._s.y+=Math.round(i*s.y*this.speed.y),(s.x||s.y)&&(h=t.p,this.Ds.set(0==s.x?this.Ds.x:s.x>0?1:-1,0==s.y?this.Ds.y:s.y>0?1:-1))),h}ls(){return this._s.y+this.I}ys(s){this.fs=this.fs||new t.Zt(this.level),this.fs.set(.5),this.ps=Math.max(0,this.ps-s.Fs);const i=s.Ss(this);i&&this.Is.push(i),this.ps<=0&&this.Ps()}update(s,i){if(this.ps<=0||this.Hs)return;let h=t.l;this.As+=s,this.ks(s),i&&(h=this.Ks(i,s,h)),this.state!=h&&(this.As=0),this.state=h}},t.Ls=class extends t.Ms{constructor(s={}){s.w=t.o,s.I=t.o,super(s),this.Os=42/t.h,this.action=null,this.Cs=null,this.ws=!1,this.bs=100,this.ps=100,this.item=s.item,this.speed.set(12,12),this.item&&(this.item.Hs=this)}Ns(t,s){const i=this.Pt();t.translate(i.x,i.y),t.scale(s,1),t.translate(-i.x,-i.y)}Us(t){const s=this.Pt();t.translate(s.x,s.y),t.rotate(.1*Math.sin(this.As*this.Os)),t.translate(-s.x,-s.y)}Gs(t){if(this.ps==this.bs)return;let s=this.ps/this.bs,i=this._s.x+16,h=this._s.y-24,e=this.w-32;t.fillStyle="#000",t.fillRect(i,h,e,8),t.fillStyle="#f00",t.fillRect(i,h,e*s,8)}Rs(t,s){const i=this.Ds.x<0;i&&this.Ns(t,-1),this.item?.Lt(t,s),i&&this.Ns(t,-1)}attack(){!this.ws&&this.item&&(this.Cs=this.Cs||new t.Zt(this.level),this.Cs.set(this.item.Ws),this.ws=!0)}Lt(s){if(this.ps<=0)return;let i=this.zs+(this.Ds.x<0?16:0),h=t.g.images;if(this.fs&&!this.fs.qt()){const s=this.fs.Yt();(s>=0&&s<=.2||s>=.4&&s<=.6||s>=.8&&s<=1)&&(h=t.g.Gt)}this.state===t.p&&this.Us(s),this.item&&this.Rs(s,h),this.Gs(s),s.drawImage(h,i,this.Bs,this.Vs,this.Zs,this._s.x,this._s.y,t.o,t.o),t.g.resetTransform()}Ps(){this.item?.qs(),this.ps>0&&(this.item=new t.Xs,this.item.Hs=this)}os(){const s={x:this._s.x,y:this._s.y+this.I,w:this.w,I:t.u/2};return s.y-=s.I,s}ds(t){this.item?.qs(),this.item=t,t.cs=!1,t.Hs=this,this.level.removeItem(t)}update(s,i){if(this.ps<=0)return;let h=t.l;this.As+=s,this.ks(s),i&&(h=this.Ks(i,s,h)),this.action&&(h=this.action(s)||h),this.state!=h&&(this.As=0),this.ws&&this.Cs.qt()&&(this.ws=!1),this.level&&(this._s.x=Math.min(this.level.Qt.x+this.level.Qt.w-this.w,Math.max(this.level.Qt.x,this._s.x)),this._s.y=Math.min(this.level.Qt.y+this.level.Qt.I-this.I,Math.max(this.level.Qt.y,this._s.y))),this.state=h}},t.xs={Es(s,i){if(!i||s.Ts.vs)return;const h=new t.Zt(s.level,1),e=s.Pt(),n=i.Pt(),r=new t.D(n.x-e.x,n.y-e.y);r.normalize(),s.action=function(t){if(h.qt())s.action=null;else if(!s.Ts.vs)return s.Ks(r,t,0)}}},t.Ys=class extends t.Ms{constructor(t){super(t),this.Hs=null}js(t){const s=this.os();t.strokeStyle="#f00",t.lineWidth=2,t.strokeRect(s.x,s.y,s.w,s.I)}Qs(){this._s.set(this.Hs._s.x+this.Hs.w/2,this.Hs._s.y-this.Hs.I)}qs(){this.us&&(this.Qs(),this.Hs.level.es(this)),this.Hs=null}Ss(){return null}ls(){return this._s.y}},t.Js=class extends t.Ls{constructor(s){super(s),this.zs=0,this.Bs=32,this.Vs=16,this.Zs=16,this.Os=32/t.h,this.speed.set(3,3)}ys(t){this.ps<=0||super.ys(t)}},t.$s=class extends t.Ls{constructor(t){super(t),this.zs=0,this.Bs=16,this.Vs=16,this.Zs=16}},t.Xs=class extends t.Ys{constructor(t={}){super(t),this.Ws=.15,this.Fs=10}gs(s){const i={x:this.Hs._s.x+this.Hs.w,y:this.Hs._s.y+t.u/2,w:t.u,I:t.u};this.Hs.Ds.x<0&&(i.x-=this.Hs.w+i.w);const h={x:s._s.x,y:s._s.y,w:s.w,I:s.I};return t.T(h,i)}Lt(s,i){let h=this._s.x,e=this._s.y;if(this.Hs&&(h=this.Hs._s.x+this.Hs.w-32,e=this.Hs._s.y+this.Hs.I/2-16),this.Hs.ws){const s=Math.sin(this.Hs.Cs.Yt()*Math.PI*2)*t.u;h+=Math.max(0,s)}s.drawImage(i||t.g.images,40,16,8,8,h,e,t.u,t.u)}Ss(s){if(s instanceof t.Ls)return function(){return s.Ps(),!0}}},t.ti=class extends t.Ys{constructor(s={}){s.w=t.u,s.I=2*t.o,super(s),this.Ws=.25,this.us=!0,this.Fs=25}Qs(){this.Hs&&this._s.set(this.Hs._s.x+this.Hs.w/2,this.Hs._s.y-this.Hs.I+this.I/2)}gs(s){const i=[{x:this.Hs._s.x+this.Hs.w,y:this.Hs._s.y,w:1.7*t.o,I:t.o},{x:this.Hs._s.x+this.Hs.w,y:this.Hs._s.y-.7*t.o,w:t.o,I:2.4*t.o}];this.Hs.Ds.x<0&&(i[0].x-=this.Hs.w+i[0].w,i[1].x-=this.Hs.w+i[1].w);const h={x:s._s.x,y:s._s.y,w:s.w,I:s.I};for(let s=0;s<i.length;s++)if(t.T(h,i[s]))return!0;return!1}Lt(s,i){let h=this._s.x,e=this._s.y;this.Hs&&(h=this.Hs._s.x+t.u,e=this.Hs._s.y-t.o-16);let n=0,r={x:h+this.w/2,y:e+this.I/2};if(this.Hs){if(this.Hs?.ws){r.x=h+t.o/4,r.y=e+2*t.o;let s=this.Hs.Cs.Yt();const i=Math.PI;s<=.4?(s/=.4,n=s*i):n=s<=.8?i:0}}else n=80*Math.PI/180;n&&(s.translate(r.x,r.y),s.rotate(n),s.translate(-r.x,-r.y)),s.drawImage(i||t.g.images,32,16,8,32,h,e,t.u,2*t.o),n&&this.Hs?.ws&&(s.translate(r.x,r.y),s.rotate(-n),s.translate(-r.x,-r.y)),this.Hs||(t.g.resetTransform(),this.cs&&this.js(s))}Ss(s){if(!(s instanceof t.Ls))return;const i=s._s.clone(),h=this.Hs.Pt(),e=s.Pt(),n=new t.D(e.x-h.x,e.y-h.y);n.normalize();const r=new t.Zt(this.Hs.level,.3),o=1.5*t.o;return s.Ts.vs=!0,function(){if(r.qt())return s.Ts.vs=!1,!0;const t=r.Yt();return s._s.set(i.x+n.x*o*t,i.y+n.y*o*t),!1}}os(){return{x:this._s.x-1.5*this.w,y:this._s.y+1.5*this.w,w:this.I,I:this.w}}},t._.M=class extends t._{constructor(){super(),this.Qt={x:0,y:0,w:8*t.o,I:8*t.o};const s=new t.$s({x:400,y:400,item:new t.Xs}),i=new t.Js({x:600,y:400,item:new t.ti});i.Ds.x=-1,this.ss(s,i);const h=new t.ti({x:400,y:540});this.es(h),this.ts.p1=s}rs(s){s.strokeStyle="#8f563b",s.lineWidth=t.o/16;let i=s.lineWidth/2;s.strokeRect(-i,-i,this.Qt.w+2*i,this.Qt.I);for(let i=0;i<8;i++)for(let h=0;h<8;h++){let e=i*t.o,n=h*t.o;s.drawImage(t.g.images,0,0,16,16,e,n,t.o,t.o)}}};