let t,s,i;s=.3,t=(t=1,s=.05,h=220,e=0,n=0,r=.1,o=0,a=1,c=0,l=0,u=0,d=0,f=0,w=0,p=0,g=0,m=0,y=1,x=0,E=0,M=Math,k=44100,A=2*M.PI,T=(c*=500*A/k/k),_=(h*=(1-s+2*s*M.random(s=[]))*A/k),b=0,D=0,I=0,F=1,v=0,C=0,K=0,L,N)=>{for(l*=500*A/k**3,p*=A/k,u*=A/k,d*=k,f=k*f|0,N=(e=k*e+9)+(x*=k)+(n*=k)+(r*=k)+(m*=k)|0;I<N;s[I++]=K)++C%(100*g|0)||(K=o?1<o?2<o?3<o?M.sin((b%A)**3):M.max(M.min(M.tan(b),1),-1):1-(2*b/A%2+2)%2:1-4*M.abs(M.round(b/A)-b/A):M.sin(b),K=(f?1-E+E*M.sin(A*I/f):1)*(0<K?1:-1)*M.abs(K)**a*.3*t*(I<e?I/e:I<e+x?1-(I-e)/x*(1-y):I<e+x+n?y:I<N-m?(N-I-m)/r*y:0),K=m?K/2+(m>I?0:(I<N-m?1:(N-I)/m)*s[I-m|0]/2):K),b+=(L=(h+=c+=l)*M.cos(p*D++))-L*w*(1-1e9*(M.sin(I)+1)%2),F&&++F>d&&(h+=u,_+=u,F=0),!f||++v%f||(h=_,c=T,F||=1);return(t=i.createBuffer(1,N,k)).getChannelData(0).set(s),(h=i.createBufferSource()).buffer=t,h.connect(i.destination),h.start(),h},i=new AudioContext;const h={t:!0,i:"Arial, sans-serif",h:60,o:96,l:48,u:1,p:2,init(){h.g.init(),h.m.init((()=>{h.m.level=new h.k.M,h.m.A()}))},T(t,s){let i=Math.min(t.x+t.w,s.x+s.w)-Math.max(t.x,s.x);i=i<0?0:i;let h=Math.min(t.y+t._,s.y+s._)-Math.max(t.y,s.y);return h=h<0?0:h,i*h>Number.EPSILON}};window.addEventListener("load",(()=>h.init())),h.D=class{constructor(t=0,s=0){this.x=t,this.y=s}clone(){return new h.D(this.x,this.y)}length(){return this.x+this.y===0?0:Math.sqrt(this.x*this.x+this.y*this.y)}mul(t){return this.x*=t,this.y*=t,this}normalize(){const t=this.length();return t&&(this.x/=t,this.y/=t),this}set(t,s){this.x=t,this.y=s}},h.Audio={I:[.3,0,8,.01,.01,.01,1,2.29,86,,,,,,-82,,,.42,.01],F:[.2,0,68,.02,.01,.18,2,1.89,-.3,,,,,1.4,,.3,,.59,.06,.12],v:[.15,0,382,.1,.01,.09,,2.2,-1.2,-3.8,,,,5,,,,.48,.05],SELECT:[.2,0,883,.01,.07,,1,1.74,,,366,.1,.06,,,,,.62,.01],play(s){t(...s)}},h.g={C:{K:1,L:2,N:3,I:4,S:5,v:6,R:10,H:11,G:12,P:13,O:14,B:15},U:{},W:{},Y:{click:[],Z:[],V:[]},X:{},j:{},q:{},J:{},$:0,tt(){this.st={[this.C.K]:{keyboard:["Escape"],gamepad:[9]},[this.C.H]:{keyboard:["ArrowUp","KeyW","KeyZ","KeyY"],gamepad:[12]},[this.C.R]:{keyboard:["ArrowLeft","KeyA","KeyQ"],gamepad:[14]},[this.C.P]:{keyboard:["ArrowDown","KeyS"],gamepad:[13]},[this.C.G]:{keyboard:["ArrowRight","KeyD"],gamepad:[15]},[this.C.I]:{keyboard:["Space","Enter"],gamepad:[0]},[this.C.v]:{keyboard:["KeyR"],gamepad:[]},[this.C.L]:{keyboard:["Enter"],gamepad:[0]},[this.C.S]:{keyboard:["KeyE"],gamepad:[0]}}},it(){let t=0,s=0;if(this.ht(this.C.R)?t=-1:this.ht(this.C.G)&&(t=1),this.ht(this.C.H)?s=-1:this.ht(this.C.P)&&(s=1),!t||!s){const i=.3;for(const h in this.q){const e=this.q[h];e.axes[0]&&Math.abs(e.axes[0])>i?t=e.axes[0]>0?1:-1:e.axes[2]&&Math.abs(e.axes[2])>i&&(t=e.axes[2]>0?1:-1),e.axes[1]&&Math.abs(e.axes[1])>i?s=e.axes[1]>0?1:-1:e.axes[3]&&Math.abs(e.axes[3])>i&&(s=e.axes[3]>0?1:-1)}}return{x:t,y:s}},et(t){return this.st[t]},init(){this.tt(),this.nt()},ht(t,s){const i=this.et(t);for(const t of i.keyboard)if(this.rt(t,s))return!0;for(const t of i.gamepad)if(this.ot(t,s))return!0;if(t===this.C.R)for(const t in this.q){const i=this.q[t];if(i.axes[6]&&i.axes[6]<=-.2)return!this.W["ct"]&&(s&&(this.W["ct"]=!0),!0)}else if(t===this.C.G)for(const t in this.q){const i=this.q[t];if(i.axes[6]&&i.axes[6]>=.2)return!this.W["lt"]&&(s&&(this.W["lt"]=!0),!0)}else if(t===this.C.H)for(const t in this.q){const i=this.q[t];if(i.axes[7]&&i.axes[7]<=-.2)return!this.W["ut"]&&(s&&(this.W["ut"]=!0),!0)}else if(t===this.C.P)for(const t in this.q){const i=this.q[t];if(i.axes[7]&&i.axes[7]>=.2)return!this.W["dt"]&&(s&&(this.W["dt"]=!0),!0)}return!1},ot(t,s){for(const i in this.q){const h=this.q[i].buttons[t];if(h&&h.pressed)return!this.W[t]&&(s&&(this.W[t]=!0),!0)}return!1},rt(t,s){const i=this.J[t];return!(!i||!i.time)&&(s&&(i.time=0,i.ft=!0),!0)},wt(t,s){if("function"!=typeof s)return void(this.Y[t]=[]);const i=this.Y[t].indexOf(s);i>=0&&this.Y[t].splice(i,1)},gt(t,s){this.Y[t].push(s)},yt(t,s){const i=this.X[t]||[];i.push(s),this.X[t]=i},xt(t,s){const i=this.j[t]||[];i.push(s),this.j[t]=i},nt(){document.body.onkeydown=t=>{const s=this.J[t.code];s&&s.ft||(this.J[t.code]={time:Date.now()},this.X[t.code]&&this.X[t.code].forEach((t=>t())))},document.body.onkeyup=t=>{this.J[t.code]={time:0},this.j[t.code]&&this.j[t.code].forEach((t=>t()))},window.addEventListener("gamepadconnected",(t=>{this.$++,this.q[t.gamepad.index]=t.gamepad,this.Y.Z.forEach((t=>t()))})),window.addEventListener("gamepaddisconnected",(t=>{this.$--,delete this.q[t.gamepad.index],this.Y.V.forEach((t=>t()))}))},update(){const t=navigator.getGamepads();for(const s of t)if(s){this.q[s.index]=s;for(const t in this.W)"axis6-"===t||"axis6+"===t?s.axes[6]||delete this.W[t]:"axis7-"===t||"axis7+"===t?s.axes[7]||delete this.W[t]:s.buttons[t]&&!s.buttons[t].pressed&&delete this.W[t]}}},h.m={Et:new h.D,scale:1,Mt:0,kt:0,At(t){const[s,i]=this.Tt(t.width,t.height);i.drawImage(t,0,0);const h=i.getImageData(0,0,t.width,t.height);for(let s=0;s<t.height;s++)for(let i=0;i<t.width;i++){const e=4*(s*t.width+i);0!==h.data[e+3]&&(h.data[e+0]=255,h.data[e+1]=255,h.data[e+2]=255)}return i.putImageData(h,0,0),s},_t(t){const s=t.bt();if(this.Mt=this.Et.x-s.x,this.kt=(this.Et.y-s.y)*this.scale,t.level){const s=t.level.Dt;this.Mt=Math.min(0,Math.max(-s.w+2*this.Et.x,this.Mt))}this.Mt*=this.scale},It(t){this.level=t},clear(){this.Ft.setTransform(1,0,0,1,0,0),this.Ft.clearRect(0,0,window.innerWidth,window.innerHeight),this.vt.setTransform(1,0,0,1,0,0),this.vt.clearRect(0,0,window.innerWidth,window.innerHeight)},createLinearGradient(t,s,i,h,e="#0003",n="#fff1"){const r=this.Ft.createLinearGradient(t,s,i,h);return r.addColorStop(0,e),r.addColorStop(1,n),r},Ct(){this.clear(),this.Ft.setTransform(this.scale,0,0,this.scale,this.Mt,this.kt),this.vt.setTransform(this.scale,0,0,this.scale,0,0),this.level&&this.level.Ct()},Kt(){this.vt.setTransform(1,0,0,1,0,0),this.vt.clearRect(0,0,window.innerWidth,window.innerHeight),this.vt.setTransform(this.scale,0,0,this.scale,0,0),this.vt.fillStyle="rgba(0,0,0,0.4)",this.vt.fillRect(0,0,this.Lt.width/this.scale,this.Lt.height/this.scale),this.vt.fillStyle="#FFF",this.vt.font="56px "+h.i,this.vt.textAlign="center",this.vt.textBaseline="top",this.vt.fillText("GAME OVER",this.Et.x,this.Et.y-56)},Nt(t,s,i){let e=9*h.o,n=2*h.o,r=this.Et.x-e/2,o=this.Et.y-n/2;1===i?o=2*this.Et.y-n-h.o:2===i&&(o=h.o),this.vt.fillStyle="#444",this.vt.fillRect(r,o,e,n),this.vt.drawImage(this.images,t.St,t.Rt,t.Ht,t.Gt,r,o,2*h.o,2*h.o),this.vt.lineWidth=12,this.vt.strokeStyle="#847e87",this.vt.strokeRect(r+6,o+6,2*h.o-12,2*h.o-12),this.vt.fillStyle="#fff",this.vt.font='600 31px "Courier New", monospace',this.vt.textAlign="left",this.vt.textBaseline="alphabetic";let a=r+24,c=o+38;s.forEach((t=>{this.vt.fillText(t,a+2*h.o,c),c+=38}))},Pt(){this.vt.setTransform(1,0,0,1,0,0),this.vt.clearRect(0,0,window.innerWidth,window.innerHeight),this.vt.setTransform(this.scale,0,0,this.scale,0,0),this.vt.fillStyle="rgba(0,0,0,0.4)",this.vt.fillRect(0,0,this.Lt.width/this.scale,this.Lt.height/this.scale),this.vt.fillStyle="#FFF",this.vt.font="56px "+h.i,this.vt.textAlign="center",this.vt.textBaseline="top",this.vt.fillText("PAUSED",this.Et.x,this.Et.y-56)},Ot(){this.Ft.fillRect(-this.Mt/this.scale-h.o,-this.kt/this.scale-h.o,this.Bt.width/this.scale+2*h.o,this.Bt.height/this.scale+2*h.o)},Tt(t,s){const i=document.createElement("canvas");i.width=t,i.height=s;const h=i.getContext("2d",{alpha:!0});return h.imageSmoothingEnabled=!1,[i,h]},init(t){this.Bt=document.getElementById("c"),this.Ft=this.Bt.getContext("2d",{alpha:!0}),this.Ft.imageSmoothingEnabled=!1,this.Lt=document.getElementById("ui"),this.vt=this.Lt.getContext("2d",{alpha:!0}),this.vt.imageSmoothingEnabled=!1,this.Ut((()=>{this.nt(),t()}))},Ut(t){const s=new Image;s.onload=()=>{this.images=s,this.zt=this.At(s);const[i,e]=this.Tt(5,3),n=new ImageData(5,3);n.data.set([255,255,255,196,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,196,0,0,0,0,255,255,255,196,255,255,255,255,255,255,255,196,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,196,0,0,0,0,0,0,0,0]),e.putImageData(n,0,0),this.Wt=i;const[r,o]=this.Tt(h.o,h.o);o.drawImage(this.images,16,0,16,16,0,0,h.o,h.o),this.Yt=o.createPattern(r,"repeat");const[a,c]=h.m.Tt(h.o,h.o),l=c.createRadialGradient(h.l,h.l,0,h.l,h.l,h.l);l.addColorStop(0,"#000a"),l.addColorStop(.9,"#0002"),l.addColorStop(1,"#0000"),c.fillStyle=l,c.fillRect(0,0,h.o,h.o),this.Zt=a,t()},s.src="i.png"},A(t=0){if(h.g.update(),t&&this.Vt){const s=(t-this.Vt)/(1e3/h.h);if(this.Ft.imageSmoothingEnabled=!1,this.vt.imageSmoothingEnabled=!1,this.Ft.lineWidth=1,this.Ft.textBaseline="alphabetic",this.Xt)return void this.Pt();this.level.update(s),this.Ct(),h.t&&(this.vt.fillStyle="#000",this.vt.fillRect(60,this.Bt.height/this.scale-74,140,28),this.vt.fillStyle="#FFF",this.vt.font="16px monospace",this.vt.textAlign="right",this.vt.textBaseline="bottom",this.vt.fillText(~~(h.h/s)+" FPS, "+Math.round(1e3*this.scale)/1e3,192,this.Bt.height/this.scale-50))}this.Vt=t,requestAnimationFrame((t=>this.A(t)))},pause(){this.Xt=!0},nt(){window.addEventListener("resize",(t=>this.resize())),this.resize();const t=h.g.et(h.g.C.K);setInterval((()=>{this.Xt&&h.g.update(),t.gamepad.forEach((t=>{h.g.ot(t,!0)&&this.jt()}))}),100);const s=()=>this.jt();t.keyboard.forEach((t=>h.g.xt(t,s))),h.g.gt("gp_disconnect",(()=>this.pause()))},qt(){this.level=new this.level.constructor},resetTransform(){this.Ft.setTransform(this.scale,0,0,this.scale,this.Mt,this.kt)},resize(){const t=1920/1080;let s=window.innerHeight,i=Math.round(s*t);i>window.innerWidth&&(i=window.innerWidth,s=i/t),this.scale=s/1080,this.Et.x=i/2/this.scale,this.Et.y=s/2/this.scale;let h=~~((window.innerHeight-s)/2)+"px",e=~~((window.innerWidth-i)/2)+"px";this.Bt.width=i,this.Bt.height=s,this.Bt.style.top=h,this.Bt.style.left=e,this.Lt.width=i,this.Lt.height=s,this.Lt.style.top=h,this.Lt.style.left=e,this.Xt&&(clearTimeout(this.Qt),this.Qt=setTimeout((()=>this.Pt()),100))},Jt(t,s,i){t.translate(i.x,i.y),t.rotate(s),t.translate(-i.x,-i.y)},$t(t,s,i,h){t.translate(h.x,h.y),t.scale(s,i),t.translate(-h.x,-h.y)},jt(){this.Xt?this.unpause():this.pause()},unpause(){this.Xt&&(this.Xt=!1,this.A())}},h.ts=class{constructor(t,s=0){this.level=t,this.set(s)}ss(){return this.level.hs>this.timeEnd}es(){return Math.min(1,1-(this.timeEnd-this.level.hs)/this.duration)}set(t){this.duration=t*h.h,this.timeEnd=this.level.hs+this.duration}},h.k=class{constructor(){this.ns=!1,this.Dt={},this.hs=0,this.rs=[],this.os=[],this.items=[],this.cs}ls(t,s){if(h.m._t(t),t.us||t.ds)t.update(s);else{h.g.ht(h.g.C.v,!0)?t.fs():h.g.ht(h.g.C.I,!0)&&t.attack();let i=h.g.it();i=new h.D(i.x,i.y),t.update(s,i.normalize());const e=t.ws();this.items.forEach((s=>{s.ps=!1,s.gs&&h.T(s.ws(),e)&&(s.ps=!0,h.g.ht(h.g.C.S,!0)&&t.ys(s))}))}}xs(...t){this.os.push(...t),this.Es(...t)}Ms(...t){this.items.push(...t),this.Es(...t)}Es(...t){t.forEach((t=>t.level=this)),this.rs.push(...t)}removeItem(t){let s=this.items.indexOf(t);s>=0&&this.items.splice(s,1),s=this.rs.indexOf(t),s>=0&&this.rs.splice(s,1)}Ct(){this.ks&&this.ks(h.m.Ft),this.rs.forEach((t=>t.Ct(h.m.Ft))),this.As&&this.As(h.m.Ft),this.ns&&h.m.Kt()}update(t){if(this.hs+=t,this.ns)h.g.ht(h.g.C.L,!0)&&h.m.qt();else{const s=this.cs;if(s){if(s.Ts<=0)return void(this.ns=!0);this.ls(s,t)}this.rs.sort(((t,s)=>t._s()-s._s())),this.rs.forEach((i=>{i!==s&&(i.update(t),s?.ds&&i.Ts>0&&i.bs()&&s.item.Ds(i)&&i.Is(s.item),i.action||h.vs.Fs(i,s))}))}}},h.Cs=class{constructor(t={}){this.Ks=new h.D(t.x,t.y),this.w=t.w||0,this._=t._||0,this.Ls=0,this.Ns=null,this.Ss={},this.gs=!1,this.Rs=[],this.Hs=new h.D(1,0),this.Gs=1/0,this.Ts=1/0,this.ps=!1,this.level=null,this.speed=new h.D,this.state=h.u}Ps(t){for(let s=this.Rs.length-1;s>=0;s--){(0,this.Rs[s])(t)&&this.Rs.splice(s,1)}}bs(){return(!this.Ns||this.Ns.ss())&&!this.us}Ct(t){}ws(){return{x:this.Ks.x,y:this.Ks.y,w:this.w,_:this._}}bt(){return{x:this.Ks.x+this.w/2,y:this.Ks.y+this._/2}}Os(t,s,i){return this.Ss.Bs||(this.Ks.x+=Math.round(s*t.x*this.speed.x),this.Ks.y+=Math.round(s*t.y*this.speed.y),(t.x||t.y)&&(i=h.p,this.Hs.set(0==t.x?this.Hs.x:t.x>0?1:-1,0==t.y?this.Hs.y:t.y>0?1:-1))),i}_s(){return this.Ks.y+this._}Is(t){if(!this.bs())return;this===this.level.cs&&h.Audio.play(h.Audio.F),this.Ns=this.Ns||new h.ts(this.level),this.Ns.set(.5),this.Ts=Math.max(0,this.Ts-t.Us);const s=t.zs(this);s&&this.Rs.push(s),this.Ts<=0&&this.Ws()}update(t,s){if(this.Ts<=0||this.Ys)return;let i=h.u;this.Ls+=t,this.Ps(t),s&&(i=this.Os(s,t,i)),this.state!=i&&(this.Ls=0),this.state=i}},h.Zs=class extends h.Cs{constructor(t={}){t.w=h.o,t._=h.o,super(t),this.Vs=42/h.h,this.action=null,this.Xs=null,this.ds=!1,this.Gs=100,this.Ts=100,this.item=t.item,this.speed.set(12,12),this.item&&(this.item.Ys=this)}js(t,s){h.m.$t(t,s,1,this.bt())}qs(t){h.m.Jt(t,.1*Math.sin(this.Ls*this.Vs),this.bt())}Qs(t){if(this.Ts==this.Gs||this.us)return;let s=this.Ts/this.Gs,i=this.Ks.x+16,h=this.Ks.y-24,e=this.w-32;t.fillStyle="#000",t.fillRect(i,h,e,8),t.fillStyle="#f00",t.fillRect(i,h,e*s,8)}Js(t,s){const i=this.Hs.x<0;i&&this.js(t,-1),this.item?.Ct(t,s),i&&this.js(t,-1)}$s(t){t.drawImage(h.m.Zt,this.Ks.x,this.Ks.y+this._-12,this.w,24)}attack(){this.ds||this.us||!this.item||(h.Audio.play(h.Audio.I),this.Xs=this.Xs||new h.ts(this.level),this.Xs.set(this.item.ti),this.ds=!0)}fs(){this.us||(h.Audio.play(h.Audio.v),this.si=this.si||new h.ts(this.level),this.si.set(.5),this.us=!0)}Ct(t){if(this.Ts<=0)return;let s=this.St+(this.Hs.x<0?16:0),i=h.m.images;if(this.$s(t),this.us){let s=360*this.si.es()*3*Math.PI/180;this.Hs.x<0&&(s=-s),h.m.Jt(t,s,this.bt())}else{if(this.Ns&&!this.Ns.ss()){const t=this.Ns.es();(t>=0&&t<=.2||t>=.4&&t<=.6||t>=.8&&t<=1)&&(i=h.m.zt)}this.state===h.p&&this.qs(t)}this.item&&this.Js(t,i),this.Qs(t),t.drawImage(i,s,this.Rt,this.Ht,this.Gt,this.Ks.x,this.Ks.y,h.o,h.o),h.m.resetTransform()}Ws(){this.item?.ii(),this.Ts>0?(this.item=new h.hi,this.item.Ys=this):this.item=null}ws(){const t={x:this.Ks.x,y:this.Ks.y+this._,w:this.w,_:h.l/2};return t.y-=t._,t}ys(t){t.Ys||(this.item?.ii(),this.item=t,t.ps=!1,t.Ys=this,this.level.removeItem(t))}update(t,s){if(this.Ts<=0)return;let i=h.u;this.Ls+=t,this.Ps(t),s&&(i=this.Os(s,t,i)),this.action&&(i=this.action(t)||i),this.state!=i&&(this.Ls=0),this.ds&&this.Xs.ss()&&(this.ds=!1),this.us&&(this.si.ss()?this.us=!1:(s=new h.D(this.Hs.x<0?-1:1,0),this.Os(s,t,i))),this.level&&(this.Ks.x=Math.min(this.level.Dt.w-this.w,Math.max(0,this.Ks.x)),this.Ks.y=Math.min(this.level.Dt._-this._-8,Math.max(-h.l,this.Ks.y))),this.state=i}},h.vs={ei(t,s){if(t.ds||!t.item)return!1;if(t.item.Ds(s)){const i=new h.ts(t.level,.3);return t.action=function(){i.ss()&&(t.ds&&t.Xs&&t.Xs.ss()?t.action=null:t.ds||(t.attack(),s.Is(t.item)))},!0}return!1},ni(t){if(t.item&&!(t.item instanceof h.hi))return!1;let s=1/0,i=null,e=null;const n=t.bt(),r=t.ws(),o=new h.D;for(let a=0;a<t.level.items.length;a++){const c=t.level.items[a];if(c instanceof h.ri){const a=c.ws();if(h.T(a,r)){const s=new h.ts(t.level,.5);return t.action=function(){s.ss()&&(t.ys(c),t.action=null)},!0}o.set(a.x+a.w/2-n.x,a.y+a._/2-n.y);const l=o.length();l<3*h.o&&s>l&&(s=l,i=o.clone(),e=c)}}if(!e)return!1;const a=new h.ts(t.level,1);return i.normalize(),t.action=function(s){if(a.ss())t.action=null;else if(!t.Ss.Bs)return t.Os(i,s,0)},!0},oi(t,s){const i=t.bt(),e=s.bt(),n=new h.D(e.x-i.x,e.y-i.y);if(n.length()>5*h.o)return!1;const r=new h.ts(t.level,1);return n.normalize(),t.action=function(s){if(r.ss())t.action=null;else if(!t.Ss.Bs)return t.Os(n,s,0)},!0},Fs(t,s){t instanceof h.ai||!s||t.Ss.Bs||s.Ts<=0||this.ni(t)||this.ei(t,s)||this.oi(t,s)}},h.ri=class extends h.Cs{constructor(t){super(t),this.Ys=null}ci(){const t=h.m,s=this.ws(),i=t.Mt/t.scale,e=t.kt/t.scale,n=Math.sin(t.level.hs/25);let r=s.x+s.w/2+i-15,o=s.y-1.5*h.l+e;t.vt.drawImage(t.Wt,r,o+8*n,30,18),t.vt.fillStyle="#fff";let a=2*n;r=s.x-6+i-a,o=s.y+s._+e+a,t.vt.fillRect(r,o,6,12),t.vt.fillRect(r,o+6,12,6),r=s.x+s.w+i+a,o=s.y-6+e-a,t.vt.fillRect(r-6,o,12,6),t.vt.fillRect(r,o,6,12)}li(){this.Ys&&this.Ks.set(this.Ys.Ks.x+this.Ys.w/2,this.Ys.Ks.y-this.Ys._)}ii(){this.gs&&(this.li(),this.Ys?.level.Ms(this)),this.Ys=null}zs(){return null}_s(){return this.Ks.y}},h.ui=class extends h.Zs{constructor(t){super(t),this.St=0,this.Rt=32,this.Ht=16,this.Gt=16,this.Vs=32/h.h,this.speed.set(3,3)}Is(t){this.Ts<=0||super.Is(t)}},h.ai=class extends h.ui{constructor(t){super(t),this.St=0,this.Rt=48,this.Ht=16,this.Gt=16,this.Ts=1e3,this.Gs=1e3}Ws(){this.item?.ii(),this.item=null}Is(t){this.Ts<=0||super.Is(t)}},h.di=class extends h.Zs{constructor(t){super(t),this.St=0,this.Rt=16,this.Ht=16,this.Gt=16}},h.hi=class extends h.ri{constructor(t={}){super(t),this.ti=.15,this.Us=10}Ds(t){if(!this.Ys)return!1;const s={x:this.Ys.Ks.x+this.Ys.w,y:this.Ys.Ks.y+h.l/2,w:h.l,_:h.l};this.Ys.Hs.x<0&&(s.x-=this.Ys.w+s.w);const i={x:t.Ks.x,y:t.Ks.y,w:t.w,_:t._};return h.T(i,s)}Ct(t,s){let i=this.Ks.x,e=this.Ks.y;if(this.Ys&&(i=this.Ys.Ks.x+this.Ys.w-32,e=this.Ys.Ks.y+this.Ys._/2-16),this.Ys.ds){const t=Math.sin(this.Ys.Xs.es()*Math.PI*2)*h.l;i+=Math.max(0,t)}t.drawImage(s||h.m.images,40,16,8,8,i,e,h.l,h.l)}zs(t){if(t instanceof h.Zs)return function(){return t.Ws(),!0}}},h.fi=class extends h.ri{constructor(t={}){t.w=h.l,t._=2*h.o,super(t),this.ti=.25,this.gs=!0,this.Us=34}li(){this.Ys&&this.Ks.set(this.Ys.Ks.x+this.Ys.w/2,this.Ys.Ks.y-this.Ys._+this._/2)}Ds(t){if(!this.Ys)return!1;const s=[{x:this.Ys.Ks.x+this.Ys.w,y:this.Ys.Ks.y,w:1.7*h.o,_:h.o},{x:this.Ys.Ks.x+this.Ys.w,y:this.Ys.Ks.y-.7*h.o,w:h.o,_:2.4*h.o}];this.Ys.Hs.x<0&&(s[0].x-=this.Ys.w+s[0].w,s[1].x-=this.Ys.w+s[1].w);const i={x:t.Ks.x,y:t.Ks.y,w:t.w,_:t._};for(let t=0;t<s.length;t++)if(h.T(i,s[t]))return!0;return!1}Ct(t,s){let i=this.Ks.x,e=this.Ks.y;this.Ys&&(i=this.Ys.Ks.x+h.l,e=this.Ys.Ks.y-h.o-16);let n=0,r={x:i+this.w/2,y:e+this._/2};if(this.Ys){if(this.Ys?.ds){r.x=i+h.o/4,r.y=e+2*h.o;let t=this.Ys.Xs.es();const s=Math.PI;t<=.4?(t/=.4,n=t*s):n=t<=.8?s:0}}else n=80*Math.PI/180;n&&h.m.Jt(t,n,r),t.drawImage(s||h.m.images,32,16,8,32,i,e,h.l,2*h.o),n&&this.Ys?.ds&&h.m.Jt(t,-n,r),this.Ys||(h.m.resetTransform(),this.ps&&this.ci(t))}zs(t){if(!(t instanceof h.Zs))return;const s=t.Ks.clone(),i=this.Ys.bt(),e=t.bt(),n=new h.D(e.x-i.x,e.y-i.y);n.normalize();const r=new h.ts(this.Ys.level,.3),o=1.5*h.o;return t.Ss.Bs=!0,function(){if(r.ss())return t.Ss.Bs=!1,!0;const i=r.es();return t.Ks.set(s.x+n.x*o*i,s.y+n.y*o*i),!1}}ws(){return{x:this.Ks.x-1.5*this.w,y:this.Ks.y+1.5*this.w,w:this._,_:this.w}}},h.k.wi=class extends h.k{constructor(){super(),this.pi=0,this.gi=2}mi(t,s,i,e,n){if(n){let s=h.l/2,n=h.o,r=i-96,o=e-n/2,a={x:r+s/2,y:o+n/2};h.m.Jt(t,Math.PI/2,a),h.m.$t(t,Math.sin(.08*this.hs),1,a),t.drawImage(h.m.images,32,16,8,32,r,o,s,n),h.m.resetTransform()}t.fillStyle=n?"#fa0":"#777",t.textBaseline="middle",t.fillText(s,i,e)}Ct(){const t=h.m.Ft;let s=Math.max(2*h.o,h.m.Et.x-500),i=Math.max(2*h.o,h.m.Et.y-128);t.fillStyle="#0d161e",h.m.Ot(),t.font="600 64px "+h.i,t.textAlign="left",t.fillStyle="#fa0",t.fillText("TREASURE OF THE NIBELUNGS",s,i+3),t.fillStyle="#777",t.fillText("TREASURE OF THE NIBELUNGS",s,i),t.font="42px "+h.i,s+=h.l/2+114,i+=96,this.mi(t,"New Game",s,i,0===this.pi),i+=72,this.mi(t,"Continue",s,i,1===this.pi)}update(t){this.hs+=t,h.g.ht(h.g.C.H,!0)?this.pi--:h.g.ht(h.g.C.P,!0)?this.pi++:h.g.ht(h.g.C.L,!0)&&(h.Audio.play(h.Audio.SELECT),0===this.pi&&(h.m.level=new h.k.yi)),this.pi<0?this.pi=this.gi-1:this.pi>=this.gi&&(this.pi=0)}},h.k.xi=class extends h.k{constructor(){super(),this.Dt={w:2*h.m.Et.x,_:8*h.o};const t=new h.di({x:6*h.o,y:3*h.o,item:new h.hi});this.Ei=t.Ks.clone();const s=new h.ai({x:13*h.o,y:3*h.o,item:new h.fi});this.xs(t,s),this.cs=t,this.Mi=s,this.ki=-1,this.Ai=new h.ts(this,6)}Ct(){super.Ct();const t=h.m.Ft;t.font='600 23px "Courier New", monospace',t.fillStyle="#fffc",t.textAlign="center";const s=this.cs,i=s.bt(),e=this.Mi.bt();if(this.ki<0)t.fillStyle="#111",h.m.Ot();else if(0===this.ki)t.fillText("Move with [W][A][S][D] or arrow keys",i.x,i.y-s._);else if(1===this.ki)t.fillText("Attack with [ENTER]",e.x,e.y-2*this.Mi._);else if(2===this.ki){const s=this.items[0];if(s){const i=s.ws();t.fillText("Pick up with [E]",i.x+i.w/2,i.y-i._-h.l-8)}}else 3===this.ki?t.fillText("Attack with the sword",e.x,e.y-this.Mi._):4===this.ki?t.fillText("You can dodge roll with [R]",i.x,i.y-s._-h.o):5===this.ki&&t.fillText("Right, that’s how it goes!",h.m.Et.x,0)}ks(t){if(this.ki<0)return;const s=this.cs,i=this.Mi,e=this.items[0];if(t.fillStyle="#222",t.fillRect(s.Ks.x-h.l,s.Ks.y+s._-h.l,2*h.o,h.o),t.fillRect(i.Ks.x-h.l,i.Ks.y+i._-h.l,2*h.o,h.o),e){const s=e.ws();t.fillRect(s.x-h.l,s.y+s._-1.5*h.l,3*h.o,1.25*h.o)}}As(t){const s=h.m;if(this.ki<0){const t=this.Ai.es(),i=1-(t>=.5?2-2*t:1);s.$t(s.vt,1,1-i,s.Et),s.Nt(this.cs,["Before heading out, let’s","think back on my training.","How did it go again?"],0),s.vt.setTransform(s.scale,0,0,s.scale,0,0)}if(5!==this.ki)return;const i=Math.sin(this.hs/25);let e=this.Dt.w-h.o+8*i,n=this.Dt._/2+9;const r={x:e,y:n};t.fillStyle="#fff",t.textAlign="right",t.fillText("Continue",e-22,n-8);let o=-Math.PI/2;s.Jt(t,o,r),t.drawImage(s.Wt,e,n,30,18),s.Jt(t,-o,r)}update(t){const s=this.cs,i=h.g;if(-1===this.ki)this.cs.Ks.set(this.Ei.x,this.Ei.y),i.ht(i.C.L,!0)&&this.Ai.set(0),this.Ai.ss()&&(this.ki=0);else if(0===this.ki)(i.ht(i.C.H)||i.ht(i.C.G)||i.ht(i.C.P)||i.ht(i.C.R))&&(this.ki=1);else if(1===this.ki)this.Mi.item instanceof h.fi||(this.items[0].Ks.x=this.Mi.Ks.x+2*h.o,this.ki=2);else if(2===this.ki)s.item instanceof h.fi&&(this.ki=3);else if(3===this.ki)this.Mi.Ts<this.Mi.Gs-s.item.Us&&(this.ki=4);else if(4===this.ki)i.ht(i.C.v)&&(this.ki=5);else if(5===this.ki){if(s.bt().x>=this.Dt.w-h.l)return void h.m.It(new h.k.M)}super.update(t)}},h.k.yi=class extends h.k{constructor(){super(),this.Ti=["Ez enwas niht anders","wan gestéinẹ unde golt.","unt ob man al die werlde","het dâ von versolt,","sîn wǽré niht mínner","einer marke wert."],this._i=["Ê daz der künee rîche","wider wære komen,","die wîle hete Hagene","den schaz vil gar genomen.","","er sanctẹ in dâ ze Lôche","allen in den Rîn.","er wandẹ er soldẹ in niezen:","des enkunde niht gesîn."],this.bi=["The legendary treasure of the Nibelungs:","Gems and gold more than one could ever hope to spent.","","While the king and his men where away, Hagen stole it","all and sunk the treasure in the Rhine at Lochheim.","But he was killed before being able to retrieve the riches.","","Betting on its the existance,","many set off to look for the treasure."],this.Di=0,this.Ii=new h.ts(this,2);this.Ti.concat(this._i).forEach((t=>{const s=h.m.Ft.measureText(t);this.Di=Math.max(this.Di,s.width)}))}Ct(){const t=h.m.Ft;t.fillStyle="#0d161e",h.m.Ot();let s=2*h.o,i=s,e=this.Di+h.o,n=49*(this.Ti.length+this._i.length)+1.5*h.o+16;if(t.fillStyle="#e5c382",t.fillRect(s-h.l,i-h.o,e,n),t.font='italic 40px "Times New Roman", serif',t.textAlign="center",t.fillStyle="#000",s+=this.Di/2,!this.Ii.ss()){const s=this.Ii.es();i+=(1-s)*h.l,t.fillStyle="#000000"+Math.round(255*s).toString(16).padStart(2,"0")}if(this.Ti.forEach((h=>{t.fillText(h,s,i),i+=49})),this.Ii.ss()){if(i+=49,!this.Fi.ss()){const s=this.Fi.es();i+=(1-s)*h.l,t.fillStyle="#000000"+Math.round(255*s).toString(16).padStart(2,"0")}this._i.forEach((h=>{t.fillText(h,s,i),i+=49}))}if(this.Fi?.ss()){const n=this.vi.es();if(s=e+2.5*h.o,i=2*h.o+(1-n)*h.l,t.font="32px "+h.i,t.textAlign="left",t.fillStyle="#ffffff"+Math.round(255*n).toString(16).padStart(2,"0"),this.bi.forEach((h=>{t.fillText(h,s,i),i+=49})),this.vi.ss()){i+=49;let e=h.l/2,n=h.o,r=s+n/2,o=i-n/2,a={x:r+e/2,y:o+n/2};h.m.Jt(t,Math.PI/2,a),h.m.$t(t,Math.sin(.08*this.hs),1,a),t.drawImage(h.m.images,32,16,8,32,r,o,e,n),h.m.resetTransform(),t.font="32px "+h.i,t.fillStyle="#fa0",t.textBaseline="middle",t.fillText("Continue",s+n+32,i)}}}update(t){this.hs+=t,this.Ii.ss()&&!this.Fi?this.Fi=new h.ts(this,2):this.Fi&&this.Fi.ss()&&!this.vi&&(this.vi=new h.ts(this,2)),h.g.ht(h.g.C.L,!0)&&(this.Ii.ss()?this.Fi&&!this.Fi.ss()?this.Fi.set(0):this.vi&&!this.vi.ss()?this.vi.set(0):(h.Audio.play(h.Audio.SELECT),h.m.level=new h.k.Ci):this.Ii.set(0))}},h.k.M=class extends h.k{constructor(){super(),this.Ki=24,this.Li=2,this.Dt={w:h.o*this.Ki,_:h.o*this.Li};const t=new h.di({x:2*h.o,y:0,item:new h.hi}),s=new h.ui({x:12*h.o,y:0,item:new h.fi});s.Hs.x=-1,this.xs(t,s),this.cs=t}ks(t){const s=h.m,i=12*Math.sin(this.hs/50);t.fillStyle=s.Yt,t.translate(-i,0),s.Ot(),t.translate(i,0);for(let i=0;i<this.Ki;i++)for(let e=0;e<this.Li;e++){let n=i*h.o,r=e*h.o;t.drawImage(s.images,0,0,16,16,n,r,h.o,h.o)}t.fillStyle="#655",t.fillRect(0,this.Dt._-6,this.Dt.w,24)}update(t){super.update(t);this.cs.bt().x>=this.Dt.w-h.l&&h.m.It(new h.k.Ci)}},h.k.Ci=class extends h.k{constructor(){super(),this.Ki=24,this.Li=6,this.Dt={w:h.o*this.Ki,_:h.o*this.Li};const t=new h.di({x:2*h.o,y:2*h.o,item:new h.hi}),s=new h.ui({x:12*h.o,y:2*h.o,item:new h.fi});s.Hs.x=-1,this.xs(t,s);const i=new h.fi({x:4*h.o,y:4.5*h.o});this.Ms(i),this.cs=t}ks(t){const s=h.m;if(t.fillStyle=s.Yt,t.translate(-this.Ni,0),s.Ot(),t.translate(this.Ni,0),this.Si&&t.drawImage(this.Si,-6,-h.o),this.Ri)t.drawImage(this.Ri,0,0);else{const t=6,[i,e]=h.m.Tt(this.Dt.w+1.5*t,this.Dt._+.5*t+h.o);e.lineWidth=t;let n=t/2;e.strokeStyle="#8f563b",e.strokeRect(0,n,this.Dt.w+e.lineWidth+n,this.Dt._+n);for(let i=0;i<this.Ki;i++)for(let n=0;n<this.Li;n++){let r=i*h.o,o=t+n*h.o;e.drawImage(s.images,0,0,16,16,r,o,h.o,h.o)}e.fillStyle="#5a3c2e",e.fillRect(n-e.lineWidth,this.Dt._,this.Dt.w+2*e.lineWidth,h.o),e.fillStyle=h.m.createLinearGradient(0,this.Dt._,0,this.Dt._+h.o,"#0003","#4b73ac30"),e.fillRect(n-e.lineWidth,this.Dt._,this.Dt.w+2*e.lineWidth,h.o),e.fillStyle=h.m.createLinearGradient(0,0,0,this.Dt._),e.fillRect(0,0,this.Dt.w+n,this.Dt._),this.Ri=i}}As(t){if(this.Hi)t.drawImage(this.Hi,-this.Ni,this.Dt._+.5,h.o*(this.Ki+1),h.o);else{const[t,s]=h.m.Tt(h.o*(this.Ki+1),h.o);for(let t=0;t<=this.Ki;t++)s.drawImage(h.m.images,32,0,16,16,t*h.o,0,h.o,h.o);this.Hi=t}if(this.Si)t.drawImage(this.Si,-6,this.Dt._-h.o);else{const t=12+this.Dt.w,s=h.o,[i,e]=h.m.Tt(t,s);e.lineWidth=6,e.fillStyle="#5a3c2e",e.fillRect(0,0,this.Dt.w+2*e.lineWidth,18),e.fillStyle="#0002",e.fillRect(0,12,this.Dt.w+2*e.lineWidth,6),e.fillStyle="#fff1",e.fillRect(0,0,this.Dt.w+2*e.lineWidth,6);const n=this.Dt.w/h.o+1;for(let t=0;t<=n;t++){let s=t*h.o,i=18,n=h.o+1;e.fillStyle="#5a3c2e",e.fillRect(s,i,18,n),e.fillStyle="#0002",e.fillRect(s,i,6,n),e.fillStyle="#fff1",e.fillRect(s+12,i,6,n)}this.Si=i}}update(t){super.update(t),this.Ni=this.hs%25/25*h.o}},h.k.Gi=class extends h.k{constructor(){super()}};