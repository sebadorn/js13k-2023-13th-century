let t,s,i;s=.3,t=(t=1,s=.05,h=220,e=0,n=0,r=.1,o=0,a=1,c=0,l=0,f=0,u=0,w=0,d=0,p=0,x=0,g=0,y=1,m=0,M=0,E=Math,k=44100,_=2*E.PI,A=(c*=500*_/k/k),T=(h*=(1-s+2*s*E.random(s=[]))*_/k),b=0,v=0,I=0,S=1,F=0,D=0,C=0,N,H)=>{for(l*=500*_/k**3,p*=_/k,f*=_/k,u*=k,w=k*w|0,H=(e=k*e+9)+(m*=k)+(n*=k)+(r*=k)+(g*=k)|0;I<H;s[I++]=C)++D%(100*x|0)||(C=o?1<o?2<o?3<o?E.sin((b%_)**3):E.max(E.min(E.tan(b),1),-1):1-(2*b/_%2+2)%2:1-4*E.abs(E.round(b/_)-b/_):E.sin(b),C=(w?1-M+M*E.sin(_*I/w):1)*(0<C?1:-1)*E.abs(C)**a*.3*t*(I<e?I/e:I<e+m?1-(I-e)/m*(1-y):I<e+m+n?y:I<H-g?(H-I-g)/r*y:0),C=g?C/2+(g>I?0:(I<H-g?1:(H-I)/g)*s[I-g|0]/2):C),b+=(N=(h+=c+=l)*E.cos(p*v++))-N*d*(1-1e9*(E.sin(I)+1)%2),S&&++S>u&&(h+=f,T+=f,S=0),!w||++F%w||(h=T,c=A,S||=1);return(t=i.createBuffer(1,H,k)).getChannelData(0).set(s),(h=i.createBufferSource()).buffer=t,h.connect(i.destination),h.start(),h},i=new AudioContext;const h={t:"Arial, sans-serif",i:'"Times New Roman", serif',h:'"Courier New", monospace',o:60,l:96,u:48,p:1,g:2,m(t,s){let i=Math.min(t.x+t.w,s.x+s.w)-Math.max(t.x,s.x);i=i<0?0:i;let h=Math.min(t.y+t.M,s.y+s.M)-Math.max(t.y,s.y);return h=h<0?0:h,i*h},init(){h.k.init(),h._.init((()=>{h._.level=new h.T.A,h._.v()}))},I(){const t=localStorage.getItem("2023_sd_nibelungs.save");return t?JSON.parse(t):null},S(t,s){return this.m(t,s)>Number.EPSILON},F(t){if(!t||0==t.id)return;const s={level:t.id};localStorage.setItem("2023_sd_nibelungs.save",JSON.stringify(s))}};window.addEventListener("load",(()=>h.init())),h.D=class{constructor(t=0,s=0){this.x=t,this.y=s}clone(){return new h.D(this.x,this.y)}length(){return this.x+this.y==0?0:Math.sqrt(this.x*this.x+this.y*this.y)}mul(t){return this.x*=t,this.y*=t,this}normalize(){const t=this.length();return t&&(this.x/=t,this.y/=t),this}set(t,s){this.x=t,this.y=s}sub(t){return this.x-=t.x,this.y-=t.y,this}},h.Audio={C:[.3,0,8,.01,.01,.01,1,2.29,86,,,,,,-82,,,.42,.01],N:[.2,0,68,.02,.01,.18,2,1.89,-.3,,,,,1.4,,.3,,.59,.06,.12],H:[.15,0,382,.1,.01,.09,,2.2,-1.2,-3.8,,,,5,,,,.48,.05],SELECT:[.2,0,883,.01,.07,,1,1.74,,,366,.1,.06,,,,,.62,.01],play(s){t(...s)}},h.k={L:{O:1,R:2,K:3,C:4,P:5,H:6,G:10,B:11,X:12,U:13,W:14,Y:15},j:{},Z:{},J:{gp_connect:[],gp_disconnect:[]},V:{},$:{},q:{},tt:{},st:0,it(){this.ht={[this.L.O]:{keyboard:["Escape"],gamepad:[9]},[this.L.B]:{keyboard:["ArrowUp","KeyW","KeyZ","KeyY"],gamepad:[12]},[this.L.G]:{keyboard:["ArrowLeft","KeyA","KeyQ"],gamepad:[14]},[this.L.U]:{keyboard:["ArrowDown","KeyS"],gamepad:[13]},[this.L.X]:{keyboard:["ArrowRight","KeyD"],gamepad:[15]},[this.L.C]:{keyboard:["Space","Enter"],gamepad:[0,2]},[this.L.H]:{keyboard:["ShiftLeft","ShiftRight"],gamepad:[4,5]},[this.L.R]:{keyboard:["Space","Enter"],gamepad:[0,2]},[this.L.P]:{keyboard:["KeyE","CtrlLeft"],gamepad:[1,3]}}},et(){let t=0,s=0;if(this.nt(this.L.G)?t=-1:this.nt(this.L.X)&&(t=1),this.nt(this.L.B)?s=-1:this.nt(this.L.U)&&(s=1),!t||!s){const i=.3;for(const h in this.q){const e=this.q[h];e.axes[0]&&Math.abs(e.axes[0])>i?t=e.axes[0]>0?1:-1:e.axes[2]&&Math.abs(e.axes[2])>i&&(t=e.axes[2]>0?1:-1),e.axes[1]&&Math.abs(e.axes[1])>i?s=e.axes[1]>0?1:-1:e.axes[3]&&Math.abs(e.axes[3])>i&&(s=e.axes[3]>0?1:-1)}}return{x:t,y:s}},rt(t){return this.ht[t]},init(){this.it(),this.ot()},nt(t,s){const i=this.rt(t);for(const t of i.keyboard)if(this.ct(t,s))return!0;for(const t of i.gamepad)if(this.lt(t,s))return!0;if(t==this.L.G)for(const t in this.q){const i=this.q[t];if(i.axes[6]&&i.axes[6]<=-.2)return!this.Z["axis6-"]&&(s&&(this.Z["axis6-"]=!0),!0)}else if(t==this.L.X)for(const t in this.q){const i=this.q[t];if(i.axes[6]&&i.axes[6]>=.2)return!this.Z["axis6+"]&&(s&&(this.Z["axis6+"]=!0),!0)}else if(t==this.L.B)for(const t in this.q){const i=this.q[t];if(i.axes[7]&&i.axes[7]<=-.2)return!this.Z["axis7-"]&&(s&&(this.Z["axis7-"]=!0),!0)}else if(t==this.L.U)for(const t in this.q){const i=this.q[t];if(i.axes[7]&&i.axes[7]>=.2)return!this.Z["axis7+"]&&(s&&(this.Z["axis7+"]=!0),!0)}return!1},lt(t,s){for(const i in this.q){const h=this.q[i].buttons[t];if(h&&h.pressed)return!this.Z[t]&&(s&&(this.Z[t]=!0),!0)}return!1},ct(t,s){const i=this.tt[t];return!(!i||!i.time)&&(s&&(i.time=0,i.ft=!0),!0)},ut(t,s){if("function"!=typeof s)return void(this.J[t]=[]);const i=this.J[t].indexOf(s);i>=0&&this.J[t].splice(i,1)},wt(t,s){this.J[t].push(s)},dt(t,s){const i=this.V[t]||[];i.push(s),this.V[t]=i},xt(t,s){const i=this.$[t]||[];i.push(s),this.$[t]=i},ot(){document.body.onkeydown=t=>{const s=this.tt[t.code];s&&s.ft||(this.tt[t.code]={time:Date.now()},this.V[t.code]&&this.V[t.code].forEach((t=>t())))},document.body.onkeyup=t=>{this.tt[t.code]={time:0},this.$[t.code]&&this.$[t.code].forEach((t=>t()))},window.addEventListener("gamepadconnected",(t=>{this.st++,this.q[t.gamepad.index]=t.gamepad,this.J.gp_connect.forEach((t=>t()))})),window.addEventListener("gamepaddisconnected",(t=>{this.st--,delete this.q[t.gamepad.index],this.J.gp_disconnect.forEach((t=>t()))}))},update(){const t=navigator.getGamepads();for(const s of t)if(s){this.q[s.index]=s;for(const t in this.Z)"axis6-"==t||"axis6+"==t?s.axes[6]||delete this.Z[t]:"axis7-"==t||"axis7+"==t?s.axes[7]||delete this.Z[t]:s.buttons[t]&&!s.buttons[t].pressed&&delete this.Z[t]}}},h._={gt:new h.D,scale:1,yt:0,Mt:0,Et:0,kt(t,s,i,h=0){const[e,n]=this._t(36,36);n.drawImage(this.images,h,s,16,16,1,1,16,16),n.drawImage(this.images,h+16,s,16,16,18,1,16,16),i&&i.At(n);let r=n.getImageData(1,1,35,16);for(let s=0;s<r.data.length;s+=4){r.data[s]+r.data[s+1]+r.data[s+2]==765&&(r.data[s+0]=t[0],r.data[s+1]=t[1],r.data[s+2]=t[2])}n.putImageData(r,1,1),n.putImageData(r,1,18),r=n.getImageData(1,18,34,16);for(let t=0;t<r.data.length;t+=4){0!==r.data[t+3]&&(r.data[t+0]=255,r.data[t+1]=255,r.data[t+2]=255)}return n.putImageData(r,1,18),e},Tt(t,s,i,h){const[e,n]=this._t(i+2,h+2);return n.drawImage(this.images,t,s,i,h,1,1,i,h),e},bt(t){const s=t.vt();if(this.Mt=this.gt.x-s.x,this.Et=(this.gt.y-s.y)*this.scale,t.level){const s=t.level.It;this.Mt=Math.min(0,Math.max(-s.w+2*this.gt.x,this.Mt))}this.Mt*=this.scale},St(t){this.Ft||(this.Ft=new h.Dt(this,2),this.Ct=t,h.F(t))},clear(){this.Nt.setTransform(1,0,0,1,0,0),this.Nt.clearRect(0,0,window.innerWidth,window.innerHeight),this.Ht.setTransform(1,0,0,1,0,0),this.Ht.clearRect(0,0,window.innerWidth,window.innerHeight)},createLinearGradient(t,s,i,h,e="#0003",n="#fff1"){const r=this.Nt.createLinearGradient(t,s,i,h);return r.addColorStop(0,e),r.addColorStop(1,n),r},Lt(){if(this.clear(),this.Nt.setTransform(this.scale,0,0,this.scale,this.Mt,this.Et),this.Ht.setTransform(this.scale,0,0,this.scale,0,0),this.level&&this.level.Lt(),this.Ft){const t=2*this.Ft.Ot(),s=this.Rt.width/this.scale*2;this.Ht.fillStyle="#0d161e",this.Ht.fillRect(s*(1-t),0,s,this.Rt.height/this.scale)}},Kt(){this.Ht.setTransform(1,0,0,1,0,0),this.Ht.clearRect(0,0,window.innerWidth,window.innerHeight),this.Ht.setTransform(this.scale,0,0,this.scale,0,0),this.Ht.fillStyle="rgba(0,0,0,0.4)",this.Ht.fillRect(0,0,this.Rt.width/this.scale,this.Rt.height/this.scale),this.Ht.fillStyle="#FFF",this.Ht.font="600 56px "+h.h,this.Ht.textAlign="center",this.Ht.textBaseline="top",this.Ht.fillText("GAME OVER",this.gt.x,this.gt.y-77);let t=this.gt.x+1.25*h.u;this.Ht.fillStyle="#fa0",this.Ht.font="600 28px "+h.h,this.Ht.fillText("Try again",t,this.gt.y-7);let s=h.u/2,i=h.l,e=t-1.6*h.l,n=this.gt.y-42,r={x:e+s/2,y:n+i/2};h._.Pt(this.Ht,Math.PI/2,r),h._.Gt(this.Ht,Math.sin(.08*this.level.yt),1,r),this.Ht.drawImage(h._.Bt,1,1,8,32,e,n,s,i),this.Ht.setTransform(this.scale,0,0,this.scale,0,0)},Xt(t,s){let i=9*h.l,e=2*h.l,n=this.gt.x-i/2,r=h.u;this.Ht.fillStyle="#0004",this.Ht.fillRect(n-12,r-12,i+24,e+24),this.Ht.fillStyle="#444",this.Ht.fillRect(n,r,i,e),this.Ht.drawImage(t.images,0,0,16,16,n,r+.25*h.l,1.75*h.l,1.75*h.l),this.Ht.lineWidth=12,this.Ht.strokeStyle="#847e87",this.Ht.strokeRect(n+6,r+6,2*h.l-12,2*h.l-12),this.Ht.fillStyle="#fff",this.Ht.font="600 31px "+h.h,this.Ht.textAlign="left",this.Ht.textBaseline="alphabetic";let o=n+28,a=r+48;s.forEach((t=>{this.Ht.fillText(t,o+2*h.l,a),a+=38}))},Ut(){this.Ht.setTransform(1,0,0,1,0,0),this.Ht.clearRect(0,0,window.innerWidth,window.innerHeight),this.Ht.setTransform(this.scale,0,0,this.scale,0,0),this.Ht.fillStyle="rgba(0,0,0,0.4)",this.Ht.fillRect(0,0,this.Rt.width/this.scale,this.Rt.height/this.scale),this.Ht.fillStyle="#FFF",this.Ht.font="600 56px "+h.h,this.Ht.textAlign="center",this.Ht.textBaseline="top",this.Ht.fillText("PAUSED",this.gt.x,this.gt.y-56)},Wt(){this.Nt.fillRect(-this.Mt/this.scale-h.l,-this.Et/this.scale-h.l,this.zt.width/this.scale+2*h.l,this.zt.height/this.scale+2*h.l)},_t(t,s){const i=document.createElement("canvas");i.width=t,i.height=s;const h=i.getContext("2d",{alpha:!0});return h.imageSmoothingEnabled=!1,[i,h]},init(t){this.zt=document.getElementById("c"),this.Nt=this.zt.getContext("2d",{alpha:!0}),this.Nt.imageSmoothingEnabled=!1,this.Rt=document.getElementById("ui"),this.Ht=this.Rt.getContext("2d",{alpha:!0}),this.Ht.imageSmoothingEnabled=!1,this.Yt((()=>{this.ot(),t()}))},Yt(t){const s=new Image;s.onload=()=>{this.images=s;const[i,e]=this._t(5,3);let n=new ImageData(5,3);n.data.set([255,255,255,196,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,196,0,0,0,0,255,255,255,196,255,255,255,255,255,255,255,196,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,196,0,0,0,0,0,0,0,0]),e.putImageData(n,0,0),this.jt=i,this.Zt=this.kt([255,255,0],16,h.Jt),this.Vt=this.kt([255,0,0],16,h.$t),this.qt=this.kt([127,0,0],16,h.Qt),this.ts=this.kt([0,0,0],48),this.ss=this.kt([255,255,255],32),this.hs=this.kt([0,0,0],48,null,32),this.es=this.Tt(41,16,7,6),this.Bt=this.Tt(32,16,8,32),this.ns=this.Tt(40,32,6,14);const[r,o]=this._t(h.l,h.l);o.drawImage(this.images,16,0,16,16,0,0,h.l,h.l),this.rs=o.createPattern(r,"repeat");const[a,c]=h._._t(h.l,h.l),l=c.createRadialGradient(h.u,h.u,0,h.u,h.u,h.u);l.addColorStop(0,"#000a"),l.addColorStop(.9,"#0002"),l.addColorStop(1,"#0000"),c.fillStyle=l,c.fillRect(0,0,h.l,h.l),this.os=a,t()},s.src="i.png"},v(t=0){if(h.k.update(),t&&this.cs){const s=(t-this.cs)/(1e3/h.o);if(this.Nt.imageSmoothingEnabled=!1,this.Ht.imageSmoothingEnabled=!1,this.Nt.lineWidth=1,this.Nt.textBaseline="alphabetic",this.ls)return void this.Ut();this.yt+=s,this.Ft&&(this.Ct&&this.Ft.Ot()>.5&&(this.level=this.Ct,this.fs=null),this.Ft.us()&&(this.Ft=null)),this.level.update(s),this.Lt()}this.cs=t,requestAnimationFrame((t=>this.v(t)))},pause(){this.ls=!0},ot(){window.addEventListener("resize",(t=>this.resize())),this.resize();const t=h.k.rt(h.k.L.O);setInterval((()=>{this.ls&&h.k.update(),t.gamepad.forEach((t=>{h.k.lt(t,!0)&&this.ws()}))}),100);const s=()=>this.ws();t.keyboard.forEach((t=>h.k.xt(t,s))),h.k.wt("gp_disconnect",(()=>this.pause()))},ds(){this.St(new this.level.constructor)},resetTransform(){this.Nt.setTransform(this.scale,0,0,this.scale,this.Mt,this.Et)},resize(){const t=1920/1080;let s=window.innerHeight,i=Math.round(s*t);i>window.innerWidth&&(i=window.innerWidth,s=i/t),this.scale=s/1080,this.gt.x=i/2/this.scale,this.gt.y=s/2/this.scale;let h=~~((window.innerHeight-s)/2)+"px",e=~~((window.innerWidth-i)/2)+"px";this.zt.width=i,this.zt.height=s,this.zt.style.top=h,this.zt.style.left=e,this.Rt.width=i,this.Rt.height=s,this.Rt.style.top=h,this.Rt.style.left=e,this.ls&&(clearTimeout(this.ps),this.ps=setTimeout((()=>this.Ut()),100))},Pt(t,s,i){t.translate(i.x,i.y),t.rotate(s),t.translate(-i.x,-i.y)},Gt(t,s,i,h){t.translate(h.x,h.y),t.scale(s,i),t.translate(-h.x,-h.y)},ws(){this.ls?this.unpause():this.pause()},unpause(){this.ls&&(this.ls=!1,this.v())}},h.Dt=class{constructor(t,s=0){this.level=t,this.set(s)}us(){return this.level.yt>this.timeEnd}Ot(){return Math.min(1,1-(this.timeEnd-this.level.yt)/this.duration)}set(t){this.duration=t*h.o,this.timeEnd=this.level.yt+this.duration}},h.T=class{constructor(){this.id=0,this.It={},this.yt=0,this.xs=[],this.gs=[],this.items=[]}ys(t,s){if(h._.bt(t),t.Ms||t.Es)t.update(s);else{h.k.nt(h.k.L.H,!0)?t.ks():h.k.nt(h.k.L.C,!0)&&t.attack();let i=h.k.et();i=new h.D(i.x,i.y),t.update(s,i.normalize());const e=t._s();this.items.forEach((s=>{s.As=!1,s.Ts&&h.S(s._s(),e)&&(s.As=!0,h.k.nt(h.k.L.P,!0)&&t.bs(s))}))}}vs(...t){this.gs.push(...t),this.Is(...t)}Ss(...t){this.items.push(...t),this.Is(...t)}Is(...t){t.forEach((t=>t.level=this)),this.xs.push(...t)}Lt(){this.Fs&&this.Fs(h._.Nt),this.xs.forEach((t=>t.Lt(h._.Nt))),this.Ds&&this.Ds(h._.Nt),this.Cs&&h._.Kt()}Ns(t,s){const i=h._;if(!this.Hs){const[t,s]=i._t(2*i.gt.x+3*h.l,2*i.gt.y+2*h.l);s.fillStyle=i.rs,s.fillRect(0,0,t.width,t.height),this.Hs=t}let e=Math.ceil(-i.Mt/i.scale/h.l)*h.l,n=Math.ceil(-i.Et/i.scale/h.l)*h.l;t.drawImage(this.Hs,e-1.5*h.l-s,n-h.l)}Ls(){let t=0;return this.xs.forEach((s=>{s instanceof h.Os&&(t+=s.Rs>0?1:0)})),t}removeItem(t){let s=this.items.indexOf(t);s>=0&&this.items.splice(s,1),s=this.xs.indexOf(t),s>=0&&this.xs.splice(s,1)}update(t){if(this.yt+=t,this.Cs)h.k.nt(h.k.L.R,!0)&&h._.ds();else if(!this.locked){const s=this.Ks;if(s){if(s.Rs<=0)return void(this.Cs=!0);this.ys(s,t)}this.xs.sort(((t,s)=>t.Ps()-s.Ps())),this.xs.forEach((i=>{i!=s&&(i.update(t),s?.Es&&i.Rs>0&&i.Gs()&&s.item?.Bs(i)&&i.Xs(s.item),i.action||h.Ws.Us(i,s))}))}}},h.zs=class{constructor(t={}){this.Ys=new h.D(t.x,t.y),this.w=t.w||0,this.M=t.M||0,this.js=0,this.Zs={},this.Js=[],this.Vs=t.Vs||1,this.Rs=this.$s=1/0,this.speed=new h.D(4,4),this.state=h.p,this.weight=0}qs(t){for(let s=this.Js.length-1;s>=0;s--){(0,this.Js[s])(t)&&this.Js.splice(s,1)}}Gs(){return(!this.Qs||this.Qs.us())&&!this.Ms}Lt(){}ti(t,s){if(!this.level||this.si)return;this.Ys.x=Math.min(this.level.It.w-this.w,Math.max(0,this.Ys.x)),this.Ys.y=Math.min(this.level.It.M-this.M-8,Math.max(-h.u,this.Ys.y));const i=this.Ys.clone().sub(t);i.x=i.x<0?-i.x:i.x,i.y=i.y<0?-i.y:i.y;const e=this._s();this.level.xs.forEach((n=>{if(n==this||!n.ii||n.Rs<=0)return;if(n instanceof h.hi&&this.Ms)return;const r=n._s(),o=h.m(e,r);o>Number.EPSILON&&(s&&o>=8?this.Ys.set(i.x>0?r.x+r.w:r.x-e.w,t.y):this.Ys.set(t.x,t.y))}))}_s(){return{x:this.Ys.x,y:this.Ys.y,w:this.w,M:this.M}}vt(){return{x:this.Ys.x+this.w/2,y:this.Ys.y+this.M/2}}ei(t,s,i){if(this.Zs.ni&&this!==this.level?.Ks)return i;const e=this.Ys.clone();return this.Ys.x+=Math.round(s*t.x*this.speed.x),this.Ys.y+=Math.round(s*t.y*this.speed.y),(t.x||t.y)&&(i=h.g,this.Vs=0==t.x?this.Vs:t.x>0?1:-1),this.ti(e),i}Ps(){return this.Ys.y+this.M}ri(){if(!this.Qs||this.Qs.us())return!1;const t=this.Qs.Ot();return t>=0&&t<=.2||t>=.4&&t<=.6||t>=.8&&t<=1}Xs(t){if(!t||!this.Gs())return;this==this.level.Ks&&h.Audio.play(h.Audio.N),this.Qs=this.Qs||new h.Dt(this.level),this.Qs.set(.5),this.Rs=Math.max(0,this.Rs-t.oi);const s=t.ai(this);s&&this.Js.push(s),this.Rs<=0&&this.ci&&this.ci()}update(t,s){if(this.Rs<=0||this.li)return;let i=h.p;this.js+=t,this.qs(t),s&&(i=this.ei(s,t,i)),this.state!=i&&(this.js=0),this.state=i}},h.fi=class extends h.zs{constructor(t={}){t.w=h.l,t.M=h.l,super(t),this.images=h._.hs,this.Rs=this.$s=55,this.ii=!0,this.weight=h.l}Lt(t){if(this.Rs<=0)return;let s=this.ri()?18:1;t.drawImage(this.images,1,s,16,16,this.Ys.x,this.Ys.y,this.w,this.M)}update(t){super.update(t),this.ii=this.Rs>0}},h.ui=class extends h.zs{constructor(t){t.w=h.l-6,t.M=h.l-12,super(t),this.ii=!0,this.si=!0,this.weight=2*h.l}Lt(t){t.drawImage(h._.images,16,50,15,14,this.Ys.x,this.Ys.y,this.w,this.M)}},h.hi=class extends h.zs{constructor(t={}){t.w=h.l,t.M=h.l,super(t),this.wi=42/h.o,this.images=h._.Zt,this.Rs=this.$s=100,this.di="#f00",this.pi=null,this.ii=!0,this.item=t.item,this.xi=8*h.l,this.speed.set(12,12),this.item&&(this.item.li=this)}gi(t,s){h._.Gt(t,s,1,this.vt())}yi(t){h._.Pt(t,.1*Math.sin(this.js*this.wi),this.vt())}mi(t){if(this.pi==this.$s||this.Ms)return;let s=this.pi/this.$s,i=this.Ys.x+16,h=this.Ys.y-24,e=this.w-32;t.fillStyle="#000",t.fillRect(i,h,e,8),t.fillStyle=this.di,t.fillRect(i,h,e*s,8),t.fillStyle="#0001",t.fillRect(i,h+4,e*s,4)}Mi(t){const s=this.Vs<0;s&&this.gi(t,-1),this.item?.Lt(t),s&&this.gi(t,-1)}Ei(t){t.drawImage(h._.os,this.Ys.x,this.Ys.y+this.M-12,this.w,24)}attack(){return!(this.Es||this.Ms||!this.item||this.Zs?.ni)&&(h.Audio.play(h.Audio.C),this.ki=this.ki||new h.Dt(this.level),this.ki.set(this.item._i),this.Es=!0,!0)}ks(){return!this.Ms&&!this.Zs?.ni&&(h.Audio.play(h.Audio.H),this.Ai=this.Ai||new h.Dt(this.level),this.Ai.set(.5),this.Ti=this.Ys.clone(),this.Ms=!0,!0)}Lt(t){if(this.Rs<=0)return;let s=this.Vs<0?18:1,i=1,e=this.images;if(this.Ei(t),this.Ms){let s=360*this.Ai.Ot()*3*Math.PI/180;this.Vs<0&&(s=-s),h._.Pt(t,s,this.vt())}else this.ri()&&(i=18),this.state==h.g&&this.yi(t);this.item&&this.Mi(t,e),this.mi(t),t.drawImage(e,s,i,16,16,this.Ys.x,this.Ys.y,h.l,h.l),h._.resetTransform()}ci(){this.item?.bi(),this.Rs>0?(this.item=new h.vi,this.item.li=this):this.item=null}_s(){const t={x:this.Ys.x+16,y:this.Ys.y+this.M,w:this.w-32,M:h.u/2};return t.y-=t.M,t}bs(t){t.li||(this.item?.bi(),this.item=t,t.As=!1,t.li=this,this.level.removeItem(t))}update(t,s){if(null===this.pi&&(this.pi=this.Rs),this.Rs<=0)return;let i=h.p;this.js+=t,this.qs(t),this.Ms?this.Ai.us()?(this.Ms=!1,this.ti(this.Ti,!0)):(s=new h.D(this.Vs<0?-1:1,0),this.ei(s,t,i)):s&&(i=this.ei(s,t,i)),this.action&&(i=this.action(t)||i),this.state!=i&&(this.js=0),this.Es&&this.ki.us()&&(this.Es=!1),this.pi>this.Rs&&(this.pi=Math.max(this.Rs,this.pi-1.5*t)),this.state=i}},h.Ws={Ii(t,s){if(!t.item||!t.item.Bs(s))return!1;if(t.Si&&!t.Si.us())return!0;const i=new h.Dt(t.level,.3);return t.action=function(){i.us()&&(t.Es&&t.ki&&t.ki.us()?t.action=null:t.Es||(t.attack(),s.Xs(t.item),t.Si=t.Si||new h.Dt(t.level),t.Si.set(.8)))},!0},Fi(t,s){if(!(t instanceof h.$t)||Math.random()<.8)return!1;if(t.Di&&!t.Di.us())return!1;const i=t.vt(),e=s.vt(),n=new h.D(e.x-i.x,e.y-i.y);return!(Math.abs(n.y)>h.u||n.length()>2*h.l)&&(t.Vs=n.x<0?-1:1,t.speed.set(11,11),t.ks(),t.Di=t.Di||new h.Dt(t.level),t.Di.set(1.5),t.action=function(){t.Ms||(t.speed.set(3,3),t.action=null)},!0)},Ci(t){if(t.item&&!(t.item instanceof h.vi))return!1;let s=1/0,i=null,e=null;const n=t.vt(),r=t._s(),o=new h.D;for(let a=0;a<t.level.items.length;a++){const c=t.level.items[a];if(c instanceof h.Ni){const a=c._s();if(h.S(a,r)){const s=new h.Dt(t.level,.5);return t.action=function(){s.us()&&(t.bs(c),t.action=null)},!0}o.set(a.x+a.w/2-n.x,a.y+a.M/2-n.y);const l=o.length();l<3*h.l&&s>l&&(s=l,i=o.clone(),e=c)}}if(!e)return!1;const a=new h.Dt(t.level,.5);return i.normalize().mul(.5),t.action=function(s){if(a.us())t.action=null;else if(!t.Zs.ni)return t.ei(i,s,0)},!0},Hi(t,s){const i=t.vt(),e=s.vt(),n=new h.D(e.x-i.x,e.y-i.y);if(n.length()>t.xi)return!1;const r=new h.Dt(t.level,1);return n.normalize(),t.action=function(s){if(r.us())t.action=null;else if(!t.Zs.ni)return t.ei(n,s,0)},!0},Us(t,s){!s||t instanceof h.Li||!(t instanceof h.hi)||t.Zs.ni||t.Es||t.Ms||s.Rs<=0||this.Ci(t)||this.Fi(t,s)||this.Ii(t,s)||this.Hi(t,s)}},h.Ni=class extends h.zs{constructor(t){super(t)}Oi(){const t=h._,s=this._s(),i=t.Mt/t.scale,e=t.Et/t.scale,n=Math.sin(t.level.yt/25);let r=s.x+s.w/2+i-15,o=s.y-1.5*h.u+e;t.Ht.drawImage(t.jt,r,o+8*n,30,18),t.Ht.fillStyle="#fff";let a=2*n;r=s.x-6+i-a,o=s.y+s.M+e+a,t.Ht.fillRect(r,o,6,12),t.Ht.fillRect(r,o+6,12,6),r=s.x+s.w+i+a,o=s.y-6+e-a,t.Ht.fillRect(r-6,o,12,6),t.Ht.fillRect(r,o,6,12)}Ri(){this.li&&this.Ys.set(this.li.Ys.x-h.u,this.li.Ys.y+this.li.M)}bi(){this.Ts&&(this.Ri(),this.li?.level.Ss(this)),this.li=null}ai(){}Ps(){return this.Ys.y}},h.Os=class extends h.hi{constructor(t={}){t.item=t.item||new h.vi,super(t),this.images=h._.Vt,this.wi=32/h.o,this.speed.set(3,3)}Xs(t){this.Rs<=0||super.Xs(t)}},h.$t=class extends h.Os{static At(t){t.fillStyle="#000";let s=7;t.fillRect(s,8,6,1),t.fillRect(s+2,8,3,2),s=22,t.fillRect(s,8,6,1),t.fillRect(s+1,8,3,2)}},h.Qt=class extends h.$t{constructor(t){super(t),this.Rs=this.$s=300,this.images=h._.qt,this.xi=14*h.l}static At(t){t.fillStyle="#000";let s=8;t.fillRect(s,7,3,1),t.fillRect(s+1,7,2,2),t.fillRect(s+2,7,1,3),t.fillRect(s+4,7,1,3),t.fillRect(s+4,7,2,2),s=22,t.fillRect(s,7,2,2),t.fillRect(s+1,7,1,3),t.fillRect(s+3,7,1,3),t.fillRect(s+3,7,2,2),t.fillRect(s+3,7,3,1)}mi(){}},h.Ki=class extends h.Os{constructor(t={}){super(t),this.images=h._.ss,this.speed.set(4,4)}},h.Li=class extends h.Os{constructor(t){super(t),this.images=h._.ts,this.Rs=this.$s=300}ci(){this.item?.bi(),this.item=null}Xs(t){this.Rs<=0||super.Xs(t)}},h.Jt=class extends h.hi{constructor(t={}){t.item=t.item||new h.vi,super(t),this.Rs=this.$s=200,this.di="#fe0"}attack(){return!(this.Si&&!this.Si.us())&&(!!super.attack()&&(this.Si=this.Si||new h.Dt(this.level),this.Si.set(.65),!0))}ks(){return!(this.Di&&!this.Di.us())&&(!!super.ks()&&(this.Di=this.Di||new h.Dt(this.level),this.Di.set(.8),!0))}static At(t){t.fillStyle="#000";let s=12;t.fillRect(s,7,1,4),t.fillRect(s-2,7,1,4),t.fillRect(s-4,7,1,4),s=23,t.fillRect(s,7,1,4),t.fillRect(s+2,7,1,4),t.fillRect(s+4,7,1,4)}},h.vi=class extends h.Ni{constructor(t={}){super(t),this._i=.2,this.oi=15}Bs(t){if(!this.li)return!1;const s={x:this.li.Ys.x+this.li.w,y:this.li.Ys.y+h.u/2,w:h.u,M:h.u};this.li.Vs<0&&(s.x-=this.li.w+s.w);const i={x:t.Ys.x,y:t.Ys.y,w:t.w,M:t.M};return h.S(i,s)}Lt(t){if(!this.li?.Es)return;let s=this.li.Ys.x+this.li.w-32,i=this.li.Ys.y+this.li.M/2-16,e=this.li.ki.Ot();s+=Math.sin(e*Math.PI)*h.u*1.5,t.drawImage(h._.es,1,1,7,6,s,i,h.u,h.u)}ai(t){if(!(t instanceof h.hi))return;const s=new h.Dt(this.li.level,.4);return t.Zs.ni=!0,t.ci(),function(){return!!s.us()&&(t.Zs.ni=!1,!0)}}},h.Pi=class extends h.Ni{constructor(t={}){t.w=t.w||h.u,t.M=t.M||2*h.l,super(t),this._i=.25,this.Ts=!0,this.oi=30,this.Gi=1.35*h.l}Ri(){this.li&&(this.Ys.x=this.li.Ys.x-h.u,this.Ys.y=this.li.Ys.y-this.li.M+this.M/2,this.li.Vs>0&&(this.Ys.x+=1.5*h.u+this.li.w))}Bs(t){if(!this.li)return!1;const s=[{x:this.li.Ys.x+this.li.w,y:this.li.Ys.y,w:1.7*h.l,M:h.l},{x:this.li.Ys.x+this.li.w,y:this.li.Ys.y-.7*h.l,w:h.l,M:2.4*h.l}];this.li.Vs<0&&(s[0].x-=this.li.w+s[0].w,s[1].x-=this.li.w+s[1].w);const i={x:t.Ys.x,y:t.Ys.y,w:t.w,M:t.M};for(let t=0;t<s.length;t++)if(h.S(i,s[t]))return!0;return!1}Lt(t){let s=this.Ys.x,i=this.Ys.y;this.li&&(s=this.li.Ys.x+h.u,i=this.li.Ys.y-h.l-16);let e=0,n={x:s+this.w/2,y:i+this.M/2};if(this.li){if(this.li?.Es){n.x=s+this.w/2,n.y=i+this.M;let t=this.li.ki.Ot();const h=Math.PI;t<=.4?(t/=.4,e=t*h):e=t<=.8?h:0}}else e=80*Math.PI/180;e&&h._.Pt(t,e,n),t.drawImage(h._.Bt,1,1,8,32,s,i,this.w,this.M),e&&this.li?.Es&&h._.Pt(t,-e,n),this.li||(h._.resetTransform(),this.As&&this.Oi(t))}ai(t){if(!t.ii)return;const s=t.Ys.clone(),i=this.li.vt(),e=t.vt(),n=new h.D(e.x-i.x,e.y-i.y);n.normalize();const r=new h.Dt(this.li.level,.5),o=Math.max(0,this.Gi-t.weight);return t.Zs.ni=!0,function(){if(r.us())return t.Zs.ni=!1,!0;const i=r.Ot(),h=t.Ys.clone();return t.Ys.set(s.x+n.x*o*i,s.y+n.y*o*i),t.ti(h),!1}}_s(){return{x:this.Ys.x-1.5*this.w,y:this.Ys.y+1.5*this.w,w:this.M,M:this.w}}},h.Bi=class extends h.Pi{constructor(t={}){t.w=30,t.M=70,super(t),this._i=.2,this.oi=25,this.Gi=.8*h.l}Ri(){this.li&&(this.Ys.x=this.li.Ys.x-this.w/2,this.Ys.y=this.li.Ys.y+this.li.M-this.M/2,this.li.Vs>0&&(this.Ys.x+=this.li.w+this.w/2-16))}Bs(t){if(!this.li)return!1;const s={x:this.li.Ys.x+this.li.w-24,y:this.li.Ys.y-16,w:.7*h.l+24,M:.7*h.l+16};this.li.Vs<0&&(s.x-=this.li.w+s.w-48);const i={x:t.Ys.x,y:t.Ys.y,w:t.w,M:t.M};return h.S(i,s)}Lt(t){let s=this.Ys.x,i=this.Ys.y;this.li&&(s=this.li.Ys.x+this.li.w-26,i=this.li.Ys.y-8);let e=0,n={x:s+this.w/2,y:i+this.M/2};if(this.li){if(this.li?.Es){n.x=s+this.w/2,n.y=i+this.M;let t=this.li.ki.Ot();const h=75*Math.PI/180;t<=.4?(t/=.4,e=t*h):e=t<=.8?h:0}}else e=55*Math.PI/180;e&&h._.Pt(t,e,n),t.drawImage(h._.ns,1,1,6,14,s,i,this.w,this.M),e&&this.li?.Es&&h._.Pt(t,-e,n),this.li||(h._.resetTransform(),this.As&&this.Oi(t))}_s(){return{x:this.Ys.x-36,y:this.Ys.y,w:this.w+56,M:this.M}}},h.T.Xi=class extends h.T{constructor(){super(),this.Ui=0,this.Wi=1,this.zi=!!h.I(),this.zi&&(this.Ui=1,this.Wi=2)}Yi(t,s,i,e,n){if(n){let s=h.u/2,n=h.l,r=i-96,o=e-n/2,a={x:r+s/2,y:o+n/2};h._.Pt(t,Math.PI/2,a),h._.Gt(t,Math.sin(.08*this.yt),1,a),t.drawImage(h._.images,32,16,8,32,r,o,s,n),h._.resetTransform()}t.fillStyle=n?"#fa0":"#777",t.textBaseline="middle",t.fillText(s,i,e)}Lt(){const t=h._.Nt;let s=Math.max(2*h.l,h._.gt.x-500),i=Math.max(2*h.l,h._.gt.y-128);t.fillStyle="#0d161e",h._.Wt(),t.font="600 64px "+h.h,t.textAlign="left",t.fillStyle="#fa0",t.fillText("TREASURE OF THE NIBELUNGS",s,i+3),t.fillStyle="#777",t.fillText("TREASURE OF THE NIBELUNGS",s,i),t.font="600 42px "+h.h,s+=h.u/2+114,i+=96,this.Yi(t,"New Game",s,i,0==this.Ui),this.zi||(t.globalAlpha=.5),i+=72,this.Yi(t,"Continue",s,i,1==this.Ui),t.globalAlpha=1}I(){const t=h.I();if(!t)return;let s=null;if(1==t.level)s=new h.T.ji;else if(2==t.level)s=new h.T.Zi;else if(3==t.level)s=new h.T.A;else{if(4!=t.level)return;s=new h.T.Ji}h._.St(s)}update(t){this.yt+=t,h.k.nt(h.k.L.B,!0)?this.Ui--:h.k.nt(h.k.L.U,!0)?this.Ui++:h.k.nt(h.k.L.R,!0)&&(h.Audio.play(h.Audio.SELECT),0==this.Ui?h._.St(new h.T.Vi):1==this.Ui&&this.I()),this.Ui<0?this.Ui=this.Wi-1:this.Ui>=this.Wi&&(this.Ui=0)}},h.T.Vi=class extends h.T{constructor(){super(),this.$i=["Ez enwas niht anders","wan gestéinẹ unde golt.","unt ob man al die werlde","het dâ von versolt,","sîn wǽré niht mínner","einer marke wert."],this.qi=["Ê daz der künee rîche","wider wære komen,","die wîle hete Hagene","den schaz vil gar genomen.","","er sanctẹ in dâ ze Lôche","allen in den Rîn.","er wandẹ er soldẹ in niezen:","des enkunde niht gesîn."],this.Qi=["The legendary treasure of the Nibelungs:","Gems and gold more than one could ever hope to spent.","","While the king and his men where away, Hagen stole it","all and sunk the treasure in the Rhine at Lochheim.","But he was killed before being able to retrieve the riches.","","Betting on its the existance,","many set off to look for the treasure."],this.th=new h.Dt(this,2)}Lt(){const t=h._.Nt;t.fillStyle="#0d161e",h._.Wt();let s=2*h.l,i=s,e=500+h.l,n=49*(this.$i.length+this.qi.length)+2*h.l+16,r=s-h.u,o=i-h.l;t.fillStyle="#e5c382",t.fillRect(r,o,e,n),t.fillStyle=h._.createLinearGradient(r,o,r,o+n/2,"#0002","#0000"),t.fillRect(r,o,e,n/2),t.fillStyle=h._.createLinearGradient(r,o+n/2,r,o+n,"#0000","#0002"),t.fillRect(r,o+n/2,e,n/2),t.fillStyle="#e5c382",t.fillRect(r-36,o-72,e+72,1.5*h.l),t.fillRect(r-36,o+n-72,e+72,1.5*h.l);let a=t.createLinearGradient(r-36,o-72,r-36,o-72+1.5*h.l);a.addColorStop(0,"#0000"),a.addColorStop(1,"#0003"),t.fillStyle=a,t.fillRect(r-36,o-72,e+72,1.5*h.l),a=t.createLinearGradient(r-36,o+n-72,r-36,o+n-72+1.5*h.l),a.addColorStop(0,"#0003"),a.addColorStop(1,"#0000"),t.fillStyle=a,t.fillRect(r-36,o+n-72,e+72,1.5*h.l),t.font="italic 38px "+h.i,t.textAlign="center",t.fillStyle="#000";s+=250,i+=36,this.$i.forEach((h=>{t.fillText(h,s,i),i+=47})),i+=47,this.qi.forEach((h=>{t.fillText(h,s,i),i+=47}));const c=this.th.Ot();if(s=e+2.75*h.l,i=3.25*h.l+(1-c)*h.l,t.font="32px "+h.t,t.textAlign="left",t.fillStyle="#ffffff"+Math.round(255*c).toString(16).padStart(2,"0"),this.Qi.forEach((h=>{t.fillText(h,s,i),i+=49})),this.th.us()){i+=49;let e=h.u/2,n=h.l,r=s+n/2,o=i-n/2,a={x:r+e/2,y:o+n/2};h._.Pt(t,Math.PI/2,a),h._.Gt(t,Math.sin(.08*this.yt),1,a),t.drawImage(h._.images,32,16,8,32,r,o,e,n),h._.resetTransform(),t.font="32px "+h.t,t.fillStyle="#fa0",t.textBaseline="middle",t.fillText("Continue",s+n+32,i)}}update(t){this.yt+=t,h.k.nt(h.k.L.R,!0)&&(this.th.us()?(h.Audio.play(h.Audio.SELECT),h._.St(new h.T.ji)):this.th.set(0))}},h.T.ji=class extends h.T{constructor(){super(),this.id=1,this.It={w:2*h._.gt.x,M:8*h.l};const t=new h.Jt({x:6*h.l,y:3*h.l,item:new h.vi}),s=new h.Li({x:13*h.l,y:3*h.l,item:new h.Pi});this.vs(t,s),this.Ks=t,this.sh=s,this.locked=!0,this.ih=-1,this.hh=new h.Dt(this,5)}Lt(){super.Lt();const t=h._.Nt;t.font="600 23px "+h.h,t.fillStyle="#fffc",t.textAlign="center";const s=this.Ks,i=s.vt(),e=this.sh.vt();if(0==this.ih)t.fillText("Move with [W][A][S][D] or arrow keys",i.x,i.y-s.M);else if(1==this.ih)t.fillText("Attack with [ENTER] or [SPACE]",e.x,e.y-2*this.sh.M);else if(2==this.ih){const s=this.items[0];if(s){const i=s._s();t.fillText("Pick up with [E]",i.x+i.w/2,i.y-i.M-h.u-8)}}else 3==this.ih?t.fillText("Attack with the sword",e.x,e.y-this.sh.M):4==this.ih&&t.fillText("You can dodge roll with [SHIFT]",i.x,i.y-s.M-h.l)}Fs(t){const s=this.Ks,i=this.sh,e=this.items[0];if(t.fillStyle="#222",t.fillRect(s.Ys.x-h.u,s.Ys.y+s.M-h.u,2*h.l,h.l),i.Rs>0&&t.fillRect(i.Ys.x-h.u,i.Ys.y+i.M-h.u,2*h.l,h.l),e){const s=e._s();t.fillRect(s.x-h.u,s.y+s.M-1.5*h.u,3*h.l,1.25*h.l)}}Ds(t){const s=h._;if(this.ih<0&&s.Xt(this.Ks,["Before heading out, let’s","think back on my training.","How did it go again?"]),5!==this.ih)return;s.Xt(this.Ks,["Right, that’s how it goes!","Now I am prepared!"]);const i=Math.sin(this.yt/25);let e=this.It.w-h.l+8*i,n=this.It.M/2+9;const r={x:e,y:n};t.fillStyle="#fff",t.textAlign="right",t.fillText("Continue",e-22,n-8);let o=-Math.PI/2;s.Pt(t,o,r),t.drawImage(s.jt,e,n,30,18),s.Pt(t,-o,r)}update(t){const s=this.Ks,i=h.k;if(-1==this.ih)h._.bt(s),i.nt(i.L.R,!0)&&this.hh.set(0),this.hh.us()&&(this.locked=!1,this.ih=0);else if(0==this.ih)i.nt(i.L.C,!0),this.eh?this.eh.us()&&(this.ih=1):(i.nt(i.L.B)||i.nt(i.L.X)||i.nt(i.L.U)||i.nt(i.L.G))&&(this.eh=new h.Dt(this,2));else if(1==this.ih){if(!(this.sh.item instanceof h.Pi)){const t=this.items[0];t.Ys.x=this.sh.Ys.x+2*h.l,t.Ys.y+=h.u,this.ih=2}}else if(2==this.ih)s.item instanceof h.Pi&&(this.ih=3);else if(3==this.ih)this.sh.Rs<this.sh.$s-s.item.oi&&(this.ih=4);else if(4==this.ih)i.nt(i.L.H)&&(this.ih=5);else if(5==this.ih){if(s.vt().x>=this.It.w-h.u)return void h._.St(new h.T.Zi)}super.update(t)}},h.T.Zi=class extends h.T{constructor(){super(),this.id=2,this.nh=36,this.rh=2,this.It={w:h.l*this.nh,M:h.l*this.rh};const t=new h.Jt({x:h.l});this.vs(t,new h.Ki({x:11*h.l,y:h.l-8,Vs:-1,item:new h.Bi}),new h.Ki({x:20*h.l,y:h.l-8,Vs:-1}),new h.Ki({x:31*h.l,Vs:-1,item:new h.Pi}),new h.Ki({x:31*h.l,y:h.l-8,Vs:-1})),this.Ss(new h.fi({x:11*h.l}),new h.fi({x:22*h.l,y:h.l+8}),new h.fi({x:32*h.l}),new h.fi({x:32*h.l,y:h.l+8}),new h.fi({x:33*h.l,y:h.l/2})),this.Ks=t,this.hh=new h.Dt(this,14)}oh(t,s,i,h,e){const n=t.fillStyle;t.fillRect(s,i,h,e),t.fillStyle="#0001",t.fillRect(s,i,12,e),t.fillStyle="#fff1",t.fillRect(s+h-12,i,12,e),t.fillStyle=n}Fs(t){const s=h._,i=12*Math.sin(this.yt/50);if(this.Ns(t,i),this.ah)t.drawImage(this.ah,0,-h.u/2);else{const[t,i]=s._t(this.It.w,this.It.M+4*h.l),e=h.u;i.fillStyle="#0003",i.fillRect(0,e+1.25*h.l,this.It.w,this.It.M),i.fillStyle="#544";for(let t=0;t<this.nh;t+=4)this.oh(i,t*h.l,4,h.u,2*h.l);for(let t=0;t<this.nh;t++)for(let n=0;n<this.rh;n++){let r=t*h.l,o=n*h.l+e;i.drawImage(s.images,0,0,16,16,r,o,h.l,h.l)}i.fillStyle=s.createLinearGradient(0,e,0,this.It.M,"#0001"),i.fillRect(0,e,this.It.w,this.It.M),i.fillStyle="#544",i.fillRect(0,this.It.M-6+e,this.It.w,24),this.ah=t}}Ds(t){this.hh.us()||h._.Xt(this.Ks,["My crew is already waiting. I","just have to make it to the ship.","But it seems there are pirates","in the harbor."]),t.fillStyle="#544";let s=this.rh*h.l-h.u/2,i=2*h.l;for(let e=0;e<this.nh;e+=4)this.oh(t,e*h.l,s,h.u,i)}update(t){super.update(t);this.Ks.vt().x>=this.It.w-h.u&&h._.St(new h.T.A)}},h.T.A=class extends h.T{constructor(){super(),this.id=3,this.nh=24,this.rh=6,this.It={w:h.l*this.nh,M:h.l*this.rh},this.Ks=new h.Jt({x:this.It.w/2-2*h.l,y:this.It.M/2-h.l}),this.vs(this.Ks);const t=this.It.M-h.l;this.Ss(this.lh(),new h.Bi({x:4*h.l,y:4.5*h.l}),new h.fi({x:this.It.w/2-h.u,y:this.It.M/2-h.l}),new h.fi({y:t}),new h.fi({x:4*h.l}),new h.fi({x:2*h.l,y:h.l}),new h.fi({x:2*h.l,y:h.l}),new h.fi({x:18*h.l}),new h.fi({x:19*h.l}),new h.fi({x:18.5*h.l,y:h.l}),new h.fi({x:8.5*h.l,y:t}),new h.fi({x:9.5*h.l,y:t}),new h.fi({x:this.It.w-2*h.l,y:t})),this.hh=new h.Dt(this,10),this.fh=new h.Dt(this),this.uh=new h.Dt(this,4),this.wh=0,this.dh=3}lh(){const t=new h.zs({x:this.It.w/2+h.u+8,y:this.It.M/2-1.25*h.u,w:h.l-16,M:1.25*h.u});return t.ii=!0,t.Gs=()=>!1,t.Lt=function(t){const s=this.Ys.y-8*h.l,i=this.M+8*h.l,e=this.w/3;t.fillStyle="#5a3c2e",t.fillRect(this.Ys.x,s,this.w,i),t.fillStyle="#0002",t.fillRect(this.Ys.x,s,e,i),t.fillStyle="#fff1",t.fillRect(this.Ys.x+this.w-e,s,e,i)},t}ph(){this.wh++,this.fh.set(2),this.xh=[],1==this.wh?this.xh.push(new h.Ki({x:-h.l,y:1.5*h.l,item:new h.Bi}),new h.Ki({x:-h.l,y:3*h.l}),new h.Ki({x:this.It.w,y:2.5*h.l,Vs:-1})):2==this.wh?this.xh.push(new h.Ki({x:this.It.w,y:1.5*h.l,Vs:-1}),new h.Ki({x:this.It.w,y:3*h.l,Vs:-1}),new h.Ki({x:-h.l,y:2.5*h.l})):3==this.wh&&this.xh.push(new h.Ki({x:this.It.w+h.l,y:1.5*h.l,Vs:-1}),new h.$t({x:this.It.w+h.l,y:3*h.l,Vs:-1,item:new h.Pi}),new h.$t({x:2*-h.l,y:2.5*h.l,item:new h.Pi})),this.xh.forEach((t=>{t.si=!0;const s=new h.D(t.Vs/2);t.action=i=>this.fh.us()?(t.action=null,void delete t.si):t.ei(s,i,h.g)})),this.vs(...this.xh)}Fs(t){const s=h._;if(this.Ns(t,this.gh),this.yh&&t.drawImage(this.yh,-6,-h.l),this.mh)t.drawImage(this.mh,0,0);else{const t=6,[i,e]=h._._t(this.It.w+1.5*t,this.It.M+.5*t+2*h.l);e.lineWidth=t;let n=t/2;e.strokeStyle="#8f563b",e.strokeRect(0,n,this.It.w+e.lineWidth+n,this.It.M+n);for(let i=0;i<this.nh;i++)for(let n=0;n<this.rh;n++){let r=i*h.l,o=t+n*h.l;e.drawImage(s.images,0,0,16,16,r,o,h.l,h.l)}e.fillStyle="#5a3c2e",e.fillRect(n-e.lineWidth,this.It.M,this.It.w+2*e.lineWidth,2*h.l),e.fillStyle=h._.createLinearGradient(0,this.It.M,0,this.It.M+2*h.l,"#0003","#4b73ac30"),e.fillRect(n-e.lineWidth,this.It.M,this.It.w+2*e.lineWidth,2*h.l),e.fillStyle=h._.createLinearGradient(0,0,0,this.It.M),e.fillRect(0,0,this.It.w+n,this.It.M),this.mh=i}}Ds(t){if(this.wh<=this.dh){const t=h._.Ht;t.fillStyle="#fff",t.font="600 23px "+h.h,t.textAlign="left",t.fillText(`Wave ${this.wh}/${this.dh}`,h.u,h.u)}if(this.Mh)t.drawImage(this.Mh,-this.gh,this.It.M+h.l+.5,h.l*(this.nh+1),h.l);else{const[t,s]=h._._t(h.l*(this.nh+1),h.l);for(let t=0;t<=this.nh;t++)s.drawImage(h._.images,32,0,16,16,t*h.l,0,h.l,h.l);this.Mh=t}if(this.yh)t.drawImage(this.yh,-6,this.It.M-h.l);else{const t=12+this.It.w,s=h.l,[i,e]=h._._t(t,s);e.lineWidth=6,e.fillStyle="#5a3c2e",e.fillRect(0,0,this.It.w+2*e.lineWidth,18),e.fillStyle="#0002",e.fillRect(0,12,this.It.w+2*e.lineWidth,6),e.fillStyle="#fff1",e.fillRect(0,0,this.It.w+2*e.lineWidth,6);const n=this.It.w/h.l+1;for(let t=0;t<=n;t++){let s=t*h.l,i=18,n=h.l+1;e.fillStyle="#5a3c2e",e.fillRect(s,i,18,n),e.fillStyle="#0002",e.fillRect(s,i,6,n),e.fillStyle="#fff1",e.fillRect(s+12,i,6,n)}this.yh=i}this.hh.us()||h._.Xt(this.Ks,["The Rhine has become a","battlefield! I have to","to defend the ship!"]),this.Eh&&!this.Eh.us()&&h._.Xt(this.Ks,["A tough battle, but finally...","Wait, do I see a golden","shimmer below the water?"])}update(t){super.update(t),this.gh=this.yt%20/20*h.l,this.wh<this.dh&&this.uh.us()&&(this.ph(),this.uh.set(16)),this.wh>=this.dh&&0==this.Ls()&&(this.Eh?this.Eh?.us()&&h._.St(new h.T.Ji):this.Eh=new h.Dt(this,5))}},h.T.Ji=class extends h.T{constructor(){super(),this.id=4,this.nh=24,this.rh=6,this.It={w:2*h._.gt.x,M:h.l*this.rh},this.Ks=new h.Jt({x:4*h.l,y:this.It.M/2-h.l,item:new h.Bi}),this.kh=new h.Qt({x:this.It.w-5*h.l,y:this.Ks.Ys.y,Vs:-1,item:new h.Pi}),this.vs(this.Ks,this.kh);let t=this.It.w-h.l+6;const s=[new h.fi({x:4*h.l,y:0}),new h.fi({x:5*h.l,y:0}),new h.fi({x:12*h.l,y:0}),new h.fi({x:16*h.l,y:this.It.M-h.l}),new h.fi({x:17*h.l,y:this.It.M-2*h.l}),new h.fi({x:18*h.l,y:this.It.M-2*h.l}),new h.ui({x:h.l-18,y:-10}),new h.ui({x:h.l-18,y:6*h.l-130}),new h.ui({x:t-h.l+18,y:-10}),new h.ui({x:t-h.l+18,y:6*h.l-130})];for(let i=0;i<8;i++){if(3==i||4==i)continue;let e=(h.l-20)*i-46;s.push(new h.ui({y:e})),s.push(new h.ui({x:t,y:e}))}this.Ss(...s),this.hh=new h.Dt(this,6),this.locked=!0,this._h=1,this.fh=new h.Dt(this),this.pi=this.kh.Rs,h._.bt(this.Ks)}Ah(){if(this.pi<=0)return;const t=Math.max(0,this.pi/this.kh.$s),s=h._,i=s.Ht;let e=3*h.l,n=s.Rt.height/s.scale-2*h.l,r=s.Rt.width/s.scale-6*h.l,o=24;i.fillStyle="#000a",i.fillRect(e,n,r,o),i.fillStyle="#f00",i.fillRect(e,n,r*t,o),i.fillStyle="#fff2",i.fillRect(e,n,r*t,12),i.fillStyle="#fffa",i.fillRect(e,n,2,o),i.fillRect(e+r/3,n,2,o),i.fillRect(e+2*r/3,n,2,o),i.fillRect(e+r,n,2,o)}Th(){this.fh.set(2),this.xh=[],2==this._h?this.xh.push(new h.Ki({x:-h.l,y:1.5*h.l,item:new h.Bi}),new h.Ki({x:this.It.w,y:2.5*h.l,Vs:-1})):3==this._h&&this.xh.push(new h.Ki({x:this.It.w,y:1.5*h.l,Vs:-1}),new h.$t({x:-h.l,y:2.5*h.l,item:new h.Pi})),this.xh.forEach((t=>{t.si=!0;const s=new h.D(t.Vs/2);t.action=i=>this.fh.us()?(t.action=null,void delete t.si):t.ei(s,i,h.g)})),this.vs(...this.xh)}Fs(t){const s=h._;if(this.Ns(t,this.gh),this.yh&&t.drawImage(this.yh,-6,-h.l),this.mh)t.drawImage(this.mh,0,0);else{const t=6,[i,e]=h._._t(this.It.w+1.5*t,this.It.M+.5*t+2*h.l);e.lineWidth=t;let n=t/2;e.strokeStyle="#8f563b",e.strokeRect(0,n,this.It.w+e.lineWidth+n,this.It.M+n);for(let i=0;i<this.nh;i++)for(let n=0;n<this.rh;n++){let r=i*h.l,o=t+n*h.l;e.drawImage(s.images,0,0,16,16,r,o,h.l,h.l)}e.fillStyle="#5a3c2e",e.fillRect(n-e.lineWidth,this.It.M,this.It.w+2*e.lineWidth,2*h.l),e.fillStyle=h._.createLinearGradient(0,this.It.M,0,this.It.M+2*h.l,"#0003","#4b73ac30"),e.fillRect(n-e.lineWidth,this.It.M,this.It.w+2*e.lineWidth,2*h.l),e.fillStyle=h._.createLinearGradient(0,0,0,this.It.M),e.fillRect(0,0,this.It.w+n,this.It.M),this.mh=i}}Ds(t){const s=h._;if(this.Mh)t.drawImage(this.Mh,-this.gh,this.It.M+h.l+.5,h.l*(this.nh+1),h.l);else{const[t,i]=s._t(h.l*(this.nh+1),h.l);for(let t=0;t<=this.nh;t++)i.drawImage(s.images,32,0,16,16,t*h.l,0,h.l,h.l);this.Mh=t}if(this.yh)t.drawImage(this.yh,-6,this.It.M-h.l);else{const t=12+this.It.w,i=h.l,[e,n]=s._t(t,i);n.lineWidth=6,n.fillStyle="#5a3c2e",n.fillRect(0,0,this.It.w+2*n.lineWidth,18),n.fillStyle="#0002",n.fillRect(0,12,this.It.w+2*n.lineWidth,6),n.fillStyle="#fff1",n.fillRect(0,0,this.It.w+2*n.lineWidth,6);const r=this.It.w/h.l+1;for(let t=0;t<=r;t++){let s=t*h.l,i=18,e=h.l+1;n.fillStyle="#5a3c2e",n.fillRect(s,i,18,e),n.fillStyle="#0002",n.fillRect(s,i,6,e),n.fillStyle="#fff1",n.fillRect(s+12,i,6,e)}this.yh=e}this.Ah(),this.hh.us()||s.Xt(this.Ks,["So much gold! What a treasure!","There is only one other group left","opposing us. Let’s finish this!"]),this.Eh&&!this.Eh.us()&&s.Xt(this.Ks,["Cast off, crew!","Before even more arrive!"])}update(t){this.hh.Ot()>.3&&(this.locked=!1),super.update(t),this.gh=12*Math.sin(this.yt/50),this.pi>this.kh.Rs&&(this.pi=Math.max(this.kh.Rs,this.pi-t));const s=Math.max(0,this.pi/this.kh.$s);1==this._h?s<.67&&(this._h=2,this.Th()):2==this._h?s<.34&&(this._h=3,this.Th()):0==s&&0==this.Ls()&&(this.Eh?this.Eh?.us()&&h._.St(new h.T.bh):this.Eh=new h.Dt(this,5))}},h.T.bh=class extends h.T{constructor(){super();const t=h._.gt.x,s=h._.gt.y;this.Ks=new h.Jt({x:t-h.u,y:s-h.u,Vs:-1,item:new h.Pi}),this.Ks.si=!0,this.vs(this.Ks);const i=h.l-6,e=h.l-30;this.Ih=[];let n=1;const r=i/2,o=this.Ks.Ys.y+e;for(let t=-1;t<8;t++){const s=this.Ks.Ys.x-Math.floor(n/2)*r;for(let i=0;i<n;i++)this.Ih.push(new h.ui({x:s+i*r,y:o+t*e}));n+=2}this.Sh=0,this.Fh=new h.Dt(this,5)}Lt(){const t=h._.Ht;this.Ih.forEach((s=>s.Lt(t)));const s=h._.gt.x;let i=2.5*h.l;t.fillStyle="#ff0",t.font="600 72px "+h.h,t.textAlign="center",t.fillText("YOU CLAIMED THE TREASURE!",s,i),t.fillStyle="#fffa",t.font="600 18px "+h.h,this.Sh>0&&(i+=32,t.fillText("That makes you the richest person far and wide.",s,i)),this.Sh>1&&(i+=25,t.fillText("Make sure to properly pay your crew.",s,i)),this.Sh>2&&(i+=25,t.fillText("Where will you even store all that?",s,i)),this.Ks.Lt(t)}update(t){this.yt+=t,this.Fh.us()&&(this.Sh++,this.Fh.set(5))}};