const t={t:!0,i:'"Courier New", monospace',h:60,o:96,u:1,l:2,init(){t.p.init(),t.Audio.init(),t.m.init((()=>{t.m.level=new t.M.g,t.m.A()}))}};window.addEventListener("load",(()=>t.init())),t._=class{constructor(t=0,s=0){this.x=t,this.y=s}clone(){return new t._(this.x,this.y)}length(){return this.x+this.y===0?0:Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const t=this.length();return t&&(this.x/=t,this.y/=t),this}set(t,s){this.x=t,this.y=s}},t.Audio={T:{},k:.2,D:{K:(t,s,i)=>(s[t]=2*Math.random()-1,i[t]=2*Math.random()-1,!1)},init(){this.F=new window.AudioContext,this.gain=this.F.createGain(),this.gain.connect(this.F.destination),this.volume(.1);for(const t in this.D){const s=2*this.F.sampleRate,i=this.F.createBuffer(2,s,this.F.sampleRate),h=i.getChannelData(0),e=i.getChannelData(1);for(let i=0;i<s&&!this.D[t](i,h,e);i++);this.T[t]=i}},S(){0!==this.gain.gain.value&&(this.k=this.gain.gain.value,this.gain.gain.value=0)},play(t,s,i=1,h="dec"){const e=this.F.createGain();e.connect(this.gain),"inc"===h?(e.gain.setValueAtTime(0,this.F.currentTime),e.gain.linearRampToValueAtTime(i,this.F.currentTime+s-.01)):(e.gain.setValueAtTime(i,this.F.currentTime),e.gain.linearRampToValueAtTime(0,this.F.currentTime+s-.01));const n=this.T[t.name],o=this.F.createBufferSource();return o.buffer=n,o.connect(e),o.start(0,0,s),o},O(t,s,i="sine",h="dec"){const e=this.F.createGain();e.connect(this.gain),"inc"===h?(e.gain.setValueAtTime(0,this.F.currentTime),e.gain.linearRampToValueAtTime(1,this.F.currentTime+s-.01)):(e.gain.setValueAtTime(1,this.F.currentTime),e.gain.linearRampToValueAtTime(0,this.F.currentTime+s-.01));const n=this.F.createOscillator();return n.type=i,n.frequency.setValueAtTime(t,this.F.currentTime),n.connect(e),n.start(),n.stop(this.F.currentTime+s),n},P(){this.gain.gain.value=this.k},volume(t){this.gain.gain.value=Math.min(1,Math.max(0,t))}},t.p={v:{I:1,C:2,L:3,N:4,U:10,G:11,R:12,H:13,W:14,B:15},V:{},q:{},X:{click:[],Y:[],Z:[]},j:{},J:{},$:{},tt:{},st:new t._,it:0,ht(){this.et={[this.v.I]:{keyboard:["Escape"],gamepad:[9]},[this.v.G]:{keyboard:["ArrowUp","KeyW","KeyZ","KeyY"],gamepad:[12]},[this.v.U]:{keyboard:["ArrowLeft","KeyA","KeyQ"],gamepad:[14]},[this.v.H]:{keyboard:["ArrowDown","KeyS"],gamepad:[13]},[this.v.R]:{keyboard:["ArrowRight","KeyD"],gamepad:[15]},[this.v.N]:{keyboard:["Space","Enter"],gamepad:[0]},[this.v.C]:{keyboard:["Enter"],gamepad:[0]}}},nt(){let t=0,s=0;if(this.ot(this.v.U)?t=-1:this.ot(this.v.R)&&(t=1),this.ot(this.v.G)?s=-1:this.ot(this.v.H)&&(s=1),!t||!s){const i=.3;for(const h in this.$){const e=this.$[h];e.axes[0]&&Math.abs(e.axes[0])>i?t=e.axes[0]>0?1:-1:e.axes[2]&&Math.abs(e.axes[2])>i&&(t=e.axes[2]>0?1:-1),e.axes[1]&&Math.abs(e.axes[1])>i?s=e.axes[1]>0?1:-1:e.axes[3]&&Math.abs(e.axes[3])>i&&(s=e.axes[3]>0?1:-1)}}return{x:t,y:s}},rt(t){return this.et[t]},init(){this.ht(),this.ct()},ot(t,s){const i=this.rt(t);for(const t of i.keyboard)if(this.dt(t,s))return!0;for(const t of i.gamepad)if(this.ut(t,s))return!0;if(t===this.v.U)for(const t in this.$){const i=this.$[t];if(i.axes[6]&&i.axes[6]<=-.2)return!this.q["lt"]&&(s&&(this.q["lt"]=!0),!0)}else if(t===this.v.R)for(const t in this.$){const i=this.$[t];if(i.axes[6]&&i.axes[6]>=.2)return!this.q["wt"]&&(s&&(this.q["wt"]=!0),!0)}else if(t===this.v.G)for(const t in this.$){const i=this.$[t];if(i.axes[7]&&i.axes[7]<=-.2)return!this.q["ft"]&&(s&&(this.q["ft"]=!0),!0)}else if(t===this.v.H)for(const t in this.$){const i=this.$[t];if(i.axes[7]&&i.axes[7]>=.2)return!this.q["gt"]&&(s&&(this.q["gt"]=!0),!0)}return!1},ut(t,s){for(const i in this.$){const h=this.$[i].buttons[t];if(h&&h.pressed)return!this.q[t]&&(s&&(this.q[t]=!0),!0)}return!1},dt(t,s){const i=this.tt[t];return!(!i||!i.time)&&(s&&(i.time=0,i.yt=!0),!0)},Mt(t,s){if("function"!=typeof s)return void(this.X[t]=[]);const i=this.X[t].indexOf(s);i>=0&&this.X[t].splice(i,1)},Et(t,s){this.X[t].push(s)},xt(t,s){const i=this.j[t]||[];i.push(s),this.j[t]=i},At(t,s){const i=this.J[t]||[];i.push(s),this.J[t]=i},ct(){document.body.onkeydown=t=>{const s=this.tt[t.code];s&&s.yt||(this.tt[t.code]={time:Date.now()},this.j[t.code]&&this.j[t.code].forEach((t=>t())))},document.body.onkeyup=t=>{this.tt[t.code]={time:0},this.J[t.code]&&this.J[t.code].forEach((t=>t()))},document.body.onmousemove=t=>{this.st.x=t.clientX,this.st.y=t.clientY},document.body.onclick=t=>{this.X.click.forEach((t=>t(this.st.clone())))},window.addEventListener("gamepadconnected",(t=>{this.it++,this.$[t.gamepad.index]=t.gamepad,this.X.Y.forEach((t=>t()))})),window.addEventListener("gamepaddisconnected",(t=>{this.it--,delete this.$[t.gamepad.index],this.X.Z.forEach((t=>t()))}))},update(){const t=navigator.getGamepads();for(const s of t)if(s){this.$[s.index]=s;for(const t in this.q)"axis6-"===t||"axis6+"===t?s.axes[6]||delete this.q[t]:"axis7-"===t||"axis7+"===t?s.axes[7]||delete this.q[t]:s.buttons[t]&&!s.buttons[t].pressed&&delete this.q[t]}}},t.m={_t:new t._,scale:1,Tt:0,kt:0,bt(t){const s=t.Dt();this.Tt=this._t.x-s.x,this.kt=this._t.y-s.y},clear(){this.F.setTransform(1,0,0,1,0,0),this.F.clearRect(0,0,window.innerWidth,window.innerHeight),this.Kt.setTransform(1,0,0,1,0,0),this.Kt.clearRect(0,0,window.innerWidth,window.innerHeight)},Ft(){this.clear(),this.F.setTransform(this.scale,0,0,this.scale,this.Tt,this.kt),this.Kt.setTransform(this.scale,0,0,this.scale,0,0),this.level&&this.level.Ft()},St(){this.Kt.setTransform(this.scale,0,0,this.scale,0,0),this.Kt.clearRect(0,0,window.innerWidth,window.innerHeight),this.Kt.fillStyle="rgba(0,0,0,0.4)",this.Kt.fillRect(0,0,window.innerWidth,window.innerHeight),this.Kt.fillStyle="#FFF",this.Kt.font="normal 56px "+t.i,this.Kt.textAlign="center",this.Kt.textBaseline="top",this.Kt.fillText("PAUSED",this._t.x,60)},Ot(t,s){const i=document.createElement("canvas");i.width=t,i.height=s;const h=i.getContext("2d",{alpha:!0});return h.imageSmoothingEnabled=!1,[i,h]},init(t){this.Pt=document.getElementById("c"),this.F=this.Pt.getContext("2d",{alpha:!0}),this.F.imageSmoothingEnabled=!1,this.vt=document.getElementById("ui"),this.Kt=this.vt.getContext("2d",{alpha:!0}),this.Kt.imageSmoothingEnabled=!1,this.It((()=>{this.ct(),t()}))},It(t){const s=new Image;s.onload=()=>{this.images=s,t()},s.src="i.png"},A(s=0){if(t.p.update(),s&&this.Ct){const i=(s-this.Ct)/(1e3/t.h);if(this.F.imageSmoothingEnabled=!1,this.Kt.imageSmoothingEnabled=!1,this.Lt)return void this.St();this.level.update(i),this.Ft(),t.t&&(this.Kt.fillStyle="#000",this.Kt.fillRect(40,window.innerHeight-45,140,28),this.Kt.fillStyle="#FFF",this.Kt.font="bold 16px "+t.i,this.Kt.textAlign="right",this.Kt.textBaseline="bottom",this.Kt.fillText(~~(t.h/i)+" FPS / "+this.scale,160,window.innerHeight-22))}this.Ct=s,requestAnimationFrame((t=>this.A(t)))},resetTransform(){this.F.setTransform(this.scale,0,0,this.scale,this.Tt,this.kt)},pause(){this.Lt=!0,t.Audio.S()},ct(){window.addEventListener("resize",(t=>this.resize())),this.resize();const s=t.p.rt(t.p.v.I);setInterval((()=>{this.Lt&&t.p.update(),s.gamepad.forEach((s=>{t.p.ut(s,!0)&&this.Nt()}))}),100);const i=()=>this.Nt();s.keyboard.forEach((s=>t.p.At(s,i))),t.p.Et("gp_disconnect",(()=>this.pause())),t.p.Et("click",(t=>{this.Lt||this.level&&this.level.Ut(t)}))},Gt(){this.level=new this.level.constructor},resize(){this.Pt.width=window.innerWidth,this.Pt.height=window.innerHeight,this.vt.width=window.innerWidth,this.vt.height=window.innerHeight,this._t.x=Math.floor(this.Pt.width/2),this._t.y=Math.floor(this.Pt.height/2),this.Lt&&(clearTimeout(this.Rt),this.Rt=setTimeout((()=>this.St()),100))},Nt(){this.Lt?this.unpause():this.pause()},unpause(){this.Lt&&(this.Lt=!1,t.Audio.P(),this.A())}},t.Ht=class{constructor(t,s=0){this.level=t,this.set(s)}Wt(){return this.level.zt>this.timeEnd}Bt(){return Math.min(1,1-(this.timeEnd-this.level.zt)/this.duration)}set(s){this.duration=s*t.h,this.timeEnd=this.level.zt+this.duration}},t.M=class{constructor(){this.Vt=!1,this.qt={},this.zt=0,this.Xt=[],this.Yt=[],this.Zt={p1:null,p2:null}}jt(...t){t.forEach((t=>t.level=this)),this.Yt.push(...t),this.Xt.push(...t)}Qt(...t){t.forEach((t=>t.level=this)),this.Xt.push(...t)}Ut(t){if(!this.Vt)for(const s of this.Yt)if(s.Jt(t)&&this.Zt.p2!==s){this.Zt.p1=s;break}}Ft(){this.Vt?this.$t(t.m.F):(this.ts(t.m.F),this.Xt.forEach((s=>s.Ft(t.m.F))))}$t(s){const i=t.m._t;s.font="bold 36px "+t.i,s.textAlign="center",s.fillStyle="#DDD",s.fillText("GAME OVER",i.x,i.y)}update(s){if(this.zt+=s,this.Vt)t.p.ot(t.p.v.C,!0)&&t.m.Gt();else{const i=this.Zt.p1;if(i){t.m.bt(i),t.p.ot(t.p.v.N,!0)&&i.attack();let h=t.p.nt();h=new t._(h.x,h.y),i.update(s,h.normalize())}this.Xt.sort(((t,s)=>t.ss()-s.ss())),this.Xt.forEach((t=>{t!==i&&(t.update(s),i?.hs&&i.item.es(t)&&t.ns(i.item))}))}}},t.os=class{constructor(s={}){this.rs=new t._(s.x,s.y),this.w=s.w||0,this.cs=s.cs||0,this.ds=0,this.us=1/0,this.ls=1/0,this.ws=new t._(1,0),this.speed=new t._,this.state=t.u}Ft(t){}Dt(){return{x:this.rs.x+this.w/2,y:this.rs.y+this.cs/2}}Jt(t){return this.rs.x<=t.x&&t.x<=this.rs.x+this.w&&this.rs.y<=t.y&&t.y<=this.rs.y+this.cs}ss(){return this.rs.y+this.cs}ns(t){this.ls=Math.max(0,this.ls-t.ps)}update(s,i){let h=t.u;this.ds+=s,i&&(this.rs.x+=Math.round(s*i.x*this.speed.x),this.rs.y+=Math.round(s*i.y*this.speed.y),(i.x||i.y)&&(h=t.l,this.ws.set(0==i.x?this.ws.x:i.x>0?1:-1,0==i.y?this.ws.y:i.y>0?1:-1))),this.state!=h&&(this.ds=0),this.state=h}},t.fs=class extends t.os{constructor(s={}){s.w=t.o,s.cs=t.o,super(s),this.gs=null,this.hs=!1,this.us=100,this.ls=100,this.item=s.item,this.level=null,this.speed.set(12,12),this.item&&(this.item.ys=this)}Ms(t,s){const i=this.Dt();t.translate(i.x,i.y),t.scale(s,1),t.translate(-i.x,-i.y)}Es(s){const i=this.Dt();s.translate(i.x,i.y),s.rotate(.1*Math.sin(this.ds/t.h*48)),s.translate(-i.x,-i.y)}xs(t){if(this.ls==this.us)return;let s=this.ls/this.us,i=this.rs.x+16,h=this.rs.y-24,e=this.w-32;t.fillStyle="#000",t.fillRect(i,h,e,8),t.fillStyle="#f00",t.fillRect(i,h,e*s,8)}As(t){const s=this.ws.x<0;s&&this.Ms(t,-1),this.item?.Ft(t),s&&this.Ms(t,-1)}attack(){!this.hs&&this.item&&(this.gs=this.gs||new t.Ht(this.level),this.gs.set(this.item._s),this.hs=!0)}Ft(s){let i=this.Ts+(this.ws.x<0?16:0);this.state===t.l&&this.Es(s),this.item&&this.As(s),this.xs(s),s.drawImage(t.m.images,i,this.ks,this.bs,this.Ds,this.rs.x,this.rs.y,t.o,t.o),t.m.resetTransform()}update(t,s){super.update(t,s),this.hs&&this.gs.Wt()&&(this.hs=!1),this.level&&(this.rs.x=Math.min(this.level.qt.x+this.level.qt.w-this.w,Math.max(this.level.qt.x,this.rs.x)),this.rs.y=Math.min(this.level.qt.y+this.level.qt.cs-this.cs,Math.max(this.level.qt.y,this.rs.y)))}},t.Ks=class extends t.os{constructor(t){super(t),this.ys=null}},t.Fs=class extends t.fs{constructor(t){super(t),this.Ts=0,this.ks=32,this.bs=16,this.Ds=16}},t.Ss=class extends t.fs{constructor(t){super(t),this.Ts=0,this.ks=16,this.bs=16,this.Ds=16}},t.Os=class extends t.Ks{constructor(t){super(t),this._s=.2,this.ps=5}Ft(s){let i=this.rs.x,h=this.rs.y;this.ys&&(i=this.ys.rs.x+this.w-20,h=this.ys.rs.y+this.cs/2-6),this.ys.hs&&(i+=Math.max(0,Math.sin(this.ys.gs.Bt()*Math.PI*2)*t.o/2)),s.drawImage(t.m.images,40,16,8,8,i,h,t.o/2,t.o/2)}},t.Ps=class extends t.Ks{constructor(t){super(t),this._s=.25,this.ps=10}Ft(s){let i=this.rs.x,h=this.rs.y;this.ys&&(i=this.ys.rs.x+t.o/2,h=this.ys.rs.y-t.o-16);let e=0,n={x:i+t.o/4,y:h+2*t.o};if(this.ys?.hs){let t=this.ys.gs.Bt();const i=Math.PI;t<=.4?(t/=.4,e=t*i):e=t<=.8?i:0,s.translate(n.x,n.y),s.rotate(e),s.translate(-n.x,-n.y)}s.drawImage(t.m.images,32,16,8,32,i,h,t.o/2,2*t.o),this.ys?.hs&&(s.translate(n.x,n.y),s.rotate(-e),s.translate(-n.x,-n.y))}es(t){}},t.M.g=class extends t.M{constructor(){super(),this.qt={x:0,y:0,w:8*t.o,cs:8*t.o};const s=new t.Ss({x:400,y:400,item:new t.Ps}),i=new t.Fs({x:600,y:400,item:new t.Ps});i.ws.x=-1,this.jt(s,i),this.Zt.p1=s}ts(s){s.strokeStyle="#8f563b",s.lineWidth=t.o/16;let i=s.lineWidth/2;s.strokeRect(-i,-i,this.qt.w+2*i,this.qt.cs);for(let i=0;i<8;i++)for(let h=0;h<8;h++){let e=i*t.o,n=h*t.o;s.drawImage(t.m.images,0,0,16,16,e,n,t.o,t.o)}}};