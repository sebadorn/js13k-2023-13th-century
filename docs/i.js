let t,s,i;s=.3,t=(t=1,s=.05,h=220,e=0,n=0,r=.1,o=0,a=1,c=0,u=0,l=0,f=0,d=0,w=0,p=0,g=0,m=0,x=1,y=0,E=0,M=Math,k=44100,A=2*M.PI,T=(c*=500*A/k/k),_=(h*=(1-s+2*s*M.random(s=[]))*A/k),b=0,F=0,I=0,D=1,v=0,S=0,C=0,L,N)=>{for(u*=500*A/k**3,p*=A/k,l*=A/k,f*=k,d=k*d|0,N=(e=k*e+9)+(y*=k)+(n*=k)+(r*=k)+(m*=k)|0;I<N;s[I++]=C)++S%(100*g|0)||(C=o?1<o?2<o?3<o?M.sin((b%A)**3):M.max(M.min(M.tan(b),1),-1):1-(2*b/A%2+2)%2:1-4*M.abs(M.round(b/A)-b/A):M.sin(b),C=(d?1-E+E*M.sin(A*I/d):1)*(0<C?1:-1)*M.abs(C)**a*.3*t*(I<e?I/e:I<e+y?1-(I-e)/y*(1-x):I<e+y+n?x:I<N-m?(N-I-m)/r*x:0),C=m?C/2+(m>I?0:(I<N-m?1:(N-I)/m)*s[I-m|0]/2):C),b+=(L=(h+=c+=u)*M.cos(p*F++))-L*w*(1-1e9*(M.sin(I)+1)%2),D&&++D>f&&(h+=l,_+=l,D=0),!d||++v%d||(h=_,c=T,D||=1);return(t=i.createBuffer(1,N,k)).getChannelData(0).set(s),(h=i.createBufferSource()).buffer=t,h.connect(i.destination),h.start(),h},i=new AudioContext;const h={t:!0,i:"Arial, sans-serif",h:60,o:96,u:48,l:1,p:2,g(t,s){let i=Math.min(t.x+t.w,s.x+s.w)-Math.max(t.x,s.x);i=i<0?0:i;let h=Math.min(t.y+t.m,s.y+s.m)-Math.max(t.y,s.y);return h=h<0?0:h,i*h},init(){h.M.init(),h.k.init((()=>{h.k.level=new h.T.A,h.k._()}))},F(t,s){return this.g(t,s)>Number.EPSILON}};window.addEventListener("load",(()=>h.init())),h.I=class{constructor(t=0,s=0){this.x=t,this.y=s}clone(){return new h.I(this.x,this.y)}length(){return this.x+this.y===0?0:Math.sqrt(this.x*this.x+this.y*this.y)}mul(t){return this.x*=t,this.y*=t,this}normalize(){const t=this.length();return t&&(this.x/=t,this.y/=t),this}set(t,s){this.x=t,this.y=s}sub(t){return this.x-=t.x,this.y-=t.y,this}},h.Audio={D:[.3,0,8,.01,.01,.01,1,2.29,86,,,,,,-82,,,.42,.01],v:[.2,0,68,.02,.01,.18,2,1.89,-.3,,,,,1.4,,.3,,.59,.06,.12],S:[.15,0,382,.1,.01,.09,,2.2,-1.2,-3.8,,,,5,,,,.48,.05],SELECT:[.2,0,883,.01,.07,,1,1.74,,,366,.1,.06,,,,,.62,.01],play(s){t(...s)}},h.M={C:{L:1,N:2,K:3,D:4,P:5,S:6,H:10,R:11,G:12,B:13,O:14,U:15},W:{},X:{},Y:{click:[],Z:[],j:[]},V:{},q:{},J:{},$:{},tt:0,st(){this.it={[this.C.L]:{keyboard:["Escape"],gamepad:[9]},[this.C.R]:{keyboard:["ArrowUp","KeyW","KeyZ","KeyY"],gamepad:[12]},[this.C.H]:{keyboard:["ArrowLeft","KeyA","KeyQ"],gamepad:[14]},[this.C.B]:{keyboard:["ArrowDown","KeyS"],gamepad:[13]},[this.C.G]:{keyboard:["ArrowRight","KeyD"],gamepad:[15]},[this.C.D]:{keyboard:["Space","Enter"],gamepad:[0]},[this.C.S]:{keyboard:["ShiftLeft","ShiftRight"],gamepad:[]},[this.C.N]:{keyboard:["Space","Enter"],gamepad:[0]},[this.C.P]:{keyboard:["KeyE","CtrlLeft"],gamepad:[0]}}},ht(){let t=0,s=0;if(this.et(this.C.H)?t=-1:this.et(this.C.G)&&(t=1),this.et(this.C.R)?s=-1:this.et(this.C.B)&&(s=1),!t||!s){const i=.3;for(const h in this.J){const e=this.J[h];e.axes[0]&&Math.abs(e.axes[0])>i?t=e.axes[0]>0?1:-1:e.axes[2]&&Math.abs(e.axes[2])>i&&(t=e.axes[2]>0?1:-1),e.axes[1]&&Math.abs(e.axes[1])>i?s=e.axes[1]>0?1:-1:e.axes[3]&&Math.abs(e.axes[3])>i&&(s=e.axes[3]>0?1:-1)}}return{x:t,y:s}},nt(t){return this.it[t]},init(){this.st(),this.rt()},et(t,s){const i=this.nt(t);for(const t of i.keyboard)if(this.ot(t,s))return!0;for(const t of i.gamepad)if(this.ct(t,s))return!0;if(t===this.C.H)for(const t in this.J){const i=this.J[t];if(i.axes[6]&&i.axes[6]<=-.2)return!this.X["ut"]&&(s&&(this.X["ut"]=!0),!0)}else if(t===this.C.G)for(const t in this.J){const i=this.J[t];if(i.axes[6]&&i.axes[6]>=.2)return!this.X["lt"]&&(s&&(this.X["lt"]=!0),!0)}else if(t===this.C.R)for(const t in this.J){const i=this.J[t];if(i.axes[7]&&i.axes[7]<=-.2)return!this.X["ft"]&&(s&&(this.X["ft"]=!0),!0)}else if(t===this.C.B)for(const t in this.J){const i=this.J[t];if(i.axes[7]&&i.axes[7]>=.2)return!this.X["dt"]&&(s&&(this.X["dt"]=!0),!0)}return!1},ct(t,s){for(const i in this.J){const h=this.J[i].buttons[t];if(h&&h.pressed)return!this.X[t]&&(s&&(this.X[t]=!0),!0)}return!1},ot(t,s){const i=this.$[t];return!(!i||!i.time)&&(s&&(i.time=0,i.wt=!0),!0)},gt(t,s){if("function"!=typeof s)return void(this.Y[t]=[]);const i=this.Y[t].indexOf(s);i>=0&&this.Y[t].splice(i,1)},xt(t,s){this.Y[t].push(s)},yt(t,s){const i=this.V[t]||[];i.push(s),this.V[t]=i},Et(t,s){const i=this.q[t]||[];i.push(s),this.q[t]=i},rt(){document.body.onkeydown=t=>{const s=this.$[t.code];s&&s.wt||(this.$[t.code]={time:Date.now()},this.V[t.code]&&this.V[t.code].forEach((t=>t())))},document.body.onkeyup=t=>{this.$[t.code]={time:0},this.q[t.code]&&this.q[t.code].forEach((t=>t()))},window.addEventListener("gamepadconnected",(t=>{this.tt++,this.J[t.gamepad.index]=t.gamepad,this.Y.Z.forEach((t=>t()))})),window.addEventListener("gamepaddisconnected",(t=>{this.tt--,delete this.J[t.gamepad.index],this.Y.j.forEach((t=>t()))}))},update(){const t=navigator.getGamepads();for(const s of t)if(s){this.J[s.index]=s;for(const t in this.X)"axis6-"===t||"axis6+"===t?s.axes[6]||delete this.X[t]:"axis7-"===t||"axis7+"===t?s.axes[7]||delete this.X[t]:s.buttons[t]&&!s.buttons[t].pressed&&delete this.X[t]}}},h.k={Mt:new h.I,scale:1,kt:0,At:0,Tt(t,s,i,h=0){const[e,n]=this._t(32,32);n.drawImage(this.images,h,s,32,16,0,0,32,16),i&&i.bt(n);let r=n.getImageData(0,0,32,16);for(let s=0;s<r.data.length;s+=4){r.data[s]+r.data[s+1]+r.data[s+2]===765&&(r.data[s+0]=t[0],r.data[s+1]=t[1],r.data[s+2]=t[2])}n.putImageData(r,0,0),n.putImageData(r,0,16),r=n.getImageData(0,16,32,16);for(let t=0;t<r.data.length;t+=4){0!==r.data[t+3]&&(r.data[t+0]=255,r.data[t+1]=255,r.data[t+2]=255)}return n.putImageData(r,0,16),e},Ft(t){const s=t.It();if(this.kt=this.Mt.x-s.x,this.At=(this.Mt.y-s.y)*this.scale,t.level){const s=t.level.Dt;this.kt=Math.min(0,Math.max(-s.w+2*this.Mt.x,this.kt))}this.kt*=this.scale},vt(t){this.level=t},clear(){this.St.setTransform(1,0,0,1,0,0),this.St.clearRect(0,0,window.innerWidth,window.innerHeight),this.Ct.setTransform(1,0,0,1,0,0),this.Ct.clearRect(0,0,window.innerWidth,window.innerHeight)},createLinearGradient(t,s,i,h,e="#0003",n="#fff1"){const r=this.St.createLinearGradient(t,s,i,h);return r.addColorStop(0,e),r.addColorStop(1,n),r},Lt(){this.clear(),this.St.setTransform(this.scale,0,0,this.scale,this.kt,this.At),this.Ct.setTransform(this.scale,0,0,this.scale,0,0),this.level&&this.level.Lt()},Nt(){this.Ct.setTransform(1,0,0,1,0,0),this.Ct.clearRect(0,0,window.innerWidth,window.innerHeight),this.Ct.setTransform(this.scale,0,0,this.scale,0,0),this.Ct.fillStyle="rgba(0,0,0,0.4)",this.Ct.fillRect(0,0,this.Kt.width/this.scale,this.Kt.height/this.scale),this.Ct.fillStyle="#FFF",this.Ct.font="56px "+h.i,this.Ct.textAlign="center",this.Ct.textBaseline="top",this.Ct.fillText("GAME OVER",this.Mt.x,this.Mt.y-56)},Pt(t,s,i){let e=9*h.o,n=2*h.o,r=this.Mt.x-e/2,o=this.Mt.y-n/2;1===i?o=2*this.Mt.y-n-h.o:2===i&&(o=h.u),this.Ct.fillStyle="#0004",this.Ct.fillRect(r-12,o-12,e+24,n+24),this.Ct.fillStyle="#444",this.Ct.fillRect(r,o,e,n),this.Ct.drawImage(t.images,0,0,16,16,r,o+.25*h.o,1.75*h.o,1.75*h.o),this.Ct.lineWidth=12,this.Ct.strokeStyle="#847e87",this.Ct.strokeRect(r+6,o+6,2*h.o-12,2*h.o-12),this.Ct.fillStyle="#fff",this.Ct.font='600 31px "Courier New", monospace',this.Ct.textAlign="left",this.Ct.textBaseline="alphabetic";let a=r+28,c=o+48;s.forEach((t=>{this.Ct.fillText(t,a+2*h.o,c),c+=38}))},Ht(){this.Ct.setTransform(1,0,0,1,0,0),this.Ct.clearRect(0,0,window.innerWidth,window.innerHeight),this.Ct.setTransform(this.scale,0,0,this.scale,0,0),this.Ct.fillStyle="rgba(0,0,0,0.4)",this.Ct.fillRect(0,0,this.Kt.width/this.scale,this.Kt.height/this.scale),this.Ct.fillStyle="#FFF",this.Ct.font="56px "+h.i,this.Ct.textAlign="center",this.Ct.textBaseline="top",this.Ct.fillText("PAUSED",this.Mt.x,this.Mt.y-56)},Rt(){this.St.fillRect(-this.kt/this.scale-h.o,-this.At/this.scale-h.o,this.Gt.width/this.scale+2*h.o,this.Gt.height/this.scale+2*h.o)},_t(t,s){const i=document.createElement("canvas");i.width=t,i.height=s;const h=i.getContext("2d",{alpha:!0});return h.imageSmoothingEnabled=!1,[i,h]},init(t){this.Gt=document.getElementById("c"),this.St=this.Gt.getContext("2d",{alpha:!0}),this.St.imageSmoothingEnabled=!1,this.Kt=document.getElementById("ui"),this.Ct=this.Kt.getContext("2d",{alpha:!0}),this.Ct.imageSmoothingEnabled=!1,this.Bt((()=>{this.rt(),t()}))},Bt(t){const s=new Image;s.onload=()=>{this.images=s;const[i,e]=this._t(5,3);let n=new ImageData(5,3);n.data.set([255,255,255,196,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,196,0,0,0,0,255,255,255,196,255,255,255,255,255,255,255,196,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,196,0,0,0,0,0,0,0,0]),e.putImageData(n,0,0),this.Ot=i,this.Ut=this.Tt([255,255,0],16,h.zt),this.Wt=this.Tt([255,0,0],16,h.Xt),this.Yt=this.Tt([0,0,0],48),this.Zt=this.Tt([255,255,255],32),this.jt=this.Tt([0,0,0],48,null,32);const[r,o]=this._t(h.o,h.o);o.drawImage(this.images,16,0,16,16,0,0,h.o,h.o),this.Vt=o.createPattern(r,"repeat");const[a,c]=h.k._t(h.o,h.o),u=c.createRadialGradient(h.u,h.u,0,h.u,h.u,h.u);u.addColorStop(0,"#000a"),u.addColorStop(.9,"#0002"),u.addColorStop(1,"#0000"),c.fillStyle=u,c.fillRect(0,0,h.o,h.o),this.qt=a,t()},s.src="i.png"},_(t=0){if(h.M.update(),t&&this.Qt){const s=(t-this.Qt)/(1e3/h.h);if(this.St.imageSmoothingEnabled=!1,this.Ct.imageSmoothingEnabled=!1,this.St.lineWidth=1,this.St.textBaseline="alphabetic",this.Jt)return void this.Ht();this.level.update(s),this.Lt(),h.t&&(this.Ct.fillStyle="#000",this.Ct.fillRect(60,this.Gt.height/this.scale-74,140,28),this.Ct.fillStyle="#FFF",this.Ct.font="16px monospace",this.Ct.textAlign="right",this.Ct.textBaseline="bottom",this.Ct.fillText(~~(h.h/s)+" FPS, "+Math.round(1e3*this.scale)/1e3,192,this.Gt.height/this.scale-50))}this.Qt=t,requestAnimationFrame((t=>this._(t)))},pause(){this.Jt=!0},rt(){window.addEventListener("resize",(t=>this.resize())),this.resize();const t=h.M.nt(h.M.C.L);setInterval((()=>{this.Jt&&h.M.update(),t.gamepad.forEach((t=>{h.M.ct(t,!0)&&this.$t()}))}),100);const s=()=>this.$t();t.keyboard.forEach((t=>h.M.Et(t,s))),h.M.xt("gp_disconnect",(()=>this.pause()))},ts(){this.level=new this.level.constructor},resetTransform(){this.St.setTransform(this.scale,0,0,this.scale,this.kt,this.At)},resize(){const t=1920/1080;let s=window.innerHeight,i=Math.round(s*t);i>window.innerWidth&&(i=window.innerWidth,s=i/t),this.scale=s/1080,this.Mt.x=i/2/this.scale,this.Mt.y=s/2/this.scale;let h=~~((window.innerHeight-s)/2)+"px",e=~~((window.innerWidth-i)/2)+"px";this.Gt.width=i,this.Gt.height=s,this.Gt.style.top=h,this.Gt.style.left=e,this.Kt.width=i,this.Kt.height=s,this.Kt.style.top=h,this.Kt.style.left=e,this.Jt&&(clearTimeout(this.ss),this.ss=setTimeout((()=>this.Ht()),100))},hs(t,s,i){t.translate(i.x,i.y),t.rotate(s),t.translate(-i.x,-i.y)},es(t,s,i,h){t.translate(h.x,h.y),t.scale(s,i),t.translate(-h.x,-h.y)},$t(){this.Jt?this.unpause():this.pause()},unpause(){this.Jt&&(this.Jt=!1,this._())}},h.ns=class{constructor(t,s=0){this.level=t,this.set(s)}rs(){return this.level.os>this.timeEnd}cs(){return Math.min(1,1-(this.timeEnd-this.level.os)/this.duration)}set(t){this.duration=t*h.h,this.timeEnd=this.level.os+this.duration}},h.T=class{constructor(){this.Dt={},this.os=0,this.us=[],this.ls=[],this.items=[]}fs(t,s){if(h.k.Ft(t),t.ds||t.ws)t.update(s);else{h.M.et(h.M.C.S,!0)?t.ps():h.M.et(h.M.C.D,!0)&&t.attack();let i=h.M.ht();i=new h.I(i.x,i.y),t.update(s,i.normalize());const e=t.gs();this.items.forEach((s=>{s.xs=!1,s.ys&&h.F(s.gs(),e)&&(s.xs=!0,h.M.et(h.M.C.P,!0)&&t.Es(s))}))}}Ms(...t){this.ls.push(...t),this.ks(...t)}As(...t){this.items.push(...t),this.ks(...t)}ks(...t){t.forEach((t=>t.level=this)),this.us.push(...t)}removeItem(t){let s=this.items.indexOf(t);s>=0&&this.items.splice(s,1),s=this.us.indexOf(t),s>=0&&this.us.splice(s,1)}Lt(){this.Ts&&this.Ts(h.k.St),this.us.forEach((t=>t.Lt(h.k.St))),this._s&&this._s(h.k.St),this.bs&&h.k.Nt()}Fs(t,s){const i=h.k;if(!this.Is){const[t,s]=i._t(2*i.Mt.x+2*h.o,2*i.Mt.y+2*h.o);s.fillStyle=i.Vt,s.fillRect(0,0,t.width,t.height),this.Is=t}let e=Math.ceil(-i.kt/i.scale/h.o)*h.o,n=Math.ceil(-i.At/i.scale/h.o)*h.o;t.drawImage(this.Is,e-h.o-s,n-h.o)}update(t){if(this.os+=t,this.bs)h.M.et(h.M.C.N,!0)&&h.k.ts();else if(!this.locked){const s=this.Ds;if(s){if(s.vs<=0)return void(this.bs=!0);this.fs(s,t)}this.us.sort(((t,s)=>t.Ss()-s.Ss())),this.us.forEach((i=>{i!==s&&(i.update(t),s?.ws&&i.vs>0&&i.Cs()&&s.item.Ls(i)&&i.Ns(s.item),i.action||h.Ps.Ks(i,s))}))}}},h.Hs=class{constructor(t={}){this.Rs=new h.I(t.x,t.y),this.w=t.w||0,this.m=t.m||0,this.Gs=0,this.Bs={},this.Os=[],this.Us=new h.I(t.zs||1,0),this.Ws=1/0,this.vs=1/0,this.speed=new h.I(4,4),this.state=h.l,this.weight=0}Xs(t){for(let s=this.Os.length-1;s>=0;s--){(0,this.Os[s])(t)&&this.Os.splice(s,1)}}Cs(){return(!this.Ys||this.Ys.rs())&&!this.ds}Lt(t){}Zs(t,s){if(!this.level)return;this.Rs.x=Math.min(this.level.Dt.w-this.w,Math.max(0,this.Rs.x)),this.Rs.y=Math.min(this.level.Dt.m-this.m-8,Math.max(-h.u,this.Rs.y));const i=this.Rs.clone().sub(t);i.x=i.x<0?-i.x:i.x,i.y=i.y<0?-i.y:i.y;const e=this.gs();this.level.us.forEach((n=>{if(n===this||!n.js||n.vs<=0)return;if(n instanceof h.Vs&&this.ds)return;const r=n.gs(),o=h.g(e,r);o>Number.EPSILON&&(s&&o>=8?this.Rs.set(i.x>0?r.x+r.w:r.x-e.w,t.y):this.Rs.set(t.x,t.y))}))}gs(){return{x:this.Rs.x,y:this.Rs.y,w:this.w,m:this.m}}It(){return{x:this.Rs.x+this.w/2,y:this.Rs.y+this.m/2}}qs(t,s,i){if(this.Bs.Qs&&this!==this.level?.Ds)return i;const e=this.Rs.clone();return this.Rs.x+=Math.round(s*t.x*this.speed.x),this.Rs.y+=Math.round(s*t.y*this.speed.y),(t.x||t.y)&&(i=h.p,this.Us.set(0==t.x?this.Us.x:t.x>0?1:-1,0==t.y?this.Us.y:t.y>0?1:-1)),this.Zs(e),i}Ss(){return this.Rs.y+this.m}Js(){if(!this.Ys||this.Ys.rs())return!1;const t=this.Ys.cs();return t>=0&&t<=.2||t>=.4&&t<=.6||t>=.8&&t<=1}Ns(t){if(!this.Cs())return;this===this.level.Ds&&h.Audio.play(h.Audio.v),this.Ys=this.Ys||new h.ns(this.level),this.Ys.set(.5),this.vs=Math.max(0,this.vs-t.$s);const s=t.ti(this);s&&this.Os.push(s),this.vs<=0&&this.si&&this.si()}update(t,s){if(this.vs<=0||this.ii)return;let i=h.l;this.Gs+=t,this.Xs(t),s&&(i=this.qs(s,t,i)),this.state!=i&&(this.Gs=0),this.state=i}},h.hi=class extends h.Hs{constructor(t={}){t.w=h.o,t.m=h.o,super(t),this.images=h.k.jt,this.vs=this.Ws=50,this.js=!0,this.weight=h.o}Lt(t){if(this.vs<=0)return;let s=this.Js()?16:0;t.drawImage(this.images,0,s,16,16,this.Rs.x,this.Rs.y,this.w,this.m)}update(t){super.update(t),this.js=this.vs>0}},h.Vs=class extends h.Hs{constructor(t={}){t.w=h.o,t.m=h.o,super(t),this.ei=42/h.h,this.images=h.k.Ut,this.Ws=this.vs=100,this.js=!0,this.item=t.item,this.speed.set(12,12),this.item&&(this.item.ii=this)}ni(t,s){h.k.es(t,s,1,this.It())}ri(t){h.k.hs(t,.1*Math.sin(this.Gs*this.ei),this.It())}oi(t){if(this.vs==this.Ws||this.ds)return;let s=this.vs/this.Ws,i=this.Rs.x+16,h=this.Rs.y-24,e=this.w-32;t.fillStyle="#000",t.fillRect(i,h,e,8),t.fillStyle="#f00",t.fillRect(i,h,e*s,8)}ai(t){const s=this.Us.x<0;s&&this.ni(t,-1),this.item?.Lt(t),s&&this.ni(t,-1)}ci(t){t.drawImage(h.k.qt,this.Rs.x,this.Rs.y+this.m-12,this.w,24)}attack(){return!(this.ws||this.ds||!this.item||this.Bs?.Qs)&&(h.Audio.play(h.Audio.D),this.ui=this.ui||new h.ns(this.level),this.ui.set(this.item.li),this.ws=!0,!0)}ps(){return!this.ds&&!this.Bs?.Qs&&(h.Audio.play(h.Audio.S),this.fi=this.fi||new h.ns(this.level),this.fi.set(.5),this.di=this.Rs.clone(),this.ds=!0,!0)}Lt(t){if(this.vs<=0)return;let s=this.Us.x<0?16:0,i=0,e=this.images;if(this.ci(t),this.ds){let s=360*this.fi.cs()*3*Math.PI/180;this.Us.x<0&&(s=-s),h.k.hs(t,s,this.It())}else this.Js()&&(i=16),this.state===h.p&&this.ri(t);this.item&&this.ai(t,e),this.oi(t),t.drawImage(e,s,i,16,16,this.Rs.x,this.Rs.y,h.o,h.o),h.k.resetTransform()}static bt(t){t.fillStyle="#000";let s=11;t.fillRect(s,6,1,4),t.fillRect(s-2,6,1,4),t.fillRect(s-4,6,1,4),s=21,t.fillRect(s,6,1,4),t.fillRect(s+2,6,1,4),t.fillRect(s+4,6,1,4)}si(){this.item?.wi(),this.vs>0?(this.item=new h.pi,this.item.ii=this):this.item=null}gs(){const t={x:this.Rs.x,y:this.Rs.y+this.m,w:this.w,m:h.u/2};return t.y-=t.m,t}Es(t){t.ii||(this.item?.wi(),this.item=t,t.xs=!1,t.ii=this,this.level.removeItem(t))}update(t,s){if(this.vs<=0)return;let i=h.l;this.Gs+=t,this.Xs(t),this.ds?this.fi.rs()?(this.ds=!1,this.Zs(this.di,!0)):(s=new h.I(this.Us.x<0?-1:1,0),this.qs(s,t,i)):s&&(i=this.qs(s,t,i)),this.action&&(i=this.action(t)||i),this.state!=i&&(this.Gs=0),this.ws&&this.ui.rs()&&(this.ws=!1),this.state=i}},h.Ps={gi(t,s){if(t.ws||!t.item||!t.item.Ls(s))return!1;if(t.mi&&!t.mi.rs())return!0;const i=new h.ns(t.level,.3);return t.action=function(){i.rs()&&(t.ws&&t.ui&&t.ui.rs()?t.action=null:t.ws||(t.attack(),s.Ns(t.item),t.mi=t.mi||new h.ns(t.level),t.mi.set(.8)))},!0},xi(t){if(t.item&&!(t.item instanceof h.pi))return!1;let s=1/0,i=null,e=null;const n=t.It(),r=t.gs(),o=new h.I;for(let a=0;a<t.level.items.length;a++){const c=t.level.items[a];if(c instanceof h.yi){const a=c.gs();if(h.F(a,r)){const s=new h.ns(t.level,.5);return t.action=function(){s.rs()&&(t.Es(c),t.action=null)},!0}o.set(a.x+a.w/2-n.x,a.y+a.m/2-n.y);const u=o.length();u<3*h.o&&s>u&&(s=u,i=o.clone(),e=c)}}if(!e)return!1;const a=new h.ns(t.level,1);return i.normalize(),t.action=function(s){if(a.rs())t.action=null;else if(!t.Bs.Qs)return t.qs(i,s,0)},!0},Ei(t,s){const i=t.It(),e=s.It(),n=new h.I(e.x-i.x,e.y-i.y);if(n.length()>7*h.o)return!1;const r=new h.ns(t.level,1);return n.normalize(),t.action=function(s){if(r.rs())t.action=null;else if(!t.Bs.Qs)return t.qs(n,s,0)},!0},Ks(t,s){!s||t instanceof h.Mi||!(t instanceof h.Vs)||t.Bs.Qs||s.vs<=0||this.xi(t)||this.gi(t,s)||this.Ei(t,s)}},h.yi=class extends h.Hs{constructor(t){super(t)}ki(){const t=h.k,s=this.gs(),i=t.kt/t.scale,e=t.At/t.scale,n=Math.sin(t.level.os/25);let r=s.x+s.w/2+i-15,o=s.y-1.5*h.u+e;t.Ct.drawImage(t.Ot,r,o+8*n,30,18),t.Ct.fillStyle="#fff";let a=2*n;r=s.x-6+i-a,o=s.y+s.m+e+a,t.Ct.fillRect(r,o,6,12),t.Ct.fillRect(r,o+6,12,6),r=s.x+s.w+i+a,o=s.y-6+e-a,t.Ct.fillRect(r-6,o,12,6),t.Ct.fillRect(r,o,6,12)}Ai(){this.ii&&this.Rs.set(this.ii.Rs.x+this.ii.w/2,this.ii.Rs.y-this.ii.m)}wi(){this.ys&&(this.Ai(),this.ii?.level.As(this)),this.ii=null}ti(){return null}Ss(){return this.Rs.y}},h.Xt=class extends h.Vs{constructor(t={}){t.item=t.item||new h.pi,super(t),this.images=h.k.Wt,this.ei=32/h.h,this.speed.set(3,3)}static bt(t){t.fillStyle="#000";let s=6;t.fillRect(s,7,6,1),t.fillRect(s+2,7,3,2),s=20,t.fillRect(s,7,6,1),t.fillRect(s+1,7,3,2)}Ns(t){this.vs<=0||super.Ns(t)}},h.Ti=class extends h.Xt{constructor(t={}){super(t),this.images=h.k.Zt,this.speed.set(4,4)}},h.Mi=class extends h.Xt{constructor(t){super(t),this.images=h.k.Yt,this.Ws=this.vs=300}si(){this.item?.wi(),this.item=null}Ns(t){this.vs<=0||super.Ns(t)}},h.zt=class extends h.Vs{constructor(t={}){t.item=t.item||new h.pi,super(t),this.vs=this.Ws=1/0,this._i={}}attack(){return!(this._i.attack&&!this._i.attack.rs())&&(!!super.attack()&&(this._i.attack=this._i.attack||new h.ns(this.level),this._i.attack.set(.65),!0))}ps(){return!(this._i.ps&&!this._i.ps.rs())&&(!!super.ps()&&(this._i.ps=this._i.ps||new h.ns(this.level),this._i.ps.set(.8),!0))}},h.pi=class extends h.yi{constructor(t={}){super(t),this.li=.2,this.$s=10}Ls(t){if(!this.ii)return!1;const s={x:this.ii.Rs.x+this.ii.w,y:this.ii.Rs.y+h.u/2,w:h.u,m:h.u};this.ii.Us.x<0&&(s.x-=this.ii.w+s.w);const i={x:t.Rs.x,y:t.Rs.y,w:t.w,m:t.m};return h.F(i,s)}Lt(t){if(!this.ii?.ws)return;let s=this.ii.Rs.x+this.ii.w-32,i=this.ii.Rs.y+this.ii.m/2-16,e=this.ii.ui.cs();s+=e*e*h.u*1.5,t.globalAlpha=Math.min(1,e+.5),t.drawImage(h.k.images,40,16,8,8,s,i,h.u,h.u),t.globalAlpha=1}ti(t){if(!(t instanceof h.Vs))return;const s=new h.ns(this.ii.level,.4);return t.Bs.Qs=!0,t.si(),function(){return!!s.rs()&&(t.Bs.Qs=!1,!0)}}},h.bi=class extends h.yi{constructor(t={}){t.w=h.u,t.m=2*h.o,super(t),this.li=.25,this.ys=!0,this.$s=34}Ai(){this.ii&&this.Rs.set(this.ii.Rs.x+this.ii.w/2,this.ii.Rs.y-this.ii.m+this.m/2)}Ls(t){if(!this.ii)return!1;const s=[{x:this.ii.Rs.x+this.ii.w,y:this.ii.Rs.y,w:1.7*h.o,m:h.o},{x:this.ii.Rs.x+this.ii.w,y:this.ii.Rs.y-.7*h.o,w:h.o,m:2.4*h.o}];this.ii.Us.x<0&&(s[0].x-=this.ii.w+s[0].w,s[1].x-=this.ii.w+s[1].w);const i={x:t.Rs.x,y:t.Rs.y,w:t.w,m:t.m};for(let t=0;t<s.length;t++)if(h.F(i,s[t]))return!0;return!1}Lt(t){let s=this.Rs.x,i=this.Rs.y;this.ii&&(s=this.ii.Rs.x+h.u,i=this.ii.Rs.y-h.o-16);let e=0,n={x:s+this.w/2,y:i+this.m/2};if(this.ii){if(this.ii?.ws){n.x=s+h.o/4,n.y=i+2*h.o;let t=this.ii.ui.cs();const r=Math.PI;t<=.4?(t/=.4,e=t*r):e=t<=.8?r:0}}else e=80*Math.PI/180;e&&h.k.hs(t,e,n),t.drawImage(h.k.images,32,16,8,32,s,i,h.u,2*h.o),e&&this.ii?.ws&&h.k.hs(t,-e,n),this.ii||(h.k.resetTransform(),this.xs&&this.ki(t))}ti(t){if(!t.js)return;const s=t.Rs.clone(),i=this.ii.It(),e=t.It(),n=new h.I(e.x-i.x,e.y-i.y);n.normalize();const r=new h.ns(this.ii.level,.5),o=1.5*h.o-t.weight;return t.Bs.Qs=!0,function(){if(r.rs())return t.Bs.Qs=!1,!0;const i=r.cs(),h=t.Rs.clone();return t.Rs.set(s.x+n.x*o*i,s.y+n.y*o*i),t.Zs(h),!1}}gs(){return{x:this.Rs.x-1.5*this.w,y:this.Rs.y+1.5*this.w,w:this.m,m:this.w}}},h.T.Fi=class extends h.T{constructor(){super(),this.Ii=0,this.Di=2}vi(t,s,i,e,n){if(n){let s=h.u/2,n=h.o,r=i-96,o=e-n/2,a={x:r+s/2,y:o+n/2};h.k.hs(t,Math.PI/2,a),h.k.es(t,Math.sin(.08*this.os),1,a),t.drawImage(h.k.images,32,16,8,32,r,o,s,n),h.k.resetTransform()}t.fillStyle=n?"#fa0":"#777",t.textBaseline="middle",t.fillText(s,i,e)}Lt(){const t=h.k.St;let s=Math.max(2*h.o,h.k.Mt.x-500),i=Math.max(2*h.o,h.k.Mt.y-128);t.fillStyle="#0d161e",h.k.Rt(),t.font="600 64px "+h.i,t.textAlign="left",t.fillStyle="#fa0",t.fillText("TREASURE OF THE NIBELUNGS",s,i+3),t.fillStyle="#777",t.fillText("TREASURE OF THE NIBELUNGS",s,i),t.font="42px "+h.i,s+=h.u/2+114,i+=96,this.vi(t,"New Game",s,i,0===this.Ii),i+=72,this.vi(t,"Continue",s,i,1===this.Ii)}update(t){this.os+=t,h.M.et(h.M.C.R,!0)?this.Ii--:h.M.et(h.M.C.B,!0)?this.Ii++:h.M.et(h.M.C.N,!0)&&(h.Audio.play(h.Audio.SELECT),0===this.Ii&&(h.k.level=new h.T.Si)),this.Ii<0?this.Ii=this.Di-1:this.Ii>=this.Di&&(this.Ii=0)}},h.T.Ci=class extends h.T{constructor(){super(),this.Dt={w:2*h.k.Mt.x,m:8*h.o};const t=new h.zt({x:6*h.o,y:3*h.o,item:new h.pi}),s=new h.Mi({x:13*h.o,y:3*h.o,item:new h.bi});this.Ms(t,s),this.Ds=t,this.Li=s,this.locked=!0,this.Ni=-1,this.Ki=new h.ns(this,6)}Lt(){super.Lt();const t=h.k.St;t.font='600 23px "Courier New", monospace',t.fillStyle="#fffc",t.textAlign="center";const s=this.Ds,i=s.It(),e=this.Li.It();if(0===this.Ni)t.fillText("Move with [W][A][S][D] or arrow keys",i.x,i.y-s.m);else if(1===this.Ni)t.fillText("Attack with [ENTER] or [SPACE]",e.x,e.y-2*this.Li.m);else if(2===this.Ni){const s=this.items[0];if(s){const i=s.gs();t.fillText("Pick up with [E]",i.x+i.w/2,i.y-i.m-h.u-8)}}else 3===this.Ni?t.fillText("Attack with the sword",e.x,e.y-this.Li.m):4===this.Ni&&t.fillText("You can dodge roll with [SHIFT]",i.x,i.y-s.m-h.o)}Ts(t){const s=this.Ds,i=this.Li,e=this.items[0];if(t.fillStyle="#222",t.fillRect(s.Rs.x-h.u,s.Rs.y+s.m-h.u,2*h.o,h.o),i.vs>0&&t.fillRect(i.Rs.x-h.u,i.Rs.y+i.m-h.u,2*h.o,h.o),e){const s=e.gs();t.fillRect(s.x-h.u,s.y+s.m-1.5*h.u,3*h.o,1.25*h.o)}}_s(t){const s=h.k;if(this.Ni<0&&s.Pt(this.Ds,["Before heading out, let’s","think back on my training.","How did it go again?"],2),5!==this.Ni)return;s.Pt(this.Ds,["Right, that’s how it goes!","Now I am prepared!"],2);const i=Math.sin(this.os/25);let e=this.Dt.w-h.o+8*i,n=this.Dt.m/2+9;const r={x:e,y:n};t.fillStyle="#fff",t.textAlign="right",t.fillText("Continue",e-22,n-8);let o=-Math.PI/2;s.hs(t,o,r),t.drawImage(s.Ot,e,n,30,18),s.hs(t,-o,r)}update(t){const s=this.Ds,i=h.M;if(-1===this.Ni)h.k.Ft(s),i.et(i.C.N,!0)&&this.Ki.set(0),this.Ki.rs()&&(this.locked=!1,this.Ni=0);else if(0===this.Ni)i.et(i.C.D,!0),this.Pi?this.Pi.rs()&&(this.Ni=1):(i.et(i.C.R)||i.et(i.C.G)||i.et(i.C.B)||i.et(i.C.H))&&(this.Pi=new h.ns(this,3));else if(1===this.Ni){if(!(this.Li.item instanceof h.bi)){const t=this.items[0];t.Rs.x=this.Li.Rs.x+2*h.o,t.Rs.y+=h.u,this.Ni=2}}else if(2===this.Ni)s.item instanceof h.bi&&(this.Ni=3);else if(3===this.Ni)this.Li.vs<this.Li.Ws-s.item.$s&&(this.Ni=4);else if(4===this.Ni)i.et(i.C.S)&&(this.Ni=5);else if(5===this.Ni){if(s.It().x>=this.Dt.w-h.u)return void h.k.vt(new h.T.Hi)}super.update(t)}},h.T.Si=class extends h.T{constructor(){super(),this.Ri=["Ez enwas niht anders","wan gestéinẹ unde golt.","unt ob man al die werlde","het dâ von versolt,","sîn wǽré niht mínner","einer marke wert."],this.Gi=["Ê daz der künee rîche","wider wære komen,","die wîle hete Hagene","den schaz vil gar genomen.","","er sanctẹ in dâ ze Lôche","allen in den Rîn.","er wandẹ er soldẹ in niezen:","des enkunde niht gesîn."],this.Bi=["The legendary treasure of the Nibelungs:","Gems and gold more than one could ever hope to spent.","","While the king and his men where away, Hagen stole it","all and sunk the treasure in the Rhine at Lochheim.","But he was killed before being able to retrieve the riches.","","Betting on its the existance,","many set off to look for the treasure."],this.Oi=0,this.Ui=new h.ns(this,2);this.Ri.concat(this.Gi).forEach((t=>{const s=h.k.St.measureText(t);this.Oi=Math.max(this.Oi,s.width)}))}Lt(){const t=h.k.St;t.fillStyle="#0d161e",h.k.Rt();let s=2*h.o,i=s,e=this.Oi+h.o,n=49*(this.Ri.length+this.Gi.length)+1.5*h.o+16;if(t.fillStyle="#e5c382",t.fillRect(s-h.u,i-h.o,e,n),t.font='italic 40px "Times New Roman", serif',t.textAlign="center",t.fillStyle="#000",s+=this.Oi/2,!this.Ui.rs()){const s=this.Ui.cs();i+=(1-s)*h.u,t.fillStyle="#000000"+Math.round(255*s).toString(16).padStart(2,"0")}if(this.Ri.forEach((h=>{t.fillText(h,s,i),i+=49})),this.Ui.rs()){if(i+=49,!this.zi.rs()){const s=this.zi.cs();i+=(1-s)*h.u,t.fillStyle="#000000"+Math.round(255*s).toString(16).padStart(2,"0")}this.Gi.forEach((h=>{t.fillText(h,s,i),i+=49}))}if(this.zi?.rs()){const n=this.Wi.cs();if(s=e+2.5*h.o,i=2*h.o+(1-n)*h.u,t.font="32px "+h.i,t.textAlign="left",t.fillStyle="#ffffff"+Math.round(255*n).toString(16).padStart(2,"0"),this.Bi.forEach((h=>{t.fillText(h,s,i),i+=49})),this.Wi.rs()){i+=49;let e=h.u/2,n=h.o,r=s+n/2,o=i-n/2,a={x:r+e/2,y:o+n/2};h.k.hs(t,Math.PI/2,a),h.k.es(t,Math.sin(.08*this.os),1,a),t.drawImage(h.k.images,32,16,8,32,r,o,e,n),h.k.resetTransform(),t.font="32px "+h.i,t.fillStyle="#fa0",t.textBaseline="middle",t.fillText("Continue",s+n+32,i)}}}update(t){this.os+=t,this.Ui.rs()&&!this.zi?this.zi=new h.ns(this,2):this.zi&&this.zi.rs()&&!this.Wi&&(this.Wi=new h.ns(this,2)),h.M.et(h.M.C.N,!0)&&(this.Ui.rs()?this.zi&&!this.zi.rs()?this.zi.set(0):this.Wi&&!this.Wi.rs()?this.Wi.set(0):(h.Audio.play(h.Audio.SELECT),h.k.level=new h.T.A):this.Ui.set(0))}},h.T.Hi=class extends h.T{constructor(){super(),this.Xi=36,this.Yi=2,this.Dt={w:h.o*this.Xi,m:h.o*this.Yi};const t=new h.zt({x:h.o});this.Ms(t,new h.Ti({x:11*h.o,y:h.o-8,zs:-1,item:new h.bi}),new h.Ti({x:20*h.o,y:h.o-8,zs:-1}),new h.Ti({x:31*h.o,zs:-1,item:new h.bi}),new h.Ti({x:31*h.o,y:h.o-8,zs:-1})),this.As(new h.hi({x:11*h.o}),new h.hi({x:22*h.o,y:h.o+8}),new h.hi({x:32*h.o}),new h.hi({x:32*h.o,y:h.o+8}),new h.hi({x:33*h.o,y:h.o/2})),this.Ds=t,this.Ki=new h.ns(this,14)}Zi(t,s,i,h,e){const n=t.fillStyle;t.fillRect(s,i,h,e),t.fillStyle="#0001",t.fillRect(s,i,12,e),t.fillStyle="#fff1",t.fillRect(s+h-12,i,12,e),t.fillStyle=n}Ts(t){const s=h.k,i=12*Math.sin(this.os/50);if(this.Fs(t,i),this.ji)t.drawImage(this.ji,0,-h.u/2);else{const[t,i]=s._t(this.Dt.w,this.Dt.m+4*h.o),e=h.u;i.fillStyle="#0003",i.fillRect(0,e+1.25*h.o,this.Dt.w,this.Dt.m),i.fillStyle="#544";for(let t=0;t<this.Xi;t+=4)this.Zi(i,t*h.o,4,h.u,2*h.o);for(let t=0;t<this.Xi;t++)for(let n=0;n<this.Yi;n++){let r=t*h.o,o=n*h.o+e;i.drawImage(s.images,0,0,16,16,r,o,h.o,h.o)}i.fillStyle=s.createLinearGradient(0,e,0,this.Dt.m,"#0001"),i.fillRect(0,e,this.Dt.w,this.Dt.m),i.fillStyle="#544",i.fillRect(0,this.Dt.m-6+e,this.Dt.w,24),this.ji=t}}_s(t){this.Ki.rs()||h.k.Pt(this.Ds,["My crew is already waiting. I","just have to make it to the ship.","But it seems there are pirates","in the harbor."],2),t.fillStyle="#544";let s=this.Yi*h.o-h.u/2,i=2*h.o;for(let e=0;e<this.Xi;e+=4)this.Zi(t,e*h.o,s,h.u,i)}update(t){super.update(t);this.Ds.It().x>=this.Dt.w-h.u&&h.k.vt(new h.T.A)}},h.T.A=class extends h.T{constructor(){super(),this.Xi=24,this.Yi=6,this.Dt={w:h.o*this.Xi,m:h.o*this.Yi};const t=new h.zt({x:2*h.o,y:2*h.o,item:new h.pi}),s=new h.Xt({x:12*h.o,y:2*h.o,item:new h.bi});s.Us.x=-1,this.Ms(t,s);const i=new h.bi({x:4*h.o,y:4.5*h.o});this.As(i),this.Ds=t}Ts(t){const s=h.k;if(this.Fs(t,this.Vi),this.qi&&t.drawImage(this.qi,-6,-h.o),this.Qi)t.drawImage(this.Qi,0,0);else{const t=6,[i,e]=h.k._t(this.Dt.w+1.5*t,this.Dt.m+.5*t+h.o);e.lineWidth=t;let n=t/2;e.strokeStyle="#8f563b",e.strokeRect(0,n,this.Dt.w+e.lineWidth+n,this.Dt.m+n);for(let i=0;i<this.Xi;i++)for(let n=0;n<this.Yi;n++){let r=i*h.o,o=t+n*h.o;e.drawImage(s.images,0,0,16,16,r,o,h.o,h.o)}e.fillStyle="#5a3c2e",e.fillRect(n-e.lineWidth,this.Dt.m,this.Dt.w+2*e.lineWidth,h.o),e.fillStyle=h.k.createLinearGradient(0,this.Dt.m,0,this.Dt.m+h.o,"#0003","#4b73ac30"),e.fillRect(n-e.lineWidth,this.Dt.m,this.Dt.w+2*e.lineWidth,h.o),e.fillStyle=h.k.createLinearGradient(0,0,0,this.Dt.m),e.fillRect(0,0,this.Dt.w+n,this.Dt.m),this.Qi=i}}_s(t){if(this.Ji)t.drawImage(this.Ji,-this.Vi,this.Dt.m+.5,h.o*(this.Xi+1),h.o);else{const[t,s]=h.k._t(h.o*(this.Xi+1),h.o);for(let t=0;t<=this.Xi;t++)s.drawImage(h.k.images,32,0,16,16,t*h.o,0,h.o,h.o);this.Ji=t}if(this.qi)t.drawImage(this.qi,-6,this.Dt.m-h.o);else{const t=12+this.Dt.w,s=h.o,[i,e]=h.k._t(t,s);e.lineWidth=6,e.fillStyle="#5a3c2e",e.fillRect(0,0,this.Dt.w+2*e.lineWidth,18),e.fillStyle="#0002",e.fillRect(0,12,this.Dt.w+2*e.lineWidth,6),e.fillStyle="#fff1",e.fillRect(0,0,this.Dt.w+2*e.lineWidth,6);const n=this.Dt.w/h.o+1;for(let t=0;t<=n;t++){let s=t*h.o,i=18,n=h.o+1;e.fillStyle="#5a3c2e",e.fillRect(s,i,18,n),e.fillStyle="#0002",e.fillRect(s,i,6,n),e.fillStyle="#fff1",e.fillRect(s+12,i,6,n)}this.qi=i}}update(t){super.update(t),this.Vi=this.os%25/25*h.o}},h.T.$i=class extends h.T{constructor(){super()}};