const t={t:!0,i:'"Courier New", monospace',h:60,init(){t.o.init(),t.Audio.init(),t.u.init((()=>{t.u.level=new t.p.l,t.u.m()}))}};window.addEventListener("load",(()=>t.init())),t.g=class{constructor(t=0,s=0){this.x=t,this.y=s}clone(){return new t.g(this.x,this.y)}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const t=this.length();this.x/=t,this.y/=t}},t.Audio={A:{},M:.2,D:{K:(t,s,i)=>(s[t]=2*Math.random()-1,i[t]=2*Math.random()-1,!1)},init(){this.F=new window.AudioContext,this.gain=this.F.createGain(),this.gain.connect(this.F.destination),this.volume(.1);for(const t in this.D){const s=2*this.F.sampleRate,i=this.F.createBuffer(2,s,this.F.sampleRate),h=i.getChannelData(0),e=i.getChannelData(1);for(let i=0;i<s&&!this.D[t](i,h,e);i++);this.A[t]=i}},_(){0!==this.gain.gain.value&&(this.M=this.gain.gain.value,this.gain.gain.value=0)},play(t,s,i=1,h="dec"){const e=this.F.createGain();e.connect(this.gain),"inc"===h?(e.gain.setValueAtTime(0,this.F.currentTime),e.gain.linearRampToValueAtTime(i,this.F.currentTime+s-.01)):(e.gain.setValueAtTime(i,this.F.currentTime),e.gain.linearRampToValueAtTime(0,this.F.currentTime+s-.01));const n=this.A[t.name],o=this.F.createBufferSource();return o.buffer=n,o.connect(e),o.start(0,0,s),o},k(t,s,i="sine",h="dec"){const e=this.F.createGain();e.connect(this.gain),"inc"===h?(e.gain.setValueAtTime(0,this.F.currentTime),e.gain.linearRampToValueAtTime(1,this.F.currentTime+s-.01)):(e.gain.setValueAtTime(1,this.F.currentTime),e.gain.linearRampToValueAtTime(0,this.F.currentTime+s-.01));const n=this.F.createOscillator();return n.type=i,n.frequency.setValueAtTime(t,this.F.currentTime),n.connect(e),n.start(),n.stop(this.F.currentTime+s),n},P(){this.gain.gain.value=this.M},volume(t){this.gain.gain.value=Math.min(1,Math.max(0,t))}},t.o={v:{T:1,S:2,O:3,U:10,C:11,N:12,G:13,L:14,R:15},I:{},B:{},V:{click:[],q:[],H:[]},W:{},X:{},Y:{},Z:{},j:new t.g,J:0,$(){this.tt={[this.v.T]:{keyboard:["Escape"],gamepad:[9]},[this.v.C]:{keyboard:["ArrowUp","KeyW","KeyZ","KeyY"],gamepad:[12]},[this.v.U]:{keyboard:["ArrowLeft","KeyA","KeyQ"],gamepad:[14]},[this.v.G]:{keyboard:["ArrowDown","KeyS"],gamepad:[13]},[this.v.N]:{keyboard:["ArrowRight","KeyD"],gamepad:[15]},[this.v.S]:{keyboard:["Space","Enter"],gamepad:[0]}}},st(){let t=0,s=0;if(this.it(this.v.U)?t=-1:this.it(this.v.N)&&(t=1),this.it(this.v.C)?s=-1:this.it(this.v.G)&&(s=1),!t||!s){const i=.3;for(const h in this.Y){const e=this.Y[h];e.axes[0]&&Math.abs(e.axes[0])>i?t=e.axes[0]>0?1:-1:e.axes[2]&&Math.abs(e.axes[2])>i&&(t=e.axes[2]>0?1:-1),e.axes[1]&&Math.abs(e.axes[1])>i?s=e.axes[1]>0?1:-1:e.axes[3]&&Math.abs(e.axes[3])>i&&(s=e.axes[3]>0?1:-1)}}return{x:t,y:s}},ht(t){return this.tt[t]},init(){this.$(),this.et()},it(t,s){const i=this.ht(t);for(const t of i.keyboard)if(this.nt(t,s))return!0;for(const t of i.gamepad)if(this.ot(t,s))return!0;if(t===this.v.U)for(const t in this.Y){const i=this.Y[t];if(i.axes[6]&&i.axes[6]<=-.2)return!this.B["rt"]&&(s&&(this.B["rt"]=!0),!0)}else if(t===this.v.N)for(const t in this.Y){const i=this.Y[t];if(i.axes[6]&&i.axes[6]>=.2)return!this.B["ct"]&&(s&&(this.B["ct"]=!0),!0)}else if(t===this.v.C)for(const t in this.Y){const i=this.Y[t];if(i.axes[7]&&i.axes[7]<=-.2)return!this.B["dt"]&&(s&&(this.B["dt"]=!0),!0)}else if(t===this.v.G)for(const t in this.Y){const i=this.Y[t];if(i.axes[7]&&i.axes[7]>=.2)return!this.B["ut"]&&(s&&(this.B["ut"]=!0),!0)}return!1},ot(t,s){for(const i in this.Y){const h=this.Y[i].buttons[t];if(h&&h.pressed)return!this.B[t]&&(s&&(this.B[t]=!0),!0)}return!1},nt(t,s){const i=this.Z[t];return!(!i||!i.time)&&(s&&(i.time=0,i.wt=!0),!0)},lt(t,s){if("function"!=typeof s)return void(this.V[t]=[]);const i=this.V[t].indexOf(s);i>=0&&this.V[t].splice(i,1)},ft(t,s){this.V[t].push(s)},gt(t,s){const i=this.W[t]||[];i.push(s),this.W[t]=i},yt(t,s){const i=this.X[t]||[];i.push(s),this.X[t]=i},et(){document.body.onkeydown=t=>{const s=this.Z[t.code];s&&s.wt||(this.Z[t.code]={time:Date.now()},this.W[t.code]&&this.W[t.code].forEach((t=>t())))},document.body.onkeyup=t=>{this.Z[t.code]={time:0},this.X[t.code]&&this.X[t.code].forEach((t=>t()))},document.body.onmousemove=t=>{this.j.x=t.clientX,this.j.y=t.clientY},document.body.onclick=t=>{this.V.click.forEach((t=>t(this.j.clone())))},window.addEventListener("gamepadconnected",(t=>{this.J++,this.Y[t.gamepad.index]=t.gamepad,this.V.q.forEach((t=>t()))})),window.addEventListener("gamepaddisconnected",(t=>{this.J--,delete this.Y[t.gamepad.index],this.V.H.forEach((t=>t()))}))},update(){const t=navigator.getGamepads();for(const s of t)if(s){this.Y[s.index]=s;for(const t in this.B)"axis6-"===t||"axis6+"===t?s.axes[6]||delete this.B[t]:"axis7-"===t||"axis7+"===t?s.axes[7]||delete this.B[t]:s.buttons[t]&&!s.buttons[t].pressed&&delete this.B[t]}}},t.u={scale:1,clear(){this.F.clearRect(0,0,window.innerWidth,window.innerHeight),this.Et.clearRect(0,0,window.innerWidth,window.innerHeight)},At(){this.clear(),this.level&&this.level.At()},Mt(){this.Et.setTransform(this.scale,0,0,this.scale,0,0),this.Et.clearRect(0,0,window.innerWidth,window.innerHeight),this.Et.fillStyle="rgba(0,0,0,0.4)",this.Et.fillRect(0,0,window.innerWidth,window.innerHeight),this.Et.fillStyle="#FFF",this.Et.font="normal 56px "+t.i,this.Et.textAlign="center",this.Et.textBaseline="top",this.Et.fillText("PAUSED",this.Dt,60)},Kt(t,s){const i=document.createElement("canvas");i.width=t,i.height=s;const h=i.getContext("2d",{alpha:!0});return h.imageSmoothingEnabled=!1,[i,h]},init(t){this.bt=document.getElementById("c"),this.F=this.bt.getContext("2d",{alpha:!0}),this.F.imageSmoothingEnabled=!1,this.xt=document.getElementById("ui"),this.Et=this.xt.getContext("2d",{alpha:!0}),this.Et.imageSmoothingEnabled=!1,this.et(),t()},m(s=0){if(t.o.update(),s&&this.Ft){const i=(s-this.Ft)/(1e3/t.h);if(this.F.imageSmoothingEnabled=!1,this.Et.imageSmoothingEnabled=!1,this.F.setTransform(this.scale,0,0,this.scale,0,0),this.Et.setTransform(this.scale,0,0,this.scale,0,0),this._t)return void this.Mt();this.level.update(i),this.At(),t.t&&(this.Et.fillStyle="#000",this.Et.fillRect(40,window.innerHeight-45,140,28),this.Et.fillStyle="#FFF",this.Et.font="bold 16px "+t.i,this.Et.textAlign="right",this.Et.textBaseline="bottom",this.Et.fillText(~~(t.h/i)+" FPS / "+this.scale,160,window.innerHeight-22))}this.Ft=s,requestAnimationFrame((t=>this.m(t)))},pause(){this._t=!0,t.Audio._()},et(){window.addEventListener("resize",(t=>this.resize())),this.resize();const s=t.o.ht(t.o.v.T);setInterval((()=>{this._t&&t.o.update(),s.gamepad.forEach((s=>{t.o.ot(s,!0)&&this.kt()}))}),100);const i=()=>this.kt();s.keyboard.forEach((s=>t.o.yt(s,i))),t.o.ft("gp_disconnect",(()=>this.pause())),t.o.ft("click",(t=>{this._t||this.level&&this.level.Pt(t)}))},vt(){this.level=new this.level.constructor},resize(){this.bt.width=window.innerWidth,this.bt.height=window.innerHeight,this.xt.width=window.innerWidth,this.xt.height=window.innerHeight,this._t&&(clearTimeout(this.Tt),this.Tt=setTimeout((()=>this.Mt()),100))},kt(){this._t?this.unpause():this.pause()},unpause(){this._t&&(this._t=!1,t.Audio.P(),this.m())}},t.p=class{constructor(){this.St=!1,this.Ot=0,this.Ut=[],this.Ct=[],this.Nt={p1:null,p2:null}}Gt(...t){this.Ct.push(...t),this.Ut.push(...t)}Pt(t){if(!this.St)for(const s of this.Ct)if(s.Lt(t)&&this.Nt.p2!==s){this.Nt.p1=s;break}}At(){this.St?this.Rt(t.u.F):(this.It(t.u.F),this.Ut.forEach((s=>s.At(t.u.F))))}It(){}Rt(s){const i=t.u.Dt;s.font="bold 36px "+t.i,s.textAlign="center",s.fillStyle="#DDD",s.fillText("GAME OVER",i,i)}update(s){if(this.Ot+=s,this.St)t.o.it(t.o.v.S,!0)&&t.u.vt();else{this.Ut.sort(((t,s)=>t.y-s.y));const i=t.o.st();this.Ut.forEach((t=>{t===this.Nt.p1?t.update(s,i):t.update(s)}))}}},t.zt=class{constructor(s){this.Bt=new t.g(s.x,s.y),this.w=s.w||0,this.Vt=s.Vt||0,this.qt=1/0,this.speed=new t.g}At(t){}Lt(t){return this.Bt.x<=t.x&&t.x<=this.Bt.x+this.w&&this.Bt.y<=t.y&&t.y<=this.Bt.y+this.Vt}update(t,s){s&&(this.Bt.x+=Math.round(t*s.x*this.speed.x),this.Bt.y+=Math.round(t*s.y*this.speed.y))}},t.Ht=class extends t.zt{constructor(t){super(t),this.speed.x=6,this.speed.y=6}},t.Wt=class extends t.Ht{constructor(t){super(t)}},t.Qt=class extends t.Ht{constructor(t){t.w??=32,t.Vt??=48,super(t)}At(t){t.fillStyle="#ff0000",t.fillRect(Math.round(this.Bt.x),Math.round(this.Bt.y),this.w,this.Vt)}},t.Xt=class extends t.Ht{constructor(t){super(t)}};