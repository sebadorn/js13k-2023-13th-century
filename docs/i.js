let t,s,i;s=.3,t=(t=1,s=.05,h=220,e=0,n=0,r=.1,o=0,a=1,c=0,u=0,l=0,d=0,f=0,w=0,p=0,m=0,g=0,y=1,x=0,E=0,M=Math,k=44100,A=2*M.PI,T=(c*=500*A/k/k),_=(h*=(1-s+2*s*M.random(s=[]))*A/k),b=0,D=0,I=0,F=1,v=0,K=0,C=0,L,S)=>{for(u*=500*A/k**3,p*=A/k,l*=A/k,d*=k,f=k*f|0,S=(e=k*e+9)+(x*=k)+(n*=k)+(r*=k)+(g*=k)|0;I<S;s[I++]=C)++K%(100*m|0)||(C=o?1<o?2<o?3<o?M.sin((b%A)**3):M.max(M.min(M.tan(b),1),-1):1-(2*b/A%2+2)%2:1-4*M.abs(M.round(b/A)-b/A):M.sin(b),C=(f?1-E+E*M.sin(A*I/f):1)*(0<C?1:-1)*M.abs(C)**a*.3*t*(I<e?I/e:I<e+x?1-(I-e)/x*(1-y):I<e+x+n?y:I<S-g?(S-I-g)/r*y:0),C=g?C/2+(g>I?0:(I<S-g?1:(S-I)/g)*s[I-g|0]/2):C),b+=(L=(h+=c+=u)*M.cos(p*D++))-L*w*(1-1e9*(M.sin(I)+1)%2),F&&++F>d&&(h+=l,_+=l,F=0),!f||++v%f||(h=_,c=T,F||=1);return(t=i.createBuffer(1,S,k)).getChannelData(0).set(s),(h=i.createBufferSource()).buffer=t,h.connect(i.destination),h.start(),h},i=new AudioContext;const h={t:!0,i:"Arial, sans-serif",h:60,o:96,u:48,l:1,p:2,init(){h.m.init(),h.g.init((()=>{h.g.level=new h.k.M,h.g.A()}))},T(t,s){let i=Math.min(t.x+t.w,s.x+s.w)-Math.max(t.x,s.x);i=i<0?0:i;let h=Math.min(t.y+t._,s.y+s._)-Math.max(t.y,s.y);return h=h<0?0:h,i*h>Number.EPSILON}};window.addEventListener("load",(()=>h.init())),h.D=class{constructor(t=0,s=0){this.x=t,this.y=s}clone(){return new h.D(this.x,this.y)}length(){return this.x+this.y===0?0:Math.sqrt(this.x*this.x+this.y*this.y)}mul(t){return this.x*=t,this.y*=t,this}normalize(){const t=this.length();return t&&(this.x/=t,this.y/=t),this}set(t,s){this.x=t,this.y=s}},h.Audio={I:[.3,0,8,.01,.01,.01,1,2.29,86,,,,,,-82,,,.42,.01],F:[.2,0,68,.02,.01,.18,2,1.89,-.3,,,,,1.4,,.3,,.59,.06,.12],v:[.15,0,382,.1,.01,.09,,2.2,-1.2,-3.8,,,,5,,,,.48,.05],SELECT:[.2,0,883,.01,.07,,1,1.74,,,366,.1,.06,,,,,.62,.01],play(s){t(...s)}},h.m={K:{C:1,L:2,S:3,I:4,N:5,v:6,R:10,G:11,H:12,P:13,O:14,U:15},B:{},W:{},Y:{click:[],Z:[],V:[]},X:{},j:{},q:{},J:{},$:new h.D,tt:0,st(){this.it={[this.K.C]:{keyboard:["Escape"],gamepad:[9]},[this.K.G]:{keyboard:["ArrowUp","KeyW","KeyZ","KeyY"],gamepad:[12]},[this.K.R]:{keyboard:["ArrowLeft","KeyA","KeyQ"],gamepad:[14]},[this.K.P]:{keyboard:["ArrowDown","KeyS"],gamepad:[13]},[this.K.H]:{keyboard:["ArrowRight","KeyD"],gamepad:[15]},[this.K.I]:{keyboard:["Space","Enter"],gamepad:[0]},[this.K.v]:{keyboard:["KeyR"],gamepad:[]},[this.K.L]:{keyboard:["Enter"],gamepad:[0]},[this.K.N]:{keyboard:["KeyE"],gamepad:[0]}}},ht(){let t=0,s=0;if(this.et(this.K.R)?t=-1:this.et(this.K.H)&&(t=1),this.et(this.K.G)?s=-1:this.et(this.K.P)&&(s=1),!t||!s){const i=.3;for(const h in this.q){const e=this.q[h];e.axes[0]&&Math.abs(e.axes[0])>i?t=e.axes[0]>0?1:-1:e.axes[2]&&Math.abs(e.axes[2])>i&&(t=e.axes[2]>0?1:-1),e.axes[1]&&Math.abs(e.axes[1])>i?s=e.axes[1]>0?1:-1:e.axes[3]&&Math.abs(e.axes[3])>i&&(s=e.axes[3]>0?1:-1)}}return{x:t,y:s}},nt(t){return this.it[t]},init(){this.st(),this.rt()},et(t,s){const i=this.nt(t);for(const t of i.keyboard)if(this.ot(t,s))return!0;for(const t of i.gamepad)if(this.ct(t,s))return!0;if(t===this.K.R)for(const t in this.q){const i=this.q[t];if(i.axes[6]&&i.axes[6]<=-.2)return!this.W["ut"]&&(s&&(this.W["ut"]=!0),!0)}else if(t===this.K.H)for(const t in this.q){const i=this.q[t];if(i.axes[6]&&i.axes[6]>=.2)return!this.W["lt"]&&(s&&(this.W["lt"]=!0),!0)}else if(t===this.K.G)for(const t in this.q){const i=this.q[t];if(i.axes[7]&&i.axes[7]<=-.2)return!this.W["dt"]&&(s&&(this.W["dt"]=!0),!0)}else if(t===this.K.P)for(const t in this.q){const i=this.q[t];if(i.axes[7]&&i.axes[7]>=.2)return!this.W["ft"]&&(s&&(this.W["ft"]=!0),!0)}return!1},ct(t,s){for(const i in this.q){const h=this.q[i].buttons[t];if(h&&h.pressed)return!this.W[t]&&(s&&(this.W[t]=!0),!0)}return!1},ot(t,s){const i=this.J[t];return!(!i||!i.time)&&(s&&(i.time=0,i.wt=!0),!0)},gt(t,s){if("function"!=typeof s)return void(this.Y[t]=[]);const i=this.Y[t].indexOf(s);i>=0&&this.Y[t].splice(i,1)},yt(t,s){this.Y[t].push(s)},xt(t,s){const i=this.X[t]||[];i.push(s),this.X[t]=i},Et(t,s){const i=this.j[t]||[];i.push(s),this.j[t]=i},rt(){document.body.onkeydown=t=>{const s=this.J[t.code];s&&s.wt||(this.J[t.code]={time:Date.now()},this.X[t.code]&&this.X[t.code].forEach((t=>t())))},document.body.onkeyup=t=>{this.J[t.code]={time:0},this.j[t.code]&&this.j[t.code].forEach((t=>t()))},document.body.onmousemove=t=>{this.$.x=t.clientX,this.$.y=t.clientY},document.body.onclick=t=>{this.Y.click.forEach((t=>t(this.$.clone())))},window.addEventListener("gamepadconnected",(t=>{this.tt++,this.q[t.gamepad.index]=t.gamepad,this.Y.Z.forEach((t=>t()))})),window.addEventListener("gamepaddisconnected",(t=>{this.tt--,delete this.q[t.gamepad.index],this.Y.V.forEach((t=>t()))}))},update(){const t=navigator.getGamepads();for(const s of t)if(s){this.q[s.index]=s;for(const t in this.W)"axis6-"===t||"axis6+"===t?s.axes[6]||delete this.W[t]:"axis7-"===t||"axis7+"===t?s.axes[7]||delete this.W[t]:s.buttons[t]&&!s.buttons[t].pressed&&delete this.W[t]}}},h.g={Mt:new h.D,scale:1,kt:0,At:0,Tt(t){const[s,i]=this._t(t.width,t.height);i.drawImage(t,0,0);const h=i.getImageData(0,0,t.width,t.height);for(let s=0;s<t.height;s++)for(let i=0;i<t.width;i++){const e=4*(s*t.width+i);0!==h.data[e+3]&&(h.data[e+0]=255,h.data[e+1]=255,h.data[e+2]=255)}return i.putImageData(h,0,0),s},bt(t){const s=t.Dt();if(this.kt=this.Mt.x-s.x,this.At=(this.Mt.y-s.y)*this.scale,t.level){const s=t.level.It;this.kt=Math.min(0,Math.max(-s.w+2*this.Mt.x,this.kt))}this.kt*=this.scale},Ft(t){this.level=t},clear(){this.vt.setTransform(1,0,0,1,0,0),this.vt.clearRect(0,0,window.innerWidth,window.innerHeight),this.Kt.setTransform(1,0,0,1,0,0),this.Kt.clearRect(0,0,window.innerWidth,window.innerHeight)},createLinearGradient(t,s,i,h,e="#0003",n="#fff1"){const r=this.vt.createLinearGradient(t,s,i,h);return r.addColorStop(0,e),r.addColorStop(1,n),r},Ct(){this.clear(),this.vt.setTransform(this.scale,0,0,this.scale,this.kt,this.At),this.Kt.setTransform(this.scale,0,0,this.scale,0,0),this.level&&this.level.Ct()},Lt(){this.Kt.setTransform(1,0,0,1,0,0),this.Kt.clearRect(0,0,window.innerWidth,window.innerHeight),this.Kt.setTransform(this.scale,0,0,this.scale,0,0),this.Kt.fillStyle="rgba(0,0,0,0.4)",this.Kt.fillRect(0,0,this.St.width/this.scale,this.St.height/this.scale),this.Kt.fillStyle="#FFF",this.Kt.font="56px "+h.i,this.Kt.textAlign="center",this.Kt.textBaseline="top",this.Kt.fillText("GAME OVER",this.Mt.x,this.Mt.y-56)},Nt(){this.Kt.setTransform(1,0,0,1,0,0),this.Kt.clearRect(0,0,window.innerWidth,window.innerHeight),this.Kt.setTransform(this.scale,0,0,this.scale,0,0),this.Kt.fillStyle="rgba(0,0,0,0.4)",this.Kt.fillRect(0,0,this.St.width/this.scale,this.St.height/this.scale),this.Kt.fillStyle="#FFF",this.Kt.font="56px "+h.i,this.Kt.textAlign="center",this.Kt.textBaseline="top",this.Kt.fillText("PAUSED",this.Mt.x,this.Mt.y-56)},Rt(){this.vt.fillRect(-this.kt/this.scale-h.o,-this.At/this.scale-h.o,this.Gt.width/this.scale+2*h.o,this.Gt.height/this.scale+2*h.o)},_t(t,s){const i=document.createElement("canvas");i.width=t,i.height=s;const h=i.getContext("2d",{alpha:!0});return h.imageSmoothingEnabled=!1,[i,h]},init(t){this.Gt=document.getElementById("c"),this.vt=this.Gt.getContext("2d",{alpha:!0}),this.vt.imageSmoothingEnabled=!1,this.St=document.getElementById("ui"),this.Kt=this.St.getContext("2d",{alpha:!0}),this.Kt.imageSmoothingEnabled=!1,this.Ht((()=>{this.rt(),t()}))},Ht(t){const s=new Image;s.onload=()=>{this.images=s,this.Pt=this.Tt(s);const[i,e]=this._t(5,3),n=new ImageData(5,3);n.data.set([255,255,255,196,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,196,0,0,0,0,255,255,255,196,255,255,255,255,255,255,255,196,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,196,0,0,0,0,0,0,0,0]),e.putImageData(n,0,0),this.Ot=i;const[r,o]=this._t(h.o,h.o);o.drawImage(this.images,16,0,16,16,0,0,h.o,h.o),this.Ut=o.createPattern(r,"repeat");const[a,c]=h.g._t(h.o,h.o),u=c.createRadialGradient(h.u,h.u,0,h.u,h.u,h.u);u.addColorStop(0,"#000a"),u.addColorStop(.9,"#0002"),u.addColorStop(1,"#0000"),c.fillStyle=u,c.fillRect(0,0,h.o,h.o),this.Bt=a,t()},s.src="i.png"},A(t=0){if(h.m.update(),t&&this.zt){const s=(t-this.zt)/(1e3/h.h);if(this.vt.imageSmoothingEnabled=!1,this.Kt.imageSmoothingEnabled=!1,this.vt.lineWidth=1,this.vt.textBaseline="alphabetic",this.Wt)return void this.Nt();this.level.update(s),this.Ct(),h.t&&(this.Kt.fillStyle="#000",this.Kt.fillRect(60,this.Gt.height/this.scale-74,140,28),this.Kt.fillStyle="#FFF",this.Kt.font="16px monospace",this.Kt.textAlign="right",this.Kt.textBaseline="bottom",this.Kt.fillText(~~(h.h/s)+" FPS, "+Math.round(1e3*this.scale)/1e3,192,this.Gt.height/this.scale-50))}this.zt=t,requestAnimationFrame((t=>this.A(t)))},pause(){this.Wt=!0},rt(){window.addEventListener("resize",(t=>this.resize())),this.resize();const t=h.m.nt(h.m.K.C);setInterval((()=>{this.Wt&&h.m.update(),t.gamepad.forEach((t=>{h.m.ct(t,!0)&&this.Yt()}))}),100);const s=()=>this.Yt();t.keyboard.forEach((t=>h.m.Et(t,s))),h.m.yt("gp_disconnect",(()=>this.pause()))},Zt(){this.level=new this.level.constructor},resetTransform(){this.vt.setTransform(this.scale,0,0,this.scale,this.kt,this.At)},resize(){const t=1920/1080;let s=window.innerHeight,i=Math.round(s*t);i>window.innerWidth&&(i=window.innerWidth,s=i/t),this.scale=s/1080,this.Mt.x=i/2/this.scale,this.Mt.y=s/2/this.scale;let h=~~((window.innerHeight-s)/2)+"px",e=~~((window.innerWidth-i)/2)+"px";this.Gt.width=i,this.Gt.height=s,this.Gt.style.top=h,this.Gt.style.left=e,this.St.width=i,this.St.height=s,this.St.style.top=h,this.St.style.left=e,this.Wt&&(clearTimeout(this.Vt),this.Vt=setTimeout((()=>this.Nt()),100))},Xt(t,s,i){t.translate(i.x,i.y),t.rotate(s),t.translate(-i.x,-i.y)},jt(t,s,i,h){t.translate(h.x,h.y),t.scale(s,i),t.translate(-h.x,-h.y)},Yt(){this.Wt?this.unpause():this.pause()},unpause(){this.Wt&&(this.Wt=!1,this.A())}},h.qt=class{constructor(t,s=0){this.level=t,this.set(s)}Qt(){return this.level.Jt>this.timeEnd}$t(){return Math.min(1,1-(this.timeEnd-this.level.Jt)/this.duration)}set(t){this.duration=t*h.h,this.timeEnd=this.level.Jt+this.duration}},h.k=class{constructor(){this.ts=!1,this.It={},this.Jt=0,this.ss=[],this.hs=[],this.items=[],this.es={p1:null,p2:null}}ns(t,s){if(h.g.bt(t),t.rs||t.os)t.update(s);else{h.m.et(h.m.K.v,!0)?t.cs():h.m.et(h.m.K.I,!0)&&t.attack();let i=h.m.ht();i=new h.D(i.x,i.y),t.update(s,i.normalize());const e=t.us();this.items.forEach((s=>{s.ls=!1,s.ds&&h.T(s.us(),e)&&(s.ls=!0,h.m.et(h.m.K.N,!0)&&t.fs(s))}))}}ws(...t){this.hs.push(...t),this.ps(...t)}gs(...t){this.items.push(...t),this.ps(...t)}ps(...t){t.forEach((t=>t.level=this)),this.ss.push(...t)}removeItem(t){let s=this.items.indexOf(t);s>=0&&this.items.splice(s,1),s=this.ss.indexOf(t),s>=0&&this.ss.splice(s,1)}Ct(){this.ys&&this.ys(h.g.vt),this.ss.forEach((t=>t.Ct(h.g.vt))),this.xs&&this.xs(h.g.vt),this.ts&&h.g.Lt()}update(t){if(this.Jt+=t,this.ts)h.m.et(h.m.K.L,!0)&&h.g.Zt();else{const s=this.es.p1;if(s){if(s.Es<=0)return void(this.ts=!0);this.ns(s,t)}this.ss.sort(((t,s)=>t.Ms()-s.Ms())),this.ss.forEach((i=>{i!==s&&(i.update(t),s?.os&&i.Es>0&&i.ks()&&s.item.As(i)&&i.Ts(s.item),i.action||h.bs._s(i,s))}))}}},h.Ds=class{constructor(t={}){this.Is=new h.D(t.x,t.y),this.w=t.w||0,this._=t._||0,this.Fs=0,this.vs=null,this.Ks={},this.ds=!1,this.Cs=[],this.Ls=new h.D(1,0),this.Ss=1/0,this.Es=1/0,this.ls=!1,this.level=null,this.speed=new h.D,this.state=h.l}Ns(t){for(let s=this.Cs.length-1;s>=0;s--){(0,this.Cs[s])(t)&&this.Cs.splice(s,1)}}ks(){return(!this.vs||this.vs.Qt())&&!this.rs}Ct(t){}us(){return{x:this.Is.x,y:this.Is.y,w:this.w,_:this._}}Dt(){return{x:this.Is.x+this.w/2,y:this.Is.y+this._/2}}Rs(t,s,i){return this.Ks.Gs||(this.Is.x+=Math.round(s*t.x*this.speed.x),this.Is.y+=Math.round(s*t.y*this.speed.y),(t.x||t.y)&&(i=h.p,this.Ls.set(0==t.x?this.Ls.x:t.x>0?1:-1,0==t.y?this.Ls.y:t.y>0?1:-1))),i}Ms(){return this.Is.y+this._}Ts(t){if(!this.ks())return;this===this.level.es.p1&&h.Audio.play(h.Audio.F),this.vs=this.vs||new h.qt(this.level),this.vs.set(.5),this.Es=Math.max(0,this.Es-t.Hs);const s=t.Ps(this);s&&this.Cs.push(s),this.Es<=0&&this.Os()}update(t,s){if(this.Es<=0||this.Us)return;let i=h.l;this.Fs+=t,this.Ns(t),s&&(i=this.Rs(s,t,i)),this.state!=i&&(this.Fs=0),this.state=i}},h.Bs=class extends h.Ds{constructor(t={}){t.w=h.o,t._=h.o,super(t),this.zs=42/h.h,this.action=null,this.Ws=null,this.os=!1,this.Ss=100,this.Es=100,this.item=t.item,this.speed.set(12,12),this.item&&(this.item.Us=this)}Ys(t,s){h.g.jt(t,s,1,this.Dt())}Zs(t){h.g.Xt(t,.1*Math.sin(this.Fs*this.zs),this.Dt())}Vs(t){if(this.Es==this.Ss||this.rs)return;let s=this.Es/this.Ss,i=this.Is.x+16,h=this.Is.y-24,e=this.w-32;t.fillStyle="#000",t.fillRect(i,h,e,8),t.fillStyle="#f00",t.fillRect(i,h,e*s,8)}Xs(t,s){const i=this.Ls.x<0;i&&this.Ys(t,-1),this.item?.Ct(t,s),i&&this.Ys(t,-1)}js(t){t.drawImage(h.g.Bt,this.Is.x,this.Is.y+this._-12,this.w,24)}attack(){this.os||this.rs||!this.item||(h.Audio.play(h.Audio.I),this.Ws=this.Ws||new h.qt(this.level),this.Ws.set(this.item.qs),this.os=!0)}cs(){this.rs||(h.Audio.play(h.Audio.v),this.Qs=this.Qs||new h.qt(this.level),this.Qs.set(.5),this.rs=!0)}Ct(t){if(this.Es<=0)return;let s=this.Js+(this.Ls.x<0?16:0),i=h.g.images;if(this.js(t),this.rs){let s=360*this.Qs.$t()*3*Math.PI/180;this.Ls.x<0&&(s=-s),h.g.Xt(t,s,this.Dt())}else{if(this.vs&&!this.vs.Qt()){const t=this.vs.$t();(t>=0&&t<=.2||t>=.4&&t<=.6||t>=.8&&t<=1)&&(i=h.g.Pt)}this.state===h.p&&this.Zs(t)}this.item&&this.Xs(t,i),this.Vs(t),t.drawImage(i,s,this.$s,this.ti,this.si,this.Is.x,this.Is.y,h.o,h.o),h.g.resetTransform()}Os(){this.item?.ii(),this.Es>0?(this.item=new h.hi,this.item.Us=this):this.item=null}us(){const t={x:this.Is.x,y:this.Is.y+this._,w:this.w,_:h.u/2};return t.y-=t._,t}fs(t){t.Us||(this.item?.ii(),this.item=t,t.ls=!1,t.Us=this,this.level.removeItem(t))}update(t,s){if(this.Es<=0)return;let i=h.l;this.Fs+=t,this.Ns(t),s&&(i=this.Rs(s,t,i)),this.action&&(i=this.action(t)||i),this.state!=i&&(this.Fs=0),this.os&&this.Ws.Qt()&&(this.os=!1),this.rs&&(this.Qs.Qt()?this.rs=!1:(s=new h.D(this.Ls.x<0?-1:1,0),this.Rs(s,t,i))),this.level&&(this.Is.x=Math.min(this.level.It.w-this.w,Math.max(0,this.Is.x)),this.Is.y=Math.min(this.level.It._-this._-8,Math.max(-h.u,this.Is.y))),this.state=i}},h.bs={ei(t,s){if(t.os||!t.item)return!1;if(t.item.As(s)){const i=new h.qt(t.level,.3);return t.action=function(){i.Qt()&&(t.os&&t.Ws&&t.Ws.Qt()?t.action=null:t.os||(t.attack(),s.Ts(t.item)))},!0}return!1},ni(t){if(t.item&&!(t.item instanceof h.hi))return!1;let s=1/0,i=null,e=null;const n=t.Dt(),r=t.us(),o=new h.D;for(let a=0;a<t.level.items.length;a++){const c=t.level.items[a];if(c instanceof h.ri){const a=c.us();if(h.T(a,r)){const s=new h.qt(t.level,.5);return t.action=function(){s.Qt()&&(t.fs(c),t.action=null)},!0}o.set(a.x+a.w/2-n.x,a.y+a._/2-n.y);const u=o.length();u<3*h.o&&s>u&&(s=u,i=o.clone(),e=c)}}if(!e)return!1;const a=new h.qt(t.level,1);return i.normalize(),t.action=function(s){if(a.Qt())t.action=null;else if(!t.Ks.Gs)return t.Rs(i,s,0)},!0},oi(t,s){const i=t.Dt(),e=s.Dt(),n=new h.D(e.x-i.x,e.y-i.y);if(n.length()>5*h.o)return!1;const r=new h.qt(t.level,1);return n.normalize(),t.action=function(s){if(r.Qt())t.action=null;else if(!t.Ks.Gs)return t.Rs(n,s,0)},!0},_s(t,s){t instanceof h.ai||!s||t.Ks.Gs||s.Es<=0||this.ni(t)||this.ei(t,s)||this.oi(t,s)}},h.ri=class extends h.Ds{constructor(t){super(t),this.Us=null}ci(){const t=h.g,s=this.us();let i=Math.sin(t.level.Jt/25),e=s.x+s.w/2+t.kt,n=s.y-1.5*h.u+t.At;t.Kt.drawImage(t.Ot,e,n+8*i,30,18),t.Kt.fillStyle="#fff";let r=2*i;e=s.x-6+t.kt-r,n=s.y+s._+t.At+r,t.Kt.fillRect(e,n,6,12),t.Kt.fillRect(e,n+6,12,6),e=s.x+s.w+t.kt+r,n=s.y-6+t.At-r,t.Kt.fillRect(e-6,n,12,6),t.Kt.fillRect(e,n,6,12)}ui(){this.Us&&this.Is.set(this.Us.Is.x+this.Us.w/2,this.Us.Is.y-this.Us._)}ii(){this.ds&&(this.ui(),this.Us?.level.gs(this)),this.Us=null}Ps(){return null}Ms(){return this.Is.y}},h.li=class extends h.Bs{constructor(t){super(t),this.Js=0,this.$s=32,this.ti=16,this.si=16,this.zs=32/h.h,this.speed.set(3,3)}Ts(t){this.Es<=0||super.Ts(t)}},h.ai=class extends h.li{constructor(t){super(t),this.Js=0,this.$s=48,this.ti=16,this.si=16}Os(){this.item?.ii(),this.item=null}Ts(t){this.Es<=0||super.Ts(t)}},h.di=class extends h.Bs{constructor(t){super(t),this.Js=0,this.$s=16,this.ti=16,this.si=16}},h.hi=class extends h.ri{constructor(t={}){super(t),this.qs=.15,this.Hs=10}As(t){if(!this.Us)return!1;const s={x:this.Us.Is.x+this.Us.w,y:this.Us.Is.y+h.u/2,w:h.u,_:h.u};this.Us.Ls.x<0&&(s.x-=this.Us.w+s.w);const i={x:t.Is.x,y:t.Is.y,w:t.w,_:t._};return h.T(i,s)}Ct(t,s){let i=this.Is.x,e=this.Is.y;if(this.Us&&(i=this.Us.Is.x+this.Us.w-32,e=this.Us.Is.y+this.Us._/2-16),this.Us.os){const t=Math.sin(this.Us.Ws.$t()*Math.PI*2)*h.u;i+=Math.max(0,t)}t.drawImage(s||h.g.images,40,16,8,8,i,e,h.u,h.u)}Ps(t){if(t instanceof h.Bs)return function(){return t.Os(),!0}}},h.fi=class extends h.ri{constructor(t={}){t.w=h.u,t._=2*h.o,super(t),this.qs=.25,this.ds=!0,this.Hs=34}ui(){this.Us&&this.Is.set(this.Us.Is.x+this.Us.w/2,this.Us.Is.y-this.Us._+this._/2)}As(t){if(!this.Us)return!1;const s=[{x:this.Us.Is.x+this.Us.w,y:this.Us.Is.y,w:1.7*h.o,_:h.o},{x:this.Us.Is.x+this.Us.w,y:this.Us.Is.y-.7*h.o,w:h.o,_:2.4*h.o}];this.Us.Ls.x<0&&(s[0].x-=this.Us.w+s[0].w,s[1].x-=this.Us.w+s[1].w);const i={x:t.Is.x,y:t.Is.y,w:t.w,_:t._};for(let t=0;t<s.length;t++)if(h.T(i,s[t]))return!0;return!1}Ct(t,s){let i=this.Is.x,e=this.Is.y;this.Us&&(i=this.Us.Is.x+h.u,e=this.Us.Is.y-h.o-16);let n=0,r={x:i+this.w/2,y:e+this._/2};if(this.Us){if(this.Us?.os){r.x=i+h.o/4,r.y=e+2*h.o;let t=this.Us.Ws.$t();const s=Math.PI;t<=.4?(t/=.4,n=t*s):n=t<=.8?s:0}}else n=80*Math.PI/180;n&&h.g.Xt(t,n,r),t.drawImage(s||h.g.images,32,16,8,32,i,e,h.u,2*h.o),n&&this.Us?.os&&h.g.Xt(t,-n,r),this.Us||(h.g.resetTransform(),this.ls&&this.ci(t))}Ps(t){if(!(t instanceof h.Bs))return;const s=t.Is.clone(),i=this.Us.Dt(),e=t.Dt(),n=new h.D(e.x-i.x,e.y-i.y);n.normalize();const r=new h.qt(this.Us.level,.3),o=1.5*h.o;return t.Ks.Gs=!0,function(){if(r.Qt())return t.Ks.Gs=!1,!0;const i=r.$t();return t.Is.set(s.x+n.x*o*i,s.y+n.y*o*i),!1}}us(){return{x:this.Is.x-1.5*this.w,y:this.Is.y+1.5*this.w,w:this._,_:this.w}}},h.k.wi=class extends h.k{constructor(){super(),this.pi=0,this.mi=2}gi(t,s,i,e,n){if(n){let s=h.u/2,n=h.o,r=i-96,o=e-n/2,a={x:r+s/2,y:o+n/2};h.g.Xt(t,Math.PI/2,a),h.g.jt(t,Math.sin(.08*this.Jt),1,a),t.drawImage(h.g.images,32,16,8,32,r,o,s,n),h.g.resetTransform()}t.fillStyle=n?"#fa0":"#777",t.textBaseline="middle",t.fillText(s,i,e)}Ct(){const t=h.g.vt;let s=Math.max(2*h.o,h.g.Mt.x-500),i=Math.max(2*h.o,h.g.Mt.y-128);t.fillStyle="#0d161e",h.g.Rt(),t.font="600 64px "+h.i,t.textAlign="left",t.fillStyle="#fa0",t.fillText("TREASURE OF THE NIBELUNGS",s,i+3),t.fillStyle="#777",t.fillText("TREASURE OF THE NIBELUNGS",s,i),t.font="42px "+h.i,s+=h.u/2+114,i+=96,this.gi(t,"New Game",s,i,0===this.pi),i+=72,this.gi(t,"Continue",s,i,1===this.pi)}update(t){this.Jt+=t,h.m.et(h.m.K.G,!0)?this.pi--:h.m.et(h.m.K.P,!0)?this.pi++:h.m.et(h.m.K.L,!0)&&(h.Audio.play(h.Audio.SELECT),0===this.pi&&(h.g.level=new h.k.yi)),this.pi<0?this.pi=this.mi-1:this.pi>=this.mi&&(this.pi=0)}},h.k.M=class extends h.k{constructor(){super(),this.It={w:2*h.g.Mt.x,_:8*h.o};const t=new h.di({x:3*h.o,y:3*h.o,item:new h.hi}),s=new h.ai({x:14*h.o,y:3*h.o,item:new h.fi});this.ws(t,s),this.es.p1=t,this.xi=s,this.Ei=0}Ct(){super.Ct();const t=h.g.vt;t.font='600 23px "Courier New", monospace',t.fillStyle="#fff7",t.textAlign="center";const s=this.es.p1,i=s.Dt(),e=this.xi.Dt();0===this.Ei?t.fillText("Move with [W][A][S][D] or arrow keys",i.x,i.y-s._):1===this.Ei?t.fillText("Attack with [ENTER]",e.x,e.y-2*this.xi._):2===this.Ei?t.fillText("Pick up with [E]",e.x,e.y-this.xi._):3===this.Ei?t.fillText("Attack with the sword",e.x,e.y-this.xi._):4===this.Ei?t.fillText("You can dodge roll with [R]",i.x,i.y-s._):5===this.Ei&&t.fillText("Your training is complete! Continue on...",i.x,i.y-s._)}ys(t){const s=h.g;t.fillStyle="#273325",s.Rt(),t.fillStyle="#4d571b",t.fillRect(0,0,this.It.w,this.It._),t.fillStyle="#a58d2c",t.beginPath(),t.ellipse(this.It.w/2,this.It._/2,this.It.w/2-h.o,this.It._/2-h.o,0,0,4*Math.PI),t.closePath(),t.fill(),t.fillStyle=s.createLinearGradient(0,0,0,this.It._,"#0003","#0000"),t.fillRect(0,0,this.It.w,this.It._)}xs(t){if(5!==this.Ei)return;const s=h.g,i=Math.sin(this.Jt/25);let e=this.It.w-h.o+8*i,n=this.It._/2+9;const r={x:e,y:n};let o=-Math.PI/2;s.Xt(t,o,r),t.drawImage(s.Ot,e,n,30,18),s.Xt(t,-o,r)}update(t){const s=this.es.p1,i=h.m;if(0===this.Ei)(i.et(i.K.G)||i.et(i.K.H)||i.et(i.K.P)||i.et(i.K.R))&&(this.Ei=1);else if(1===this.Ei)this.xi.item instanceof h.fi||(this.Ei=2);else if(2===this.Ei)s.item instanceof h.fi&&(this.Ei=3);else if(3===this.Ei)this.xi.Es<this.xi.Ss-s.item.Hs&&(this.Ei=4);else if(4===this.Ei)i.et(i.K.v)&&(this.Ei=5);else if(5===this.Ei){if(s.Dt().x>=this.It.w-h.o)return void h.g.Ft(new h.k.Mi)}super.update(t)}},h.k.yi=class extends h.k{constructor(){super(),this.ki=["Ez enwas niht anders","wan gestéinẹ unde golt.","unt ob man al die werlde","het dâ von versolt,","sîn wǽré niht mínner","einer marke wert."],this.Ai=["Ê daz der künee rîche","wider wære komen,","die wîle hete Hagene","den schaz vil gar genomen.","","er sanctẹ in dâ ze Lôche","allen in den Rîn.","er wandẹ er soldẹ in niezen:","des enkunde niht gesîn."],this.Ti=["The legendary treasure of the Nibelungs:","Gems and gold more than one could ever hope to spent.","","While the king and his men where away, Hagen stole it","all and sunk the treasure in the Rhine at Lochheim.","But he was killed before being able to retrieve the riches.","","Betting on its the existance,","many set off to look for the treasure."],this._i=0,this.bi=new h.qt(this,2);this.ki.concat(this.Ai).forEach((t=>{const s=h.g.vt.measureText(t);this._i=Math.max(this._i,s.width)}))}Ct(){const t=h.g.vt;t.fillStyle="#0d161e",h.g.Rt();let s=2*h.o,i=s,e=this._i+h.o,n=49*(this.ki.length+this.Ai.length)+1.5*h.o+16;if(t.fillStyle="#e5c382",t.fillRect(s-h.u,i-h.o,e,n),t.font='italic 40px "Times New Roman", serif',t.textAlign="center",t.fillStyle="#000",s+=this._i/2,!this.bi.Qt()){const s=this.bi.$t();i+=(1-s)*h.u,t.fillStyle="#000000"+Math.round(255*s).toString(16).padStart(2,"0")}if(this.ki.forEach((h=>{t.fillText(h,s,i),i+=49})),this.bi.Qt()){if(i+=49,!this.Di.Qt()){const s=this.Di.$t();i+=(1-s)*h.u,t.fillStyle="#000000"+Math.round(255*s).toString(16).padStart(2,"0")}this.Ai.forEach((h=>{t.fillText(h,s,i),i+=49}))}if(this.Di?.Qt()){const n=this.Ii.$t();if(s=e+2.5*h.o,i=2*h.o+(1-n)*h.u,t.font="32px "+h.i,t.textAlign="left",t.fillStyle="#ffffff"+Math.round(255*n).toString(16).padStart(2,"0"),this.Ti.forEach((h=>{t.fillText(h,s,i),i+=49})),this.Ii.Qt()){i+=49;let e=h.u/2,n=h.o,r=s+n/2,o=i-n/2,a={x:r+e/2,y:o+n/2};h.g.Xt(t,Math.PI/2,a),h.g.jt(t,Math.sin(.08*this.Jt),1,a),t.drawImage(h.g.images,32,16,8,32,r,o,e,n),h.g.resetTransform(),t.font="32px "+h.i,t.fillStyle="#fa0",t.textBaseline="middle",t.fillText("Continue",s+n+32,i)}}}update(t){this.Jt+=t,this.bi.Qt()&&!this.Di?this.Di=new h.qt(this,2):this.Di&&this.Di.Qt()&&!this.Ii&&(this.Ii=new h.qt(this,2)),h.m.et(h.m.K.L,!0)&&(this.bi.Qt()?this.Di&&!this.Di.Qt()?this.Di.set(0):this.Ii&&!this.Ii.Qt()?this.Ii.set(0):(h.Audio.play(h.Audio.SELECT),h.g.level=new h.k.Mi):this.bi.set(0))}},h.k.Mi=class extends h.k{constructor(){super(),this.Fi=24,this.vi=6,this.It={w:h.o*this.Fi,_:h.o*this.vi};const t=new h.di({x:2*h.o,y:2*h.o,item:new h.hi}),s=new h.li({x:12*h.o,y:2*h.o,item:new h.fi});s.Ls.x=-1,this.ws(t,s);const i=new h.fi({x:4*h.o,y:4.5*h.o});this.gs(i),this.es.p1=t}ys(t){const s=h.g;if(t.fillStyle=s.Ut,t.translate(-this.Ki,0),s.Rt(),t.translate(this.Ki,0),this.Ci&&t.drawImage(this.Ci,-6,-h.o),this.Li)t.drawImage(this.Li,0,0);else{const t=6,[i,e]=h.g._t(this.It.w+1.5*t,this.It._+.5*t+h.o);e.lineWidth=t;let n=t/2;e.strokeStyle="#8f563b",e.strokeRect(0,n,this.It.w+e.lineWidth+n,this.It._+n);for(let i=0;i<this.Fi;i++)for(let n=0;n<this.vi;n++){let r=i*h.o,o=t+n*h.o;e.drawImage(s.images,0,0,16,16,r,o,h.o,h.o)}e.fillStyle="#5a3c2e",e.fillRect(n-e.lineWidth,this.It._,this.It.w+2*e.lineWidth,h.o),e.fillStyle=h.g.createLinearGradient(0,this.It._,0,this.It._+h.o,"#0003","#4b73ac30"),e.fillRect(n-e.lineWidth,this.It._,this.It.w+2*e.lineWidth,h.o),e.fillStyle=h.g.createLinearGradient(0,0,0,this.It._),e.fillRect(0,0,this.It.w+n,this.It._),this.Li=i}}xs(t){if(this.Si)t.drawImage(this.Si,-this.Ki,this.It._+.5,h.o*(this.Fi+1),h.o);else{const[t,s]=h.g._t(h.o*(this.Fi+1),h.o);for(let t=0;t<=this.Fi;t++)s.drawImage(h.g.images,32,0,16,16,t*h.o,0,h.o,h.o);this.Si=t}if(this.Ci)t.drawImage(this.Ci,-6,this.It._-h.o);else{const t=12+this.It.w,s=h.o,[i,e]=h.g._t(t,s);e.lineWidth=6,e.fillStyle="#5a3c2e",e.fillRect(0,0,this.It.w+2*e.lineWidth,18),e.fillStyle="#0002",e.fillRect(0,12,this.It.w+2*e.lineWidth,6),e.fillStyle="#fff1",e.fillRect(0,0,this.It.w+2*e.lineWidth,6);const n=this.It.w/h.o+1;for(let t=0;t<=n;t++){let s=t*h.o,i=18,n=h.o+1;e.fillStyle="#5a3c2e",e.fillRect(s,i,18,n),e.fillStyle="#0002",e.fillRect(s,i,6,n),e.fillStyle="#fff1",e.fillRect(s+12,i,6,n)}this.Ci=i}}update(t){super.update(t),this.Ki=this.Jt%25/25*h.o}},h.k.Ni=class extends h.k{constructor(){super()}};