let t,s,i;s=.3,t=(t=1,s=.05,h=220,e=0,n=0,r=.1,o=0,a=1,c=0,f=0,l=0,u=0,w=0,d=0,p=0,x=0,y=0,g=1,m=0,M=0,E=Math,k=44100,_=2*E.PI,A=(c*=500*_/k/k),b=(h*=(1-s+2*s*E.random(s=[]))*_/k),T=0,v=0,F=0,I=1,D=0,S=0,N=0,C,H)=>{for(f*=500*_/k**3,p*=_/k,l*=_/k,u*=k,w=k*w|0,H=(e=k*e+9)+(m*=k)+(n*=k)+(r*=k)+(y*=k)|0;F<H;s[F++]=N)++S%(100*x|0)||(N=o?1<o?2<o?3<o?E.sin((T%_)**3):E.max(E.min(E.tan(T),1),-1):1-(2*T/_%2+2)%2:1-4*E.abs(E.round(T/_)-T/_):E.sin(T),N=(w?1-M+M*E.sin(_*F/w):1)*(0<N?1:-1)*E.abs(N)**a*.3*t*(F<e?F/e:F<e+m?1-(F-e)/m*(1-g):F<e+m+n?g:F<H-y?(H-F-y)/r*g:0),N=y?N/2+(y>F?0:(F<H-y?1:(H-F)/y)*s[F-y|0]/2):N),T+=(C=(h+=c+=f)*E.cos(p*v++))-C*d*(1-1e9*(E.sin(F)+1)%2),I&&++I>u&&(h+=l,b+=l,I=0),!w||++D%w||(h=b,c=A,I||=1);return(t=i.createBuffer(1,H,k)).getChannelData(0).set(s),(h=i.createBufferSource()).buffer=t,h.connect(i.destination),h.start(),h},i=new AudioContext;const h={t:!0,i:"Arial, sans-serif",h:'"Times New Roman", serif',o:'"Courier New", monospace',l:60,u:96,p:48,g:1,m:2,M(t,s){let i=Math.min(t.x+t.w,s.x+s.w)-Math.max(t.x,s.x);i=i<0?0:i;let h=Math.min(t.y+t.k,s.y+s.k)-Math.max(t.y,s.y);return h=h<0?0:h,i*h},init(){h._.init(),h.A.init((()=>{h.A.level=new h.v.T,h.A.F()}))},I(t,s){return this.M(t,s)>Number.EPSILON}};window.addEventListener("load",(()=>h.init())),h.D=class{constructor(t=0,s=0){this.x=t,this.y=s}clone(){return new h.D(this.x,this.y)}length(){return this.x+this.y===0?0:Math.sqrt(this.x*this.x+this.y*this.y)}mul(t){return this.x*=t,this.y*=t,this}normalize(){const t=this.length();return t&&(this.x/=t,this.y/=t),this}set(t,s){this.x=t,this.y=s}sub(t){return this.x-=t.x,this.y-=t.y,this}},h.Audio={S:[.3,0,8,.01,.01,.01,1,2.29,86,,,,,,-82,,,.42,.01],N:[.2,0,68,.02,.01,.18,2,1.89,-.3,,,,,1.4,,.3,,.59,.06,.12],C:[.15,0,382,.1,.01,.09,,2.2,-1.2,-3.8,,,,5,,,,.48,.05],SELECT:[.2,0,883,.01,.07,,1,1.74,,,366,.1,.06,,,,,.62,.01],play(s){t(...s)}},h._={H:{L:1,P:2,R:3,S:4,K:5,C:6,O:10,B:11,G:12,X:13,U:14,W:15},Y:{},Z:{},j:{click:[],V:[],$:[]},q:{},J:{},tt:{},st:{},it:0,ht(){this.et={[this.H.L]:{keyboard:["Escape"],gamepad:[9]},[this.H.B]:{keyboard:["ArrowUp","KeyW","KeyZ","KeyY"],gamepad:[12]},[this.H.O]:{keyboard:["ArrowLeft","KeyA","KeyQ"],gamepad:[14]},[this.H.X]:{keyboard:["ArrowDown","KeyS"],gamepad:[13]},[this.H.G]:{keyboard:["ArrowRight","KeyD"],gamepad:[15]},[this.H.S]:{keyboard:["Space","Enter"],gamepad:[0,2]},[this.H.C]:{keyboard:["ShiftLeft","ShiftRight"],gamepad:[4,5]},[this.H.P]:{keyboard:["Space","Enter"],gamepad:[0,2]},[this.H.K]:{keyboard:["KeyE","CtrlLeft"],gamepad:[1,3]}}},nt(){let t=0,s=0;if(this.rt(this.H.O)?t=-1:this.rt(this.H.G)&&(t=1),this.rt(this.H.B)?s=-1:this.rt(this.H.X)&&(s=1),!t||!s){const i=.3;for(const h in this.tt){const e=this.tt[h];e.axes[0]&&Math.abs(e.axes[0])>i?t=e.axes[0]>0?1:-1:e.axes[2]&&Math.abs(e.axes[2])>i&&(t=e.axes[2]>0?1:-1),e.axes[1]&&Math.abs(e.axes[1])>i?s=e.axes[1]>0?1:-1:e.axes[3]&&Math.abs(e.axes[3])>i&&(s=e.axes[3]>0?1:-1)}}return{x:t,y:s}},ot(t){return this.et[t]},init(){this.ht(),this.ct()},rt(t,s){const i=this.ot(t);for(const t of i.keyboard)if(this.ft(t,s))return!0;for(const t of i.gamepad)if(this.lt(t,s))return!0;if(t===this.H.O)for(const t in this.tt){const i=this.tt[t];if(i.axes[6]&&i.axes[6]<=-.2)return!this.Z["ut"]&&(s&&(this.Z["ut"]=!0),!0)}else if(t===this.H.G)for(const t in this.tt){const i=this.tt[t];if(i.axes[6]&&i.axes[6]>=.2)return!this.Z["wt"]&&(s&&(this.Z["wt"]=!0),!0)}else if(t===this.H.B)for(const t in this.tt){const i=this.tt[t];if(i.axes[7]&&i.axes[7]<=-.2)return!this.Z["dt"]&&(s&&(this.Z["dt"]=!0),!0)}else if(t===this.H.X)for(const t in this.tt){const i=this.tt[t];if(i.axes[7]&&i.axes[7]>=.2)return!this.Z["xt"]&&(s&&(this.Z["xt"]=!0),!0)}return!1},lt(t,s){for(const i in this.tt){const h=this.tt[i].buttons[t];if(h&&h.pressed)return!this.Z[t]&&(s&&(this.Z[t]=!0),!0)}return!1},ft(t,s){const i=this.st[t];return!(!i||!i.time)&&(s&&(i.time=0,i.yt=!0),!0)},gt(t,s){if("function"!=typeof s)return void(this.j[t]=[]);const i=this.j[t].indexOf(s);i>=0&&this.j[t].splice(i,1)},Mt(t,s){this.j[t].push(s)},Et(t,s){const i=this.q[t]||[];i.push(s),this.q[t]=i},kt(t,s){const i=this.J[t]||[];i.push(s),this.J[t]=i},ct(){document.body.onkeydown=t=>{const s=this.st[t.code];s&&s.yt||(this.st[t.code]={time:Date.now()},this.q[t.code]&&this.q[t.code].forEach((t=>t())))},document.body.onkeyup=t=>{this.st[t.code]={time:0},this.J[t.code]&&this.J[t.code].forEach((t=>t()))},window.addEventListener("gamepadconnected",(t=>{this.it++,this.tt[t.gamepad.index]=t.gamepad,this.j.V.forEach((t=>t()))})),window.addEventListener("gamepaddisconnected",(t=>{this.it--,delete this.tt[t.gamepad.index],this.j.$.forEach((t=>t()))}))},update(){const t=navigator.getGamepads();for(const s of t)if(s){this.tt[s.index]=s;for(const t in this.Z)"axis6-"===t||"axis6+"===t?s.axes[6]||delete this.Z[t]:"axis7-"===t||"axis7+"===t?s.axes[7]||delete this.Z[t]:s.buttons[t]&&!s.buttons[t].pressed&&delete this.Z[t]}}},h.A={_t:new h.D,scale:1,At:0,bt:0,Tt(t,s,i,h=0){const[e,n]=this.vt(32,32);n.drawImage(this.images,h,s,32,16,0,0,32,16),i&&i.Ft(n);let r=n.getImageData(0,0,32,16);for(let s=0;s<r.data.length;s+=4){r.data[s]+r.data[s+1]+r.data[s+2]===765&&(r.data[s+0]=t[0],r.data[s+1]=t[1],r.data[s+2]=t[2])}n.putImageData(r,0,0),n.putImageData(r,0,16),r=n.getImageData(0,16,32,16);for(let t=0;t<r.data.length;t+=4){0!==r.data[t+3]&&(r.data[t+0]=255,r.data[t+1]=255,r.data[t+2]=255)}return n.putImageData(r,0,16),e},It(t){const s=t.Dt();if(this.At=this._t.x-s.x,this.bt=(this._t.y-s.y)*this.scale,t.level){const s=t.level.St;this.At=Math.min(0,Math.max(-s.w+2*this._t.x,this.At))}this.At*=this.scale},Nt(t){this.level=t},clear(){this.Ct.setTransform(1,0,0,1,0,0),this.Ct.clearRect(0,0,window.innerWidth,window.innerHeight),this.Ht.setTransform(1,0,0,1,0,0),this.Ht.clearRect(0,0,window.innerWidth,window.innerHeight)},createLinearGradient(t,s,i,h,e="#0003",n="#fff1"){const r=this.Ct.createLinearGradient(t,s,i,h);return r.addColorStop(0,e),r.addColorStop(1,n),r},Lt(){this.clear(),this.Ct.setTransform(this.scale,0,0,this.scale,this.At,this.bt),this.Ht.setTransform(this.scale,0,0,this.scale,0,0),this.level&&this.level.Lt()},Pt(){this.Ht.setTransform(1,0,0,1,0,0),this.Ht.clearRect(0,0,window.innerWidth,window.innerHeight),this.Ht.setTransform(this.scale,0,0,this.scale,0,0),this.Ht.fillStyle="rgba(0,0,0,0.4)",this.Ht.fillRect(0,0,this.Rt.width/this.scale,this.Rt.height/this.scale),this.Ht.fillStyle="#FFF",this.Ht.font="56px "+h.i,this.Ht.textAlign="center",this.Ht.textBaseline="top",this.Ht.fillText("GAME OVER",this._t.x,this._t.y-56)},Kt(t,s,i){let e=9*h.u,n=2*h.u,r=this._t.x-e/2,o=this._t.y-n/2;1===i?o=2*this._t.y-n-h.u:2===i&&(o=h.p),this.Ht.fillStyle="#0004",this.Ht.fillRect(r-12,o-12,e+24,n+24),this.Ht.fillStyle="#444",this.Ht.fillRect(r,o,e,n),this.Ht.drawImage(t.images,0,0,16,16,r,o+.25*h.u,1.75*h.u,1.75*h.u),this.Ht.lineWidth=12,this.Ht.strokeStyle="#847e87",this.Ht.strokeRect(r+6,o+6,2*h.u-12,2*h.u-12),this.Ht.fillStyle="#fff",this.Ht.font="600 31px "+h.o,this.Ht.textAlign="left",this.Ht.textBaseline="alphabetic";let a=r+28,c=o+48;s.forEach((t=>{this.Ht.fillText(t,a+2*h.u,c),c+=38}))},Ot(){this.Ht.setTransform(1,0,0,1,0,0),this.Ht.clearRect(0,0,window.innerWidth,window.innerHeight),this.Ht.setTransform(this.scale,0,0,this.scale,0,0),this.Ht.fillStyle="rgba(0,0,0,0.4)",this.Ht.fillRect(0,0,this.Rt.width/this.scale,this.Rt.height/this.scale),this.Ht.fillStyle="#FFF",this.Ht.font="56px "+h.i,this.Ht.textAlign="center",this.Ht.textBaseline="top",this.Ht.fillText("PAUSED",this._t.x,this._t.y-56)},Bt(){this.Ct.fillRect(-this.At/this.scale-h.u,-this.bt/this.scale-h.u,this.Gt.width/this.scale+2*h.u,this.Gt.height/this.scale+2*h.u)},vt(t,s){const i=document.createElement("canvas");i.width=t,i.height=s;const h=i.getContext("2d",{alpha:!0});return h.imageSmoothingEnabled=!1,[i,h]},init(t){this.Gt=document.getElementById("c"),this.Ct=this.Gt.getContext("2d",{alpha:!0}),this.Ct.imageSmoothingEnabled=!1,this.Rt=document.getElementById("ui"),this.Ht=this.Rt.getContext("2d",{alpha:!0}),this.Ht.imageSmoothingEnabled=!1,this.Xt((()=>{this.ct(),t()}))},Xt(t){const s=new Image;s.onload=()=>{this.images=s;const[i,e]=this.vt(5,3);let n=new ImageData(5,3);n.data.set([255,255,255,196,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,196,0,0,0,0,255,255,255,196,255,255,255,255,255,255,255,196,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,196,0,0,0,0,0,0,0,0]),e.putImageData(n,0,0),this.Ut=i,this.Wt=this.Tt([255,255,0],16,h.zt),this.Yt=this.Tt([255,0,0],16,h.Zt),this.jt=this.Tt([127,0,0],16,h.Vt),this.$t=this.Tt([0,0,0],48),this.qt=this.Tt([255,255,255],32),this.Qt=this.Tt([0,0,0],48,null,32);const[r,o]=this.vt(h.u,h.u);o.drawImage(this.images,16,0,16,16,0,0,h.u,h.u),this.Jt=o.createPattern(r,"repeat");const[a,c]=h.A.vt(h.u,h.u),f=c.createRadialGradient(h.p,h.p,0,h.p,h.p,h.p);f.addColorStop(0,"#000a"),f.addColorStop(.9,"#0002"),f.addColorStop(1,"#0000"),c.fillStyle=f,c.fillRect(0,0,h.u,h.u),this.ts=a,t()},s.src="i.png"},F(t=0){if(h._.update(),t&&this.ss){const s=(t-this.ss)/(1e3/h.l);if(this.Ct.imageSmoothingEnabled=!1,this.Ht.imageSmoothingEnabled=!1,this.Ct.lineWidth=1,this.Ct.textBaseline="alphabetic",this.hs)return void this.Ot();this.level.update(s),this.Lt(),h.t&&(this.Ht.fillStyle="#fff",this.Ht.font="600 16px "+h.o,this.Ht.textAlign="left",this.Ht.fillText(~~(h.l/s)+" FPS, "+Math.round(1e3*this.scale)/1e3,h.u,this.Gt.height/this.scale-h.u))}this.ss=t,requestAnimationFrame((t=>this.F(t)))},pause(){this.hs=!0},ct(){window.addEventListener("resize",(t=>this.resize())),this.resize();const t=h._.ot(h._.H.L);setInterval((()=>{this.hs&&h._.update(),t.gamepad.forEach((t=>{h._.lt(t,!0)&&this.es()}))}),100);const s=()=>this.es();t.keyboard.forEach((t=>h._.kt(t,s))),h._.Mt("gp_disconnect",(()=>this.pause()))},ns(){this.level=new this.level.constructor},resetTransform(){this.Ct.setTransform(this.scale,0,0,this.scale,this.At,this.bt)},resize(){const t=1920/1080;let s=window.innerHeight,i=Math.round(s*t);i>window.innerWidth&&(i=window.innerWidth,s=i/t),this.scale=s/1080,this._t.x=i/2/this.scale,this._t.y=s/2/this.scale;let h=~~((window.innerHeight-s)/2)+"px",e=~~((window.innerWidth-i)/2)+"px";this.Gt.width=i,this.Gt.height=s,this.Gt.style.top=h,this.Gt.style.left=e,this.Rt.width=i,this.Rt.height=s,this.Rt.style.top=h,this.Rt.style.left=e,this.hs&&(clearTimeout(this.rs),this.rs=setTimeout((()=>this.Ot()),100))},os(t,s,i){t.translate(i.x,i.y),t.rotate(s),t.translate(-i.x,-i.y)},cs(t,s,i,h){t.translate(h.x,h.y),t.scale(s,i),t.translate(-h.x,-h.y)},es(){this.hs?this.unpause():this.pause()},unpause(){this.hs&&(this.hs=!1,this.F())}},h.fs=class{constructor(t,s=0){this.level=t,this.set(s)}ls(){return this.level.us>this.timeEnd}ws(){return Math.min(1,1-(this.timeEnd-this.level.us)/this.duration)}set(t){this.duration=t*h.l,this.timeEnd=this.level.us+this.duration}},h.v=class{constructor(){this.St={},this.us=0,this.ds=[],this.ps=[],this.items=[]}xs(t,s){if(h.A.It(t),t.ys||t.gs)t.update(s);else{h._.rt(h._.H.C,!0)?t.Ms():h._.rt(h._.H.S,!0)&&t.attack();let i=h._.nt();i=new h.D(i.x,i.y),t.update(s,i.normalize());const e=t.Es();this.items.forEach((s=>{s.ks=!1,s._s&&h.I(s.Es(),e)&&(s.ks=!0,h._.rt(h._.H.K,!0)&&t.As(s))}))}}bs(...t){this.ps.push(...t),this.Ts(...t)}vs(...t){this.items.push(...t),this.Ts(...t)}Ts(...t){t.forEach((t=>t.level=this)),this.ds.push(...t)}removeItem(t){let s=this.items.indexOf(t);s>=0&&this.items.splice(s,1),s=this.ds.indexOf(t),s>=0&&this.ds.splice(s,1)}Lt(){this.Fs&&this.Fs(h.A.Ct),this.ds.forEach((t=>t.Lt(h.A.Ct))),this.Is&&this.Is(h.A.Ct),this.Ds&&h.A.Pt()}Ss(t,s){const i=h.A;if(!this.Ns){const[t,s]=i.vt(2*i._t.x+2*h.u,2*i._t.y+2*h.u);s.fillStyle=i.Jt,s.fillRect(0,0,t.width,t.height),this.Ns=t}let e=Math.ceil(-i.At/i.scale/h.u)*h.u,n=Math.ceil(-i.bt/i.scale/h.u)*h.u;t.drawImage(this.Ns,e-h.u-s,n-h.u)}update(t){if(this.us+=t,this.Ds)h._.rt(h._.H.P,!0)&&h.A.ns();else if(!this.locked){const s=this.Cs;if(s){if(s.Hs<=0)return void(this.Ds=!0);this.xs(s,t)}this.ds.sort(((t,s)=>t.Ls()-s.Ls())),this.ds.forEach((i=>{i!==s&&(i.update(t),s?.gs&&i.Hs>0&&i.Ps()&&s.item.Rs(i)&&i.Ks(s.item),i.action||h.Bs.Os(i,s))}))}}},h.Gs=class{constructor(t={}){this.Xs=new h.D(t.x,t.y),this.w=t.w||0,this.k=t.k||0,this.Us=0,this.Ws={},this.zs=[],this.Ys=t.Ys||1,this.Hs=this.Zs=1/0,this.speed=new h.D(4,4),this.state=h.g,this.weight=0}js(t){for(let s=this.zs.length-1;s>=0;s--){(0,this.zs[s])(t)&&this.zs.splice(s,1)}}Ps(){return(!this.Vs||this.Vs.ls())&&!this.ys}Lt(){}$s(t,s){if(!this.level||this.qs)return;this.Xs.x=Math.min(this.level.St.w-this.w,Math.max(0,this.Xs.x)),this.Xs.y=Math.min(this.level.St.k-this.k-8,Math.max(-h.p,this.Xs.y));const i=this.Xs.clone().sub(t);i.x=i.x<0?-i.x:i.x,i.y=i.y<0?-i.y:i.y;const e=this.Es();this.level.ds.forEach((n=>{if(n===this||!n.Qs||n.Hs<=0)return;if(n instanceof h.Js&&this.ys)return;const r=n.Es(),o=h.M(e,r);o>Number.EPSILON&&(s&&o>=8?this.Xs.set(i.x>0?r.x+r.w:r.x-e.w,t.y):this.Xs.set(t.x,t.y))}))}Es(){return{x:this.Xs.x,y:this.Xs.y,w:this.w,k:this.k}}Dt(){return{x:this.Xs.x+this.w/2,y:this.Xs.y+this.k/2}}ti(t,s,i){if(this.Ws.si&&this!==this.level?.Cs)return i;const e=this.Xs.clone();return this.Xs.x+=Math.round(s*t.x*this.speed.x),this.Xs.y+=Math.round(s*t.y*this.speed.y),(t.x||t.y)&&(i=h.m,this.Ys=0==t.x?this.Ys:t.x>0?1:-1),this.$s(e),i}Ls(){return this.Xs.y+this.k}ii(){if(!this.Vs||this.Vs.ls())return!1;const t=this.Vs.ws();return t>=0&&t<=.2||t>=.4&&t<=.6||t>=.8&&t<=1}Ks(t){if(!this.Ps())return;this===this.level.Cs&&h.Audio.play(h.Audio.N),this.Vs=this.Vs||new h.fs(this.level),this.Vs.set(.5),this.Hs=Math.max(0,this.Hs-t.hi);const s=t.ei(this);s&&this.zs.push(s),this.Hs<=0&&this.ni&&this.ni()}update(t,s){if(this.Hs<=0||this.ri)return;let i=h.g;this.Us+=t,this.js(t),s&&(i=this.ti(s,t,i)),this.state!=i&&(this.Us=0),this.state=i}},h.oi=class extends h.Gs{constructor(t={}){t.w=h.u,t.k=h.u,super(t),this.images=h.A.Qt,this.Hs=this.Zs=50,this.Qs=!0,this.weight=h.u}Lt(t){if(this.Hs<=0)return;let s=this.ii()?16:0;t.drawImage(this.images,0,s,16,16,this.Xs.x,this.Xs.y,this.w,this.k)}update(t){super.update(t),this.Qs=this.Hs>0}},h.Js=class extends h.Gs{constructor(t={}){t.w=h.u,t.k=h.u,super(t),this.ai=42/h.l,this.images=h.A.Wt,this.Hs=this.Zs=100,this.Qs=!0,this.item=t.item,this.speed.set(12,12),this.item&&(this.item.ri=this)}ci(t,s){h.A.cs(t,s,1,this.Dt())}fi(t){h.A.os(t,.1*Math.sin(this.Us*this.ai),this.Dt())}li(t){if(this.Hs==this.Zs||this.ys)return;let s=this.Hs/this.Zs,i=this.Xs.x+16,h=this.Xs.y-24,e=this.w-32;t.fillStyle="#000",t.fillRect(i,h,e,8),t.fillStyle="#f00",t.fillRect(i,h,e*s,8)}ui(t){const s=this.Ys<0;s&&this.ci(t,-1),this.item?.Lt(t),s&&this.ci(t,-1)}wi(t){t.drawImage(h.A.ts,this.Xs.x,this.Xs.y+this.k-12,this.w,24)}attack(){return!(this.gs||this.ys||!this.item||this.Ws?.si)&&(h.Audio.play(h.Audio.S),this.di=this.di||new h.fs(this.level),this.di.set(this.item.pi),this.gs=!0,!0)}Ms(){return!this.ys&&!this.Ws?.si&&(h.Audio.play(h.Audio.C),this.xi=this.xi||new h.fs(this.level),this.xi.set(.5),this.yi=this.Xs.clone(),this.ys=!0,!0)}Lt(t){if(this.Hs<=0)return;let s=this.Ys<0?16:0,i=0,e=this.images;if(this.wi(t),this.ys){let s=360*this.xi.ws()*3*Math.PI/180;this.Ys<0&&(s=-s),h.A.os(t,s,this.Dt())}else this.ii()&&(i=16),this.state===h.m&&this.fi(t);this.item&&this.ui(t,e),this.li(t),t.drawImage(e,s,i,16,16,this.Xs.x,this.Xs.y,h.u,h.u),h.A.resetTransform()}static Ft(t){t.fillStyle="#000";let s=11;t.fillRect(s,6,1,4),t.fillRect(s-2,6,1,4),t.fillRect(s-4,6,1,4),s=21,t.fillRect(s,6,1,4),t.fillRect(s+2,6,1,4),t.fillRect(s+4,6,1,4)}ni(){this.item?.gi(),this.Hs>0?(this.item=new h.mi,this.item.ri=this):this.item=null}Es(){const t={x:this.Xs.x+16,y:this.Xs.y+this.k,w:this.w-32,k:h.p/2};return t.y-=t.k,t}As(t){t.ri||(this.item?.gi(),this.item=t,t.ks=!1,t.ri=this,this.level.removeItem(t))}update(t,s){if(this.Hs<=0)return;let i=h.g;this.Us+=t,this.js(t),this.ys?this.xi.ls()?(this.ys=!1,this.$s(this.yi,!0)):(s=new h.D(this.Ys<0?-1:1,0),this.ti(s,t,i)):s&&(i=this.ti(s,t,i)),this.action&&(i=this.action(t)||i),this.state!=i&&(this.Us=0),this.gs&&this.di.ls()&&(this.gs=!1),this.state=i}},h.Bs={Mi(t,s){if(!t.item||!t.item.Rs(s))return!1;if(t.Ei&&!t.Ei.ls())return!0;const i=new h.fs(t.level,.3);return t.action=function(){i.ls()&&(t.gs&&t.di&&t.di.ls()?t.action=null:t.gs||(t.attack(),s.Ks(t.item),t.Ei=t.Ei||new h.fs(t.level),t.Ei.set(.8)))},!0},ki(t,s){if(!(t instanceof h.Zt)||Math.random()<.8)return!1;if(t._i&&!t._i.ls())return!1;const i=t.Dt(),e=s.Dt(),n=new h.D(e.x-i.x,e.y-i.y);return!(Math.abs(n.y)>h.p||n.length()>2*h.u)&&(t.Ys=n.x<0?-1:1,t.speed.set(11,11),t.Ms(),t._i=t._i||new h.fs(t.level),t._i.set(1.5),t.action=function(){t.ys||(t.speed.set(3,3),t.action=null)},!0)},Ai(t){if(t.item&&!(t.item instanceof h.mi))return!1;let s=1/0,i=null,e=null;const n=t.Dt(),r=t.Es(),o=new h.D;for(let a=0;a<t.level.items.length;a++){const c=t.level.items[a];if(c instanceof h.bi){const a=c.Es();if(h.I(a,r)){const s=new h.fs(t.level,.5);return t.action=function(){s.ls()&&(t.As(c),t.action=null)},!0}o.set(a.x+a.w/2-n.x,a.y+a.k/2-n.y);const f=o.length();f<3*h.u&&s>f&&(s=f,i=o.clone(),e=c)}}if(!e)return!1;const a=new h.fs(t.level,.5);return i.normalize().mul(.5),t.action=function(s){if(a.ls())t.action=null;else if(!t.Ws.si)return t.ti(i,s,0)},!0},Ti(t,s){const i=t.Dt(),e=s.Dt(),n=new h.D(e.x-i.x,e.y-i.y);if(n.length()>7*h.u)return!1;const r=new h.fs(t.level,1);return n.normalize(),t.action=function(s){if(r.ls())t.action=null;else if(!t.Ws.si)return t.ti(n,s,0)},!0},Os(t,s){!s||t instanceof h.vi||!(t instanceof h.Js)||t.Ws.si||t.gs||t.ys||s.Hs<=0||this.Ai(t)||this.ki(t,s)||this.Mi(t,s)||this.Ti(t,s)}},h.bi=class extends h.Gs{constructor(t){super(t)}Fi(){const t=h.A,s=this.Es(),i=t.At/t.scale,e=t.bt/t.scale,n=Math.sin(t.level.us/25);let r=s.x+s.w/2+i-15,o=s.y-1.5*h.p+e;t.Ht.drawImage(t.Ut,r,o+8*n,30,18),t.Ht.fillStyle="#fff";let a=2*n;r=s.x-6+i-a,o=s.y+s.k+e+a,t.Ht.fillRect(r,o,6,12),t.Ht.fillRect(r,o+6,12,6),r=s.x+s.w+i+a,o=s.y-6+e-a,t.Ht.fillRect(r-6,o,12,6),t.Ht.fillRect(r,o,6,12)}Ii(){this.ri&&this.Xs.set(this.ri.Xs.x-h.p,this.ri.Xs.y+this.ri.k)}gi(){this._s&&(this.Ii(),this.ri?.level.vs(this)),this.ri=null}ei(){return null}Ls(){return this.Xs.y}},h.Di=class extends h.Js{constructor(t={}){t.item=t.item||new h.mi,super(t),this.images=h.A.Yt,this.ai=32/h.l,this.speed.set(3,3)}Ks(t){this.Hs<=0||super.Ks(t)}},h.Zt=class extends h.Di{static Ft(t){t.fillStyle="#000";let s=6;t.fillRect(s,7,6,1),t.fillRect(s+2,7,3,2),s=20,t.fillRect(s,7,6,1),t.fillRect(s+1,7,3,2)}},h.Vt=class extends h.Zt{constructor(t){super(t),this.Hs=this.Zs=300,this.images=h.A.jt}static Ft(t){t.fillStyle="#000";let s=7;t.fillRect(s,6,3,1),t.fillRect(s+1,6,2,2),t.fillRect(s+2,6,1,3),t.fillRect(s+4,6,1,3),t.fillRect(s+4,6,2,2),s=20,t.fillRect(s,6,2,2),t.fillRect(s+1,6,1,3),t.fillRect(s+3,6,1,3),t.fillRect(s+3,6,2,2),t.fillRect(s+3,6,3,1)}li(){}},h.Si=class extends h.Di{constructor(t={}){super(t),this.images=h.A.qt,this.speed.set(4,4)}},h.vi=class extends h.Di{constructor(t){super(t),this.images=h.A.$t,this.Hs=this.Zs=300}ni(){this.item?.gi(),this.item=null}Ks(t){this.Hs<=0||super.Ks(t)}},h.zt=class extends h.Js{constructor(t={}){t.item=t.item||new h.mi,super(t),this.Hs=this.Zs=1/0}attack(){return!(this.Ei&&!this.Ei.ls())&&(!!super.attack()&&(this.Ei=this.Ei||new h.fs(this.level),this.Ei.set(.65),!0))}Ms(){return!(this._i&&!this._i.ls())&&(!!super.Ms()&&(this._i=this._i||new h.fs(this.level),this._i.set(.8),!0))}},h.mi=class extends h.bi{constructor(t={}){super(t),this.pi=.2,this.hi=10}Rs(t){if(!this.ri)return!1;const s={x:this.ri.Xs.x+this.ri.w,y:this.ri.Xs.y+h.p/2,w:h.p,k:h.p};this.ri.Ys<0&&(s.x-=this.ri.w+s.w);const i={x:t.Xs.x,y:t.Xs.y,w:t.w,k:t.k};return h.I(i,s)}Lt(t){if(!this.ri?.gs)return;let s=this.ri.Xs.x+this.ri.w-32,i=this.ri.Xs.y+this.ri.k/2-16,e=this.ri.di.ws();s+=e*e*h.p*1.5,t.globalAlpha=Math.min(1,e+.5),t.drawImage(h.A.images,40,16,8,8,s,i,h.p,h.p),t.globalAlpha=1}ei(t){if(!(t instanceof h.Js))return;const s=new h.fs(this.ri.level,.4);return t.Ws.si=!0,t.ni(),function(){return!!s.ls()&&(t.Ws.si=!1,!0)}}},h.Ni=class extends h.bi{constructor(t={}){t.w=t.w||h.p,t.k=t.k||2*h.u,super(t),this.pi=.25,this._s=!0,this.hi=34,this.Ci=1.35*h.u}Ii(){this.ri&&(this.Xs.x=this.ri.Xs.x-h.p,this.Xs.y=this.ri.Xs.y-this.ri.k+this.k/2,this.ri.Ys>0&&(this.Xs.x+=1.5*h.p+this.ri.w))}Rs(t){if(!this.ri)return!1;const s=[{x:this.ri.Xs.x+this.ri.w,y:this.ri.Xs.y,w:1.7*h.u,k:h.u},{x:this.ri.Xs.x+this.ri.w,y:this.ri.Xs.y-.7*h.u,w:h.u,k:2.4*h.u}];this.ri.Ys<0&&(s[0].x-=this.ri.w+s[0].w,s[1].x-=this.ri.w+s[1].w);const i={x:t.Xs.x,y:t.Xs.y,w:t.w,k:t.k};for(let t=0;t<s.length;t++)if(h.I(i,s[t]))return!0;return!1}Lt(t){let s=this.Xs.x,i=this.Xs.y;this.ri&&(s=this.ri.Xs.x+h.p,i=this.ri.Xs.y-h.u-16);let e=0,n={x:s+this.w/2,y:i+this.k/2};if(this.ri){if(this.ri?.gs){n.x=s+this.w/2,n.y=i+this.k;let t=this.ri.di.ws();const h=Math.PI;t<=.4?(t/=.4,e=t*h):e=t<=.8?h:0}}else e=80*Math.PI/180;e&&h.A.os(t,e,n),t.drawImage(h.A.images,32,16,8,32,s,i,this.w,this.k),e&&this.ri?.gs&&h.A.os(t,-e,n),this.ri||(h.A.resetTransform(),this.ks&&this.Fi(t))}ei(t){if(!t.Qs)return;const s=t.Xs.clone(),i=this.ri.Dt(),e=t.Dt(),n=new h.D(e.x-i.x,e.y-i.y);n.normalize();const r=new h.fs(this.ri.level,.5),o=Math.max(0,this.Ci-t.weight);return t.Ws.si=!0,function(){if(r.ls())return t.Ws.si=!1,!0;const i=r.ws(),h=t.Xs.clone();return t.Xs.set(s.x+n.x*o*i,s.y+n.y*o*i),t.$s(h),!1}}Es(){return{x:this.Xs.x-1.5*this.w,y:this.Xs.y+1.5*this.w,w:this.k,k:this.w}}},h.Hi=class extends h.Ni{constructor(t={}){t.w=30,t.k=70,super(t),this.pi=.2,this.hi=20,this.Ci=.8*h.u}Ii(){this.ri&&(this.Xs.x=this.ri.Xs.x-this.w/2,this.Xs.y=this.ri.Xs.y+this.ri.k-this.k/2,this.ri.Ys>0&&(this.Xs.x+=this.ri.w+this.w/2-16))}Rs(t){if(!this.ri)return!1;const s={x:this.ri.Xs.x+this.ri.w-24,y:this.ri.Xs.y-16,w:.7*h.u+24,k:.7*h.u+16};this.ri.Ys<0&&(s.x-=this.ri.w+s.w-48);const i={x:t.Xs.x,y:t.Xs.y,w:t.w,k:t.k};return h.I(i,s)}Lt(t){let s=this.Xs.x,i=this.Xs.y;this.ri&&(s=this.ri.Xs.x+this.ri.w-26,i=this.ri.Xs.y-8);let e=0,n={x:s+this.w/2,y:i+this.k/2};if(this.ri){if(this.ri?.gs){n.x=s+this.w/2,n.y=i+this.k;let t=this.ri.di.ws();const h=75*Math.PI/180;t<=.4?(t/=.4,e=t*h):e=t<=.8?h:0}}else e=55*Math.PI/180;e&&h.A.os(t,e,n),t.drawImage(h.A.images,40,32,6,14,s,i,this.w,this.k),e&&this.ri?.gs&&h.A.os(t,-e,n),this.ri||(h.A.resetTransform(),this.ks&&this.Fi(t))}Es(){return{x:this.Xs.x-36,y:this.Xs.y,w:this.w+56,k:this.k}}},h.v.Li=class extends h.v{constructor(){super(),this.Pi=0,this.Ri=2}Ki(t,s,i,e,n){if(n){let s=h.p/2,n=h.u,r=i-96,o=e-n/2,a={x:r+s/2,y:o+n/2};h.A.os(t,Math.PI/2,a),h.A.cs(t,Math.sin(.08*this.us),1,a),t.drawImage(h.A.images,32,16,8,32,r,o,s,n),h.A.resetTransform()}t.fillStyle=n?"#fa0":"#777",t.textBaseline="middle",t.fillText(s,i,e)}Lt(){const t=h.A.Ct;let s=Math.max(2*h.u,h.A._t.x-500),i=Math.max(2*h.u,h.A._t.y-128);t.fillStyle="#0d161e",h.A.Bt(),t.font="600 64px "+h.i,t.textAlign="left",t.fillStyle="#fa0",t.fillText("TREASURE OF THE NIBELUNGS",s,i+3),t.fillStyle="#777",t.fillText("TREASURE OF THE NIBELUNGS",s,i),t.font="42px "+h.i,s+=h.p/2+114,i+=96,this.Ki(t,"New Game",s,i,0===this.Pi),i+=72,this.Ki(t,"Continue",s,i,1===this.Pi)}update(t){this.us+=t,h._.rt(h._.H.B,!0)?this.Pi--:h._.rt(h._.H.X,!0)?this.Pi++:h._.rt(h._.H.P,!0)&&(h.Audio.play(h.Audio.SELECT),0===this.Pi&&(h.A.level=new h.v.Oi)),this.Pi<0?this.Pi=this.Ri-1:this.Pi>=this.Ri&&(this.Pi=0)}},h.v.Bi=class extends h.v{constructor(){super(),this.St={w:2*h.A._t.x,k:8*h.u};const t=new h.zt({x:6*h.u,y:3*h.u,item:new h.mi}),s=new h.vi({x:13*h.u,y:3*h.u,item:new h.Ni});this.bs(t,s),this.Cs=t,this.Gi=s,this.locked=!0,this.Xi=-1,this.Ui=new h.fs(this,6)}Lt(){super.Lt();const t=h.A.Ct;t.font="600 23px "+h.o,t.fillStyle="#fffc",t.textAlign="center";const s=this.Cs,i=s.Dt(),e=this.Gi.Dt();if(0===this.Xi)t.fillText("Move with [W][A][S][D] or arrow keys",i.x,i.y-s.k);else if(1===this.Xi)t.fillText("Attack with [ENTER] or [SPACE]",e.x,e.y-2*this.Gi.k);else if(2===this.Xi){const s=this.items[0];if(s){const i=s.Es();t.fillText("Pick up with [E]",i.x+i.w/2,i.y-i.k-h.p-8)}}else 3===this.Xi?t.fillText("Attack with the sword",e.x,e.y-this.Gi.k):4===this.Xi&&t.fillText("You can dodge roll with [SHIFT]",i.x,i.y-s.k-h.u)}Fs(t){const s=this.Cs,i=this.Gi,e=this.items[0];if(t.fillStyle="#222",t.fillRect(s.Xs.x-h.p,s.Xs.y+s.k-h.p,2*h.u,h.u),i.Hs>0&&t.fillRect(i.Xs.x-h.p,i.Xs.y+i.k-h.p,2*h.u,h.u),e){const s=e.Es();t.fillRect(s.x-h.p,s.y+s.k-1.5*h.p,3*h.u,1.25*h.u)}}Is(t){const s=h.A;if(this.Xi<0&&s.Kt(this.Cs,["Before heading out, let’s","think back on my training.","How did it go again?"],2),5!==this.Xi)return;s.Kt(this.Cs,["Right, that’s how it goes!","Now I am prepared!"],2);const i=Math.sin(this.us/25);let e=this.St.w-h.u+8*i,n=this.St.k/2+9;const r={x:e,y:n};t.fillStyle="#fff",t.textAlign="right",t.fillText("Continue",e-22,n-8);let o=-Math.PI/2;s.os(t,o,r),t.drawImage(s.Ut,e,n,30,18),s.os(t,-o,r)}update(t){const s=this.Cs,i=h._;if(-1===this.Xi)h.A.It(s),i.rt(i.H.P,!0)&&this.Ui.set(0),this.Ui.ls()&&(this.locked=!1,this.Xi=0);else if(0===this.Xi)i.rt(i.H.S,!0),this.Wi?this.Wi.ls()&&(this.Xi=1):(i.rt(i.H.B)||i.rt(i.H.G)||i.rt(i.H.X)||i.rt(i.H.O))&&(this.Wi=new h.fs(this,3));else if(1===this.Xi){if(!(this.Gi.item instanceof h.Ni)){const t=this.items[0];t.Xs.x=this.Gi.Xs.x+2*h.u,t.Xs.y+=h.p,this.Xi=2}}else if(2===this.Xi)s.item instanceof h.Ni&&(this.Xi=3);else if(3===this.Xi)this.Gi.Hs<this.Gi.Zs-s.item.hi&&(this.Xi=4);else if(4===this.Xi)i.rt(i.H.C)&&(this.Xi=5);else if(5===this.Xi){if(s.Dt().x>=this.St.w-h.p)return void h.A.Nt(new h.v.zi)}super.update(t)}},h.v.Oi=class extends h.v{constructor(){super(),this.Yi=["Ez enwas niht anders","wan gestéinẹ unde golt.","unt ob man al die werlde","het dâ von versolt,","sîn wǽré niht mínner","einer marke wert."],this.Zi=["Ê daz der künee rîche","wider wære komen,","die wîle hete Hagene","den schaz vil gar genomen.","","er sanctẹ in dâ ze Lôche","allen in den Rîn.","er wandẹ er soldẹ in niezen:","des enkunde niht gesîn."],this.ji=["The legendary treasure of the Nibelungs:","Gems and gold more than one could ever hope to spent.","","While the king and his men where away, Hagen stole it","all and sunk the treasure in the Rhine at Lochheim.","But he was killed before being able to retrieve the riches.","","Betting on its the existance,","many set off to look for the treasure."],this.Vi=0,this.$i=new h.fs(this,2);this.Yi.concat(this.Zi).forEach((t=>{const s=h.A.Ct.measureText(t);this.Vi=Math.max(this.Vi,s.width)}))}Lt(){const t=h.A.Ct;t.fillStyle="#0d161e",h.A.Bt();let s=2*h.u,i=s,e=this.Vi+h.u,n=49*(this.Yi.length+this.Zi.length)+1.5*h.u+16;if(t.fillStyle="#e5c382",t.fillRect(s-h.p,i-h.u,e,n),t.font="italic 40px "+h.h,t.textAlign="center",t.fillStyle="#000",s+=this.Vi/2,!this.$i.ls()){const s=this.$i.ws();i+=(1-s)*h.p,t.fillStyle="#000000"+Math.round(255*s).toString(16).padStart(2,"0")}if(this.Yi.forEach((h=>{t.fillText(h,s,i),i+=49})),this.$i.ls()){if(i+=49,!this.qi.ls()){const s=this.qi.ws();i+=(1-s)*h.p,t.fillStyle="#000000"+Math.round(255*s).toString(16).padStart(2,"0")}this.Zi.forEach((h=>{t.fillText(h,s,i),i+=49}))}if(this.qi?.ls()){const n=this.Qi.ws();if(s=e+2.5*h.u,i=2*h.u+(1-n)*h.p,t.font="32px "+h.i,t.textAlign="left",t.fillStyle="#ffffff"+Math.round(255*n).toString(16).padStart(2,"0"),this.ji.forEach((h=>{t.fillText(h,s,i),i+=49})),this.Qi.ls()){i+=49;let e=h.p/2,n=h.u,r=s+n/2,o=i-n/2,a={x:r+e/2,y:o+n/2};h.A.os(t,Math.PI/2,a),h.A.cs(t,Math.sin(.08*this.us),1,a),t.drawImage(h.A.images,32,16,8,32,r,o,e,n),h.A.resetTransform(),t.font="32px "+h.i,t.fillStyle="#fa0",t.textBaseline="middle",t.fillText("Continue",s+n+32,i)}}}update(t){this.us+=t,this.$i.ls()&&!this.qi?this.qi=new h.fs(this,2):this.qi&&this.qi.ls()&&!this.Qi&&(this.Qi=new h.fs(this,2)),h._.rt(h._.H.P,!0)&&(this.$i.ls()?this.qi&&!this.qi.ls()?this.qi.set(0):this.Qi&&!this.Qi.ls()?this.Qi.set(0):(h.Audio.play(h.Audio.SELECT),h.A.level=new h.v.Bi):this.$i.set(0))}},h.v.zi=class extends h.v{constructor(){super(),this.Ji=36,this.th=2,this.St={w:h.u*this.Ji,k:h.u*this.th};const t=new h.zt({x:h.u});this.bs(t,new h.Si({x:11*h.u,y:h.u-8,Ys:-1,item:new h.Ni}),new h.Si({x:20*h.u,y:h.u-8,Ys:-1}),new h.Si({x:31*h.u,Ys:-1,item:new h.Ni}),new h.Si({x:31*h.u,y:h.u-8,Ys:-1})),this.vs(new h.oi({x:11*h.u}),new h.oi({x:22*h.u,y:h.u+8}),new h.oi({x:32*h.u}),new h.oi({x:32*h.u,y:h.u+8}),new h.oi({x:33*h.u,y:h.u/2})),this.Cs=t,this.Ui=new h.fs(this,14)}sh(t,s,i,h,e){const n=t.fillStyle;t.fillRect(s,i,h,e),t.fillStyle="#0001",t.fillRect(s,i,12,e),t.fillStyle="#fff1",t.fillRect(s+h-12,i,12,e),t.fillStyle=n}Fs(t){const s=h.A,i=12*Math.sin(this.us/50);if(this.Ss(t,i),this.ih)t.drawImage(this.ih,0,-h.p/2);else{const[t,i]=s.vt(this.St.w,this.St.k+4*h.u),e=h.p;i.fillStyle="#0003",i.fillRect(0,e+1.25*h.u,this.St.w,this.St.k),i.fillStyle="#544";for(let t=0;t<this.Ji;t+=4)this.sh(i,t*h.u,4,h.p,2*h.u);for(let t=0;t<this.Ji;t++)for(let n=0;n<this.th;n++){let r=t*h.u,o=n*h.u+e;i.drawImage(s.images,0,0,16,16,r,o,h.u,h.u)}i.fillStyle=s.createLinearGradient(0,e,0,this.St.k,"#0001"),i.fillRect(0,e,this.St.w,this.St.k),i.fillStyle="#544",i.fillRect(0,this.St.k-6+e,this.St.w,24),this.ih=t}}Is(t){this.Ui.ls()||h.A.Kt(this.Cs,["My crew is already waiting. I","just have to make it to the ship.","But it seems there are pirates","in the harbor."],2),t.fillStyle="#544";let s=this.th*h.u-h.p/2,i=2*h.u;for(let e=0;e<this.Ji;e+=4)this.sh(t,e*h.u,s,h.p,i)}update(t){super.update(t);this.Cs.Dt().x>=this.St.w-h.p&&h.A.Nt(new h.v.hh)}},h.v.hh=class extends h.v{constructor(){super(),this.Ji=24,this.th=6,this.St={w:h.u*this.Ji,k:h.u*this.th},this.Cs=new h.zt({x:this.St.w/2-2*h.u,y:this.St.k/2-h.u,item:new h.Hi}),this.bs(this.Cs);const t=this.St.k-h.u;this.vs(this.eh(),new h.Hi({x:4*h.u,y:4.5*h.u}),new h.oi({x:this.St.w/2-h.p,y:this.St.k/2-h.u}),new h.oi({y:t}),new h.oi({x:4*h.u}),new h.oi({x:2*h.u,y:h.u}),new h.oi({x:2*h.u,y:h.u}),new h.oi({x:18*h.u}),new h.oi({x:19*h.u}),new h.oi({x:18.5*h.u,y:h.u}),new h.oi({x:8.5*h.u,y:t}),new h.oi({x:9.5*h.u,y:t}),new h.oi({x:this.St.w-2*h.u,y:t})),this.Ui=new h.fs(this,10),this.nh=new h.fs(this),this.rh=new h.fs(this,4),this.oh=0,this.ah=3}eh(){const t=new h.Gs({x:this.St.w/2+h.p+8,y:this.St.k/2-1.25*h.p,w:h.u-16,k:1.25*h.p});return t.Qs=!0,t.Ps=()=>!1,t.Lt=function(t){const s=this.Xs.y-8*h.u,i=this.k+8*h.u,e=this.w/3;t.fillStyle="#5a3c2e",t.fillRect(this.Xs.x,s,this.w,i),t.fillStyle="#0002",t.fillRect(this.Xs.x,s,e,i),t.fillStyle="#fff1",t.fillRect(this.Xs.x+this.w-e,s,e,i)},t}fh(){this.oh>=this.ah||(this.oh++,this.nh.set(2),this.lh=[],1===this.oh?this.lh.push(new h.Si({x:-h.u,y:1.5*h.u,item:new h.Hi}),new h.Si({x:-h.u,y:3*h.u}),new h.Si({x:this.St.w,y:2.5*h.u,Ys:-1})):2===this.oh?this.lh.push(new h.Si({x:this.St.w,y:1.5*h.u,Ys:-1}),new h.Si({x:this.St.w,y:3*h.u,Ys:-1}),new h.Si({x:-h.u,y:2.5*h.u})):3===this.oh&&this.lh.push(new h.Si({x:this.St.w,y:1.5*h.u,Ys:-1}),new h.Zt({x:this.St.w,y:3*h.u,Ys:-1,item:new h.Ni}),new h.Zt({x:-h.u,y:2.5*h.u,item:new h.Ni})),this.lh.forEach((t=>{t.qs=!0;const s=new h.D(t.Ys/2);t.action=i=>this.nh.ls()?(t.action=null,void delete t.qs):t.ti(s,i,h.m)})),this.bs(...this.lh))}Fs(t){const s=h.A;if(this.Ss(t,this.uh),this.wh&&t.drawImage(this.wh,-6,-h.u),this.dh)t.drawImage(this.dh,0,0);else{const t=6,[i,e]=h.A.vt(this.St.w+1.5*t,this.St.k+.5*t+2*h.u);e.lineWidth=t;let n=t/2;e.strokeStyle="#8f563b",e.strokeRect(0,n,this.St.w+e.lineWidth+n,this.St.k+n);for(let i=0;i<this.Ji;i++)for(let n=0;n<this.th;n++){let r=i*h.u,o=t+n*h.u;e.drawImage(s.images,0,0,16,16,r,o,h.u,h.u)}e.fillStyle="#5a3c2e",e.fillRect(n-e.lineWidth,this.St.k,this.St.w+2*e.lineWidth,2*h.u),e.fillStyle=h.A.createLinearGradient(0,this.St.k,0,this.St.k+2*h.u,"#0003","#4b73ac30"),e.fillRect(n-e.lineWidth,this.St.k,this.St.w+2*e.lineWidth,2*h.u),e.fillStyle=h.A.createLinearGradient(0,0,0,this.St.k),e.fillRect(0,0,this.St.w+n,this.St.k),this.dh=i}}Is(t){const s=h.A.Ht;s.fillStyle="#fff",s.font="600 23px "+h.o,s.textAlign="left",s.fillText(`Wave ${this.oh}/${this.ah}`,h.p,h.p);if(this.ph)t.drawImage(this.ph,-this.uh,this.St.k+h.u+.5,h.u*(this.Ji+1),h.u);else{const[t,s]=h.A.vt(h.u*(this.Ji+1),h.u);for(let t=0;t<=this.Ji;t++)s.drawImage(h.A.images,32,0,16,16,t*h.u,0,h.u,h.u);this.ph=t}if(this.wh)t.drawImage(this.wh,-6,this.St.k-h.u);else{const t=12+this.St.w,s=h.u,[i,e]=h.A.vt(t,s);e.lineWidth=6,e.fillStyle="#5a3c2e",e.fillRect(0,0,this.St.w+2*e.lineWidth,18),e.fillStyle="#0002",e.fillRect(0,12,this.St.w+2*e.lineWidth,6),e.fillStyle="#fff1",e.fillRect(0,0,this.St.w+2*e.lineWidth,6);const n=this.St.w/h.u+1;for(let t=0;t<=n;t++){let s=t*h.u,i=18,n=h.u+1;e.fillStyle="#5a3c2e",e.fillRect(s,i,18,n),e.fillStyle="#0002",e.fillRect(s,i,6,n),e.fillStyle="#fff1",e.fillRect(s+12,i,6,n)}this.wh=i}this.Ui.ls()||h.A.Kt(this.Cs,["The Rhine has become a","battlefield! I have to","to defend the ship!"],2)}xh(){let t=0;return this.ds.forEach((s=>{s instanceof h.Di&&(t+=s.Hs>0?1:0)})),t}update(t){super.update(t),this.uh=this.us%20/20*h.u,this.oh<=this.ah&&this.rh.ls()&&(this.fh(),this.rh.set(20)),this.oh>this.ah&&0===this.xh()&&h.A.Nt(new h.v.T)}},h.v.T=class extends h.v{constructor(){super(),this.Ji=24,this.th=6,this.St={w:2*h.A._t.x,k:h.u*this.th},this.Cs=new h.zt({x:this.St.w/2-2*h.u,y:this.St.k/2-h.u,item:new h.Hi}),this.yh=new h.Vt({x:this.Cs.Xs.x+8*h.u,y:this.Cs.Xs.y,Ys:-1,item:new h.Ni}),this.bs(this.Cs,this.yh);let t=this.St.w-h.u+6;const s=[this.eh(),new h.oi({x:4*h.u,y:0}),new h.oi({x:5*h.u,y:0}),new h.oi({x:16*h.u,y:this.St.k-h.u}),new h.oi({x:17*h.u,y:this.St.k-2*h.u}),new h.oi({x:18*h.u,y:this.St.k-2*h.u}),new h.gh({x:h.u-18,y:-10}),new h.gh({x:h.u-18,y:6*h.u-130}),new h.gh({x:t-h.u+18,y:-10}),new h.gh({x:t-h.u+18,y:6*h.u-130})];for(let i=0;i<8;i++){if(3===i||4===i)continue;let e=(h.u-20)*i-46;s.push(new h.gh({y:e})),s.push(new h.gh({x:t,y:e}))}this.vs(...s),this.Ui=new h.fs(this,1),this.locked=!0,this.mh=1,this.nh=new h.fs(this),this.Mh=this.yh.Hs,h.A.It(this.Cs)}eh(){const t=new h.Gs({x:this.St.w/2+h.p+8,y:this.St.k/2-1.25*h.p,w:h.u-16,k:1.25*h.p});return t.Qs=!0,t.Ps=()=>!1,t.Lt=function(t){const s=this.Xs.y-8*h.u,i=this.k+8*h.u,e=this.w/3;t.fillStyle="#5a3c2e",t.fillRect(this.Xs.x,s,this.w,i),t.fillStyle="#0002",t.fillRect(this.Xs.x,s,e,i),t.fillStyle="#fff1",t.fillRect(this.Xs.x+this.w-e,s,e,i)},t}Eh(){if(this.Mh<=0)return;const t=Math.max(0,this.Mh/this.yh.Zs),s=h.A,i=s.Ht;let e=3*h.u,n=s.Rt.height/s.scale-2*h.u,r=s.Rt.width/s.scale-6*h.u,o=h.p;i.fillStyle="#000",i.fillRect(e,n,r,o),i.fillStyle="#f00",i.fillRect(e,n,r*t,o),i.fillStyle="#fff7",i.fillRect(e+r/3,n,2,o),i.fillRect(e+2*r/3,n,2,o)}kh(){this.nh.set(2),this.lh=[],2===this.mh?this.lh.push(new h.Si({x:-h.u,y:1.5*h.u,item:new h.Hi}),new h.Si({x:this.St.w,y:2.5*h.u,Ys:-1})):3===this.mh&&this.lh.push(new h.Si({x:this.St.w,y:1.5*h.u,Ys:-1}),new h.Zt({x:-h.u,y:2.5*h.u,item:new h.Ni})),this.lh.forEach((t=>{t.qs=!0;const s=new h.D(t.Ys/2);t.action=i=>this.nh.ls()?(t.action=null,void delete t.qs):t.ti(s,i,h.m)})),this.bs(...this.lh)}Fs(t){const s=h.A;if(this.Ss(t,this.uh),this.wh&&t.drawImage(this.wh,-6,-h.u),this.dh)t.drawImage(this.dh,0,0);else{const t=6,[i,e]=h.A.vt(this.St.w+1.5*t,this.St.k+.5*t+2*h.u);e.lineWidth=t;let n=t/2;e.strokeStyle="#8f563b",e.strokeRect(0,n,this.St.w+e.lineWidth+n,this.St.k+n);for(let i=0;i<this.Ji;i++)for(let n=0;n<this.th;n++){let r=i*h.u,o=t+n*h.u;e.drawImage(s.images,0,0,16,16,r,o,h.u,h.u)}e.fillStyle="#5a3c2e",e.fillRect(n-e.lineWidth,this.St.k,this.St.w+2*e.lineWidth,2*h.u),e.fillStyle=h.A.createLinearGradient(0,this.St.k,0,this.St.k+2*h.u,"#0003","#4b73ac30"),e.fillRect(n-e.lineWidth,this.St.k,this.St.w+2*e.lineWidth,2*h.u),e.fillStyle=h.A.createLinearGradient(0,0,0,this.St.k),e.fillRect(0,0,this.St.w+n,this.St.k),this.dh=i}}Is(t){const s=h.A;if(this.ph)t.drawImage(this.ph,-this.uh,this.St.k+h.u+.5,h.u*(this.Ji+1),h.u);else{const[t,i]=s.vt(h.u*(this.Ji+1),h.u);for(let t=0;t<=this.Ji;t++)i.drawImage(s.images,32,0,16,16,t*h.u,0,h.u,h.u);this.ph=t}if(this.wh)t.drawImage(this.wh,-6,this.St.k-h.u);else{const t=12+this.St.w,i=h.u,[e,n]=s.vt(t,i);n.lineWidth=6,n.fillStyle="#5a3c2e",n.fillRect(0,0,this.St.w+2*n.lineWidth,18),n.fillStyle="#0002",n.fillRect(0,12,this.St.w+2*n.lineWidth,6),n.fillStyle="#fff1",n.fillRect(0,0,this.St.w+2*n.lineWidth,6);const r=this.St.w/h.u+1;for(let t=0;t<=r;t++){let s=t*h.u,i=18,e=h.u+1;n.fillStyle="#5a3c2e",n.fillRect(s,i,18,e),n.fillStyle="#0002",n.fillRect(s,i,6,e),n.fillStyle="#fff1",n.fillRect(s+12,i,6,e)}this.wh=e}this.Eh(),this.Ui.ls()||s.Kt(this.Cs,["The Rhine has become a","battlefield! I have to","to defend the ship!"],2)}update(t){this.Ui.ls()&&(this.locked=!1),super.update(t),this.uh=12*Math.sin(this.us/50),this.Mh>this.yh.Hs&&(this.Mh=Math.max(this.yh.Hs,this.Mh-t));const s=Math.max(0,this.Mh/this.yh.Zs);1===this.mh?s<.67&&(this.mh=2,this.kh()):2===this.mh?s<.34&&(this.mh=3,this.kh()):0===s&&h.A.Nt(new h.v._h)}},h.gh=class extends h.Gs{constructor(t){t.w=h.u-6,t.k=h.u-12,super(t),this.Qs=!0,this.qs=!0,this.weight=2*h.u}Lt(t){t.drawImage(h.A.images,16,50,15,14,this.Xs.x,this.Xs.y,this.w,this.k)}},h.v._h=class extends h.v{constructor(){super()}update(t){super.update(t)}};