const t={t:!0,i:'"Courier New", monospace',h:60,o:96,u:1,l:2,p:3,m:1,g:2,init(){t.M.init(),t.Audio.init(),t._.init((()=>{t._.level=new t.A.T,t._.I()}))}};window.addEventListener("load",(()=>t.init())),t.D=class{constructor(t=0,s=0){this.x=t,this.y=s}clone(){return new t.D(this.x,this.y)}length(){return this.x+this.y===0?0:Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const t=this.length();return t&&(this.x/=t,this.y/=t),this}set(t,s){this.x=t,this.y=s}},t.Audio={K:{},S:.2,k:{F:(t,s,i)=>(s[t]=2*Math.random()-1,i[t]=2*Math.random()-1,!1)},init(){this.O=new window.AudioContext,this.gain=this.O.createGain(),this.gain.connect(this.O.destination),this.volume(.1);for(const t in this.k){const s=2*this.O.sampleRate,i=this.O.createBuffer(2,s,this.O.sampleRate),h=i.getChannelData(0),e=i.getChannelData(1);for(let i=0;i<s&&!this.k[t](i,h,e);i++);this.K[t]=i}},P(){0!==this.gain.gain.value&&(this.S=this.gain.gain.value,this.gain.gain.value=0)},play(t,s,i=1,h="dec"){const e=this.O.createGain();e.connect(this.gain),"inc"===h?(e.gain.setValueAtTime(0,this.O.currentTime),e.gain.linearRampToValueAtTime(i,this.O.currentTime+s-.01)):(e.gain.setValueAtTime(i,this.O.currentTime),e.gain.linearRampToValueAtTime(0,this.O.currentTime+s-.01));const n=this.K[t.name],o=this.O.createBufferSource();return o.buffer=n,o.connect(e),o.start(0,0,s),o},v(t,s,i="sine",h="dec"){const e=this.O.createGain();e.connect(this.gain),"inc"===h?(e.gain.setValueAtTime(0,this.O.currentTime),e.gain.linearRampToValueAtTime(1,this.O.currentTime+s-.01)):(e.gain.setValueAtTime(1,this.O.currentTime),e.gain.linearRampToValueAtTime(0,this.O.currentTime+s-.01));const n=this.O.createOscillator();return n.type=i,n.frequency.setValueAtTime(t,this.O.currentTime),n.connect(e),n.start(),n.stop(this.O.currentTime+s),n},N(){this.gain.gain.value=this.S},volume(t){this.gain.gain.value=Math.min(1,Math.max(0,t))}},t.M={C:{L:1,U:2,G:3,R:4,W:10,B:11,V:12,q:13,H:14,X:15},Y:{},Z:{},j:{click:[],J:[],$:[]},tt:{},st:{},it:{},ht:{},et:new t.D,nt:0,ot(){this.rt={[this.C.L]:{keyboard:["Escape"],gamepad:[9]},[this.C.B]:{keyboard:["ArrowUp","KeyW","KeyZ","KeyY"],gamepad:[12]},[this.C.W]:{keyboard:["ArrowLeft","KeyA","KeyQ"],gamepad:[14]},[this.C.q]:{keyboard:["ArrowDown","KeyS"],gamepad:[13]},[this.C.V]:{keyboard:["ArrowRight","KeyD"],gamepad:[15]},[this.C.R]:{keyboard:["Space","Enter"],gamepad:[0]},[this.C.U]:{keyboard:["Enter"],gamepad:[0]}}},ct(){let t=0,s=0;if(this.dt(this.C.W)?t=-1:this.dt(this.C.V)&&(t=1),this.dt(this.C.B)?s=-1:this.dt(this.C.q)&&(s=1),!t||!s){const i=.3;for(const h in this.it){const e=this.it[h];e.axes[0]&&Math.abs(e.axes[0])>i?t=e.axes[0]>0?1:-1:e.axes[2]&&Math.abs(e.axes[2])>i&&(t=e.axes[2]>0?1:-1),e.axes[1]&&Math.abs(e.axes[1])>i?s=e.axes[1]>0?1:-1:e.axes[3]&&Math.abs(e.axes[3])>i&&(s=e.axes[3]>0?1:-1)}}return{x:t,y:s}},ut(t){return this.rt[t]},init(){this.ot(),this.wt()},dt(t,s){const i=this.ut(t);for(const t of i.keyboard)if(this.lt(t,s))return!0;for(const t of i.gamepad)if(this.ft(t,s))return!0;if(t===this.C.W)for(const t in this.it){const i=this.it[t];if(i.axes[6]&&i.axes[6]<=-.2)return!this.Z["gt"]&&(s&&(this.Z["gt"]=!0),!0)}else if(t===this.C.V)for(const t in this.it){const i=this.it[t];if(i.axes[6]&&i.axes[6]>=.2)return!this.Z["yt"]&&(s&&(this.Z["yt"]=!0),!0)}else if(t===this.C.B)for(const t in this.it){const i=this.it[t];if(i.axes[7]&&i.axes[7]<=-.2)return!this.Z["Et"]&&(s&&(this.Z["Et"]=!0),!0)}else if(t===this.C.q)for(const t in this.it){const i=this.it[t];if(i.axes[7]&&i.axes[7]>=.2)return!this.Z["Mt"]&&(s&&(this.Z["Mt"]=!0),!0)}return!1},ft(t,s){for(const i in this.it){const h=this.it[i].buttons[t];if(h&&h.pressed)return!this.Z[t]&&(s&&(this.Z[t]=!0),!0)}return!1},lt(t,s){const i=this.ht[t];return!(!i||!i.time)&&(s&&(i.time=0,i._t=!0),!0)},Tt(t,s){if("function"!=typeof s)return void(this.j[t]=[]);const i=this.j[t].indexOf(s);i>=0&&this.j[t].splice(i,1)},At(t,s){this.j[t].push(s)},xt(t,s){const i=this.tt[t]||[];i.push(s),this.tt[t]=i},It(t,s){const i=this.st[t]||[];i.push(s),this.st[t]=i},wt(){document.body.onkeydown=t=>{const s=this.ht[t.code];s&&s._t||(this.ht[t.code]={time:Date.now()},this.tt[t.code]&&this.tt[t.code].forEach((t=>t())))},document.body.onkeyup=t=>{this.ht[t.code]={time:0},this.st[t.code]&&this.st[t.code].forEach((t=>t()))},document.body.onmousemove=t=>{this.et.x=t.clientX,this.et.y=t.clientY},document.body.onclick=t=>{this.j.click.forEach((t=>t(this.et.clone())))},window.addEventListener("gamepadconnected",(t=>{this.nt++,this.it[t.gamepad.index]=t.gamepad,this.j.J.forEach((t=>t()))})),window.addEventListener("gamepaddisconnected",(t=>{this.nt--,delete this.it[t.gamepad.index],this.j.$.forEach((t=>t()))}))},update(){const t=navigator.getGamepads();for(const s of t)if(s){this.it[s.index]=s;for(const t in this.Z)"axis6-"===t||"axis6+"===t?s.axes[6]||delete this.Z[t]:"axis7-"===t||"axis7+"===t?s.axes[7]||delete this.Z[t]:s.buttons[t]&&!s.buttons[t].pressed&&delete this.Z[t]}}},t._={bt:new t.D,scale:1,Dt:0,Kt:0,St(t){const s=t.kt();this.Dt=this.bt.x-s.x,this.Kt=this.bt.y-s.y},clear(){this.O.setTransform(1,0,0,1,0,0),this.O.clearRect(0,0,window.innerWidth,window.innerHeight),this.Ft.setTransform(1,0,0,1,0,0),this.Ft.clearRect(0,0,window.innerWidth,window.innerHeight)},Ot(){this.clear(),this.O.setTransform(this.scale,0,0,this.scale,this.Dt,this.Kt),this.Ft.setTransform(this.scale,0,0,this.scale,0,0),this.level&&this.level.Ot()},Pt(){this.Ft.setTransform(this.scale,0,0,this.scale,0,0),this.Ft.clearRect(0,0,window.innerWidth,window.innerHeight),this.Ft.fillStyle="rgba(0,0,0,0.4)",this.Ft.fillRect(0,0,window.innerWidth,window.innerHeight),this.Ft.fillStyle="#FFF",this.Ft.font="normal 56px "+t.i,this.Ft.textAlign="center",this.Ft.textBaseline="top",this.Ft.fillText("PAUSED",this.bt.x,60)},vt(t,s){const i=document.createElement("canvas");i.width=t,i.height=s;const h=i.getContext("2d",{alpha:!0});return h.imageSmoothingEnabled=!1,[i,h]},init(t){this.Nt=document.getElementById("c"),this.O=this.Nt.getContext("2d",{alpha:!0}),this.O.imageSmoothingEnabled=!1,this.Ct=document.getElementById("ui"),this.Ft=this.Ct.getContext("2d",{alpha:!0}),this.Ft.imageSmoothingEnabled=!1,this.Lt((()=>{this.wt(),t()}))},Lt(t){const s=new Image;s.onload=()=>{this.images=s,t()},s.src="i.png"},I(s=0){if(t.M.update(),s&&this.Ut){const i=(s-this.Ut)/(1e3/t.h);if(this.O.imageSmoothingEnabled=!1,this.Ft.imageSmoothingEnabled=!1,this.Gt)return void this.Pt();this.level.update(i),this.Ot(),t.t&&(this.Ft.fillStyle="#000",this.Ft.fillRect(40,window.innerHeight-45,140,28),this.Ft.fillStyle="#FFF",this.Ft.font="bold 16px "+t.i,this.Ft.textAlign="right",this.Ft.textBaseline="bottom",this.Ft.fillText(~~(t.h/i)+" FPS / "+this.scale,160,window.innerHeight-22))}this.Ut=s,requestAnimationFrame((t=>this.I(t)))},resetTransform(){this.O.setTransform(this.scale,0,0,this.scale,this.Dt,this.Kt)},pause(){this.Gt=!0,t.Audio.P()},wt(){window.addEventListener("resize",(t=>this.resize())),this.resize();const s=t.M.ut(t.M.C.L);setInterval((()=>{this.Gt&&t.M.update(),s.gamepad.forEach((s=>{t.M.ft(s,!0)&&this.Rt()}))}),100);const i=()=>this.Rt();s.keyboard.forEach((s=>t.M.It(s,i))),t.M.At("gp_disconnect",(()=>this.pause())),t.M.At("click",(t=>{this.Gt||this.level&&this.level.Wt(t)}))},zt(){this.level=new this.level.constructor},resize(){this.Nt.width=window.innerWidth,this.Nt.height=window.innerHeight,this.Ct.width=window.innerWidth,this.Ct.height=window.innerHeight,this.bt.x=Math.floor(this.Nt.width/2),this.bt.y=Math.floor(this.Nt.height/2),this.Gt&&(clearTimeout(this.Bt),this.Bt=setTimeout((()=>this.Pt()),100))},Rt(){this.Gt?this.unpause():this.pause()},unpause(){this.Gt&&(this.Gt=!1,t.Audio.N(),this.I())}},t.A=class{constructor(){this.Vt=!1,this.qt={},this.Ht=0,this.Xt=[],this.Yt=[],this.Zt={p1:null,p2:null}}jt(...t){t.forEach((t=>t.level=this)),this.Yt.push(...t),this.Xt.push(...t)}Qt(...t){t.forEach((t=>t.level=this)),this.Xt.push(...t)}Wt(t){if(!this.Vt)for(const s of this.Yt)if(s.Jt(t)&&this.Zt.p2!==s){this.Zt.p1=s;break}}Ot(){this.Vt?this.$t(t._.O):(this.ts(t._.O),this.Xt.forEach((s=>s.Ot(t._.O))))}$t(s){const i=t._.bt;s.font="bold 36px "+t.i,s.textAlign="center",s.fillStyle="#DDD",s.fillText("GAME OVER",i.x,i.y)}update(s){if(this.Ht+=s,this.Vt)t.M.dt(t.M.C.U,!0)&&t._.zt();else{const i=this.Zt.p1;if(i){t._.St(i),t.M.dt(t.M.C.R,!0)&&i.attack();let h=t.M.ct();h=new t.D(h.x,h.y),i.update(s,h.normalize())}this.Xt.sort(((t,s)=>t.ss()-s.ss())),this.Xt.forEach((t=>{t!==i&&t.update(s)}))}}},t.hs=class{constructor(s={}){this.es=new t.D(s.x,s.y),this.w=s.w||0,this.ns=s.ns||0,this.os=0,this.rs=1/0,this.cs=new t.D(1,0),this.speed=new t.D,this.state=t.m}Ot(t){}kt(){return{x:this.es.x+this.w/2,y:this.es.y+this.ns/2}}Jt(t){return this.es.x<=t.x&&t.x<=this.es.x+this.w&&this.es.y<=t.y&&t.y<=this.es.y+this.ns}ss(){return this.es.y+this.ns}update(s,i){let h=t.m;this.os+=s,i&&(this.es.x+=Math.round(s*i.x*this.speed.x),this.es.y+=Math.round(s*i.y*this.speed.y),(i.x||i.y)&&(h=t.g,this.cs.set(0==i.x?this.cs.x:i.x>0?1:-1,0==i.y?this.cs.y:i.y>0?1:-1))),this.state!=h&&(this.os=0),this.state=h}},t.ds=class extends t.hs{constructor(s={}){s.w=t.o,s.ns=t.o,super(s),this.us=0,this.ws=!1,this.rs=100,this.item=s.item||t.u,this.level=null,this.speed.set(12,12)}ls(t,s){const i=this.kt();t.translate(i.x,i.y),t.scale(s,1),t.translate(-i.x,-i.y)}ps(s){const i=this.kt();s.translate(i.x,i.y),s.rotate(.1*Math.sin(this.os/t.h*48)),s.translate(-i.x,-i.y)}fs(s){if(!this.gs())return;const i=this.cs.x<0;i&&this.ls(s,-1),this.item===t.l?this.ys(s):this.item===t.p&&this.Es(s),i&&this.ls(s,-1)}ys(s){let i=this.es.x+this.w-20,h=this.es.y+this.ns/2-6;this.ws&&(i+=Math.max(0,32*Math.sin(this.us/t.h*24))),s.drawImage(t._.images,0,48,8,8,i,h,t.o/2,t.o/2)}Es(s){let i=this.es.x-this.w+8,h=this.es.y;s.drawImage(t._.images,0,56,32,8,i,h,2*t.o,t.o/2),this.ws}attack(){!this.ws&&this.gs()&&this.item!==t.u&&(this.ws=!0,this.us=0)}gs(){return this.item&&this.item!==t.u}update(s,i){super.update(s,i),this.ws&&(this.us+=s,this.us/t.h>.24&&(this.ws=!1,this.us=0)),this.level&&(this.es.x=Math.min(this.level.qt.x+this.level.qt.w-this.w,Math.max(this.level.qt.x,this.es.x)),this.es.y=Math.min(this.level.qt.y+this.level.qt.ns-this.ns,Math.max(this.level.qt.y,this.es.y)))}},t.Ms=class extends t.ds{constructor(t){super(t)}Ot(s){let i=this.es.x,h=this.es.y,e=this.cs.x<0?16:0;this.state===t.g&&this.ps(s),this.fs(s),s.drawImage(t._.images,e,32,16,16,i,h,t.o,t.o),t._.resetTransform()}},t._s=class extends t.ds{constructor(t){super(t)}Ot(s){let i=this.es.x,h=this.es.y,e=this.cs.x<0?16:0;this.state===t.g&&this.ps(s),this.fs(s),s.drawImage(t._.images,e,16,16,16,i,h,t.o,t.o),t._.resetTransform()}},t.A.T=class extends t.A{constructor(){super(),this.qt={x:0,y:0,w:8*t.o,ns:8*t.o};const s=new t._s({x:400,y:400,item:t.l}),i=new t.Ms({x:600,y:400,item:t.p});i.cs.x=-1,this.jt(s,i),this.Zt.p1=s}ts(s){s.strokeStyle="#8f563b",s.lineWidth=t.o/16;let i=s.lineWidth/2;s.strokeRect(-i,-i,this.qt.w+2*i,this.qt.ns);for(let i=0;i<8;i++)for(let h=0;h<8;h++){let e=i*t.o,n=h*t.o;s.drawImage(t._.images,0,0,16,16,e,n,t.o,t.o)}}};