const t={t:!0,i:'"Courier New", monospace',h:60,init(){t.o.init(),t.Audio.init(),t.u.init((()=>{t.u.level=new t.l.p,t.u.m()}))}};window.addEventListener("load",(()=>t.init())),t.Audio={g:{},A:.2,D:{K:(t,s,i)=>(s[t]=2*Math.random()-1,i[t]=2*Math.random()-1,!1)},init(){this.F=new window.AudioContext,this.gain=this.F.createGain(),this.gain.connect(this.F.destination),this.volume(.1);for(const t in this.D){const s=2*this.F.sampleRate,i=this.F.createBuffer(2,s,this.F.sampleRate),h=i.getChannelData(0),e=i.getChannelData(1);for(let i=0;i<s&&!this.D[t](i,h,e);i++);this.g[t]=i}},M(){0!==this.gain.gain.value&&(this.A=this.gain.gain.value,this.gain.gain.value=0)},play(t,s,i=1,h="dec"){const e=this.F.createGain();e.connect(this.gain),"inc"===h?(e.gain.setValueAtTime(0,this.F.currentTime),e.gain.linearRampToValueAtTime(i,this.F.currentTime+s-.01)):(e.gain.setValueAtTime(i,this.F.currentTime),e.gain.linearRampToValueAtTime(0,this.F.currentTime+s-.01));const n=this.g[t.name],o=this.F.createBufferSource();return o.buffer=n,o.connect(e),o.start(0,0,s),o},_(t,s,i="sine",h="dec"){const e=this.F.createGain();e.connect(this.gain),"inc"===h?(e.gain.setValueAtTime(0,this.F.currentTime),e.gain.linearRampToValueAtTime(1,this.F.currentTime+s-.01)):(e.gain.setValueAtTime(1,this.F.currentTime),e.gain.linearRampToValueAtTime(0,this.F.currentTime+s-.01));const n=this.F.createOscillator();return n.type=i,n.frequency.setValueAtTime(t,this.F.currentTime),n.connect(e),n.start(),n.stop(this.F.currentTime+s),n},v(){this.gain.gain.value=this.A},volume(t){this.gain.gain.value=Math.min(1,Math.max(0,t))}},t.o={P:{T:1,S:2,O:3,U:10,k:11,N:12,C:13,G:14,L:15},R:{},I:{},B:{V:[],q:[]},W:{},H:{},X:{},Y:{},Z:0,j(){this.J={[this.P.T]:{keyboard:["Escape"],gamepad:[9]},[this.P.k]:{keyboard:["ArrowUp","KeyW","KeyZ","KeyY"],gamepad:[12]},[this.P.U]:{keyboard:["ArrowLeft","KeyA","KeyQ"],gamepad:[14]},[this.P.C]:{keyboard:["ArrowDown","KeyS"],gamepad:[13]},[this.P.N]:{keyboard:["ArrowRight","KeyD"],gamepad:[15]},[this.P.S]:{keyboard:["Space","Enter"],gamepad:[0]}}},$(){let t=0,s=0;if(this.tt(this.P.U)?t=-1:this.tt(this.P.N)&&(t=1),this.tt(this.P.k)?s=-1:this.tt(this.P.C)&&(s=1),!t||!s){const i=.3;for(const h in this.X){const e=this.X[h];e.axes[0]&&Math.abs(e.axes[0])>i?t=e.axes[0]>0?1:-1:e.axes[2]&&Math.abs(e.axes[2])>i&&(t=e.axes[2]>0?1:-1),e.axes[1]&&Math.abs(e.axes[1])>i?s=e.axes[1]>0?1:-1:e.axes[3]&&Math.abs(e.axes[3])>i&&(s=e.axes[3]>0?1:-1)}}return{x:t,y:s}},st(t){return this.J[t]},init(){this.j(),this.it()},tt(t,s){const i=this.st(t);for(const t of i.keyboard)if(this.ht(t,s))return!0;for(const t of i.gamepad)if(this.et(t,s))return!0;if(t===this.P.U)for(const t in this.X){const i=this.X[t];if(i.axes[6]&&i.axes[6]<=-.2)return!this.I["nt"]&&(s&&(this.I["nt"]=!0),!0)}else if(t===this.P.N)for(const t in this.X){const i=this.X[t];if(i.axes[6]&&i.axes[6]>=.2)return!this.I["ot"]&&(s&&(this.I["ot"]=!0),!0)}else if(t===this.P.k)for(const t in this.X){const i=this.X[t];if(i.axes[7]&&i.axes[7]<=-.2)return!this.I["rt"]&&(s&&(this.I["rt"]=!0),!0)}else if(t===this.P.C)for(const t in this.X){const i=this.X[t];if(i.axes[7]&&i.axes[7]>=.2)return!this.I["ct"]&&(s&&(this.I["ct"]=!0),!0)}return!1},et(t,s){for(const i in this.X){const h=this.X[i].buttons[t];if(h&&h.pressed)return!this.I[t]&&(s&&(this.I[t]=!0),!0)}return!1},ht(t,s){const i=this.Y[t];return!(!i||!i.time)&&(s&&(i.time=0,i.dt=!0),!0)},ut(t,s){if("function"!=typeof s)return void(this.B[t]=[]);const i=this.B[t].indexOf(s);i>=0&&this.B[t].splice(i,1)},lt(t,s){this.B[t].push(s)},ft(t,s){const i=this.W[t]||[];i.push(s),this.W[t]=i},wt(t,s){const i=this.H[t]||[];i.push(s),this.H[t]=i},it(){document.body.onkeydown=t=>{const s=this.Y[t.code];s&&s.dt||(this.Y[t.code]={time:Date.now()},this.W[t.code]&&this.W[t.code].forEach((t=>t())))},document.body.onkeyup=t=>{this.Y[t.code]={time:0},this.H[t.code]&&this.H[t.code].forEach((t=>t()))},window.addEventListener("gamepadconnected",(t=>{this.Z++,this.X[t.gamepad.index]=t.gamepad,this.B.V.forEach((t=>t()))})),window.addEventListener("gamepaddisconnected",(t=>{this.Z--,delete this.X[t.gamepad.index],this.B.q.forEach((t=>t()))}))},update(){const t=navigator.getGamepads();for(const s of t)if(s){this.X[s.index]=s;for(const t in this.I)"axis6-"===t||"axis6+"===t?s.axes[6]||delete this.I[t]:"axis7-"===t||"axis7+"===t?s.axes[7]||delete this.I[t]:s.buttons[t]&&!s.buttons[t].pressed&&delete this.I[t]}}},t.l=class{constructor(){this.gt=!1,this.yt=[],this.Et={p1:null,p2:null},this.At=0}Dt(){this.gt?this.Kt(t.u.F):(this.Ft(t.u.F),this.yt.forEach((s=>s.Dt(t.u.F))))}Ft(){}Kt(s){const i=t.u.Mt;s.font="bold 36px "+t.i,s.textAlign="center",s.fillStyle="#DDD",s.fillText("GAME OVER",i,i)}update(s){if(this.At+=s,this.gt)t.o.tt(t.o.P.S,!0)&&t.u._t();else{const i=t.o.$();this.yt.forEach((t=>{t===this.Et.p1?t.update(s,i):t.update(s)}))}}},t.bt=class{constructor(t){this.x=t.x||0,this.y=t.y||0,this.w=t.w||0,this.xt=t.xt||0,this.vt={x:0,y:0},this.Pt=1/0}},t.u={scale:1,Tt:{},clear(){const t=Math.ceil(this.St.width/this.scale);this.F.clearRect(0,0,t,t),this.Ot.clearRect(0,0,t,t)},Dt(){this.clear(),this.level&&this.level.Dt()},Ut(){const s=Math.ceil(this.kt.width/this.scale);this.Ot.setTransform(this.scale,0,0,this.scale,0,0),this.Ot.clearRect(0,0,s,s),this.Ot.fillStyle="rgba(0,0,0,0.4)",this.Ot.fillRect(0,0,s,s),this.Ot.fillStyle="#FFF",this.Ot.font="normal 56px "+t.i,this.Ot.textAlign="center",this.Ot.textBaseline="top",this.Ot.fillText("PAUSED",this.Mt,60)},Nt(t,s){const i=document.createElement("canvas");i.width=t,i.height=s;const h=i.getContext("2d",{alpha:!0});return h.imageSmoothingEnabled=!1,[i,h]},init(t){this.St=document.getElementById("c"),this.F=this.St.getContext("2d",{alpha:!0}),this.F.imageSmoothingEnabled=!1,this.kt=document.getElementById("ui"),this.Ot=this.kt.getContext("2d",{alpha:!0}),this.Ot.imageSmoothingEnabled=!1,this.it(),this.Ct(t)},Ct(t){},m(s=0){if(t.o.update(),s&&this.Gt){const i=(s-this.Gt)/(1e3/t.h);if(this.F.imageSmoothingEnabled=!1,this.Ot.imageSmoothingEnabled=!1,this.F.lineWidth=1,this.F.textBaseline="alphabetic",this.F.setTransform(this.scale,0,0,this.scale,0,0),this.Ot.setTransform(this.scale,0,0,this.scale,0,0),this.Lt)return void this.Ut();this.level.update(i),this.Dt(),t.t&&(this.Ot.fillStyle="#000",this.Ot.fillRect(30,window.innerHeight-45,160,28),this.Ot.fillStyle="#FFF",this.Ot.font="bold 16px "+t.i,this.Ot.textAlign="right",this.Ot.textBaseline="bottom",this.Ot.fillText(~~(t.h/i)+" FPS / "+this.scale,180,window.innerHeight-22))}this.Gt=s,requestAnimationFrame((t=>this.m(t)))},pause(){this.Lt=!0,t.Audio.M()},it(){window.addEventListener("resize",(t=>this.resize())),this.resize();const s=t.o.st(t.o.P.T);setInterval((()=>{this.Lt&&t.o.update(),s.gamepad.forEach((s=>{t.o.et(s,!0)&&this.Rt()}))}),100);const i=()=>this.Rt();s.keyboard.forEach((s=>t.o.wt(s,i))),t.o.lt("gp_disconnect",(()=>this.pause()))},_t(){this.level=new this.level.constructor},resize(){const t=Math.min(window.innerWidth,window.innerHeight);this.St.height=t,this.St.width=t,this.kt.height=t,this.kt.width=t,this.Lt&&(clearTimeout(this.It),this.It=setTimeout((()=>this.Ut()),100))},Rt(){this.Lt?this.unpause():this.pause()},unpause(){this.Lt&&(this.Lt=!1,t.Audio.v(),this.m())}},t.bt.Bt=class extends t.bt{constructor(t){super(t)}},t.bt.Vt=class extends t.bt{constructor(t){super(t)}},t.bt.qt=class extends t.bt{constructor(t){super(t)}};