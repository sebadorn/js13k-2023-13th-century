let t,s,i;s=.3,t=(t=1,s=.05,h=220,e=0,n=0,r=.1,o=0,a=1,c=0,u=0,l=0,d=0,f=0,w=0,p=0,m=0,g=0,y=1,x=0,E=0,M=Math,k=44100,A=2*M.PI,T=(c*=500*A/k/k),_=(h*=(1-s+2*s*M.random(s=[]))*A/k),b=0,D=0,I=0,F=1,v=0,K=0,S=0,C,L)=>{for(u*=500*A/k**3,p*=A/k,l*=A/k,d*=k,f=k*f|0,L=(e=k*e+9)+(x*=k)+(n*=k)+(r*=k)+(g*=k)|0;I<L;s[I++]=S)++K%(100*m|0)||(S=o?1<o?2<o?3<o?M.sin((b%A)**3):M.max(M.min(M.tan(b),1),-1):1-(2*b/A%2+2)%2:1-4*M.abs(M.round(b/A)-b/A):M.sin(b),S=(f?1-E+E*M.sin(A*I/f):1)*(0<S?1:-1)*M.abs(S)**a*.3*t*(I<e?I/e:I<e+x?1-(I-e)/x*(1-y):I<e+x+n?y:I<L-g?(L-I-g)/r*y:0),S=g?S/2+(g>I?0:(I<L-g?1:(L-I)/g)*s[I-g|0]/2):S),b+=(C=(h+=c+=u)*M.cos(p*D++))-C*w*(1-1e9*(M.sin(I)+1)%2),F&&++F>d&&(h+=l,_+=l,F=0),!f||++v%f||(h=_,c=T,F||=1);return(t=i.createBuffer(1,L,k)).getChannelData(0).set(s),(h=i.createBufferSource()).buffer=t,h.connect(i.destination),h.start(),h},i=new AudioContext;const h={t:!0,i:"Arial, sans-serif",h:60,o:96,u:48,l:1,p:2,init(){h.m.init(),h.g.init((()=>{h.g.level=new h.k.M,h.g.A()}))},T(t,s){let i=Math.min(t.x+t.w,s.x+s.w)-Math.max(t.x,s.x);i=i<0?0:i;let h=Math.min(t.y+t._,s.y+s._)-Math.max(t.y,s.y);return h=h<0?0:h,i*h>Number.EPSILON}};window.addEventListener("load",(()=>h.init())),h.D=class{constructor(t=0,s=0){this.x=t,this.y=s}clone(){return new h.D(this.x,this.y)}length(){return this.x+this.y===0?0:Math.sqrt(this.x*this.x+this.y*this.y)}mul(t){return this.x*=t,this.y*=t,this}normalize(){const t=this.length();return t&&(this.x/=t,this.y/=t),this}set(t,s){this.x=t,this.y=s}},h.Audio={I:[.3,0,8,.01,.01,.01,1,2.29,86,,,,,,-82,,,.42,.01],F:[.2,0,68,.02,.01,.18,2,1.89,-.3,,,,,1.4,,.3,,.59,.06,.12],v:[.15,0,382,.1,.01,.09,,2.2,-1.2,-3.8,,,,5,,,,.48,.05],SELECT:[.2,0,883,.01,.07,,1,1.74,,,366,.1,.06,,,,,.62,.01],play(s){t(...s)}},h.m={K:{S:1,C:2,L:3,I:4,H:5,v:6,N:10,P:11,R:12,G:13,O:14,U:15},B:{},W:{},Y:{click:[],Z:[],V:[]},X:{},j:{},q:{},J:{},$:new h.D,tt:0,st(){this.it={[this.K.S]:{keyboard:["Escape"],gamepad:[9]},[this.K.P]:{keyboard:["ArrowUp","KeyW","KeyZ","KeyY"],gamepad:[12]},[this.K.N]:{keyboard:["ArrowLeft","KeyA","KeyQ"],gamepad:[14]},[this.K.G]:{keyboard:["ArrowDown","KeyS"],gamepad:[13]},[this.K.R]:{keyboard:["ArrowRight","KeyD"],gamepad:[15]},[this.K.I]:{keyboard:["Space","Enter"],gamepad:[0]},[this.K.v]:{keyboard:["KeyR"],gamepad:[]},[this.K.C]:{keyboard:["Enter"],gamepad:[0]},[this.K.H]:{keyboard:["KeyE"],gamepad:[0]}}},ht(){let t=0,s=0;if(this.et(this.K.N)?t=-1:this.et(this.K.R)&&(t=1),this.et(this.K.P)?s=-1:this.et(this.K.G)&&(s=1),!t||!s){const i=.3;for(const h in this.q){const e=this.q[h];e.axes[0]&&Math.abs(e.axes[0])>i?t=e.axes[0]>0?1:-1:e.axes[2]&&Math.abs(e.axes[2])>i&&(t=e.axes[2]>0?1:-1),e.axes[1]&&Math.abs(e.axes[1])>i?s=e.axes[1]>0?1:-1:e.axes[3]&&Math.abs(e.axes[3])>i&&(s=e.axes[3]>0?1:-1)}}return{x:t,y:s}},nt(t){return this.it[t]},init(){this.st(),this.rt()},et(t,s){const i=this.nt(t);for(const t of i.keyboard)if(this.ot(t,s))return!0;for(const t of i.gamepad)if(this.ct(t,s))return!0;if(t===this.K.N)for(const t in this.q){const i=this.q[t];if(i.axes[6]&&i.axes[6]<=-.2)return!this.W["ut"]&&(s&&(this.W["ut"]=!0),!0)}else if(t===this.K.R)for(const t in this.q){const i=this.q[t];if(i.axes[6]&&i.axes[6]>=.2)return!this.W["lt"]&&(s&&(this.W["lt"]=!0),!0)}else if(t===this.K.P)for(const t in this.q){const i=this.q[t];if(i.axes[7]&&i.axes[7]<=-.2)return!this.W["dt"]&&(s&&(this.W["dt"]=!0),!0)}else if(t===this.K.G)for(const t in this.q){const i=this.q[t];if(i.axes[7]&&i.axes[7]>=.2)return!this.W["ft"]&&(s&&(this.W["ft"]=!0),!0)}return!1},ct(t,s){for(const i in this.q){const h=this.q[i].buttons[t];if(h&&h.pressed)return!this.W[t]&&(s&&(this.W[t]=!0),!0)}return!1},ot(t,s){const i=this.J[t];return!(!i||!i.time)&&(s&&(i.time=0,i.wt=!0),!0)},gt(t,s){if("function"!=typeof s)return void(this.Y[t]=[]);const i=this.Y[t].indexOf(s);i>=0&&this.Y[t].splice(i,1)},yt(t,s){this.Y[t].push(s)},xt(t,s){const i=this.X[t]||[];i.push(s),this.X[t]=i},Et(t,s){const i=this.j[t]||[];i.push(s),this.j[t]=i},rt(){document.body.onkeydown=t=>{const s=this.J[t.code];s&&s.wt||(this.J[t.code]={time:Date.now()},this.X[t.code]&&this.X[t.code].forEach((t=>t())))},document.body.onkeyup=t=>{this.J[t.code]={time:0},this.j[t.code]&&this.j[t.code].forEach((t=>t()))},document.body.onmousemove=t=>{this.$.x=t.clientX,this.$.y=t.clientY},document.body.onclick=t=>{this.Y.click.forEach((t=>t(this.$.clone())))},window.addEventListener("gamepadconnected",(t=>{this.tt++,this.q[t.gamepad.index]=t.gamepad,this.Y.Z.forEach((t=>t()))})),window.addEventListener("gamepaddisconnected",(t=>{this.tt--,delete this.q[t.gamepad.index],this.Y.V.forEach((t=>t()))}))},update(){const t=navigator.getGamepads();for(const s of t)if(s){this.q[s.index]=s;for(const t in this.W)"axis6-"===t||"axis6+"===t?s.axes[6]||delete this.W[t]:"axis7-"===t||"axis7+"===t?s.axes[7]||delete this.W[t]:s.buttons[t]&&!s.buttons[t].pressed&&delete this.W[t]}}},h.g={Mt:new h.D,scale:1,kt:0,At:0,Tt(t){const[s,i]=this._t(t.width,t.height);i.drawImage(t,0,0);const h=i.getImageData(0,0,t.width,t.height);for(let s=0;s<t.height;s++)for(let i=0;i<t.width;i++){const e=4*(s*t.width+i);0!==h.data[e+3]&&(h.data[e+0]=255,h.data[e+1]=255,h.data[e+2]=255)}return i.putImageData(h,0,0),s},bt(t){const s=t.Dt();if(this.kt=this.Mt.x-s.x,this.At=(this.Mt.y-s.y)*this.scale,t.level){const s=t.level.It;this.kt=Math.min(0,Math.max(-s.w+2*this.Mt.x,this.kt))}this.kt*=this.scale},clear(){this.Ft.setTransform(1,0,0,1,0,0),this.Ft.clearRect(0,0,window.innerWidth,window.innerHeight),this.vt.setTransform(1,0,0,1,0,0),this.vt.clearRect(0,0,window.innerWidth,window.innerHeight)},Kt(){this.clear(),this.Ft.setTransform(this.scale,0,0,this.scale,this.kt,this.At),this.vt.setTransform(this.scale,0,0,this.scale,0,0),this.level&&this.level.Kt()},St(){this.vt.setTransform(1,0,0,1,0,0),this.vt.clearRect(0,0,window.innerWidth,window.innerHeight),this.vt.setTransform(this.scale,0,0,this.scale,0,0),this.vt.fillStyle="rgba(0,0,0,0.4)",this.vt.fillRect(0,0,this.Ct.width/this.scale,this.Ct.height/this.scale),this.vt.fillStyle="#FFF",this.vt.font="56px "+h.i,this.vt.textAlign="center",this.vt.textBaseline="top",this.vt.fillText("GAME OVER",this.Mt.x,this.Mt.y-56)},Lt(){this.vt.setTransform(1,0,0,1,0,0),this.vt.clearRect(0,0,window.innerWidth,window.innerHeight),this.vt.setTransform(this.scale,0,0,this.scale,0,0),this.vt.fillStyle="rgba(0,0,0,0.4)",this.vt.fillRect(0,0,this.Ct.width/this.scale,this.Ct.height/this.scale),this.vt.fillStyle="#FFF",this.vt.font="56px "+h.i,this.vt.textAlign="center",this.vt.textBaseline="top",this.vt.fillText("PAUSED",this.Mt.x,this.Mt.y-56)},Ht(){this.Ft.fillRect(-this.kt/this.scale-h.o,-this.At/this.scale-h.o,this.Nt.width/this.scale+2*h.o,this.Nt.height/this.scale+2*h.o)},_t(t,s){const i=document.createElement("canvas");i.width=t,i.height=s;const h=i.getContext("2d",{alpha:!0});return h.imageSmoothingEnabled=!1,[i,h]},init(t){this.Nt=document.getElementById("c"),this.Ft=this.Nt.getContext("2d",{alpha:!0}),this.Ft.imageSmoothingEnabled=!1,this.Ct=document.getElementById("ui"),this.vt=this.Ct.getContext("2d",{alpha:!0}),this.vt.imageSmoothingEnabled=!1,this.Pt((()=>{this.rt(),t()}))},Pt(t){const s=new Image;s.onload=()=>{this.images=s,this.Rt=this.Tt(s);const[i,e]=this._t(h.o,h.o);e.drawImage(this.images,16,0,16,16,0,0,h.o,h.o),this.Gt=e.createPattern(i,"repeat");const[n,r]=h.g._t(h.o,h.o),o=r.createRadialGradient(h.u,h.u,0,h.u,h.u,h.u);o.addColorStop(0,"#000a"),o.addColorStop(.9,"#0002"),o.addColorStop(1,"#0000"),r.fillStyle=o,r.fillRect(0,0,h.o,h.o),this.Ot=n,t()},s.src="i.png"},A(t=0){if(h.m.update(),t&&this.Ut){const s=(t-this.Ut)/(1e3/h.h);if(this.Ft.imageSmoothingEnabled=!1,this.vt.imageSmoothingEnabled=!1,this.Ft.lineWidth=1,this.Ft.textBaseline="alphabetic",this.Bt)return void this.Lt();this.level.update(s),this.Kt(),h.t&&(this.vt.fillStyle="#000",this.vt.fillRect(60,this.Nt.height/this.scale-74,140,28),this.vt.fillStyle="#FFF",this.vt.font="16px monospace",this.vt.textAlign="right",this.vt.textBaseline="bottom",this.vt.fillText(~~(h.h/s)+" FPS, "+Math.round(1e3*this.scale)/1e3,192,this.Nt.height/this.scale-50))}this.Ut=t,requestAnimationFrame((t=>this.A(t)))},pause(){this.Bt=!0},rt(){window.addEventListener("resize",(t=>this.resize())),this.resize();const t=h.m.nt(h.m.K.S);setInterval((()=>{this.Bt&&h.m.update(),t.gamepad.forEach((t=>{h.m.ct(t,!0)&&this.zt()}))}),100);const s=()=>this.zt();t.keyboard.forEach((t=>h.m.Et(t,s))),h.m.yt("gp_disconnect",(()=>this.pause()))},Wt(){this.level=new this.level.constructor},resetTransform(){this.Ft.setTransform(this.scale,0,0,this.scale,this.kt,this.At)},resize(){const t=1920/1080;let s=window.innerHeight,i=Math.round(s*t);i>window.innerWidth&&(i=window.innerWidth,s=i/t),this.scale=s/1080,this.Mt.x=i/2/this.scale,this.Mt.y=s/2/this.scale;let h=~~((window.innerHeight-s)/2)+"px",e=~~((window.innerWidth-i)/2)+"px";this.Nt.width=i,this.Nt.height=s,this.Nt.style.top=h,this.Nt.style.left=e,this.Ct.width=i,this.Ct.height=s,this.Ct.style.top=h,this.Ct.style.left=e,this.Bt&&(clearTimeout(this.Yt),this.Yt=setTimeout((()=>this.Lt()),100))},Zt(t,s,i){t.translate(i.x,i.y),t.rotate(s),t.translate(-i.x,-i.y)},Vt(t,s,i,h){t.translate(h.x,h.y),t.scale(s,i),t.translate(-h.x,-h.y)},zt(){this.Bt?this.unpause():this.pause()},unpause(){this.Bt&&(this.Bt=!1,this.A())}},h.Xt=class{constructor(t,s=0){this.level=t,this.set(s)}jt(){return this.level.qt>this.timeEnd}Qt(){return Math.min(1,1-(this.timeEnd-this.level.qt)/this.duration)}set(t){this.duration=t*h.h,this.timeEnd=this.level.qt+this.duration}},h.k=class{constructor(){this.Jt=!1,this.It={},this.qt=0,this.$t=[],this.ts=[],this.items=[],this.ss={p1:null,p2:null}}hs(t,s){if(h.g.bt(t),t.es||t.ns)t.update(s);else{h.m.et(h.m.K.v,!0)?t.rs():h.m.et(h.m.K.I,!0)&&t.attack();let i=h.m.ht();i=new h.D(i.x,i.y),t.update(s,i.normalize());const e=t.os();this.items.forEach((s=>{s.cs=!1,s.us&&h.T(s.os(),e)&&(s.cs=!0,h.m.et(h.m.K.H,!0)&&t.ls(s))}))}}ds(...t){this.ts.push(...t),this.fs(...t)}ws(...t){this.items.push(...t),this.fs(...t)}fs(...t){t.forEach((t=>t.level=this)),this.$t.push(...t)}removeItem(t){let s=this.items.indexOf(t);s>=0&&this.items.splice(s,1),s=this.$t.indexOf(t),s>=0&&this.$t.splice(s,1)}Kt(){this.ps&&this.ps(h.g.Ft),this.$t.forEach((t=>t.Kt(h.g.Ft))),this.gs&&this.gs(h.g.Ft),this.Jt&&h.g.St()}update(t){if(this.qt+=t,this.Jt)h.m.et(h.m.K.C,!0)&&h.g.Wt();else{const s=this.ss.p1;if(s){if(s.ys<=0)return void(this.Jt=!0);this.hs(s,t)}this.$t.sort(((t,s)=>t.xs()-s.xs())),this.$t.forEach((i=>{i!==s&&(i.update(t),s?.ns&&i.ys>0&&i.Es()&&s.item.Ms(i)&&i.ks(s.item),i.action||h.Ts.As(i,s))}))}}},h._s=class{constructor(t={}){this.bs=new h.D(t.x,t.y),this.w=t.w||0,this._=t._||0,this.Ds=0,this.Is=null,this.Fs={},this.us=!1,this.vs=[],this.Ks=new h.D(1,0),this.Ss=1/0,this.ys=1/0,this.cs=!1,this.level=null,this.speed=new h.D,this.state=h.l}Cs(t){for(let s=this.vs.length-1;s>=0;s--){(0,this.vs[s])(t)&&this.vs.splice(s,1)}}Es(){return(!this.Is||this.Is.jt())&&!this.es}Kt(t){}os(){return{x:this.bs.x,y:this.bs.y,w:this.w,_:this._}}Dt(){return{x:this.bs.x+this.w/2,y:this.bs.y+this._/2}}Ls(t,s,i){return this.Fs.Hs||(this.bs.x+=Math.round(s*t.x*this.speed.x),this.bs.y+=Math.round(s*t.y*this.speed.y),(t.x||t.y)&&(i=h.p,this.Ks.set(0==t.x?this.Ks.x:t.x>0?1:-1,0==t.y?this.Ks.y:t.y>0?1:-1))),i}xs(){return this.bs.y+this._}ks(t){if(!this.Es())return;this===this.level.ss.p1&&h.Audio.play(h.Audio.F),this.Is=this.Is||new h.Xt(this.level),this.Is.set(.5),this.ys=Math.max(0,this.ys-t.Ns);const s=t.Ps(this);s&&this.vs.push(s),this.ys<=0&&this.Rs()}update(t,s){if(this.ys<=0||this.Gs)return;let i=h.l;this.Ds+=t,this.Cs(t),s&&(i=this.Ls(s,t,i)),this.state!=i&&(this.Ds=0),this.state=i}},h.Os=class extends h._s{constructor(t={}){t.w=h.o,t._=h.o,super(t),this.Us=42/h.h,this.action=null,this.Bs=null,this.ns=!1,this.Ss=100,this.ys=100,this.item=t.item,this.speed.set(12,12),this.item&&(this.item.Gs=this)}zs(t,s){h.g.Vt(t,s,1,this.Dt())}Ws(t){h.g.Zt(t,.1*Math.sin(this.Ds*this.Us),this.Dt())}Ys(t){if(this.ys==this.Ss||this.es)return;let s=this.ys/this.Ss,i=this.bs.x+16,h=this.bs.y-24,e=this.w-32;t.fillStyle="#000",t.fillRect(i,h,e,8),t.fillStyle="#f00",t.fillRect(i,h,e*s,8)}Zs(t,s){const i=this.Ks.x<0;i&&this.zs(t,-1),this.item?.Kt(t,s),i&&this.zs(t,-1)}Vs(t){t.drawImage(h.g.Ot,this.bs.x,this.bs.y+this._-12,this.w,24)}attack(){this.ns||this.es||!this.item||(h.Audio.play(h.Audio.I),this.Bs=this.Bs||new h.Xt(this.level),this.Bs.set(this.item.Xs),this.ns=!0)}rs(){this.es||(h.Audio.play(h.Audio.v),this.js=this.js||new h.Xt(this.level),this.js.set(.5),this.es=!0)}Kt(t){if(this.ys<=0)return;let s=this.qs+(this.Ks.x<0?16:0),i=h.g.images;if(this.Vs(t),this.es){let s=360*this.js.Qt()*3*Math.PI/180;this.Ks.x<0&&(s=-s),h.g.Zt(t,s,this.Dt())}else{if(this.Is&&!this.Is.jt()){const t=this.Is.Qt();(t>=0&&t<=.2||t>=.4&&t<=.6||t>=.8&&t<=1)&&(i=h.g.Rt)}this.state===h.p&&this.Ws(t)}this.item&&this.Zs(t,i),this.Ys(t),t.drawImage(i,s,this.Qs,this.Js,this.$s,this.bs.x,this.bs.y,h.o,h.o),h.g.resetTransform()}Rs(){this.item?.ti(),this.ys>0?(this.item=new h.si,this.item.Gs=this):this.item=null}os(){const t={x:this.bs.x,y:this.bs.y+this._,w:this.w,_:h.u/2};return t.y-=t._,t}ls(t){t.Gs||(this.item?.ti(),this.item=t,t.cs=!1,t.Gs=this,this.level.removeItem(t))}update(t,s){if(this.ys<=0)return;let i=h.l;this.Ds+=t,this.Cs(t),s&&(i=this.Ls(s,t,i)),this.action&&(i=this.action(t)||i),this.state!=i&&(this.Ds=0),this.ns&&this.Bs.jt()&&(this.ns=!1),this.es&&(this.js.jt()?this.es=!1:(s=new h.D(this.Ks.x<0?-1:1,0),this.Ls(s,t,i))),this.level&&(this.bs.x=Math.min(this.level.It.w-this.w,Math.max(0,this.bs.x)),this.bs.y=Math.min(this.level.It._-this._-8,Math.max(-h.u,this.bs.y))),this.state=i}},h.Ts={ii(t,s){if(t.ns||!t.item)return!1;if(t.item.Ms(s)){const i=new h.Xt(t.level,.3);return t.action=function(){i.jt()&&(t.ns&&t.Bs&&t.Bs.jt()?t.action=null:t.ns||(t.attack(),s.ks(t.item)))},!0}return!1},hi(t){if(t.item&&!(t.item instanceof h.si))return!1;let s=1/0,i=null,e=null;const n=t.Dt(),r=t.os(),o=new h.D;for(let a=0;a<t.level.items.length;a++){const c=t.level.items[a];if(c instanceof h.ei){const a=c.os();if(h.T(a,r)){const s=new h.Xt(t.level,.5);return t.action=function(){s.jt()&&(t.ls(c),t.action=null)},!0}o.set(a.x+a.w/2-n.x,a.y+a._/2-n.y);const u=o.length();u<3*h.o&&s>u&&(s=u,i=o.clone(),e=c)}}if(!e)return!1;const a=new h.Xt(t.level,1);return i.normalize(),t.action=function(s){if(a.jt())t.action=null;else if(!t.Fs.Hs)return t.Ls(i,s,0)},!0},ni(t,s){const i=t.Dt(),e=s.Dt(),n=new h.D(e.x-i.x,e.y-i.y);if(n.length()>5*h.o)return!1;const r=new h.Xt(t.level,1);return n.normalize(),t.action=function(s){if(r.jt())t.action=null;else if(!t.Fs.Hs)return t.Ls(n,s,0)},!0},As(t,s){t instanceof h.ri||!s||t.Fs.Hs||s.ys<=0||this.hi(t)||this.ii(t,s)||this.ni(t,s)}},h.ei=class extends h._s{constructor(t){super(t),this.Gs=null}oi(t){const s=this.os();t.strokeStyle="#f00",t.lineWidth=2,t.strokeRect(s.x,s.y,s.w,s._)}ai(){this.Gs&&this.bs.set(this.Gs.bs.x+this.Gs.w/2,this.Gs.bs.y-this.Gs._)}ti(){this.us&&(this.ai(),this.Gs?.level.ws(this)),this.Gs=null}Ps(){return null}xs(){return this.bs.y}},h.ci=class extends h.Os{constructor(t){super(t),this.qs=0,this.Qs=32,this.Js=16,this.$s=16,this.Us=32/h.h,this.speed.set(3,3)}ks(t){this.ys<=0||super.ks(t)}},h.ri=class extends h.ci{constructor(t){super(t),this.qs=0,this.Qs=48,this.Js=16,this.$s=16}Rs(){this.item?.ti(),this.item=null}ks(t){this.ys<=0||super.ks(t)}},h.ui=class extends h.Os{constructor(t){super(t),this.qs=0,this.Qs=16,this.Js=16,this.$s=16}},h.si=class extends h.ei{constructor(t={}){super(t),this.Xs=.15,this.Ns=10}Ms(t){if(!this.Gs)return!1;const s={x:this.Gs.bs.x+this.Gs.w,y:this.Gs.bs.y+h.u/2,w:h.u,_:h.u};this.Gs.Ks.x<0&&(s.x-=this.Gs.w+s.w);const i={x:t.bs.x,y:t.bs.y,w:t.w,_:t._};return h.T(i,s)}Kt(t,s){let i=this.bs.x,e=this.bs.y;if(this.Gs&&(i=this.Gs.bs.x+this.Gs.w-32,e=this.Gs.bs.y+this.Gs._/2-16),this.Gs.ns){const t=Math.sin(this.Gs.Bs.Qt()*Math.PI*2)*h.u;i+=Math.max(0,t)}t.drawImage(s||h.g.images,40,16,8,8,i,e,h.u,h.u)}Ps(t){if(t instanceof h.Os)return function(){return t.Rs(),!0}}},h.li=class extends h.ei{constructor(t={}){t.w=h.u,t._=2*h.o,super(t),this.Xs=.25,this.us=!0,this.Ns=34}ai(){this.Gs&&this.bs.set(this.Gs.bs.x+this.Gs.w/2,this.Gs.bs.y-this.Gs._+this._/2)}Ms(t){if(!this.Gs)return!1;const s=[{x:this.Gs.bs.x+this.Gs.w,y:this.Gs.bs.y,w:1.7*h.o,_:h.o},{x:this.Gs.bs.x+this.Gs.w,y:this.Gs.bs.y-.7*h.o,w:h.o,_:2.4*h.o}];this.Gs.Ks.x<0&&(s[0].x-=this.Gs.w+s[0].w,s[1].x-=this.Gs.w+s[1].w);const i={x:t.bs.x,y:t.bs.y,w:t.w,_:t._};for(let t=0;t<s.length;t++)if(h.T(i,s[t]))return!0;return!1}Kt(t,s){let i=this.bs.x,e=this.bs.y;this.Gs&&(i=this.Gs.bs.x+h.u,e=this.Gs.bs.y-h.o-16);let n=0,r={x:i+this.w/2,y:e+this._/2};if(this.Gs){if(this.Gs?.ns){r.x=i+h.o/4,r.y=e+2*h.o;let t=this.Gs.Bs.Qt();const s=Math.PI;t<=.4?(t/=.4,n=t*s):n=t<=.8?s:0}}else n=80*Math.PI/180;n&&h.g.Zt(t,n,r),t.drawImage(s||h.g.images,32,16,8,32,i,e,h.u,2*h.o),n&&this.Gs?.ns&&h.g.Zt(t,-n,r),this.Gs||(h.g.resetTransform(),this.cs&&this.oi(t))}Ps(t){if(!(t instanceof h.Os))return;const s=t.bs.clone(),i=this.Gs.Dt(),e=t.Dt(),n=new h.D(e.x-i.x,e.y-i.y);n.normalize();const r=new h.Xt(this.Gs.level,.3),o=1.5*h.o;return t.Fs.Hs=!0,function(){if(r.jt())return t.Fs.Hs=!1,!0;const i=r.Qt();return t.bs.set(s.x+n.x*o*i,s.y+n.y*o*i),!1}}os(){return{x:this.bs.x-1.5*this.w,y:this.bs.y+1.5*this.w,w:this._,_:this.w}}},h.k.di=class extends h.k{constructor(){super(),this.fi=0,this.wi=2}pi(t,s,i,e,n){if(n){let s=h.u/2,n=h.o,r=i-96,o=e-n/2,a={x:r+s/2,y:o+n/2};h.g.Zt(t,Math.PI/2,a),h.g.Vt(t,Math.sin(.08*this.qt),1,a),t.drawImage(h.g.images,32,16,8,32,r,o,s,n),h.g.resetTransform()}t.fillStyle=n?"#fa0":"#777",t.textBaseline="middle",t.fillText(s,i,e)}Kt(){const t=h.g.Ft;let s=Math.max(2*h.o,h.g.Mt.x-500),i=Math.max(2*h.o,h.g.Mt.y-128);t.fillStyle="#0d161e",h.g.Ht(),t.font="bold 64px "+h.i,t.textAlign="left",t.fillStyle="#fa0",t.fillText("TREASURE OF THE NIBELUNGS",s,i+3),t.fillStyle="#777",t.fillText("TREASURE OF THE NIBELUNGS",s,i),t.font="42px "+h.i,s+=h.u/2+114,i+=96,this.pi(t,"New Game",s,i,0===this.fi),i+=72,this.pi(t,"Continue",s,i,1===this.fi)}update(t){this.qt+=t,h.m.et(h.m.K.P,!0)?this.fi--:h.m.et(h.m.K.G,!0)?this.fi++:h.m.et(h.m.K.C,!0)&&(h.Audio.play(h.Audio.SELECT),0===this.fi&&(h.g.level=new h.k.mi)),this.fi<0?this.fi=this.wi-1:this.fi>=this.wi&&(this.fi=0)}},h.k.M=class extends h.k{constructor(){super(),this.It={w:30*h.o,_:8*h.o};const t=new h.ui({x:3*h.o,y:3*h.o,item:new h.si}),s=new h.ri({x:14*h.o,y:3*h.o,item:new h.li});this.ds(t,s),this.ss.p1=t,this.gi=s;const i=h.g.Ft.createLinearGradient(0,0,0,h.g.Nt.height/h.g.scale);i.addColorStop(0,"#0003"),i.addColorStop(1,"#0000"),this.yi=i,this.xi=0}Kt(){super.Kt();const t=h.g.Ft;t.font="32px "+h.i,t.fillStyle="#fff7",t.textAlign="center";const s=this.ss.p1,i=s.Dt(),e=this.gi.Dt();0===this.xi?t.fillText("Move with [W][A][S][D] or arrow keys",i.x,i.y-s._):1===this.xi?t.fillText("Attack with [Enter]",e.x,e.y-2*this.gi._):2===this.xi?t.fillText("Pick up with [E]",e.x,e.y-this.gi._):3===this.xi?t.fillText("Attack with the sword",e.x,e.y-this.gi._):4===this.xi?t.fillText("You can dodge roll with [R]",i.x,i.y-s._):5===this.xi&&t.fillText("Your training is complete! Continue on...",i.x,i.y-s._)}ps(t){t.fillStyle="#273325",h.g.Ht(),t.fillStyle="#2e5e26",t.fillRect(0,0,this.It.w,this.It._),t.fillStyle="#a58d2c",t.fillStyle=this.yi,h.g.Ht()}update(t){const s=this.ss.p1,i=h.m;if(0===this.xi)(i.et(i.K.P)||i.et(i.K.R)||i.et(i.K.G)||i.et(i.K.N))&&(this.xi=1);else if(1===this.xi)this.gi.item instanceof h.li||(this.xi=2);else if(2===this.xi)s.item instanceof h.li&&(this.xi=3);else if(3===this.xi)this.gi.ys<this.gi.Ss-s.item.Ns&&(this.xi=4);else if(4===this.xi)i.et(i.K.v)&&(this.xi=5,this.It.w=50*h.o);else if(5===this.xi){if(s.Dt().x>=this.It.w-2*h.o)return void(h.g.level=new h.k.Ei)}super.update(t)}},h.k.mi=class extends h.k{constructor(){super(),this.Mi=["Ez enwas niht anders","wan gestéinẹ unde golt.","unt ob man al die werlde","het dâ von versolt,","sîn wǽré niht mínner","einer marke wert."],this.ki=["Ê daz der künee rîche","wider wære komen,","die wîle hete Hagene","den schaz vil gar genomen.","","er sanctẹ in dâ ze Lôche","allen in den Rîn.","er wandẹ er soldẹ in niezen:","des enkunde niht gesîn."],this.Ai=["The legendary treasure of the Nibelungs:","Gems and gold more than one could ever hope to spent.","","While the king and his men where away, Hagen stole it","all and sunk the treasure in the Rhine at Lochheim.","But he was killed before being able to retrieve the riches.","","Betting on its the existance,","many set off to look for the treasure."],this.Ti=0,this._i=new h.Xt(this,2);this.Mi.concat(this.ki).forEach((t=>{const s=h.g.Ft.measureText(t);this.Ti=Math.max(this.Ti,s.width)}))}Kt(){const t=h.g.Ft;t.fillStyle="#0d161e",h.g.Ht();let s=2*h.o,i=s,e=this.Ti+h.o,n=49*(this.Mi.length+this.ki.length)+1.5*h.o+16;if(t.fillStyle="#e5c382",t.fillRect(s-h.u,i-h.o,e,n),t.font='italic 40px "Times New Roman", serif',t.textAlign="center",t.fillStyle="#000",s+=this.Ti/2,!this._i.jt()){const s=this._i.Qt();i+=(1-s)*h.u,t.fillStyle="#000000"+Math.round(255*s).toString(16).padStart(2,"0")}if(this.Mi.forEach((h=>{t.fillText(h,s,i),i+=49})),this._i.jt()){if(i+=49,!this.bi.jt()){const s=this.bi.Qt();i+=(1-s)*h.u,t.fillStyle="#000000"+Math.round(255*s).toString(16).padStart(2,"0")}this.ki.forEach((h=>{t.fillText(h,s,i),i+=49}))}if(this.bi?.jt()){const n=this.Di.Qt();if(s=e+2.5*h.o,i=2*h.o+(1-n)*h.u,t.font="32px "+h.i,t.textAlign="left",t.fillStyle="#ffffff"+Math.round(255*n).toString(16).padStart(2,"0"),this.Ai.forEach((h=>{t.fillText(h,s,i),i+=49})),this.Di.jt()){i+=49;let e=h.u/2,n=h.o,r=s+n/2,o=i-n/2,a={x:r+e/2,y:o+n/2};h.g.Zt(t,Math.PI/2,a),h.g.Vt(t,Math.sin(.08*this.qt),1,a),t.drawImage(h.g.images,32,16,8,32,r,o,e,n),h.g.resetTransform(),t.font="32px "+h.i,t.fillStyle="#fa0",t.textBaseline="middle",t.fillText("Continue",s+n+32,i)}}}update(t){this.qt+=t,this._i.jt()&&!this.bi?this.bi=new h.Xt(this,2):this.bi&&this.bi.jt()&&!this.Di&&(this.Di=new h.Xt(this,2)),h.m.et(h.m.K.C,!0)&&(this._i.jt()?this.bi&&!this.bi.jt()?this.bi.set(0):this.Di&&!this.Di.jt()?this.Di.set(0):(h.Audio.play(h.Audio.SELECT),h.g.level=new h.k.Ei):this._i.set(0))}},h.k.Ei=class extends h.k{constructor(){super(),this.Ii=24,this.It={w:h.o*this.Ii,_:8*h.o};const t=new h.ui({x:300,y:400,item:new h.si}),s=new h.ci({x:800,y:400,item:new h.li});s.Ks.x=-1,this.ds(t,s);const i=new h.li({x:400,y:540});this.ws(i),this.ss.p1=t}ps(t){const s=h.g;t.fillStyle=s.Gt,t.translate(-this.Fi,0),s.Ht(),t.translate(this.Fi,0),this.vi&&t.drawImage(this.vi,-h.o/16,-h.o),t.fillStyle="#5a3c2e",t.strokeStyle="#8f563b",t.lineWidth=h.o/16;let i=t.lineWidth/2;t.strokeRect(-i,-i,this.It.w+t.lineWidth,this.It._),t.fillRect(-t.lineWidth,this.It._,this.It.w+2*t.lineWidth,h.o);for(let i=0;i<this.Ii;i++)for(let e=0;e<8;e++){let n=i*h.o,r=e*h.o;t.drawImage(s.images,0,0,16,16,n,r,h.o,h.o)}const e=h.g.Ft.createLinearGradient(0,0,0,this.It._);e.addColorStop(0,"#0002"),e.addColorStop(1,"#fff1"),t.fillStyle=e,t.fillRect(0,0,this.It.w,this.It._)}gs(t){const s=h.o/16;for(let s=0;s<=this.Ii;s++)t.drawImage(h.g.images,32,0,16,16,s*h.o-this.Fi,this.It._,h.o,h.o);if(this.vi)t.drawImage(this.vi,-s,this.It._-1.5*h.u);else{const t=3*s+this.It.w,i=h.o,[e,n]=h.g._t(t,i);n.fillStyle="#5a3c2e",n.lineWidth=s,n.fillRect(0,0,this.It.w+2*n.lineWidth,10);const r=(this.It.w+2*n.lineWidth)/h.o;for(let t=0;t<=r;t++)n.fillRect(t*h.o,0,12,h.o);this.vi=e}}update(t){super.update(t),this.Fi=this.qt%25/25*h.o}},h.k.Ki=class extends h.k{constructor(){super()}};